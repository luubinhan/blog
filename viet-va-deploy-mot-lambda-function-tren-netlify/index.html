<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Viết và Deploy một Lambda Function trên Netlify - VuiLapTrinh.com</title><meta name="gridsome:hash" content="be9cd8cba7af086bce31a0a023c14cacaa870421"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="A simple, hackable &amp; minimalistic starter for Gridsome that uses Markdown for content."><meta data-vue-tag="ssr" name="desc" content=""><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.9ab035e6.css" as="style"><link rel="preload" href="/assets/js/app.44ac298f.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.905a5c02.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.1906fe28.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.83bbacb6.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.615124f8.js"><link rel="stylesheet" href="/assets/css/0.styles.9ab035e6.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text">
    ← VuiLapTrinh.com
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">Viết và Deploy một Lambda Function trên Netlify</h1><div class="post-meta">
   Posted 2020-01-10.
   <strong>3 min read.</strong></div></div><div class="post content-box"><div class="post__header"><!----></div><div class="post__content"><h2 id="lambda-function-là-gì"><a href="#lambda-function-l%C3%A0-g%C3%AC" aria-hidden="true"><span class="icon icon-link"></span></a>Lambda function là gì?</h2>
<p>Giải thích về Serverless bạn đọc bài trước có đăng</p>
<p>Nếu bạn chỉ có một trang blog như thế này, viết bằng Gatsby, không có backend làm sao bạn có thể có được tính năng cho phép user đăng ký nhận bản tin? Ví dụ dùng dịch vụ của MailChimp đi.</p>
<p>Chúng ta ko thể đưa API key vào trang frontend được, hiển nhiên quá mà! Ai cũng có thể lấy được cái key này thì sao.</p>
<p>Chúng ta phải thông qua một bên ở giữa, là Lambda function trên Netlify, chúng ta đưa key này cho Netlify, nó sẽ có trách nhiệm bảo mật key này và truyền thông tin tới MailChimp</p>
<p>Chữ Lambda được <strong>phát minh</strong> đầu tiên bởi Amazon AWS, sau này Netlify cũng dùng luôn tên này, nó là kiểu các <em>hàm trung gian</em>, giúp chúng ta giao tiếp với phía server (vì đây là dạng serverless, chúng ta dùng dịch vụ của nó cung cấp, giống như vua chúa, nếu muốn giao tiếp với anh thì chú cứ thông qua thái dám, họ sẽ truyền tin tới cho anh)</p>
<p>Cứ dùng trang mặc định của Gatsby</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540301648/sv9k9cv1zdtr4ebqpr09.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Tạo một thư mục bên trong source code, nó sẽ chứa toàn bộ các hàm sẽ giao tiếp với Lambda. Thư mục này đặt đâu cũng được, cứ đặt vào dưới thư mục gốc tên <code class="language-text">functions</code></p>
<blockquote>
<p>Mỗi file chỉ chứa 1 function</p>
</blockquote>
<p>test.js</p>
<pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span></code></pre>
<p>Mỗi function sẽ nhận 3 parameter </p>
<ul>
<li><code class="language-text">event</code>: chứa post data, header</li>
<li><code class="language-text">context</code>: function này được call ở đâu, thông tin user hiện tại</li>
<li><code class="language-text">callback</code>: hàm callback thôi, hàm này nhận param đâu tiền là error nếu có lỗi</li>
</ul>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540301809/exdwztr8lfepei1x88ux.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<h2 id="chạy-các-function-lambda-ở-local"><a href="#ch%E1%BA%A1y-c%C3%A1c-function-lambda-%E1%BB%9F-local" aria-hidden="true"><span class="icon icon-link"></span></a>Chạy các function Lambda ở local</h2>
<p>Cần cài <code class="language-text">netlify-lambda</code> để chạy test dưới local </p>
<pre class="language-js"><code class="language-js">npm install netlify<span class="token operator">-</span>lambda</code></pre>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540301932/y8uyqgcmxa8i9sczpljo.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<pre class="language-powershell"><code class="language-powershell">netlify<span class="token operator">-</span>lambda serve &lt;functions_directory></code></pre>
<p><code class="language-text">&lt;functions_directory&gt;</code> là thư mục chứa mấy function chúng ta viết</p>
<p>Thêm đoạn <em>shortcut</em> vào trong package.json để chạy lệnh này</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540302074/xnpujx0smgs1ftul0hr2.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Bước cuối cùng cần làm, tạo file config để báo với Netlify, đây không phải là thư mục chứa source code của chúng ta, đây là thư mục sau khi build. Tạo file <code class="language-text">Netlify.toml</code> trong thư mục gốc</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540302243/gzlbxxtidpi0lukcxmmy.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Sau khi build, file bên trong <code class="language-text">functions</code> sẽ được đưa vào thư mục tên <code class="language-text">lambda</code></p>
<p>Chạy lại đoạn script <em>shortcut</em> hồi nãy khai báo <code class="language-text">npm run start:lambda</code>, bên dưới hình này đoạn chạy bị lỗi là khi chưa tạo file <code class="language-text">Netlify.toml</code>, chúng ta bắt buộc phải tạo file này trước khi chạy</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540302301/vyr4hwlxacgkhvkvhzdn.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Mở Postman lên gọi test thử</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540302549/jblo4vceh9ylxxipnct8.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Function đầu tiên đã chạy thành công!!!</p>
<p>Chúng ta truyền thêm một object <code class="language-text">{ &quot;name&quot; : &quot;James&quot; }</code>, và muốn nhận được một JSON object thay vì là một <code class="language-text">string</code>. Muốn vậy trong phần body chúng ta phải gọi <code class="language-text">JSON.stringify</code></p>
<pre class="language-js"><code class="language-js"><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    statusCode<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    body<span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token string">"Thanks for visiting "</span> <span class="token operator">+</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// nếu không nhận được name= james</span>

<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"You're not James"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540303047/s7lrt4qmn8svganfbd6s.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Test trên Postman</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540303082/gmlkczsp2hhlasrrko2d.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Trường hợp phát sinh lỗi</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540303092/y1uu9ipfgy0rq6p3mtwr.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<h2 id="deploy-lên-netlify"><a href="#deploy-l%C3%AAn-netlify" aria-hidden="true"><span class="icon icon-link"></span></a>Deploy lên Netlify</h2>
<p>Nãy giờ chúng ta đang chạy các Lambda function ở dưới local bằng lệnh <code class="language-text">serve</code>,  để đưa lên Netlify, chúng ta cần <code class="language-text">build</code> source code trước khi đẩy lên Netlify</p>
<p>Chúng ta phải setup chạy 2 script, một để build Gatsby, sau đó build mấy functions lambda</p>
<pre class="language-json"><code class="language-json"><span class="token property">"props"</span><span class="token operator">:</span> <span class="token string">"npm run build; npm run build:lambda"</span></code></pre>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540315111/hv7omcr0angknnup175q.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Lưu ý: do đang dùng gatsby, nên cần 2 lệnh này, nếu bạn dùng một thằng khác, thì lệnh sẽ khác, tuy cách setup</p>
<p>Phải cập nhập lại <strong>Netlify.toml</strong>, chúng ta sẽ báo với Netlify: "Ê, khi nào tao chạy xong <code class="language-text">prop</code>, thì mày deploy nhe"</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540315122/lytjmmofmjjgixzxycwo.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Sau khi commit lên Github, Netlify sẽ bắt đầu trigger deploy, vào trang chính của Netlify, trong tab <strong>Deployment</strong>, bạn có theo dõi xem nó đang deploy tới đâu rồi</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540315158/kulpc3u2tqftgxijpr6c.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Sau khi deploy thành công, bạn có thể chuyển qua tab <strong>Function</strong>, các function nào đã có sẽ được liệt kê ở đây</p>
<p><img src="https://scotch-res.cloudinary.com/image/upload/dpr_1,w_800,q_auto:good,f_auto/v1540315181/nblkoi0l6shvdvvybtje.png" alt="Viết và Deploy một Lambda Function trên Netlify"></p>
<p>Cơ bản là thế thôi, các bạn có thể làm <em>"mọi thứ"</em> với function mình viết (miễn là nó có cho), như gửi email, lưu dữ liệu xuống DB, gọi một API</p>
<p><a href="https://scotch.io/tutorials/build-and-deploy-a-serverless-function-to-netlify" target="_blank" rel="nofollow noopener noreferrer">https://scotch.io/tutorials/build-and-deploy-a-serverless-function-to-netlify</a></p>
</div><div class="post__footer"><div class="post-tags"><a href="/tag/netlify/" class="post-tags__link"><span>#</span> netlify
		</a><a href="/tag/thu-thuat/" class="post-tags__link"><span>#</span> thu-thuat
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-52311ff214b737f722259e901102d6b3'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-52311ff214b737f722259e901102d6b3)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAQUBAQEAAAAAAAAAAAAABwEDBAUGCAAC/8QAMxAAAQMCAwcBBgYDAAAAAAAAAQIDEQAEBRIhBhMxQVFhcQciIzJCgbEIFDORodEWgsH/xAAZAQEBAQEBAQAAAAAAAAAAAAAEAwUGAAH/xAAhEQABBAMAAgMBAAAAAAAAAAABAAIDEQQSISJBBRNRMf/aAAwDAQACEQMRAD8A6Pr1fOalmvLyUAk6AnxS5VROUx4oR%2bvmPXNjZYbhti48DcKUt9LRIJAHsgkaxMmO1ByzxnG8PeQ/a3d5bOIIUVJdUOHMifvWjB8c6aMP2q0CfPbC/TW119SVz9YetmOMLYRfWWH3TaSA4pKVNrWOuhgH6UYtkNrsK2stFvYU65nbjesOpyrbnhPIjuKhPhSwDZw4qw5kU5ph6r%2blpCYFNOLKflV5o1JSXMkDlS5xy1qtDo4mfrWe2/xhWEbJ3t400%2b6oZWyGpkBRiTGoSNJj/tVbEXEN/VMyAC1iPUTaS2xjG3bO3IS3ay2HNJc1lR6xPDx3oa4g0RvVlQcSfhFRLrEF3V0LpSAh10layOMzw7eKl3jqLhxsxLaRw4610MUYiAa1ZMxMosrPugpJJ0nlwiiJ%2bH69eZ28NulfuX7R0LTOhygKB8yKxWLaWoC0BJKpgfL2rdfh8sV3G1F9iBTLNnalGbkFuEADzAVVMpwOO6/xCx4izJaAuiSsT8UV8KKyBznmKih1J714OqIiCa5jVdJsqk4ggL9oRPSqDbty4/w/GnLVzKPyypBkaEif4p5N2RwA/anlPtvsrafAW0tJStChKVA8QR0p4ZqQQil1ilz5Y5nGloXKkcNev908G8iUoSCUiiHtVhFhhdou6wu2O6JyuNg/pzwUCdY5a8JrAXtwErWi3RmIEZwZE9utaccm/QEVzKVZjVrltN4JyJMqFdGemuz7OzmyFjbBGS5eQLm6PMuLAMf6iE/SgBavuMPNOON75wKC0tr4GDPtdqO%2bxm0i8ew0O3O7RfJnett6J4mCnXhH81DNDzGK/i%2b4/wBbZSb7S1xQ2IIVBHWvb2BAIioBcVxMCml3KgYFZQZadtSzAK460hCpkk%2bBTzahmmnXnRA0APmadsj0ol1uE2T6r5SEWgbO9K%2bARGs0H7stto3luczSyS3mEKUJIBI66VrvUnGWlJZwlKsuaHnjmgafCk/f9qwD6y%2b2pbjhKU%2bylWaJ8dabjxmtne0HInolrVcYThj18w5clKzl1KOZ/sVLRtJ%2bQbQ7akpum/01oEA9c3bvULB8WtGbRYuW1vvBOVtTivm48eVUt9Z3dwpKlIbaZIhJQZEdJq7fJxDxxHcdWgxnvtFbZz1ItsQCWMWyWb8hJcn3ZV3Pyz14eK2e9WpUBJoGYHhVpmCQyCtTZBMaHz1oq7DYxvmBh11IeZT7pR%2bZA5eR9vFCyoGs8owm4sz38kK//9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" data-srcset="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript><!----><p class="author__intro">Hiện tại site đang nâng cấp, các bạn xài tạm</p></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2020. </span><span class="footer__links">Powered by <a href="//gridsome.org"> Gridsome </a></span></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Viết và Deploy một Lambda Function trên Netlify","path":"\u002Fviet-va-deploy-mot-lambda-function-tren-netlify\u002F","date":"2020-01-10","timeToRead":3,"tags":[{"id":"netlify","title":"netlify","path":"\u002Ftag\u002Fnetlify\u002F"},{"id":"thu-thuat","title":"thu-thuat","path":"\u002Ftag\u002Fthu-thuat\u002F"}],"desc":"","content":"\u003Ch2 id=\"lambda-function-là-gì\"\u003E\u003Ca href=\"#lambda-function-l%C3%A0-g%C3%AC\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ELambda function là gì?\u003C\u002Fh2\u003E\n\u003Cp\u003EGiải thích về Serverless bạn đọc bài trước có đăng\u003C\u002Fp\u003E\n\u003Cp\u003ENếu bạn chỉ có một trang blog như thế này, viết bằng Gatsby, không có backend làm sao bạn có thể có được tính năng cho phép user đăng ký nhận bản tin? Ví dụ dùng dịch vụ của MailChimp đi.\u003C\u002Fp\u003E\n\u003Cp\u003EChúng ta ko thể đưa API key vào trang frontend được, hiển nhiên quá mà! Ai cũng có thể lấy được cái key này thì sao.\u003C\u002Fp\u003E\n\u003Cp\u003EChúng ta phải thông qua một bên ở giữa, là Lambda function trên Netlify, chúng ta đưa key này cho Netlify, nó sẽ có trách nhiệm bảo mật key này và truyền thông tin tới MailChimp\u003C\u002Fp\u003E\n\u003Cp\u003EChữ Lambda được \u003Cstrong\u003Ephát minh\u003C\u002Fstrong\u003E đầu tiên bởi Amazon AWS, sau này Netlify cũng dùng luôn tên này, nó là kiểu các \u003Cem\u003Ehàm trung gian\u003C\u002Fem\u003E, giúp chúng ta giao tiếp với phía server (vì đây là dạng serverless, chúng ta dùng dịch vụ của nó cung cấp, giống như vua chúa, nếu muốn giao tiếp với anh thì chú cứ thông qua thái dám, họ sẽ truyền tin tới cho anh)\u003C\u002Fp\u003E\n\u003Cp\u003ECứ dùng trang mặc định của Gatsby\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540301648\u002Fsv9k9cv1zdtr4ebqpr09.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ETạo một thư mục bên trong source code, nó sẽ chứa toàn bộ các hàm sẽ giao tiếp với Lambda. Thư mục này đặt đâu cũng được, cứ đặt vào dưới thư mục gốc tên \u003Ccode class=\"language-text\"\u003Efunctions\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EMỗi file chỉ chứa 1 function\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003Etest.js\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003Eexports\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method-variable function-variable method function property-access\"\u003Ehandler\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Eevent\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E context\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E callback\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EMỗi function sẽ nhận 3 parameter \u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003Eevent\u003C\u002Fcode\u003E: chứa post data, header\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003Econtext\u003C\u002Fcode\u003E: function này được call ở đâu, thông tin user hiện tại\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003Ecallback\u003C\u002Fcode\u003E: hàm callback thôi, hàm này nhận param đâu tiền là error nếu có lỗi\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540301809\u002Fexdwztr8lfepei1x88ux.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"chạy-các-function-lambda-ở-local\"\u003E\u003Ca href=\"#ch%E1%BA%A1y-c%C3%A1c-function-lambda-%E1%BB%9F-local\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EChạy các function Lambda ở local\u003C\u002Fh2\u003E\n\u003Cp\u003ECần cài \u003Ccode class=\"language-text\"\u003Enetlify-lambda\u003C\u002Fcode\u003E để chạy test dưới local \u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003Enpm install netlify\u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003Elambda\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540301932\u002Fy8uyqgcmxa8i9sczpljo.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-powershell\"\u003E\u003Ccode class=\"language-powershell\"\u003Enetlify\u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003Elambda serve &lt;functions_directory\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Ccode class=\"language-text\"\u003E&lt;functions_directory&gt;\u003C\u002Fcode\u003E là thư mục chứa mấy function chúng ta viết\u003C\u002Fp\u003E\n\u003Cp\u003EThêm đoạn \u003Cem\u003Eshortcut\u003C\u002Fem\u003E vào trong package.json để chạy lệnh này\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540302074\u002Fxnpujx0smgs1ftul0hr2.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EBước cuối cùng cần làm, tạo file config để báo với Netlify, đây không phải là thư mục chứa source code của chúng ta, đây là thư mục sau khi build. Tạo file \u003Ccode class=\"language-text\"\u003ENetlify.toml\u003C\u002Fcode\u003E trong thư mục gốc\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540302243\u002Fgzlbxxtidpi0lukcxmmy.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESau khi build, file bên trong \u003Ccode class=\"language-text\"\u003Efunctions\u003C\u002Fcode\u003E sẽ được đưa vào thư mục tên \u003Ccode class=\"language-text\"\u003Elambda\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EChạy lại đoạn script \u003Cem\u003Eshortcut\u003C\u002Fem\u003E hồi nãy khai báo \u003Ccode class=\"language-text\"\u003Enpm run start:lambda\u003C\u002Fcode\u003E, bên dưới hình này đoạn chạy bị lỗi là khi chưa tạo file \u003Ccode class=\"language-text\"\u003ENetlify.toml\u003C\u002Fcode\u003E, chúng ta bắt buộc phải tạo file này trước khi chạy\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540302301\u002Fvyr4hwlxacgkhvkvhzdn.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EMở Postman lên gọi test thử\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540302549\u002Fjblo4vceh9ylxxipnct8.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EFunction đầu tiên đã chạy thành công!!!\u003C\u002Fp\u003E\n\u003Cp\u003EChúng ta truyền thêm một object \u003Ccode class=\"language-text\"\u003E{ &quot;name&quot; : &quot;James&quot; }\u003C\u002Fcode\u003E, và muốn nhận được một JSON object thay vì là một \u003Ccode class=\"language-text\"\u003Estring\u003C\u002Fcode\u003E. Muốn vậy trong phần body chúng ta phải gọi \u003Ccode class=\"language-text\"\u003EJSON.stringify\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token function\"\u003Ecallback\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    statusCode\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    body\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EJSON\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Estringify\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E msg\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Thanks for visiting \"\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E name \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F nếu không nhận được name= james\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token function\"\u003Ecallback\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EError\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"You're not James\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540303047\u002Fs7lrt4qmn8svganfbd6s.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ETest trên Postman\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540303082\u002Fgmlkczsp2hhlasrrko2d.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ETrường hợp phát sinh lỗi\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540303092\u002Fy1uu9ipfgy0rq6p3mtwr.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"deploy-lên-netlify\"\u003E\u003Ca href=\"#deploy-l%C3%AAn-netlify\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EDeploy lên Netlify\u003C\u002Fh2\u003E\n\u003Cp\u003ENãy giờ chúng ta đang chạy các Lambda function ở dưới local bằng lệnh \u003Ccode class=\"language-text\"\u003Eserve\u003C\u002Fcode\u003E,  để đưa lên Netlify, chúng ta cần \u003Ccode class=\"language-text\"\u003Ebuild\u003C\u002Fcode\u003E source code trước khi đẩy lên Netlify\u003C\u002Fp\u003E\n\u003Cp\u003EChúng ta phải setup chạy 2 script, một để build Gatsby, sau đó build mấy functions lambda\u003C\u002Fp\u003E\n\u003Cpre class=\"language-json\"\u003E\u003Ccode class=\"language-json\"\u003E\u003Cspan class=\"token property\"\u003E\"props\"\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"npm run build; npm run build:lambda\"\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540315111\u002Fhv7omcr0angknnup175q.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ELưu ý: do đang dùng gatsby, nên cần 2 lệnh này, nếu bạn dùng một thằng khác, thì lệnh sẽ khác, tuy cách setup\u003C\u002Fp\u003E\n\u003Cp\u003EPhải cập nhập lại \u003Cstrong\u003ENetlify.toml\u003C\u002Fstrong\u003E, chúng ta sẽ báo với Netlify: \"Ê, khi nào tao chạy xong \u003Ccode class=\"language-text\"\u003Eprop\u003C\u002Fcode\u003E, thì mày deploy nhe\"\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540315122\u002Flytjmmofmjjgixzxycwo.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESau khi commit lên Github, Netlify sẽ bắt đầu trigger deploy, vào trang chính của Netlify, trong tab \u003Cstrong\u003EDeployment\u003C\u002Fstrong\u003E, bạn có theo dõi xem nó đang deploy tới đâu rồi\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540315158\u002Fkulpc3u2tqftgxijpr6c.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESau khi deploy thành công, bạn có thể chuyển qua tab \u003Cstrong\u003EFunction\u003C\u002Fstrong\u003E, các function nào đã có sẽ được liệt kê ở đây\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fscotch-res.cloudinary.com\u002Fimage\u002Fupload\u002Fdpr_1,w_800,q_auto:good,f_auto\u002Fv1540315181\u002Fnblkoi0l6shvdvvybtje.png\" alt=\"Viết và Deploy một Lambda Function trên Netlify\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ECơ bản là thế thôi, các bạn có thể làm \u003Cem\u003E\"mọi thứ\"\u003C\u002Fem\u003E với function mình viết (miễn là nó có cho), như gửi email, lưu dữ liệu xuống DB, gọi một API\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fscotch.io\u002Ftutorials\u002Fbuild-and-deploy-a-serverless-function-to-netlify\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fscotch.io\u002Ftutorials\u002Fbuild-and-deploy-a-serverless-function-to-netlify\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n","cover_image":""}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.44ac298f.js" defer></script><script src="/assets/js/page--src-templates-post-vue.905a5c02.js" defer></script>
  </body>
</html>