{"hash":"abad1accdeff08a5b295c1ca2179f7b6ebc52b82","data":{"post":{"title":"Vài lưu ý trong React để tránh các vấn đề với bảo mật","path":"/vai-luu-y-trong-react-de-tranh-cac-van-de-voi-bao-mat/","slug":"2020-11-23-10-kinh-nghiem-trong-react-voi-van-de-bao-mat","date":"2020-11-23","timeToRead":2,"tags":[{"id":"thu-thuat","title":"thu-thuat","path":"/tag/thu-thuat/"},{"id":"react","title":"react","path":"/tag/react/"}],"desc":"Một vài điểm nhắc nhẹ các bạn khi đang viết React, để tránh bị dính injection","content":"<p>[TOC]</p>\n<h2 id=\"dùng-data-binding-mặc-định-để-có-xss-protection\"><a href=\"#d%C3%B9ng-data-binding-m%E1%BA%B7c-%C4%91%E1%BB%8Bnh-%C4%91%E1%BB%83-c%C3%B3-xss-protection\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dùng data binding mặc định để có XSS protection</h2>\n<p>Khi render một nội dung dạng <code class=\"language-text\">text</code> bằng kiểu <strong>data binding mặc định</strong> (đặt trong dấu <code class=\"language-text\">{}</code>), React sẽ <strong>mặc định</strong> xử lý để tránh các vấn đề về XSS. Lưu ý một điều là nếu truyền vào cho <code class=\"language-text\">attribute</code> của element thì sẽ không có được tính năng này.</p>\n<p>Mặc định có XSS protection</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>textContent<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Không có XSS protection, nhớ validate thủ công trước</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<h2 id=\"validate-urls-trước-khi-sử-dụng\"><a href=\"#validate-urls-tr%C6%B0%E1%BB%9Bc-khi-s%E1%BB%AD-d%E1%BB%A5ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Validate URLs trước khi sử dụng</h2>\n<p>URLs có thể bị <em>inject</em> một code js bằng <code class=\"language-text\">javascript:</code>. Để <strong>validate</strong> một URL chỉ được phép là một trong 2 dạng <code class=\"language-text\">http:</code> <code class=\"language-text\">https:</code>:</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">validateURL</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> parsed <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'https:'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http:'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>parsed<span class=\"token punctuation\">.</span><span class=\"token property-access\">protocol</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">validateURL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> url <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Click here!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"render-html\"><a href=\"#render-html\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Render HTML</h2>\n<p>Việc render HTML như trên trang chính thức của React cũng đã đề cập, <em>hết sức nguy hiểm</em>, nên luôn phải <strong>sanitized</strong> trước khi render, dùng thư viện <a href=\"https://www.npmjs.com/package/dompurify\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.npmjs.com/package/dompurify</a></p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">purify</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"dompurify\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">dangerouslySetInnerHTML</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token operator\">:</span>purify<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">sanitize</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<h2 id=\"truy-cập-trực-tiếp-đến-dom\"><a href=\"#truy-c%E1%BA%ADp-tr%E1%BB%B1c-ti%E1%BA%BFp-%C4%91%E1%BA%BFn-dom\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Truy cập trực tiếp đến DOM</h2>\n<p>Không được truy cập trực tiếp đến DOM rồi <em>inject</em> thêm vào element nào đó, luôn sử dụng cặp đôi <code class=\"language-text\">dangerouslySetInnerHTML</code> và <code class=\"language-text\">dompurify</code> như ở trên nếu cần chèn nội dung</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">purify</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"dompurify\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">dangerouslySetInnerHTML</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>__html<span class=\"token operator\">:</span>purify<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">sanitize</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>Đừng có làm vậy nghe, dùng <code class=\"language-text\">findDomNode()</code>, rồi <code class=\"language-text\">innerHTML</code> như thời đi học</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">myRef</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">current</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> attackerControlledValue<span class=\"token punctuation\">;</span></code></pre>\n<h2 id=\"kiểm-tra-thư-viện-dependency\"><a href=\"#ki%E1%BB%83m-tra-th%C6%B0-vi%E1%BB%87n-dependency\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kiểm tra thư viện dependency</h2>\n<p>Các thư viện dependency đôi khi cũng rất nguy hiểm, một cách vô tình hay cố ý, dùng những công cụ như là <a href=\"https://www.npmjs.com/package/snyk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">snyk</a> tích hợp với công cụ quản lý code (Github, Gitlab, Bitbucket) để kiểm tra một cách tự động.</p>\n<h2 id=\"json\"><a href=\"#json\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>JSON</h2>\n<p>Việc gửi đi một JSON lên phía server cũng không phải là ít gặp, luôn escape ký tự <code class=\"language-text\">&lt;</code> để tránh bị <em>inject</em></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">__PRELOADED_STATE__</span> <span class=\"token operator\">=</span>   $<span class=\"token punctuation\">{</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>preloadedState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replace</span><span class=\"token punctuation\">(</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">&lt;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\\\\u003c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code></pre>\n<p><a href=\"https://snyk.io/blog/10-react-security-best-practices/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">10 React security best practices</a></p>\n","cover_image":"","related":[{"id":"dc640bd2ebc8ca9fcd4abedd80d3eb53","path":"/cac-van-de-khi-lam-viec-voi-ngay-thang-trong-javascript/","title":"Các vấn đề khi làm việc với ngày tháng trong javascript","desc":"Bỏ túi kỹ năng thiết yếu khi đụng đến xử lý ngày tháng"},{"id":"4f5128f52679191e40ab274c3db1314d","path":"/bao-mat-web-mot-so-kieu-tan-cong/","title":"Bảo mật web - Một số kiểu tấn công","desc":"Tổng quát các vấn đề bạn cần quan tâm để bảo mật ứng dụng web"},{"id":"85b3a0eb256fe8201e3801c756cc5217","path":"/mot-vai-dieu-can-luu-y-khi-ban-lam-viec-voi-js/","title":"Một vài điều cần lưu ý khi bạn làm việc với JS","desc":"Khi bạn làm việc với JS đủ lâu và ăn hành đủ nhiều bạn sẽ cần biết đến những đặc điểm rất riêng của JS"},{"id":"03393afe0d7b5976e9c258595df81919","path":"/tao-mot-animation-cho-component-trong-react/","title":"Tạo một animation cho component trong React","desc":"Sử dụng React, styled-components, react-flip-toolkit để tạo animation giống như mên trên trang chủ của Stripe"}]}},"context":{}}