{"hash":"fb6394b40d1044d313361f8d2119ce59e0069e78","data":{"post":{"title":"Kiểm tra element có nằm trong viewport không bằng javascript","path":"/2019-05-07-huong-dan-xac-dinh-element-nam-trong-viewport/","slug":"/2019-05-07-huong-dan-xac-dinh-element-nam-trong-viewport","date":"2019-05-07","timeToRead":2,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"}],"desc":"Học cách viết một helper function để kiểm tra element nằm trong viewport","content":"<p>\"Nằm trong viewport\" nghĩa là nó đang hiển thị bên trong phần <strong>nhìn thấy được</strong> của trình duyệt, function này cần thiết khi chúng ta cần tới lazy loading, hiệu ứng này kia.</p>\n<p>Phần quan trọng nhất của function này là dùng <code class=\"language-inline-text\">Element.getBoundingClientRect()</code>, nó cho chúng ta giá trị position của element so với viewport. Nó trả về một object chứa <code class=\"language-inline-text\">height</code>, <code class=\"language-inline-text\">width</code>, khoảng cách đến <code class=\"language-inline-text\">top</code>, <code class=\"language-inline-text\">right</code>, <code class=\"language-inline-text\">bottom</code>, <code class=\"language-inline-text\">left</code> với viewport</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// chọn element</span>\n<span class=\"token keyword\">var</span> h1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// lấy position của element trên</span>\n<span class=\"token keyword\">var</span> bounding <span class=\"token operator\">=</span> h1<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bounding<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// {</span>\n<span class=\"token comment\">//  height: 118,</span>\n<span class=\"token comment\">//  width: 591.359375,</span>\n<span class=\"token comment\">//  top: 137,</span>\n<span class=\"token comment\">//  bottom: 255,</span>\n<span class=\"token comment\">//  left: 40.3125,</span>\n<span class=\"token comment\">//  right: 631.671875</span>\n<span class=\"token comment\">// }</span></code></pre></div>\n<p>Nếu một element nằm trong viewport được xác định như sau</p>\n<ul>\n<li><code class=\"language-inline-text\">top</code>, <code class=\"language-inline-text\">left</code> >= 0</li>\n<li><code class=\"language-inline-text\">right</code> &#x3C;= độ rộng của viewport</li>\n<li><code class=\"language-inline-text\">bottom</code> &#x3C;= độ cao của viewport</li>\n</ul>\n<p>Để check độ rộng của viewport, chúng ta có 2 cách, một số trình duyệt hỗ trợ <code class=\"language-inline-text\">window.innerWidth</code>, một số khác hỗ trợ <code class=\"language-inline-text\">document.documentElement.clientWidth</code>, số còn lại thì support cả 2. Rắc rối nhở!</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Cũng tương tự với giá trị viewport height</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Chúng ta kiểm tra xem element có nằm trong viewport không</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n    bounding<span class=\"token punctuation\">.</span>top <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    bounding<span class=\"token punctuation\">.</span>left <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    bounding<span class=\"token punctuation\">.</span>right <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n    bounding<span class=\"token punctuation\">.</span>bottom <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Trong viewport!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Không nằm trong viewport... whoa la la'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Chúng ta gom lại vào một function helper để dành xài</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">isInViewport</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">elem</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> bounding <span class=\"token operator\">=</span> elem<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        bounding<span class=\"token punctuation\">.</span>top <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n        bounding<span class=\"token punctuation\">.</span>left <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n        bounding<span class=\"token punctuation\">.</span>bottom <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n        bounding<span class=\"token punctuation\">.</span>right <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Sử dụng function này, chúng ta có thể làm lazy load image</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>figure</span> <span class=\"token attr-name\">data-image</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url/to/my/image.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hình sẽ được load khi scroll tới đây..<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>figure</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> image <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[data-image]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isInViewport</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        image<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;img src=\"'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-image'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\">'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://gomakethings.com/how-to-test-if-an-element-is-in-the-viewport-with-vanilla-javascript/\">How to test if an element is in the viewport with vanilla JavaScript</a></p>\n","cover_image":"","related":[{"id":"584d255194aabcb163f6d4986ec1bd2e","path":"/2020-08-06-them-type-check-cho-javascript-voi-vscode/","title":"Thêm kiểm tra type trong Javascript với VS Code","desc":"Bạn thấy rằng JavaScript đã đủ xài trong dự án, bạn không ưa thằng TypeScript và bạn đang sử dụng VS Code. Bài viết này là dành cho bạn rồi."},{"id":"2a36599d56704a2b4e467b6383f44739","path":"/2018-10-20-huong-dan-thuc-hien-kiem-tra-performance-voi-chrome-devtools/","title":"Hướng dẫn kiểm tra performace với Chrome DevTools","desc":"Học cách sử dụng tab Network Chrome DevTools để biết tại sao một trang load chậm, hướng dẫn từng bước một."},{"id":"be6c10c63ff46b0bb93b57a071afe476","path":"/2019-11-29-giai-bai-toan-cong-so-trong-javascript/","title":"Giải bài toán cộng 2 số bằng javascript","desc":"Một đề bài cũng không mới, thông qua đó chúng ta sẽ biết thêm tí về cách sử dụng object sao cho hiệu quả"},{"id":"59ff8d68c6cddc5df38fcc15e2a28776","path":"/2020-02-26-dinh-dang-ngay-thang-bang-intl-date-time-format/","title":"Định dạng ngày tháng bằng Intl.DateTimeFormat","desc":""}]}},"context":{}}