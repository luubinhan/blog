{"hash":"33153471da56228ddf4e2462835c7a1a5271f1bd","data":{"post":{"title":"Giới thiệu React Portal","path":"/gioi-thieu-react-portal/","date":"2018-05-31","timeToRead":2,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"},{"id":"react","title":"react","path":"/tag/react/"}],"desc":"Tìm hiểu về Portals, bản hỗ trợ chính thức của react-dom","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81-portal-gi%E1%BA%A3i-quy%E1%BA%BFt\">Vấn đề Portal giải quyết</a></li>\n<li><a href=\"#c%C3%BA-ph%C3%A1p\">Cú pháp</a></li>\n<li><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng\">Sử dụng</a></li>\n</ul>\n<!-- /TOC -->\n<p>Gọi là bản hỗ trợ chính thức vì trước bản React 16 thì không có support, chúng ta phải dùng các thư viện bổ sung. Giờ thì nó official rồi nhé.</p>\n<h2 id=\"vấn-đề-portal-giải-quyết\"><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81-portal-gi%E1%BA%A3i-quy%E1%BA%BFt\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Vấn đề Portal giải quyết</h2>\n<p>Thông thường khi chúng ta có component cha là A, bên trong đó render component con là B, thì thằng B này sẽ luôn bị bọc lại bên trong A</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component-c<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component-a<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component-b<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Giờ nếu ta muốn khi viết thì vẫn viết component B bên trong component A, nhưng kết quả html ta có được thì component B lại nằm trong component C. Đó là lúc chúng ta cần đến Portal, ta sẽ bọc component B bằng hàm <code class=\"language-text\">createPortal</code>, để khi <code class=\"language-text\">render</code> B thì nó lại <code class=\"language-text\">render</code> ở C.</p>\n<h2 id=\"cú-pháp\"><a href=\"#c%C3%BA-ph%C3%A1p\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cú pháp</h2>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword module\">import</span> <span class=\"token maybe-class-name\">ReactDOM</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token maybe-class-name\">ReactDOM</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createPortal</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Trong đó</p>\n<ul>\n<li><code class=\"language-text\">ReactDOM.createPortal</code> là hàm của <code class=\"language-text\">react-dom</code></li>\n<li>child là thằng B, thằng con đi lông nhông không thèm ở nhà với cha nó</li>\n<li>container là nhà thằng hàng xóm, nơi thằng con B hoang đàng sẽ ở ké.</li>\n</ul>\n<h2 id=\"sử-dụng\"><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sử dụng</h2>\n<p>Để sử dụng Portal, chúng ta tạo ra một component mới, độc lập với B, rồi đẩy thằng B hay bất kỳ đứa nào muốn có cuộc sống du mục thành child component của component mới tạo này, đặt tên là <code class=\"language-text\">MyPortal</code> nha.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword module\">import</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Component</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token maybe-class-name\">PropTypes</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'prop-types'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token maybe-class-name\">ReactDOM</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyPortal</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// tìm coi có đứa nào chịu chứa chấp nó không</span>\n    <span class=\"token keyword\">const</span> haveTarget <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">target</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// không nơi chứa chấp thì ta ko render luôn</span>\n    <span class=\"token keyword\">return</span> haveTarget <span class=\"token operator\">?</span> <span class=\"token maybe-class-name\">ReactDOM</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createPortal</span><span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">,</span>\n      haveTarget\n    <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token maybe-class-name\">MyPortal</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">propTypes</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// là id của html element ta sẽ append cái đứa con hoang đàng vô</span>\n  target<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">PropTypes</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">string</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">isRequired</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token maybe-class-name\">MyPortal</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Component A sẽ viết như thế này</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token spread operator\">...</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component-a<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        Hello An.Luu\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyPortal</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>targetForB<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component-b<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                Em là B!\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">MyPortal</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token spread operator\">...</span>\n\n<span class=\"token comment\">// trong đó, id có thể nằm ở bất kỳ component nào đó khác, thậm chí window khác luôn mới ghê</span>\n\n<span class=\"token comment\">// ví dụ component C</span>\n<span class=\"token spread operator\">...</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>component-c<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        Em là C!\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>targetForB<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n)\n...</span></code></pre>\n<p>Đọc thêm </p>\n<ul>\n<li><a href=\"https://reactjs.org/docs/portals.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://reactjs.org/docs/portals.html</a> </li>\n<li><a href=\"https://hackernoon.com/using-a-react-16-portal-to-do-something-cool-2a2d627b0202\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://hackernoon.com/using-a-react-16-portal-to-do-something-cool-2a2d627b0202</a></li>\n</ul>\n","cover_image":"","related":[{"id":"0be257d7b6339261c05ba76120350279","path":"/gioi-thieu-react-router/","title":"Giới thiệu React Router","desc":"React không phải một framework, nó chỉ là một thư viện javascript, bởi vì vậy nó không thể giải quyết tất cả các yêu cầu một ứng dụng. Việc mà React làm rất tốt là tạo component và cách thức quản lý state của component, nhưng để tạo một Single Page App (sẽ viết tắt là SPA) phức tạp, nó cần những thư viện khác nữa, đầu tiên cần nhắc đến là React Router"},{"id":"5d93819d1a5c10be427112a7e0bf625b","path":"/gioi-thieu-react-memo/","title":"Giới thiệu React.memo","desc":"Api mới của React 16.6"},{"id":"18de52b6667fae340629f0c5b1fb3c22","path":"/gioi-thieu-react-profiler/","title":"Giới thiệu React Profiler","desc":"Từ version React 16.5 bổ sung thêm một plugin DevTool profiler. Plugin này được dùng để thu thập các thông tin về thời gian render một component, xác định nguyên nhân làm trì trệ performance."},{"id":"c919a56a3b126ea31da9b991ff155b3d","path":"/gioi-thieu-react-router-v4-react-router-dom/","title":"Giới thiệu React Router v4 (react router dom)","desc":"Trước đây có bài giới thiệu về React Router rồi, nhưng giờ React Router 4 ra, gần như đập đi làm lại chứ ko kế thừa nhiều."}]}},"context":{}}