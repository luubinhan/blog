{"hash":"e1532d0aebaf3bcf47bbf8a08cbde03cecbbc9cf","data":{"tag":{"title":"beginner","belongsTo":{"edges":[{"node":{"id":"28b28757469522f8f7ff7248ce3b6343","title":"Hướng dẫn delegate domain với AWS","path":"/2024-04-05-huong-dan-delegate-domain-trong-aws/","date":"2024-04-05","timeToRead":1,"desc":"Trong bài hôm nay chúng ta cùng tìm hiểu cách delegate một domain trong AWS","content":"<p>Trước tiên chúng ta cần biết delegate domain sẽ giải quyết bài toán gì</p>\n<p>Mình lấy ví dụ, Công ty Furfel đang sở hữu tên miền <code class=\"language-inline-text\">furfel.net</code>, là trang web chính của công ty\nCông ty thuê công ty Dev phát triển thêm một số dịch vụ trên tên miền con <code class=\"language-inline-text\">dev.furfel.net</code>\nCông ty Furfel sẽ trao toàn bộ quyền quyết định trên tên miền <code class=\"language-inline-text\">dev.furfel.net</code> cho công ty Dev, và chỉ nắm quyền trên tên miền cha là <code class=\"language-inline-text\">furfel.net</code></p>\n<p>Đây là bài toán mà <strong>delegate domain</strong> sẽ giải quyết</p>\n<p>Để delegate domain trong AWS thì kiến trúc tổng quát sẽ như hình bên dưới</p>\n<p><img src=\"https://i.imgur.com/w5fQhyQl.png\"></p>\n<p>Bên trong Route 53, chúng ta sẽ tạo một <strong>Public Hosted Zone</strong>, lưu ý là <strong>public</strong> với tên <strong>giống hoàn toàn với domain chính</strong>, theo ví dụ sẽ là <code class=\"language-inline-text\">furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fael6xqiv8gyd9rnk83g1.jpg\" alt=\"Public Hosted Zone furfel.net\"></p>\n<p>Sau khi tạo xong hosted zone <code class=\"language-inline-text\">furfel.net</code>, chúng ta mang giá trị NS (name server) của hosted zone vừa tạo đưa cho công ty đang nắm quyền trên tên miền <code class=\"language-inline-text\">furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fael6xqiv8gyd9rnk83g1.jpg\" alt=\"Copy giá trị Nameserver của publich hosted zone vừa tạo\"></p>\n<p>Công ty Furfel sẽ vào phần quản lý tên miền và đưa toàn bộ giá trị nameserver vào như một <em>external name server</em> là xem như đã delegate xong sub domain cho công ty Dev</p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ffuq5hfcya9thvarrizn9.jpg\" alt=\"Đưa giá trị NS vào trong tên miền chính\"></p>\n<p>Công ty Dev để thêm tên miền <code class=\"language-inline-text\">dev.furfel.net</code>, việc cần làm là tạo thêm một public hosted zone mới, với tên <code class=\"language-inline-text\">dev.furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ftwj6kpdp0vym6edjmmw9.jpg\" alt=\"Public Hosted Zone dev.furfel.net\"></p>\n<p>Copy toàn bộ giá trị NS của hosted zone <code class=\"language-inline-text\">dev.furfel.net</code>, rồi quay lại hosted zone <code class=\"language-inline-text\">furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fdfjgs3ryjwnvszvwghzb.jpg\" alt=\"NS của dev.furfel.net\"></p>\n<p>Thêm một record mới tên dev, type là NS và paste giá trị Nameserver vừa copy</p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F9qg56ridyrk3192mk9sn.jpg\" alt=\"Thêm record mới tên dev bên trong hosted zone dev.furfel.net\"></p>\n","cover_image":""}},{"node":{"id":"9f8cb439930920e69ea8b3a3edab670c","title":"Lưu ý khi sử dụng AWS Lambda để tránh mất tiền","path":"/2023-08-04-tranh-mat-tien-voi-lambda/","date":"2023-08-04","timeToRead":5,"desc":"Khi chúng ta sử dụng đúng lúc đúng nơi, những dịch vụ serverless như Lambda sẽ rẻ hơn so với hệ thống bình thường, chúng ta vẫn nghe quảng cáo nhan nhản serverless thì xài nhiêu trả nhiêu, an toàn hơn, khả năng mở rộng và phục hồi tốt hơn cách truyền thống, có thật sự đúng như quảng cáo không?","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#kh%C3%B4ng-%C4%91%E1%BB%83-%C3%BD-chi-ph%C3%AD-logging-v%C3%A0-monitor\">Không để ý chi phí logging và monitor</a></li>\n<li><a href=\"#%C4%91%E1%BB%8Dc-k%E1%BB%B9-h%C6%B0%E1%BB%9Bng-d%E1%BA%ABn-s%E1%BB%AD-d%E1%BB%A5ng-tr%C6%B0%E1%BB%9Bc-khi-d%C3%B9ng\">Đọc kỹ hướng dẫn sử dụng trước khi dùng</a></li>\n<li><a href=\"#kh%C3%B4ng-ch%E1%BB%8Bu-b%E1%BA%ADt-th%C3%B4ng-b%C3%A1o\">Không chịu bật thông báo</a></li>\n<li><a href=\"#lambda-g%E1%BB%8Di-lambda-theo-c%C6%A1-ch%E1%BA%BF-synchronous\">Lambda gọi Lambda theo cơ chế Synchronous</a></li>\n<li><a href=\"#kh%C3%B4ng-cache\">Không cache</a></li>\n<li><a href=\"#c%E1%BA%A5p-qu%C3%A1-nhi%E1%BB%81u-t%C3%A0i-nguy%C3%AAn\">Cấp quá nhiều tài nguyên</a></li>\n<li><a href=\"#ki%E1%BA%BFn-tr%C3%BAc-c%E1%BB%A7-chu%E1%BB%91i\">Kiến trúc củ chuối</a></li>\n</ul>\n<!-- /TOC -->\n<p>Vâng đúng nhưng không phải trong mọi hoàn cảnh, chiếc chìa khóa vạn năngcó thể giải quyết mọi yêu cầu hệ thống. Khi thiết kế một hệ thống chúng ta phải cân nhắc đến việc cho nó tiến hóa theo nhu cầu, cũng giống như những phần mềm chúng ta viết ra điều phải thay đổi để thích nghi và đáp ứng nhu cầu mới của khách hàng</p>\n<p>Chúng ta cùng đi qua một vài lỗi hay gặp và cách khắc phục để tiết kiệm chi phí tối đa</p>\n<h2 id=\"không-để-ý-chi-phí-logging-và-monitor\"><a href=\"#kh%C3%B4ng-%C4%91%E1%BB%83-%C3%BD-chi-ph%C3%AD-logging-v%C3%A0-monitor\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Không để ý chi phí logging và monitor</h2>\n<p>Ghi log và monitor ứng dụng để có thể tìm lỗi và phát hiện nguyên nhân gây lỗi là bắt buộc, nhưng nó đi đôi với chi phí. AWS CloudWatch tính phí cả 2 phần ghi log và lưu trữ log</p>\n<p>Bạn sẽ ngạc nhiên khi phát hiện ra rằng chi phí cho CloudWatch đôi khi còn cao hơn cả cho Lambda và API Gateway</p>\n<p>Để giải quyết:</p>\n<ol>\n<li>Log <code class=\"language-inline-text\">INFO</code> hay <code class=\"language-inline-text\">ERROR</code> chỉ trên môi trường production</li>\n<li>Chỉ giữ log thật sự hữu ích nhất để debug trên production</li>\n<li>Lưu log trong 30 ngày là vừa đủ để debug mà không làm đội chi phí lưu trữ</li>\n</ol>\n<p>Nếu đã có log được lưu ở một bên thứ 3 khác có thể bỏ qua log CloudWatch</p>\n<h2 id=\"đọc-kỹ-hướng-dẫn-sử-dụng-trước-khi-dùng\"><a href=\"#%C4%91%E1%BB%8Dc-k%E1%BB%B9-h%C6%B0%E1%BB%9Bng-d%E1%BA%ABn-s%E1%BB%AD-d%E1%BB%A5ng-tr%C6%B0%E1%BB%9Bc-khi-d%C3%B9ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Đọc kỹ hướng dẫn sử dụng trước khi dùng</h2>\n<p>Để khỏi “hết hồn” lúc nhận bill cuối tháng, chúng ta cần biết khi bật một tính năng lên sẽ phát sinh thêm những phụ phí, rất nhiều phí chỉ được áp dụng trong những điều kiện cụ thể. Ví dụ như chọn <em>provisioned concurrency</em> cho Lambda sẽ thêm một số phụ phí</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1_ER0It8JsAuL3D1ECFlUBog-768x349.jpg\"></p>\n<p>Đừng nóng vội hãy luôn nhớ chậm lại một nhịp rồi tìm hiểu cho đầy đủ trước khi muốn sử dụng một dịch vụ nào khác.</p>\n<h2 id=\"không-chịu-bật-thông-báo\"><a href=\"#kh%C3%B4ng-ch%E1%BB%8Bu-b%E1%BA%ADt-th%C3%B4ng-b%C3%A1o\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Không chịu bật thông báo</h2>\n<p>Mọi người cũng hay quên dùng tính năng <em>billing alarm</em> của AWS. Một công cụ tuyệt vời để báo liền cho chúng ta để biết được những khoản chi chúng ta đã bỏ ra có vượt ngoài tầm kiểm soát không</p>\n<p>Cài đặt Billing Alarm nên là điều đầu tiên chúng ta cần làm khi sử dụng AWS trước khi mọi thứ ra vượt ra ngoài tầm kiểm soát.</p>\n<h2 id=\"lambda-gọi-lambda-theo-cơ-chế-synchronous\"><a href=\"#lambda-g%E1%BB%8Di-lambda-theo-c%C6%A1-ch%E1%BA%BF-synchronous\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Lambda gọi Lambda theo cơ chế Synchronous</h2>\n<p>Một Lambda gọi một Lambda khác synchronous nghĩa là Lambda đầu nguồn sẽ <em>ngồi đợi</em> Lambda thứ 2 chạy xong trước khi nó tiếp tục chạy. Nó làm đội lên chi phí khá nhiều vì thời gian ngồi đợi vẫn bị tính phí, giống như lên xe taxi bạn ngồi đợi nhưng đồng hồ đếm tiền vẫn nhảy dù xe không chạy.</p>\n<p>Hãy luôn nhớ gọi Lambda asynchronous bất cứ ở đâu cho phép</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1__Z1-AG9GVnzRSQW_a77yYQ-768x334.png\"></p>\n<h2 id=\"không-cache\"><a href=\"#kh%C3%B4ng-cache\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Không cache</h2>\n<p>Caching là người bạn thân thiết, hay khắc cốt ghi tâm điều này, caching nghĩa là Lambda sẽ không cần gọi và làm gì cả, kết quả được trả thằng ngay từ API Gateway hay CloudFront. Bên cạnh đó ở ứng dụng có thể cân nhắc sử dụng thêm dịch vụ chuyên cache như ElastiCache hay Memento, hay DynamoDB Accelerator</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/0_9V50W4A0o6-r7bce-768x329.png\"></p>\n<h2 id=\"cấp-quá-nhiều-tài-nguyên\"><a href=\"#c%E1%BA%A5p-qu%C3%A1-nhi%E1%BB%81u-t%C3%A0i-nguy%C3%AAn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cấp quá nhiều tài nguyên</h2>\n<p>Cấp quá nhiều memory cho Lambda cũng là một lỗi hay mắc. Lambda được tính phí theo 2 tiêu chi: lượng memory đã sử dụng và thời gian chạy của hàm.</p>\n<p>Câu hỏi là cấp bao nhiêu cho đủ? Công cụ <a href=\"https://github.com/alexcasalboni/aws-lambda-power-tuning\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Lambda Power Tuning</a> sẽ giúp chúng ta xác định lượng memory cần thiết để cân bằng giữa chi phí và hiệu năng</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/0_V70C8Qw83OYgW5FW.png\"></p>\n<h2 id=\"kiến-trúc-củ-chuối\"><a href=\"#ki%E1%BA%BFn-tr%C3%BAc-c%E1%BB%A7-chu%E1%BB%91i\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kiến trúc củ chuối</h2>\n<p>Kiến trúc mà củ chuối quá thì hậu quả là nhản tiền, vừa tốn chi phí, hiệu năng không tối ưu và lại còn khó vận hành bảo trì</p>\n<p>AWS có rất nhiều service để thực hiện gửi nhận message, như SNS, SQS, EventBridge, Kinesis, ưu nhược điểm là khác nhau và phải hiểu để sử dụng cho đúng mục đích, không khéo chúng ta là đi lấy giao chặt thịt heo đi giết kiến</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1_WQOGHnPyWMfVIR3yO3D0zA-768x485.jpg\"></p>\n<p>Tương tự, API Gateway cũng tốn khá khá tiền so với ALB nhưng nó có nhiều đồ chơi vượt trội hơn, tiền nào của đó thôi, liệu cơm gấp mắm</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1_gpJi-nd7tx8etGi0nvKR2A-768x383.png\"></p>\n<p>Mọi sai làm điều là một cơ hội để học hỏi, nên không sợ sai chỉ sợ không học được gì từ những gì mình đã làm sai. Chúc các bạn có một cuộc chơi đỡ tốn tiền hơn trên AWS</p>\n<p><a href=\"https://lumigo.io/blog/save-money-on-serverless-common-costly-mistakes-and-how-to-avoid-them/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Save money on Serverless: common costly mistakes and how to avoid them</a></p>\n","cover_image":""}},{"node":{"id":"9aafa421dad4e53de4b2273720758cca","title":"Sử dụng nhiều AWS account trong Gitlab CI","path":"/2023-04-09-su-dung-nhieu-account-aws-de-deploy-gitlab/","date":"2023-04-09","timeToRead":4,"desc":"Một bài toán cũng quá ư phổ biến khi deploy là có nhiều môi trường khác nhau dev, qa, staging và production, và chúng ta sẽ có các tài khoản tương ứng để có đủ quyền trên môi trường đó.","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-1-t%C3%A0i-kho%E1%BA%A3n\">Sử dụng 1 tài khoản</a></li>\n<li><a href=\"#nhi%E1%BB%81u-t%C3%A0i-kho%E1%BA%A3n-b%E1%BA%B1ng-bi%E1%BA%BFn-m%C3%B4i-tr%C6%B0%E1%BB%9Dng\">Nhiều tài khoản bằng biến môi trường</a></li>\n<li><a href=\"#nhi%E1%BB%81u-t%C3%A0i-kho%E1%BA%A3n-theo-environment-v%C3%A0-scope-bi%E1%BA%BFn-m%C3%B4i-tr%C6%B0%E1%BB%9Dng-theo-environment\">Nhiều tài khoản theo environment và scope biến môi trường theo environment</a></li>\n<li><a href=\"#nhi%E1%BB%81u-t%C3%A0i-kho%E1%BA%A3n-b%E1%BA%B1ng-aws-profile\">Nhiều tài khoản bằng AWS Profile</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"sử-dụng-1-tài-khoản\"><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-1-t%C3%A0i-kho%E1%BA%A3n\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sử dụng 1 tài khoản</h2>\n<p>Để bắt đầu, chúng ta sử dụng 1 tài khoản để upload lên S3, chúng ta sẽ khai báo các biến môi trường sau bên trong Gitlab CI</p>\n<ul>\n<li><code class=\"language-inline-text\">AWS_S3_BUCKET</code></li>\n<li><code class=\"language-inline-text\">AWS_ACCESS_KEY_ID</code></li>\n<li><code class=\"language-inline-text\">AWS_SECRET_ACCESS_KEY</code></li>\n<li><code class=\"language-inline-text\">AWS_DEFAULT_REGION</code></li>\n</ul>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*rPl9Icr-_VuZXHfSW0NCrg.png\"></p>\n<p>File pipeline <code class=\"language-inline-text\">.gitlab-ci.yml</code></p>\n<div class=\"gridsome-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token punctuation\">-</span> build\n\t<span class=\"token punctuation\">-</span> production\n\n<span class=\"token key atrule\">create file</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n\t<span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n\t<span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token punctuation\">-</span> touch foo.bar\n\t<span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token punctuation\">-</span> foo.bar\n\n<span class=\"token key atrule\">deploy to production</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> production\n\t<span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n\t\t<span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n\t\t<span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$AWS_S3_BUCKET/foo.txt</code></pre></div>\n<p>Theo mặc định các biến <code class=\"language-inline-text\">AWS_ACCESS_KEY_ID</code>, <code class=\"language-inline-text\">AWS_SECRET_ACCESS_KEY</code>, <code class=\"language-inline-text\">AWS_DEFAULT_REGION</code> sẽ được AWS CLI sử dụng để authen, không cần khai báo gì thêm</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*vEKIXwu9giYQYDhVBmrT_g.png\"></p>\n<h2 id=\"nhiều-tài-khoản-bằng-biến-môi-trường\"><a href=\"#nhi%E1%BB%81u-t%C3%A0i-kho%E1%BA%A3n-b%E1%BA%B1ng-bi%E1%BA%BFn-m%C3%B4i-tr%C6%B0%E1%BB%9Dng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nhiều tài khoản bằng biến môi trường</h2>\n<p>Cách này không phải hay nhất nhưng đa phần chúng ta sẽ nghĩ ngay tới đó là đặt hàng loạt biến AWS khác nhau cho từng môi trường</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*oxrBcHZ7w83fDS8ej16grg.png\"></p>\n<p>Bên trong job, chúng ta sẽ lấy các biến môi trường này ra để sử dụng, khá \"thủ công\"</p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> build\n    <span class=\"token punctuation\">-</span> test\n    <span class=\"token punctuation\">-</span> production\n\n<span class=\"token key atrule\">create file</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> touch foo.bar\n    <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> foo.bar\n\n<span class=\"token key atrule\">deploy to test</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n        <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token comment\"># Set lại giá trị credential</span>\n        <span class=\"token punctuation\">-</span> export AWS_ACCESS_KEY_ID=$TEST_AWS_ACCESS_KEY_ID\n        <span class=\"token punctuation\">-</span> export AWS_SECRET_ACCESS_KEY=$TEST_AWS_SECRET_ACCESS_KEY\n        <span class=\"token punctuation\">-</span> export AWS_DEFAULT_REGION=$TEST_AWS_DEFAULT_REGION\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n        <span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$TEST_AWS_S3_BUCKET/foo.txt\n\n<span class=\"token key atrule\">deploy to production</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> production\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n        <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token comment\"># Set lại giá trị credential</span>\n        <span class=\"token punctuation\">-</span> export AWS_ACCESS_KEY_ID=$PROD_AWS_ACCESS_KEY_ID\n        <span class=\"token punctuation\">-</span> export AWS_SECRET_ACCESS_KEY=$PROD_AWS_SECRET_ACCESS_KEY\n        <span class=\"token punctuation\">-</span> export AWS_DEFAULT_REGION=$PROD_AWS_DEFAULT_REGION        \n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n        <span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$PROD_AWS_S3_BUCKET/foo.txt</code></pre></div>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*seYjr6dGwJ6dz3KxC-TPqw.png\"></p>\n<p>Cách này nhìn chung là dễ hiểu, dễ làm, tuy nhiên nó lại phải khai báo khá nhiều biến bên trong pipeline và quá nhiều config trên từng job</p>\n<h2 id=\"nhiều-tài-khoản-theo-environment-và-scope-biến-môi-trường-theo-environment\"><a href=\"#nhi%E1%BB%81u-t%C3%A0i-kho%E1%BA%A3n-theo-environment-v%C3%A0-scope-bi%E1%BA%BFn-m%C3%B4i-tr%C6%B0%E1%BB%9Dng-theo-environment\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nhiều tài khoản theo environment và scope biến môi trường theo environment</h2>\n<p>Nếu bạn để ý bên trong phần khai báo biến môi trường, chúng ta có cột <strong>Environment</strong>, có nghĩa là biến có thể có scope theo từng môi trường được</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*OX--G_EvC4z_1EkawOfLwg.png\"></p>\n<p>Chúng ta cần khai báo thêm environment cho job để nó có thể sử dụng biến môi trường thuộc scope </p>\n<div class=\"gridsome-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">deploy to test</span><span class=\"token punctuation\">:</span>  \n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test  \n    <span class=\"token punctuation\">...</span>  \n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>  \n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">testdeploy to production</span><span class=\"token punctuation\">:</span>  \n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> production  \n    <span class=\"token punctuation\">...</span>  \n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>  \n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> production</code></pre></div>\n<p>Sau khi khai báo thêm biến môi trường cho job, bên trong màn hình thêm <strong>variables</strong> lúc này chúng ta sẽ có thêm các lựa chọn ngoài <strong>All</strong> như trước</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*rhppig_K2zKK88gvMqSGUw.png\"></p>\n<p>Bây giờ chúng ta chỉ cần bỏ đi prefix, đặt lại đúng tên và môi trường là xong</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*gcRkv_J8UAlP5-E9O7dsuQ.png\">\n<img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*3YNcoTVtC3_1asxMc-RzZw.png\"></p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> build\n    <span class=\"token punctuation\">-</span> test\n    <span class=\"token punctuation\">-</span> production\n\n<span class=\"token key atrule\">create file</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> touch foo.bar\n    <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> foo.bar\n\n<span class=\"token key atrule\">deploy to test</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n        <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n        <span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$AWS_S3_BUCKET/foo.txt\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> test        \n\n<span class=\"token key atrule\">deploy to production</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> production\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n        <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>      \n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n        <span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$AWS_S3_BUCKET/foo.txt\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> production</code></pre></div>\n<p>Như có thể thấy, pipeline giờ gần giống như trường hợp chúng ta chỉ có 1 tài khoản, rất dễ hiểu dễ làm, không cần thêm config gì rườm rà trên file <code class=\"language-inline-text\">.gitlab-ci.yml</code>, tuy nhiên nó vẫn có quá nhiều biến môi trường cần phải quản lý</p>\n<h2 id=\"nhiều-tài-khoản-bằng-aws-profile\"><a href=\"#nhi%E1%BB%81u-t%C3%A0i-kho%E1%BA%A3n-b%E1%BA%B1ng-aws-profile\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nhiều tài khoản bằng AWS Profile</h2>\n<p>Bên trong Gitlab, <strong>variables</strong> không chỉ có thể là giá trị, nó còn có thể là <strong>file</strong>, chúng ta khai báo các credentials theo dạng file</p>\n<p>Một file credentials của aws sẽ có dạng <code class=\"language-inline-text\">~/.aws/credentials</code></p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">[</span>production<span class=\"token punctuation\">]</span>\naws_access_key_id=AKIAXKYMDEKGYDJ2OT4U\naws_secret_access_key=N/T3ZafKprWt3EMnMFDQCXXXXXXXXXXXXX\nregion=us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n<span class=\"token punctuation\">[</span>test<span class=\"token punctuation\">]</span>\naws_access_key_id=AKIA6C7LEVAXLETXGONN\naws_secret_access_key=wtilH45rB3oUyIjJnIALhOhLlyXXXXXXXXXXXXX\nregion=us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></code></pre></div>\n<p>Khai báo biến <code class=\"language-inline-text\">AWS_SHARED_CREDENTIALS_FILE</code> dạng file</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*6_L4xNcITsl1Z1Ma6mO3Qg.png\"></p>\n<p>Biến <code class=\"language-inline-text\">AWS_SHARED_CREDENTIALS_FILE</code> lúc này sẽ chứa đường dẫn đến đến file</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*EUayc8Ef5VZBeIa1bbyeng.png\"></p>\n<p>AWS CLI một cách thần kỳ sẽ hiểu dùng file này để lấy thông tin credential, job chúng ta chỉ cần chỉ định biến <code class=\"language-inline-text\">AWS_PROFILE</code> muốn sử dụng</p>\n<div class=\"gridsome-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> build\n    <span class=\"token punctuation\">-</span> test\n    <span class=\"token punctuation\">-</span> production\n\n<span class=\"token key atrule\">create file</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> touch foo.bar\n    <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> foo.bar\n\n<span class=\"token key atrule\">deploy to test</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n        <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token comment\">## chỉ định profile test</span>\n        <span class=\"token key atrule\">AWS_PROFILE</span><span class=\"token punctuation\">:</span> test\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n        <span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$AWS_S3_BUCKET/foo.txt\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> test        \n\n<span class=\"token key atrule\">deploy to production</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> production\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> amazon/aws<span class=\"token punctuation\">-</span>cli\n        <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span> \n    <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token comment\"># chỉ định profile production</span>\n        <span class=\"token key atrule\">AWS_PROFILE</span><span class=\"token punctuation\">:</span> production             \n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> aws <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>version\n        <span class=\"token punctuation\">-</span> aws s3 cp foo.bar s3<span class=\"token punctuation\">:</span>//$AWS_S3_BUCKET/foo.txt\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> production</code></pre></div>\n<p>Và nếu thích dùng môi trường thay vì biến, chúng ta khai báo thêm biến môi trường để map vào từng profile, tuy nhiên mình thấy nó thêm rườm rà, khuyên bạn không nên.</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*Hn8tRLJ3CpAtnT4f-Eyy6g.png\"></p>\n<p>Chúc các bạn thực vui!</p>\n<p><a href=\"https://medium.com/devops-with-valentine/gitlab-ci-how-to-manage-aws-cli-credentials-for-multiple-aws-accounts-in-a-single-pipeline-bb2b37972999\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitLab CI: How to Manage AWS CLI Credentials for multiple AWS Accounts in a Single Pipeline</a>\nMarkdown selection 7246 bytes 840 words 249 lines Ln 250, Col 239HTML 4358 characters 807 words 173 paragraphs</p>\n","cover_image":""}},{"node":{"id":"ccf700f7119a151321d7d3c58f0ce932","title":"Xuất bản npm module bằng Lerna với Gitlab CI/CD","path":"/2023-03-30-huong-dan-xuat-ban-module-len-gitlab-registry/","date":"2023-03-30","timeToRead":5,"desc":"","content":"<p>Trong bài viết này chúng ta sẽ thực hiện tự động hóa quá trình xuất bản npm module lên <a href=\"https://docs.gitlab.com/ee/user/packages/npm_registry/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gitlab registry</a> bằng lerna sử dụng Gitlab CI/CD, lưu ý chúng ta không dùng <a href=\"https://www.npmjs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">npmjs registry</a>, nó cũng ko có quá nhiều khác biệt, chỉ cần một vài thay đổi nhỏ để xuất bản lên <em>npmjs registry</em>. Các công cụ chúng ta cần đến</p>\n<ul>\n<li><strong>lerna</strong> để quản lý và xuất bản version cho nhiều module cùng lúc</li>\n<li><strong>Gitlab CI/CD</strong>: source code sẽ lưu trên gitlab, dùng Gitlab CI/CD runner để đẩy module lên Gitlab NPM Registry (nơi chứa module npm của gitlab)</li>\n</ul>\n<p>Các bạn cần có căn bản về 2 công cụ này để có tể hiểu hết được bài viết</p>\n<p>Phương pháp đặt tên đánh version của chúng ta sẽ như sau</p>\n<ul>\n<li><strong>main</strong> là nhánh chính, chứa version chính thức chúng ta sẽ xuất bản</li>\n<li><strong>feature branch</strong> sẽ cho ra các version <em>alpha</em> (hay còn gọi với tên khác là <strong>canary</strong>) cho phép chúng ta test nhanh phiên bản mới trước khi xuất bản chính thức</li>\n</ul>\n<p>Dùng lerna, chúng ta xuất bản version canary bằng</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lerna publish <span class=\"token parameter variable\">--canary</span>\n<span class=\"token comment\"># => 1.0.1-alpha.0+${SHA}</span></code></pre></div>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// package.json</span>\n<span class=\"token property\">\"publish:canary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lerna publish --canary --no-git-tag-version --no-push --yes\"</span></code></pre></div>\n<p>Khi đã merge vào nhánh <code class=\"language-inline-text\">main</code>, chúng ta sẽ chạy <code class=\"language-inline-text\">lerna version</code> với những tham số cần thiết để <code class=\"language-inline-text\">push</code> thêm <strong>tag</strong> vào package cũng như cập nhập, <em>commit</em>, <em>push</em> version mới vào trong <strong>package.json</strong>. Để pipeline có quyền push những thay đổi vào trong repository, chúng ta có những thiết đặt rất quan trọng sẽ được đề cập trong phần Gitlab CI/CD bên dưới.</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// package.json</span>\n<span class=\"token string-property property\">\"version:stable\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lerna version --yes\"</span></code></pre></div>\n<h2 id=\"gitlab-cicd\"><a href=\"#gitlab-cicd\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Gitlab CI/CD</h2>\n<p>Trọng tâm của bài nay này chúng ta sẽ tập trung vào việc xuất bản một module tự động bằng CI/CD của Gitlab. Chúng ta sẽ đụng đến token, file pipeline <code class=\"language-inline-text\">.gitlab-ci.yml</code>, cần quyền <strong>Maintainer</strong> trên repo để có thể vào menu <strong>Settings</strong></p>\n<h3 id=\"token\"><a href=\"#token\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Token</h3>\n<p>Chúng ta sẽ cần 2 loại TOKEN</p>\n<ul>\n<li><strong>CI_JOB_TOKEN</strong> đây là token predefined của CI/CD, nó sẽ có quyền để xuất bản lên gitlab registry, nếu như cần xuất bản lên npm registry chúng ta sẽ cần <em>npm token</em> và lưu nó bào trong biến môi trường để sử dụng trong CI.</li>\n<li>Token cho việc push và thêm tag trên repo, chúng ta sẽ đặt tên nó là <code class=\"language-inline-text\">GL_TOKEN</code>, tạo một project token và cấp quyền <code class=\"language-inline-text\">api</code>, <code class=\"language-inline-text\">read_repository</code>, <code class=\"language-inline-text\">write_repository</code> trên nhánh main</li>\n</ul>\n<h3 id=\"gitlab-ciyml\"><a href=\"#gitlab-ciyml\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">.gitlab-ci.yml</code></h3>\n<p>Đây là một file pipeline dùng để tham khảo, các bạn có thể tùy biến thêm tùy theo nhu cầu,.</p>\n<p>Khai báo một step <code class=\"language-inline-text\">.prepare</code> sẽ dùng làm extend cho các <em>job</em>, trong trường hợp cần phải sử dụng lại các bước này nhiều lần, đây là cách hiệu quả để re-use logic</p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">.prepare\n\t<span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token punctuation\">-</span> git config user.email $GITLAB_USER_EMAIL\n\t\t<span class=\"token punctuation\">-</span> git config user.name $GITLAB_USER_NAME\n\t\t<span class=\"token punctuation\">-</span> git remote set<span class=\"token punctuation\">-</span>url origin \"https<span class=\"token punctuation\">:</span>//gitlab<span class=\"token punctuation\">-</span>ci<span class=\"token punctuation\">-</span>token<span class=\"token punctuation\">:</span>$GL_TOKEN@$CI_SERVER_HOST/$CI_PROJECT_PATH.git\"\n\t\t<span class=\"token punctuation\">-</span> echo \"//$<span class=\"token punctuation\">{</span>CI_SERVER_HOST<span class=\"token punctuation\">}</span>/api/v4/projects/$<span class=\"token punctuation\">{</span>CI_PROJECT_ID<span class=\"token punctuation\">}</span>/packages/npm/<span class=\"token punctuation\">:</span>_authToken=$CI_JOB_TOKEN\" <span class=\"token punctuation\">></span> .npmrc\n\t\t<span class=\"token punctuation\">-</span> git checkout $CI_COMMIT_BRANCH</code></pre></div>\n<p>Chúng ta cần phải đảm bảo các bước này được chạy trước <em>script</em> chính, nên nó được đặt ở <code class=\"language-inline-text\">before_script</code>. Vì Lerna có đụng chạm đến Git repository trong quá trình nó đổi version và xuất bản lên registry, chúng ta phải thêm các bước thiệt đặt email, name khi chạy git</p>\n<p><strong>Đây là đoạn cực kỳ quan trọng</strong>, mình muốn tách riêng và nhắc lại lần nữa, vì nếu không có $GL_TOKEN đã tạo ở trước, chúng ta sẽ fail và bị lỗi 403, chúng ta cũng không thể dùng CI_JOB_TOKEN ở đây vì nó chỉ có quyền xuất bản mà không có quyền can thiệp vào git repository</p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">git remote set<span class=\"token punctuation\">-</span>url origin \"https<span class=\"token punctuation\">:</span>//gitlab<span class=\"token punctuation\">-</span>ci<span class=\"token punctuation\">-</span>token<span class=\"token punctuation\">:</span>$GL_TOKEN@$CI_SERVER_HOST/$CI_PROJECT_PATH.git\"</code></pre></div>\n<p>Sao đó chúng ta sẽ tạo ra phải <code class=\"language-inline-text\">.npmrc</code> để khai báo registry chúng ta muốn xuất bản, ở đây  vì chúng ta chỉ muốn xuất bản nó lên gitlab NPM registry. Trong trường hợp cần xuất bản lên npmjs registry, chúng ta thay đổi nó thành</p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">// Nhớ tạo NPM_TOKEN và lưu thành biến môi trường\necho \"//registry.npmjs.org/<span class=\"token punctuation\">:</span>_authToken=$NPM_TOKEN\" <span class=\"token punctuation\">></span> .npmrc</code></pre></div>\n<p>Mặt định Gitlab CI/CD sẽ checkout nhánh đang chạy job theo state <code class=\"language-inline-text\">DETACHED HEAD</code>, chúng ta phải chỉ định cụ thể <code class=\"language-inline-text\">git checkout $CI_COMMIT_BRANCH</code> để Lerna không <em>chửi</em> chúng ta</p>\n<p>Để build một bản <em>canary</em> (phiên bản thử nghiệm chưa hoàn thiện) dành cho nhánh feature, chúng ta sẽ khai báo</p>\n<div class=\"gridsome-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># .gitlab-ci.yml</span>\n<span class=\"token key atrule\">build-publish-canary</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> .prepare\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> yarn install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>frozen<span class=\"token punctuation\">-</span>lockfile\n    <span class=\"token punctuation\">-</span> yarn build\n    <span class=\"token punctuation\">-</span> yarn test\n    <span class=\"token punctuation\">-</span> yarn publish<span class=\"token punctuation\">:</span>canary\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span>\n        $CI_COMMIT_BRANCH <span class=\"token tag\">!=</span> \"main\" <span class=\"token important\">&amp;&amp;</span> $CI_PIPELINE_SOURCE <span class=\"token tag\">!=</span>\n        'merge_request_event' <span class=\"token important\">&amp;&amp;</span> $CI_COMMIT_TITLE <span class=\"token tag\">!=</span> \"Publish\"</code></pre></div>\n<p>Sau khi chạy các lệnh bên trong <code class=\"language-inline-text\">.prepare</code>, chúng ta cho chạy <code class=\"language-inline-text\">yarn install --frozone-lockfile</code> để cài đặt dependencies sử dụng chính xác như những gì đã liệt kê trong file <code class=\"language-inline-text\">yarn.lock</code>, đây là một kinh nghiệm để tránh CI làm thay đổi file lock.</p>\n<p>Có những <code class=\"language-inline-text\">rules</code> rất quan trọng mà chúng ta đã thiết đặt</p>\n<ul>\n<li><code class=\"language-inline-text\">$CI_COMMIT_BRANCH != main</code> đảm bảo job này chỉ chạy trên các nhánh không phải là <code class=\"language-inline-text\">main</code></li>\n<li><code class=\"language-inline-text\">$CI_PIPELINE_SOURCE != 'merge_request_event</code> đảm báo job không chạy trên merge request</li>\n<li><code class=\"language-inline-text\">$CI_COMMIT_TITLE != Publish</code> đảm bảo job không chạy sau khi Lerna tạo ra một commit với title là <strong>Publish</strong>, commit này sẽ xuất hiện khi chạy <code class=\"language-inline-text\">lerna version</code></li>\n</ul>\n<p>Đối với nhánh <code class=\"language-inline-text\">main</code> chúng ta sẽ có một job khác</p>\n<div class=\"gridsome-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># .gitlab-ci.yml</span>\n<span class=\"token key atrule\">build-version-stable</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> .prepare\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> yarn install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>frozen<span class=\"token punctuation\">-</span>lockfile\n    <span class=\"token punctuation\">-</span> yarn build\n    <span class=\"token punctuation\">-</span> yarn test\n    <span class=\"token punctuation\">-</span> yarn version<span class=\"token punctuation\">:</span>stable\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH == \"main\" <span class=\"token important\">&amp;&amp;</span> $CI_COMMIT_TITLE <span class=\"token tag\">!=</span> \"Publish\"</code></pre></div>\n<p>Chúc các bạn thành công !</p>\n<p>Bài viết của luckyluu</p>\n","cover_image":""}},{"node":{"id":"c769469501c0234d9baa0ced55d6da7d","title":"Truyền component qua prop như thế nào cho đúng","path":"/2023-02-04-cach-truyen-component-vao-prop/","date":"2023-02-04","timeToRead":3,"desc":"Điểm qua những pattern để truyền component vào prop trong React","content":"<p>Ví dụ một tính huống chúng ta cần truyền component qua prop, chúng ta có <code class=\"language-inline-text\">&lt;Button /></code> với icon</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> Button <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> ReactNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SomeIcon</span></span> <span class=\"token attr-name\">size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>small<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Để cho phép thay đổi icon, chúng ta sẽ cho phép truyền thêm prop <code class=\"language-inline-text\">icon</code> là một <strong>React element</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">type ButtonProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> ReactNode<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">icon</span><span class=\"token operator\">:</span> ReactElement<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">IconProps</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n};\n\nconst ButtonWithIconElement = (</span><span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> icon <span class=\"token punctuation\">}</span><span class=\"token plain-text\">): ButtonProps) => </span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> icon <span class=\"token operator\">=</span> <span class=\"token function\">getIconFromName</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>icon<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n// sử dụng\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconElement</span></span>  <span class=\"token attr-name\">icon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span>  <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">button here</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ButtonWithIconElement</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>hoặc icon là một <strong>React Component</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">type ButtonProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> ReactNode<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">Icon</span><span class=\"token operator\">:</span> ComponentType<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">IconProps</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n};\n\nexport const ButtonWithIconComponent = ({ children, Icon }: ButtonProps) => </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token plain-text\">;\n\n// sử dụng\nimport  AccessAlarmIconGoogle  from  '@mui/icons-material/AccessAlarm';\n\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconComponent</span></span>  <span class=\"token attr-name\">Icon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>AccessAlarmIconGoogle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">button here</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ButtonWithIconComponent</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;</span></code></pre></div>\n<p>hoặc cách thứ 3 là truyền nó vào như một function</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">type ButtonProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> ReactNode<span class=\"token punctuation\">;</span>\n  <span class=\"token function-variable function\">renderIcon</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ReactElement<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">IconProps</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n};\n\nexport const ButtonWithIconRenderFunc = ({ children, renderIcon }: ButtonProps) => </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> icon <span class=\"token operator\">=</span> <span class=\"token function\">renderIcon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>icon<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token plain-text\">;\n\n// sử dụng\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconRenderFunc</span></span>  <span class=\"token attr-name\">renderIcon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">=></span>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span>  <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">button here</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ButtonWithIconRenderFunc</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Câu hỏi đặt ra là đâu là cách đúng nhất trong 3 cách? Và đâu là sự khác nhau giữa ba cách?</p>\n<p>Để thấy sự khác nhau, xem xét tình huống chúng ta cần một <code class=\"language-inline-text\">prop</code> default cho icon component, ví dụ chúng ta cho giá trị prop <code class=\"language-inline-text\">fontSize</code> mặc định sẽ là <code class=\"language-inline-text\">small</code></p>\n<p><strong>React Element</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// ButtonWithIconElement</span>\n<span class=\"token keyword\">const</span> clonedIcon <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">cloneElement</span><span class=\"token punctuation\">(</span>icon<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token string\">'small'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span>clonedIcon<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>React Component</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// ButtonWithIconElement</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ButtonWithIconComponent</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> Icon <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> ButtonProps</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span></span> <span class=\"token attr-name\">fontSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>small<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// sử dụng</span>\n<span class=\"token keyword\">import</span>  AccessAlarmIconGoogle  <span class=\"token keyword\">from</span>  <span class=\"token string\">'@mui/icons-material/AccessAlarm'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconComponent</span></span>  <span class=\"token attr-name\">Icon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>AccessAlarmIconGoogle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">button here</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ButtonWithIconComponent</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Tuy nhiên nếu chúng ta cần truyền các prop khác cho icon, cần thay đổi một chút khi sử dụng</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AccessAlarmIcon</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>error<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><img src=\"https://www.developerway.com/assets/components-in-props/mental-circle-with-props-example.png\"></p>\n<p><em>Lưu ý quan trọng, nếu dùng bên dưới nó sẽ không chính xác</em></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AccessAlarmIcon</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span> <span class=\"token attr-name\">fontSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>small<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>error<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><img src=\"https://www.developerway.com/assets/components-in-props/mental-circle-example.png\"></p>\n<p><strong>function</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// chỉnh lại button component</span>\n<span class=\"token keyword\">const</span> icon <span class=\"token operator\">=</span> <span class=\"token function\">renderIcon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token string\">'small'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// sử dụng</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconRenderFunc</span></span> <span class=\"token attr-name\">renderIcon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">settings</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span> <span class=\"token attr-name\">fontSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>settings<span class=\"token punctuation\">.</span>fontSize<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>success<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  button here\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ButtonWithIconRenderFunc</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Để đưa ra quyết định cuối cùng, chúng ta cần nhắc đến tình huống sử dụng sau, khi hover vào button chúng ta thay thành một icon với màu khác</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ButtonWithIcon</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isHovered<span class=\"token punctuation\">,</span> setIsHovered<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n      <span class=\"token attr-name\">onMouseOver</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsHovered</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">onMouseOut</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsHovered</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      ...\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Chúng ta sẽ thực hiện những thay đổi cần thiết, tùy theo cách truyền component</p>\n<p><strong>React Element</strong></p>\n<p>Chúng ta phải tạo một wrapper component cho icon để nhận prop từ phía <code class=\"language-inline-text\">&lt;ButtonWithIconElement /></code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AlarmIconWithHoverForElement</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span>\n      <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">color</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>isHovered <span class=\"token operator\">?</span> <span class=\"token string\">'primary'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'warning'</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// sử dụng</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconElement</span></span> <span class=\"token attr-name\">icon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AlarmIconWithHoverForElement</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">button here</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ButtonWithIconElement</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><strong>React component</strong></p>\n<p>Chúng ta sử dụng lại đúng như cách đã làm với prop <code class=\"language-inline-text\">color</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AccessAlarmIcon</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>error<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ButtonWithIconElement</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ButtonWithIconComponent</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> Icon <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> ButtonProps</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isHovered<span class=\"token punctuation\">,</span> setIsHovered<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n\t    <span class=\"token attr-name\">onMouseOver</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsHovered</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n\t    <span class=\"token attr-name\">onMouseOut</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsHovered</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span></span> <span class=\"token attr-name\">fontSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>small<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">isHovered</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isHovered<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Function</strong></p>\n<p>Tương tự <code class=\"language-inline-text\">color</code>, chỉ cần truyền thêm prop <code class=\"language-inline-text\">isHovered</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> icon <span class=\"token operator\">=</span> <span class=\"token function\">renderIcon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token string\">'small'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">isHovered</span><span class=\"token operator\">:</span> isHovered<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ButtonWithIconRenderFunc</span></span>\n  <span class=\"token attr-name\">renderIcon</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">settings</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessAlarmIconGoogle</span></span>\n      <span class=\"token attr-name\">fontSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>settings<span class=\"token punctuation\">.</span>fontSize<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">color</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>settings<span class=\"token punctuation\">.</span>isHovered <span class=\"token operator\">?</span> <span class=\"token string\">\"primary\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"warning\"</span><span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"kết-luận\"><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kết luận</h2>\n<p>Thành thật xin lỗi vì đã không thể có câu trả lời cho việc đâu là cách <em>100%</em> đúng nên dùng trong trường hợp này. Việc lựa chọn pattern nào để sử dụng ở đây mang nặng tính cá nhân hơn là sự chuẩn chỉnh về logic, cuối cùng đường nào cũng sẽ về la mã.</p>\n<p><a href=\"https://www.developerway.com/posts/react-component-as-prop-the-right-way\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">React component as prop: the right way</a></p>\n","cover_image":""}},{"node":{"id":"bfa175b4ea3e9a150e447b42a8510c43","title":"Giới thiệu maximum concurrency của Lambda khi sử dụng với SQS","path":"/2023-01-21-gioi-thieu-max-concurrency-lambda-sqs/","date":"2023-01-21","timeToRead":1,"desc":"Khi một SQS gọi lambda function chúng ta có thể quyết định số lượng tối đa concurrency của Lambda","content":"<h2 id=\"giới-thiệu\"><a href=\"#gi%E1%BB%9Bi-thi%E1%BB%87u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Giới thiệu</h2>\n<p>Với SQS standard, Lambda sẽ <em>poll</em> message trên queue, lúc đầu khởi tạo 5 concurrency, khi message trên SQS tăng lên, Lambda tiếp tục tăng số lượng concurrency lên để đủ đáp ứng, tối đa <em>1000</em></p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Lambda-processing-standard-SQS-queues.png\"></p>\n<p>Chi phí sẽ đội lên khi số lượng concurrency tăng lên quá nhiều, để ngăn chặn, chúng ta có thể <em>đăng ký</em> số lượng <strong>reserved concurrency</strong> cho từng Lambda function.</p>\n<p>Khi nó chạm đến ngưỡng <strong>reserved concurrency</strong>, message sẽ được đẩy trả về queue, sau đó sẽ tiếp tục retry hoặc gửi vào DLQ (SQS Dead letter queue) nếu đã quá số lần retry cho phép</p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Lambda-reaching-reserved-concurrency-of-10.-1024x736.png\"></p>\n<p><strong>maximum concurrency</strong> cũng khá giống với reserved concurrency, chỉ khác là nó chỉ hoạt động khi <strong>nơi gọi Lambda là SQS</strong>, khi đạt tới ngưỡng <strong>maximum concurrency</strong> Lambda sẽ ngừng lấy message từ queue, nó sẽ linh động hơn nếu chúng ta cần điều chỉnh giới hạn concurrency theo nơi gọi</p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Maximum-concurrency-is-set-to-10-for-the-SQS-queue.-1024x604.png\"></p>\n<p>Ngoài việc hạn chế Lambda dùng hết <em>nguồn lực</em> để xử lý message trên queue, chừa <em>sức</em> để xử lý những công việc đến từ các nguồn khác, nó còn tránh được việc message bị đưa về queue và đưa vào DLQ không cần thiết</p>\n<h2 id=\"thiết-đặt\"><a href=\"#thi%E1%BA%BFt-%C4%91%E1%BA%B7t\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Thiết đặt</h2>\n<p>Bên trong màn hình cấu hình <strong>Trigger</strong> của Lambda</p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Configuring-the-maximum-concurrency-for-an-SQS-trigger-in-the-console.-879x1024.png\"></p>\n<p>Nếu sử dụng CLI</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws lambda create-event-source-mapping --function-name my-function <span class=\"token function-name function\">--ScalingConfig</span> <span class=\"token punctuation\">{</span>MaxConcurrency<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">}</span> --event-source-arn arn:aws:sqs:us-east-2:123456789012:my-queue</code></pre></div>\n<p>Nếu sử dụng Cloudformation</p>\n<div class=\"gridsome-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">Resources</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">MaxConcurrencyFunction</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Serverless<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Function\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Handler</span><span class=\"token punctuation\">:</span> MyLambdaFunction\n      <span class=\"token key atrule\">Events</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">SQSEventFromMax</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> SQS\n          <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Queue</span><span class=\"token punctuation\">:</span> MySQSQueueArn\n            <span class=\"token key atrule\">BatchSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token key atrule\">Enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n            <span class=\"token key atrule\">ScalingConfig</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">MaximumConcurrency</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></code></pre></div>\n","cover_image":""}},{"node":{"id":"ef07fe54df031b8956b57411b846eb64","title":"Concurrent rendering trong React là gì?","path":"/2023-01-15-giai-thich-react-concurrent-rendering-la-gi/","date":"2023-01-15","timeToRead":5,"desc":"Bài viết này chúng ta sẽ cũng tìm hiểu React Concurrent, vấn đề nó giải quyết là gì và nó chạy như thế nào, ứng dụng thực tế","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81\">Vấn đề</a></li>\n<li><a href=\"#gi%E1%BA%A3i-ph%C3%A1p\">Giải pháp</a></li>\n<li>\n<p><a href=\"#api\">API</a></p>\n<ul>\n<li><a href=\"#usetransition\"><code class=\"language-inline-text\">useTransition</code></a></li>\n<li><a href=\"#usedeferredvalue\"><code class=\"language-inline-text\">useDeferredValue</code></a></li>\n</ul>\n</li>\n<li><a href=\"#tip\">Tip</a></li>\n<li><a href=\"#k%E1%BA%BFt\">Kết</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"vấn-đề\"><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Vấn đề</h2>\n<p>Chúng ta sẽ lấy một UI như bên dưới làm ví dụ</p>\n<p><img src=\"https://i.imgur.com/CCrR9dm.png\"></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> list <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./list\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"./style.css\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">,</span> setFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>filter<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span></span> <span class=\"token attr-name\">filter</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>filter<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">List</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> filter <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> filteredList <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    entry<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>filteredList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> - $</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ms</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>performance<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start <span class=\"token operator\">&lt;</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Hàm <code class=\"language-inline-text\">sleep</code> để giả lập việc render một component tốn nhiều thời gian</p>\n<p><img src=\"https://blog-codeminer42.s3.sa-east-1.amazonaws.com/wp-content/uploads/2022/12/08194847/list-filtering.gif\"></p>\n<p>Render <code class=\"language-inline-text\">&lt;List /></code> tốn thời gian, toàn bộ UI sẽ bị <em>đóng băng</em> cho đến khi toàn bộ quá trình này kết thúc, trong thời gian đang render, khi user tiếp tục nhập vào input, chúng ta sẽ thấy nó không <em>phản ứng</em></p>\n<p>Quá trình render component trước đây của React luôn là một quá trình <em>tuần tự</em>, chạy tiếp sức, khi 1 component chạy xong đến đích của nó, nó sẽ truyền cờ cho component tiếp theo chạy</p>\n<h2 id=\"giải-pháp\"><a href=\"#gi%E1%BA%A3i-ph%C3%A1p\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Giải pháp</h2>\n<p>React 18 giới thiệu cơ chế <strong>concurrent rendering</strong> để giải quyết vấn đề trên, developer sẽ chủ động khai báo những component nào có thể sẽ không cần render, có thể bỏ qua một số lần render không cần thiết.</p>\n<p>Như ở ví dụ trên, thay vì user vừa gõ vào một ký tự, <code class=\"language-inline-text\">&lt;List /></code> sẽ được render, <code class=\"language-inline-text\">&lt;List /></code> chỉ cần render ở lần cuối cùng (khá giống với <code class=\"language-inline-text\">lodash.debounce</code>)</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">,</span> setFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ưu tiên thấp, không cần chạy liền</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>delayedFilter<span class=\"token punctuation\">,</span> setDelayedFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isPending<span class=\"token punctuation\">,</span> startTransition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// cái này để kiểm tra giá trị khi chạy</span>\n  <span class=\"token function\">useDebug</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> filter<span class=\"token punctuation\">,</span> delayedFilter <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n        <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>filter<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setDelayedFilter</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span></span> <span class=\"token attr-name\">filter</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>delayedFilter<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> List <span class=\"token operator\">=</span> <span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> filter <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> filteredList <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    entry<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>filteredList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> - $</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><img src=\"https://blog-codeminer42.s3.sa-east-1.amazonaws.com/wp-content/uploads/2022/12/08195131/concurrent-list-filtering.gif\"></p>\n<h2 id=\"api\"><a href=\"#api\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>API</h2>\n<p>Ở thời điểm viết bài này, React giới thiệu cho chúng ta 2 API hỗ trợ concurrent rendering là <code class=\"language-inline-text\">useTransition</code> (hay <code class=\"language-inline-text\">startTransition</code> nếu dùng độc lập) và <code class=\"language-inline-text\">useDeferredValue</code></p>\n<h3 id=\"usetransition\"><a href=\"#usetransition\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">useTransition</code></h3>\n<p>Trong ví dụ ở trên, chúng ta đã <em>diện kiến</em> <code class=\"language-inline-text\">useTransition</code>, hook này sẽ trả về cho chúng ta hàm <code class=\"language-inline-text\">startTransition</code> và state <code class=\"language-inline-text\">isPending</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isPending<span class=\"token punctuation\">,</span> startTransition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-inline-text\">startTransition</code> sẽ <em>đánh dấu</em> những công việc có thứ tự ưu tiên thấp trong việc render, ở trên là việc đặt lại giá trị state <code class=\"language-inline-text\">delayFilter</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">startTranstion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">setDelayedFilter</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Một lưu ý quan trọng với callback truyền cho <code class=\"language-inline-text\">startTransition(callback)</code> là nó phải là một sync function, nghĩa là sử dụng như bên dưới sẽ không cho kết quả như mong đợi</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">❌\n<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n❌\n<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">asyncWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n❌\n<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">asyncWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Different call stack</span>\n    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Chúng ta cần sửa lại thành</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">await</span> <span class=\"token function\">asyncWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">asyncWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Một lưu ý khác, chỉ dùng với <code class=\"language-inline-text\">state</code>, không dùng được với <code class=\"language-inline-text\">ref</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">❌\n<span class=\"token keyword\">const</span> delayedFilterRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  delayedFilterRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"usedeferredvalue\"><a href=\"#usedeferredvalue\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">useDeferredValue</code></h3>\n<p>Vẫn là bài toán ban đầu, chúng ta sẽ giải quyết nó bằng <code class=\"language-inline-text\">useDeferredValue</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">,</span> setFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> deferredFilter <span class=\"token operator\">=</span> <span class=\"token function\">useDeferredValue</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useDebug</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> filter<span class=\"token punctuation\">,</span> deferredFilter <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n        <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>filter<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span></span> <span class=\"token attr-name\">filter</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>deferredFilter<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> List <span class=\"token operator\">=</span> <span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> filter <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> filteredList <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    entry<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>filteredList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> - $</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><img src=\"https://blog-codeminer42.s3.sa-east-1.amazonaws.com/wp-content/uploads/2022/12/08195534/deferred-values.gif\"></p>\n<p>Khác với <code class=\"language-inline-text\">useTransition</code> chúng ta phải thêm <code class=\"language-inline-text\">delayFilter</code> state và chủ động gán giá trị này, <code class=\"language-inline-text\">useDeferredValue</code> sẽ làm dùm cho chúng ta công việc <em>cơ bắp</em> đó, chúng ta truyền vào cho <code class=\"language-inline-text\">useDeferredValue</code> giá trị <em>\"nếu có thay đổi, thì mày khoan hả làm gì cả\"</em></p>\n<h2 id=\"tip\"><a href=\"#tip\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tip</h2>\n<p>Tip nhỏ nếu anh em nào muốn hiển thị <code class=\"language-inline-text\">loading</code> khi <code class=\"language-inline-text\">fetch</code> dữ liệu lần đầu, ở những lần tiếp theo chúng ta sẽ hiển thị dữ liệu cũ trong lúc đang chờ dữ liệu mới thay vì loading. Tới thời điểm hiện tại, chúng ta sẽ chưa đủ <em>đồ chơi</em> đề làm việc này</p>\n<p><img src=\"https://blog-codeminer42.s3.sa-east-1.amazonaws.com/wp-content/uploads/2022/12/08194847/list-filtering.gif\"></p>\n<p>Đây là lúc mang thêm <code class=\"language-inline-text\">&lt;Suspense /></code> vào</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">,</span> setPage<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> deferredPage <span class=\"token operator\">=</span> <span class=\"token function\">useDeferredValue</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n          <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">page</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> page <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          Previous Page\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n          <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">page</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> page <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          Next Page\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        Page: </span><span class=\"token punctuation\">{</span>page<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Loading...<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token attr-name\">page</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>deferredPage<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Component</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">suspenseFetchData</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>data\n        <span class=\"token operator\">?</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>entry<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>entry<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> <span class=\"token string\">\"Loading ...\"</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><img src=\"https://blog-codeminer42.s3.sa-east-1.amazonaws.com/wp-content/uploads/2022/12/08195634/new-stale-while-revalidate-transitions.gif\"></p>\n<h2 id=\"kết\"><a href=\"#k%E1%BA%BFt\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kết</h2>\n<p>Concurrent Rendering là một là một phương pháp mới để giải quyết những vấn đề <em>gặp hoài</em> với anh em làm Frontend, cân nhắc sử dụng nó để đem tới những trãi nghiệm sử dụng ứng dụng <em>mượt mà</em> cho người dùng nhé anh em.</p>\n","cover_image":""}},{"node":{"id":"07147b52eef5808a0a63aa97adc0f7b8","title":"Dùng lệnh docker exec để thực thi một lệnh trong Docker Container","path":"/2023-01-14-tuong-tac-voi-docker-container/","date":"2023-01-14","timeToRead":5,"desc":"Tìm hiểu cách tương tác với một docker container đang chạy","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#d%E1%BB%B1ng-m%E1%BB%99t-docker-container-%C4%91%E1%BB%83-th%E1%BB%B1c-h%C3%A0nh\">Dựng một Docker container để thực hành</a></li>\n<li><a href=\"#t%C3%ACm-t%C3%AAn-c%E1%BB%A7a-docker-container\">Tìm tên của Docker container</a></li>\n<li><a href=\"#ch%E1%BA%A1y-shell-trong-docker-container\">Chạy shell trong Docker container</a></li>\n<li><a href=\"#th%E1%BB%B1c-thi-command-trong-docker-container-kh%C3%B4ng-d%C3%B9ng-shell\">Thực thi command trong Docker container không dùng shell</a></li>\n<li><a href=\"#th%E1%BB%B1c-thi-m%E1%BB%99t-command-%E1%BB%9F-m%E1%BB%99t-th%C6%B0-m%E1%BB%A5c-trong-docker-container\">Thực thi một command ở một thư mục trong Docker container</a></li>\n<li><a href=\"#ch%E1%BA%A1y-command-b%E1%BA%B1ng-m%E1%BB%99t-user-kh%C3%A1c-trong-docker-container\">Chạy command bằng một user khác trong Docker container</a></li>\n<li><a href=\"#truy%E1%BB%81n-bi%E1%BA%BFn-m%C3%B4i-tr%C6%B0%E1%BB%9Dng-v%C3%A0o-docker-container\">Truyền biến môi trường vào Docker container</a></li>\n<li><a href=\"#l%E1%BB%97i-th%C6%B0%E1%BB%9Dng-g%E1%BA%B7p\">Lỗi thường gặp</a></li>\n</ul>\n<!-- /TOC -->\n<p>Khi làm việc với Docker chúng ta sẽ có nhu cầu tương tác bên trong container, để debug, inspect, kiểm tra trạng thái hiện của ứng dụng. Để thực thi một lệnh bên trong một container đang chạy, chúng ta sẽ dùng đến câu lệnh <code class=\"language-inline-text\">docker exec</code></p>\n<h2 id=\"dựng-một-docker-container-để-thực-hành\"><a href=\"#d%E1%BB%B1ng-m%E1%BB%99t-docker-container-%C4%91%E1%BB%83-th%E1%BB%B1c-h%C3%A0nh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dựng một Docker container để thực hành</h2>\n<p>Chúng ta sẽ dùng <code class=\"language-inline-text\">alpipe</code> image để dựng một container với mục đích thực hành lệnh <code class=\"language-inline-text\">docker exec</code></p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> container-name alpine <span class=\"token function\">watch</span> <span class=\"token string\">\"date >> /var/log/date.log\"</span></code></pre></div>\n<blockquote>\n<p><code class=\"language-inline-text\">-d</code> để chạy chế độ <em>detach</em>, nó sẽ chạy nền và không chiếm lấy terminal</p>\n</blockquote>\n<p><code class=\"language-inline-text\">watch \"date >> /var/log/date.log\"</code> là command mà chúng ta muốn chạy bên trong container, lệnh <code class=\"language-inline-text\">watch</code> sẽ chạy lặp lại sau mỗi 2 giây (thời gian mặc định), trong trường hợp này, câu lệnh <code class=\"language-inline-text\">date >> /var/log/date.log</code> sẽ in thời gian hiện tại vào file <code class=\"language-inline-text\">date.log</code> sau mỗi 2 giây. Cái file nó sẽ như thế này</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Sat Jan 14 01:35:11 UTC 2023\nSat Jan 14 01:35:13 UTC 2023\nSat Jan 14 01:35:15 UTC 2023</code></pre></div>\n<h2 id=\"tìm-tên-của-docker-container\"><a href=\"#t%C3%ACm-t%C3%AAn-c%E1%BB%A7a-docker-container\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tìm tên của Docker container</h2>\n<p>Trong trường hợp container đang chạy rồi, chúng ta lại không biết tên của nó là gì, chúng ta sẽ liệt kê toàn bộ docker đang chạy</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token function\">ps</span></code></pre></div>\n<p>kết quả trả về</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES\n76aded7112d4   alpine    \"watch 'date >> /var…\"   11 seconds ago   Up 10 seconds             container-name</code></pre></div>\n<p>Dùng container name hoặc container id để nói với <code class=\"language-inline-text\">docker exec</code> container nào sử dụng. Nếu muốn rename </p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token function\">rename</span> container-name new-name</code></pre></div>\n<h2 id=\"chạy-shell-trong-docker-container\"><a href=\"#ch%E1%BA%A1y-shell-trong-docker-container\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chạy shell trong Docker container</h2>\n<p>Để chạy <em>shell</em> bên trong container, dùng <code class=\"language-inline-text\">docker exec</code> với flag <code class=\"language-inline-text\">-i</code> <code class=\"language-inline-text\">-t</code> (viết gọp lại thành <code class=\"language-inline-text\">-it</code>)</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> container-name <span class=\"token function\">sh</span></code></pre></div>\n<p>Sau câu lệnh này, chúng ta sẽ đứng ở <em>shell</em> terminal bên trong container, để thoát khỏi terminal này, gõ lệnh <code class=\"language-inline-text\">exit</code> và nhấn <code class=\"language-inline-text\">ENTER</code></p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/ <span class=\"token comment\"># exit</span></code></pre></div>\n<p>Nếu không dùng <code class=\"language-inline-text\">shell</code> mà cần đến những tính năng chỉ có trong <code class=\"language-inline-text\">bash</code>, thay <code class=\"language-inline-text\">sh</code> ở câu lệnh trên bằng <code class=\"language-inline-text\">bash</code></p>\n<h2 id=\"thực-thi-command-trong-docker-container-không-dùng-shell\"><a href=\"#th%E1%BB%B1c-thi-command-trong-docker-container-kh%C3%B4ng-d%C3%B9ng-shell\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Thực thi command trong Docker container không dùng shell</h2>\n<p>Nếu cần thị thi một lệnh bên trong container, nhưng không cần mở <em>shell</em> để tương tác, gọi <code class=\"language-inline-text\">docker exec</code> không thêm bất kỳ flag nào</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> container-name <span class=\"token function\">tail</span> /var/log/date.log</code></pre></div>\n<p>Nó sẽ chạy lệnh <code class=\"language-inline-text\">tail /var/log/date.log</code> và in ra kết quả, mặc định lệnh <code class=\"language-inline-text\">tail</code> sẽ in ra mười dòng cuối cùng trong file</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Sat Jan 14 01:35:11 UTC 2023\nSat Jan 14 01:35:13 UTC 2023\nSat Jan 14 01:35:15 UTC 2023\nSat Jan 14 01:35:17 UTC 2023\nSat Jan 14 01:35:19 UTC 2023\nSat Jan 14 01:35:21 UTC 2023\nSat Jan 14 01:35:23 UTC 2023\nSat Jan 14 01:35:25 UTC 2023\nSat Jan 14 01:35:27 UTC 2023\nSat Jan 14 01:35:29 UTC 2023</code></pre></div>\n<h2 id=\"thực-thi-một-command-ở-một-thư-mục-trong-docker-container\"><a href=\"#th%E1%BB%B1c-thi-m%E1%BB%99t-command-%E1%BB%9F-m%E1%BB%99t-th%C6%B0-m%E1%BB%A5c-trong-docker-container\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Thực thi một command ở một thư mục trong Docker container</h2>\n<p>Để thực thi một lệnh bên trong một thư mục cụ thể, sử dụng flag <code class=\"language-inline-text\">--workdir</code> để chỉ định thư mục</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">--workdir</span> /tmp container-name <span class=\"token builtin class-name\">pwd</span></code></pre></div>\n<p>Câu lệnh trên, chỉ định thư mục <code class=\"language-inline-text\">/tmp</code> là thư mục mà lệnh sẽ đứng ở vị trí đó để thực thi, <code class=\"language-inline-text\">pwd</code> sẽ in ra thư mục hiện tại, kết quả là</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/tmp</code></pre></div>\n<h2 id=\"chạy-command-bằng-một-user-khác-trong-docker-container\"><a href=\"#ch%E1%BA%A1y-command-b%E1%BA%B1ng-m%E1%BB%99t-user-kh%C3%A1c-trong-docker-container\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chạy command bằng một user khác trong Docker container</h2>\n<p>Sử dụng flag <code class=\"language-inline-text\">--user</code> nếu muốn thực thì bằng một user khác</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">--user</span> guest container-name <span class=\"token function\">whoami</span></code></pre></div>\n<p>Kết quả của câu lệnh <code class=\"language-inline-text\">whoami</code> sẽ trả về user đang gọi lệnh</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">guest</code></pre></div>\n<h2 id=\"truyền-biến-môi-trường-vào-docker-container\"><a href=\"#truy%E1%BB%81n-bi%E1%BA%BFn-m%C3%B4i-tr%C6%B0%E1%BB%9Dng-v%C3%A0o-docker-container\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Truyền biến môi trường vào Docker container</h2>\n<p>Đôi khi chúng ta sẽ có nhu cầu truyền thêm biến môi trường vào trong container để chạy. Flag <code class=\"language-inline-text\">-e</code> sẽ cho phép chỉ định biến môi trường</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">TEST</span><span class=\"token operator\">=</span>binhan container-name <span class=\"token function\">env</span></code></pre></div>\n<p>Lệnh này sẽ khai báo một biến môi trường tên <code class=\"language-inline-text\">TEST</code> với giá trị <code class=\"language-inline-text\">binhan</code>. Lệnh <code class=\"language-inline-text\">env</code> sẽ in toàn bộ biến môi trường bên trong container</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=2191b2d508e9\nTEST=binhan\nHOME=/root</code></pre></div>\n<p>Nếu cần khai báo thêm biến môi trường thứ 2</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">TEST</span><span class=\"token operator\">=</span>binhan <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">ENVIROMENT</span><span class=\"token operator\">=</span>prod container-name <span class=\"token function\">env</span></code></pre></div>\n<p>Nếu mà nhiều biến hơn, chúng ta dùng file <code class=\"language-inline-text\">.env</code>, <code class=\"language-inline-text\">--env-file</code> để truyền file chưa biến môi trường</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> --env-file .env container-name <span class=\"token function\">env</span></code></pre></div>\n<p>Kết quả</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=76aded7112d4\nTEST=binhan\nENVIRONMENT=prod\nHOME=/root</code></pre></div>\n<h2 id=\"lỗi-thường-gặp\"><a href=\"#l%E1%BB%97i-th%C6%B0%E1%BB%9Dng-g%E1%BA%B7p\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Lỗi thường gặp</h2>\n<p>Khi sử dụng <code class=\"language-inline-text\">docker exec</code>, có thể chúng ta sẽ gặp một số lỗi như:</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error: No such container: container-name</code></pre></div>\n<p>Kiểm tra lại xem có sai chữ nào không, chạy <code class=\"language-inline-text\">docker ps</code> để kiểm tra lần nữa, tốt nhất là copy tên từ lệnh <code class=\"language-inline-text\">docker ps</code></p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error response from daemon: Container 2a94aae70ea5dc92a12e30b13d0613dd6ca5919174d73e62e29cb0f79db6e4ab is not running</code></pre></div>\n<p>Cái này là do container chưa chạy thôi, chỉ cần <code class=\"language-inline-text\">docker start container-name</code> để dựng nó lên</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error response from daemon: Container container-name is paused, unpause the container before exec</code></pre></div>\n<p>Container đang tạm dừng, khá rõ ràng là chúng ta cần <code class=\"language-inline-text\">docker unpause container-name</code> trước khi muốn làm gì tiếp</p>\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-use-docker-exec-to-run-commands-in-a-docker-container\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How To Use docker exec to Run Commands in a Docker Container</a></p>\n","cover_image":""}},{"node":{"id":"6c5fec044498dd797ded807e27e60261","title":"Dynamic component trong Vue","path":"/2022-12-16-giai-thich-dynamic-component-vue/","date":"2022-12-16","timeToRead":3,"desc":"Tìm hiểu khái niệm Dynamic component của Vue","content":"<p>Khái niệm dynamic component trong Vue rất đơn giản, nếu <code class=\"language-inline-text\">:is=\"true\"</code>, component đó sẽ được render</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>component</span> <span class=\"token attr-name\">:is</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>”currentTab”</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>component</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Khi chúng ta dùng <code class=\"language-inline-text\">:is</code>, còn một component khác cũng cần biết là <code class=\"language-inline-text\">&lt;keep-alive/></code>, nó cho phép component <em>tạm thời</em> núp lùm chứ không phải <em>diệt cỏ tận gốc</em>, ví dụ trong tab component, khi switch qua switch lại giữa các tab, không cần phải kill nó luôn.</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>keep-alive</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>component</span> <span class=\"token attr-name\">:is</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>”currentTab”</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>keep-alive</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Chúng ta nghiền ngẫm xem cách sử dụng 2 đứa này, với một trường hợp khác</p>\n<p>Có một cục dữ liệu như thế này, mỗi key là một kiểu dữ liệu khác nhau</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> person <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">firstName</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">lastName</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Doe\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">birthdate</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1986-06-22T00:00:00Z\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">anniversary</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2005-10-09T00:00:00Z\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">activities</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Skiing\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hiking\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Cycling\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Drinking Beer\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">about</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John talking about himself. It goes on and on forever...[snip]\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">metadata</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">lastUpdateUTC</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2019-06-29T15:14:00Z\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">lastUpdatedBy</span><span class=\"token operator\">:</span> <span class=\"token string\">\"admin\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Để hiển thị 1 dữ liệu của key, chúng ta có thể làm như thế này</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> {{ person.firstName }} {{ person.lastName }}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Birthday<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> {{ person.birthday | formatDate }}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>activities<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> \n  // loop tiếp\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Với từng kiểu dữ liệu khác nhau, chúng ta sẽ cần đến những filter khác nhau, hoặc thậm chí thêm thư viện (như để parse giá trị date). Vấn đề là chúng ta không loop được 1 lần một cho khỏe</p>\n<p>Trước tiên chúng ta cần đưa trách nhiệm xử lý, định dạng các kiểu dữ liệu này cho component con, thằng bố chúng ta chỉ việc loop thôi</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>First Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>details-text</span> <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>person.firstName + ' ' + person.lastName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Birthday<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>details-date</span> <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>person.birthday<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Activities<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>details-list</span> <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>person.activities<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Vẫn chưa loop được, vì các component con này là khác nhau, chúng ta cần có một cách nào đó để đưa điều kiện: “Ê, chọn component này khi dữ liệu là a,b,c,d”</p>\n<p>Dynamic component sẽ cho chúng ta làm điều đó!</p>\n<p>Trước tiên chúng  ta cần transform dữ liệu ban đầu về dạng mảng như sau</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token literal-property property\">computed</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">items</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>person<span class=\"token punctuation\">.</span>firstName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>person<span class=\"token punctuation\">.</span>lastName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DetailsText\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Birthday\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>person<span class=\"token punctuation\">.</span>birthday<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DetailsDate\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Activities\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>person<span class=\"token punctuation\">.</span>activities<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DetailsList\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Chúng ta đã có thể dùng <code class=\"language-inline-text\">v-for</code>, chọn đúng component cần dùng</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item in items<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{item.name}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>component</span> <span class=\"token attr-name\">:is</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.component<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Cái hay là chỗ chúng ta map <code class=\"language-inline-text\">:is=”item.component”</code> với component đã khai báo cho từng thằng dữ liệu </p>\n<p><a href=\"https://www.drewtown.dev/post/the-magic-of-vues-dynamic-components-for-lists-of-data\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The Magic of Vue's Dynamic Components For Lists of Data</a></p>\n","cover_image":""}},{"node":{"id":"933ee8a3a9e6b3f4f384e1dc4805c7d1","title":"Phân biệt sự khác nhau giữa Identity và Resource Base Policy trong AWS IAM","path":"/2022-09-25-phan-biet-identity-va-resource-base-policy/","date":"2022-09-25","timeToRead":2,"desc":"Series một số kiến thức cần có để lấy chứng chỉ AWS","content":"<p><strong>IDENTITY</strong>-based policy gán cho <code class=\"language-inline-text\">user</code>, <code class=\"language-inline-text\">group</code>, hoặc <code class=\"language-inline-text\">role</code> (gọi chung là <code class=\"language-inline-text\">identity</code>). Chỉ định những quyền gì mà <em>identity</em> có thể làm\n<strong>RESOURCE</strong>-based policy gán cho <em>resource</em>, ví dụ như S3 bucket, SQS queue, VPC endpooint</p>\n<p>Trong tình huống <code class=\"language-inline-text\">user</code> <em>không được cấp quyền</em> trên S3 bucket A (không được cấp không đồng nghĩa với việc bị cấm), nhưng resource policy đang gán cho bucket A cho phép mọi user upload vào bucket này, thì <code class=\"language-inline-text\">user</code> vẫn có thể upload</p>\n<p>Ví dụ, có <em>identity policy</em></p>\n<ul>\n<li>User A: List, Read trên resource A</li>\n<li>User B: List, Read trên resource B, C</li>\n<li>User C: List, Read, Write trên Resource A,B,C</li>\n<li>User D: Không có policy nào cả</li>\n</ul>\n<p>Tiếp đó chúng ta có <em>resource policy</em></p>\n<ul>\n<li>Resource A: User A = (List, Read), User C = (List, Read)</li>\n<li>Resource B: User B = (List, Write), User D = (List, Read)</li>\n<li>Resouce C: User B = Denied Access, User D: Full Access</li>\n</ul>\n<p>Thì kết quả từ 2 policy khi áp dụng sẽ là</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>LIST</th>\n<th>READ</th>\n<th>WRITE</th>\n<th>DENIED</th>\n<th>FULL ACCCESS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>User A</td>\n<td>RES A</td>\n<td>RES A</td>\n<td>🚫</td>\n<td>🚫</td>\n<td>🚫</td>\n</tr>\n<tr>\n<td>User B</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>RES C</td>\n<td>🚫</td>\n</tr>\n<tr>\n<td>User C</td>\n<td>RES A,B,C</td>\n<td>RES A,B,C</td>\n<td>RES A,B,C</td>\n<td>🚫</td>\n<td>🚫</td>\n</tr>\n<tr>\n<td>User D</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>🚫</td>\n<td>🚫</td>\n<td>RES C</td>\n</tr>\n</tbody>\n</table>\n<p>Khi <strong>identity</strong>-based policy kết hợp với <strong>Permission Boundary</strong>, lấy phần chung giữa hai tập</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/permissions_boundary.png\"></p>\n<p>Khi <strong>Resource</strong>-based policy kết hợp với <em>identity</em>-based policy và permission boundary, nó hơi ngoài lề một chút, lấy tất cả những phần chung giữa ba tập hợp cộng với tất cả những gì có trong resource-base policy</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/EffectivePermissions-rbp-boundary-id.png\"></p>\n<p>Khi kết hợp giữa tập <em>Service Control Policy</em>, <em>Permission boundary</em> và <em>identity-base policy</em>, chúng ta chỉ lấy phần tử chung của cả 3</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/EffectivePermissions-scp-boundary-id.png\"></p>\n<p>Tham khảo thêm <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"># Permissions boundaries for IAM entities</a></p>\n","cover_image":""}},{"node":{"id":"7ac3739a0f8e1c0f98a919794db694ac","title":"Lựa chọn giữa Redis và Memcached","path":"/2022-09-10-redis-vs-memcached/","date":"2022-09-10","timeToRead":1,"desc":"Series một số kiến thức cần có để lấy chứng chỉ AWS","content":"<p>Cả 2 điều rất dễ sử dụng và có chung công dụng tăng cường tốc độ, tuy nhiên có những khác biệt rất quan trọng chúng ta cần biết.</p>\n<p><strong>Redis</strong> và <strong>Memcached</strong> là 2 thư viện nguồn mở phổ biến khi cần kho dữ liệu <em>in-memory</em>. Memcached được thiết kế với định hướng đơn giản hóa nhất, trong khi Redis sẽ hỗ trợ nhiều tính năng và phù hợp với nhiều tình huống.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Memcached</th>\n<th>Redis</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cấu trúc dữ liệu phức tạp</td>\n<td></td>\n<td>✅</td>\n</tr>\n<tr>\n<td>Multithreaded</td>\n<td>✅</td>\n<td></td>\n</tr>\n<tr>\n<td>Snapshots</td>\n<td></td>\n<td>✅</td>\n</tr>\n<tr>\n<td>Replication</td>\n<td></td>\n<td>✅</td>\n</tr>\n<tr>\n<td>Transaction</td>\n<td></td>\n<td>✅</td>\n</tr>\n<tr>\n<td>Pub/Sub</td>\n<td></td>\n<td>✅</td>\n</tr>\n<tr>\n<td>Geospatial</td>\n<td></td>\n<td>✅</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"chọn-memcached-nếu-chúng-ta-gặp-yêu-cầu\"><a href=\"#ch%E1%BB%8Dn-memcached-n%E1%BA%BFu-ch%C3%BAng-ta-g%E1%BA%B7p-y%C3%AAu-c%E1%BA%A7u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chọn Memcached nếu chúng ta gặp yêu cầu</h3>\n<ul>\n<li>Đơn giản hóa</li>\n<li>Chạy trên những <em>node</em> lớn với nhiều core, nhiều thread</li>\n<li>Khả năng scale out/in</li>\n<li>Thêm/xóa node theo yêu cầu</li>\n<li>Phân biệt dữ liệu giữa các <em>shard</em></li>\n</ul>\n<h3 id=\"chọn-redis-nếu-chúng-ta-gặp-yêu-cầu\"><a href=\"#ch%E1%BB%8Dn-redis-n%E1%BA%BFu-ch%C3%BAng-ta-g%E1%BA%B7p-y%C3%AAu-c%E1%BA%A7u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chọn Redis nếu chúng ta gặp yêu cầu</h3>\n<ul>\n<li>Nhiều kiểu dữ liệu phức tạp như <code class=\"language-inline-text\">string</code>, <code class=\"language-inline-text\">hash</code>, <code class=\"language-inline-text\">list</code>, <code class=\"language-inline-text\">set</code></li>\n<li>Cần phải <strong>sắp xếp</strong> dữ liệu</li>\n<li>Cố định <em>key</em> của store</li>\n<li>Cần tạo <strong>replicate</strong> để tối ưu việc đọc dữ liệu</li>\n<li>Tự động <strong>failover</strong> nếu node chính chết</li>\n<li>Cần <strong>pub/sub</strong></li>\n<li>Khả năng <strong>backup/restore</strong></li>\n</ul>\n","cover_image":""}},{"node":{"id":"9cbb507063e9cbfe980133e85fe58558","title":"AWS SCP là gì","path":"/2022-09-06-aws-scp-permission-boundary-iam/","date":"2022-09-06","timeToRead":2,"desc":"Series một số kiến thức cần có để lấy chứng chỉ AWS","content":"<h2 id=\"aws-scp-là-gì\"><a href=\"#aws-scp-l%C3%A0-g%C3%AC\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>AWS SCP là gì</h2>\n<p>SCP là một tập hợp các rule <strong>cấp quyền</strong> sử dụng resource AWS trên tất cả account trong một AWS Organization</p>\n<h2 id=\"tại-sao-sử-dụng-scp\"><a href=\"#t%E1%BA%A1i-sao-s%E1%BB%AD-d%E1%BB%A5ng-scp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tại sao sử dụng SCP</h2>\n<p>Khi một tổ chức có nhiều account cần quản lý, việc quản lý sẽ khó khăn nếu chỉ sử dụng IAM</p>\n<p>IAM cho phép chúng ta kiểm soát quyền hạn trên từng user và role của một account, nhưng nếu chúng ta cần quản lý quyền hạn trên nhiều role/nhiều account cùng lúc sẽ cần đến một công cụ bao quát hơn</p>\n<blockquote>\n<blockquote>\n<p>OU (Organizational Unit) = tổ hợp các account được quản lý, SCP sẽ áp các rule trên từng OU</p>\n</blockquote>\n</blockquote>\n<p><img src=\"https://towardsthecloud.com/wp-content/uploads/aws-org-scp-diagram-1024x928.webp\"></p>\n<p>Như hình trên OU sẽ thường được định danh như các đơn vị <em>ban ngành</em> trong một tổ chức, chúng ta có <em>đội</em> nằm trong <code class=\"language-inline-text\">Core</code>, đội làm <code class=\"language-inline-text\">Application</code>, đội <code class=\"language-inline-text\">Development</code></p>\n<blockquote>\n<p>Lưu ý chỉ có thể áp tối đa <strong>5</strong> SCP trên một root/OU/account</p>\n</blockquote>\n<p>Ví dụ khai báo một policy <em>deny</em> việc sử dụng AWS Shield service</p>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Statement1\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Deny\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"shield:*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Vì SCP cũng có thể áp dụng trên root account, nên hãy rất cẩn thận và test kỹ trước khi áp dụng policy nào đó trên root account, tránh trường hợp mất các quyền quan trọng</p>\n<h2 id=\"scp-vs-permission-boundary-vs-iam-userrole-permission\"><a href=\"#scp-vs-permission-boundary-vs-iam-userrole-permission\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SCP vs Permission Boundary vs IAM User/Role Permission</h2>\n<p>SCP không phải chỉ để cấp quyền, nó còn có thể <em>deny</em>, có thể hình dung nó như một danh sách có thể làm gì và không được làm gì (<strong>Deny/Allow action</strong>) trên một nhóm đối tượng trong <strong>Organization</strong></p>\n<p><img src=\"https://cloudacademy.com/wp-content/uploads/2021/03/Screenshot-2021-03-05-at-16.55.23.png\"></p>\n<table>\n<thead>\n<tr>\n<th>SCP</th>\n<th>IAM Policies</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Dùng với OU</td>\n<td>Dùng với Principal (Ai)</td>\n</tr>\n<tr>\n<td>Không thay thế IAM Policy</td>\n<td>identity-base -> dùng với user, group, role. resource-base -> dùng với AWS resource như S3</td>\n</tr>\n<tr>\n<td>Dùng được với Root account</td>\n<td>Không dùng được với Root account</td>\n</tr>\n<tr>\n<td>Một account con chỉ có số quyền như account cha hoặc ít hơn</td>\n<td>Chỉ 1 trong 2: allow hoặc deny, nếu allow thì ngầm hiểu phần còn lại deny, nếu deny ngầm hiều phần còn lại allow</td>\n</tr>\n</tbody>\n</table>\n<p>Còn về Permission Boundaries nó được sử dụng cho user/role (một IAM entity), nó cấp <strong>maximum permission mà identity-base có thể cấp cho một IAM entity</strong>, nó không dùng được với <strong>resource-base</strong>, trong khi đó SCP có thể áp dụng trên cả identity-base và resource-base</p>\n<h2 id=\"tóm-tắt-thuật-ngữ\"><a href=\"#t%C3%B3m-t%E1%BA%AFt-thu%E1%BA%ADt-ng%E1%BB%AF\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tóm tắt thuật ngữ</h2>\n<table>\n<thead>\n<tr>\n<th>Thuật ngữ</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>resource-base policy</td>\n<td>policy dùng với user, group, role</td>\n</tr>\n<tr>\n<td>identity-base policy</td>\n<td>policy dùng với các service của AWS</td>\n</tr>\n<tr>\n<td>Organization</td>\n<td>Đơn vị chúng ta khai bảo để tiện quản lý</td>\n</tr>\n</tbody>\n</table>\n","cover_image":""}},{"node":{"id":"890f605c987a5f46932d0368a51e02d6","title":"Nguyên lý nền tảng clean code trong JS","path":"/2022-08-24-clean-code-js/","date":"2022-08-24","timeToRead":1,"desc":"Ví dụ chủ yếu bằng JS, nhưng cũng có thể áp dụng với các ngôn ngữ khác","content":"<h2 id=\"exit-sớm-khi-có-thể\"><a href=\"#exit-s%E1%BB%9Bm-khi-c%C3%B3-th%E1%BB%83\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Exit sớm khi có thể</h2>\n<p><code class=\"language-inline-text\">#exit early when possible</code></p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--gFdvC2DR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-1.png\" alt=\"clean code principles\"></p>\n<h2 id=\"rõ-ràng-tốt-hơn-thông-minh\"><a href=\"#r%C3%B5-r%C3%A0ng-t%E1%BB%91t-h%C6%A1n-th%C3%B4ng-minh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Rõ ràng tốt hơn thông minh</h2>\n<p><code class=\"language-inline-text\">#Be expressive, not clever</code>\nHàm bên trái có vẻ trong cool ngầu hơn, nhưng nếu nghĩ đến việc thay đổi một xíu logic thì hàm bên phải sẽ dễ hơn vì nó dễ đọc và dễ hiểu hơn, không cần tốn quá nhiều mana để thấu hiểu</p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--C00ZxQZ2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-2.png\" alt=\"clean code principles\"></p>\n<h2 id=\"tên-biến-rành-mạch\"><a href=\"#t%C3%AAn-bi%E1%BA%BFn-r%C3%A0nh-m%E1%BA%A1ch\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tên biến rành mạch</h2>\n<p><code class=\"language-inline-text\">#Make variable names descriptive</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--iMyCptAk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-3.png\" alt=\"clean code principles\"></p>\n<h2 id=\"nên-dùng-for-of\"><a href=\"#n%C3%AAn-d%C3%B9ng-for-of\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nên dùng <code class=\"language-inline-text\">for-of</code></h2>\n<p>Tuy không phải nhanh nhất nhưng <code class=\"language-inline-text\">for-of</code> có nhiều điểm cộng hơn so với <code class=\"language-inline-text\">for-in</code>, <code class=\"language-inline-text\">for-i</code>, <code class=\"language-inline-text\">forEach</code></p>\n<ul>\n<li>ngắn hơn</li>\n<li>cho phép continue, return và break trong vòng lặp</li>\n<li>dễ follow hơn</li>\n</ul>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--jGut6Jci--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-4.png\" alt=\"clean code principles\"></p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OBn52DyH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-5.png\" alt=\"clean code principles\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--2H0zwKG2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-6.png\" alt=\"clean code principles\"></p>\n<h2 id=\"dùng-prefix-is-has-với-các-biến-mang-giá-trị-boolean\"><a href=\"#d%C3%B9ng-prefix-is-has-v%E1%BB%9Bi-c%C3%A1c-bi%E1%BA%BFn-mang-gi%C3%A1-tr%E1%BB%8B-boolean\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dùng prefix <code class=\"language-inline-text\">is</code>, <code class=\"language-inline-text\">has</code> với các biến mang giá trị boolean</h2>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--3Cme03R_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-7.png\" alt=\"clean code principles\"></p>\n<h2 id=\"tránh-dùng-phủ-định-\"><a href=\"#tr%C3%A1nh-d%C3%B9ng-ph%E1%BB%A7-%C4%91%E1%BB%8Bnh-\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tránh dùng phủ định <code class=\"language-inline-text\">!</code></h2>\n<p><code class=\"language-inline-text\">#Avoid double negatives</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--8eAJqI1M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-8.png\" alt=\"clean code principles\">\n<code class=\"language-inline-text\">#Avoid using “!” with “else”</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--mo_PlhPY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/y5aubh2ycvsrxad89acx.png\" alt=\"Image description\"></p>\n<h2 id=\"nối-chuỗi-bằng-\"><a href=\"#n%E1%BB%91i-chu%E1%BB%97i-b%E1%BA%B1ng-\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nối chuỗi bằng <code class=\"language-inline-text\">+</code></h2>\n<p><code class=\"language-inline-text\">#Prefer string interpolation over concatenation</code>\nDễ đọc hơn\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--naFp1Y1E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b86sc4fofvpj3h8j7rzc.png\" alt=\"Image description\"></p>\n<h2 id=\"tránh-sử-dụng-ternary-operator-để-trả-về-giá-trị-boolean\"><a href=\"#tr%C3%A1nh-s%E1%BB%AD-d%E1%BB%A5ng-ternary-operator-%C4%91%E1%BB%83-tr%E1%BA%A3-v%E1%BB%81-gi%C3%A1-tr%E1%BB%8B-boolean\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tránh sử dụng ternary operator để trả về giá trị boolean</h2>\n<p><code class=\"language-inline-text\">#Avoid using the ternary operator to a return boolean value</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--uqMPao6g--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6ki75tjajqfdz28edadc.png\" alt=\"Image description\"></p>\n<h2 id=\"không-sử-dụng-magic-number\"><a href=\"#kh%C3%B4ng-s%E1%BB%AD-d%E1%BB%A5ng-magic-number\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Không sử dụng magic number</h2>\n<p><code class=\"language-inline-text\">#Avoid using “magic” numbers</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--DoVWaX-X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/agjo6gso4ar0tv06k0dt.png\" alt=\"Image description\"></p>\n<h2 id=\"tránh-truyền-hơn-2-tham-số-cho-function\"><a href=\"#tr%C3%A1nh-truy%E1%BB%81n-h%C6%A1n-2-tham-s%E1%BB%91-cho-function\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tránh truyền hơn 2 tham số cho function</h2>\n<p><code class=\"language-inline-text\">#Avoid declaring functions with more than 2 arguments</code>\nNếu có nhiều hơn 2 tham số truyền vào cho function, hãy dùng object\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--mSzEeLD5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-14.png\" alt=\"clean code principles\"></p>\n<h2 id=\"tham-số-truyền-vào-là-boolean-thì-dùng-object\"><a href=\"#tham-s%E1%BB%91-truy%E1%BB%81n-v%C3%A0o-l%C3%A0-boolean-th%C3%AC-d%C3%B9ng-object\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tham số truyền vào là boolean thì dùng object</h2>\n<p><code class=\"language-inline-text\">#Prefer objects to boolean arguments</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SSpeskvO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-15.png\" alt=\"clean code principles\"></p>\n<h1 id=\"dành-cho-react\"><a href=\"#d%C3%A0nh-cho-react\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dành cho React</h1>\n<h2 id=\"mỗi-function-là-một-dom\"><a href=\"#m%E1%BB%97i-function-l%C3%A0-m%E1%BB%99t-dom\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Mỗi function là một DOM</h2>\n<p><code class=\"language-inline-text\">#Declare DOM only once per function</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--EqOya5qJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-16.png\" alt=\"clean code principles\"></p>\n<h2 id=\"cẩn-thận-với-\"><a href=\"#c%E1%BA%A9n-th%E1%BA%ADn-v%E1%BB%9Bi-\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cẩn thận với <code class=\"language-inline-text\">&amp;&amp;</code></h2>\n<p><code class=\"language-inline-text\">#Mind the guard operator</code>\n<img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--uxYQ7Xi3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://kendsnyder.com/sandbox/clean_code/images/combined-18.png\" alt=\"clean code principles\"></p>\n<p>Lấy cảm hứng từ cuốn <a href=\"https://www.amazon.com/Elements-Style-Fourth-William-Strunk/dp/020530902X/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The elements of style</a>\nHình ảnh từ <a href=\"https://dev.to/flatlogic/javascript-clean-code-principles-286\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"></a></p>\n","cover_image":""}},{"node":{"id":"8b00dbecf693b54e06b8107947c6c529","title":"8 thẻ html ít ai biết nhưng lại rất hay ho","path":"/2022-05-15-8-html-it-duoc-ai-biet/","date":"2022-05-15","timeToRead":2,"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#s\"><code class=\"language-inline-text\">s</code></a></li>\n<li><a href=\"#ruby-rt-rp\"><code class=\"language-inline-text\">ruby</code>, <code class=\"language-inline-text\">rt</code>, <code class=\"language-inline-text\">rp</code></a></li>\n<li><a href=\"#details\"><code class=\"language-inline-text\">details</code></a></li>\n<li><a href=\"#optgroup\"><code class=\"language-inline-text\">optgroup</code></a></li>\n<li><a href=\"#meter\"><code class=\"language-inline-text\">meter</code></a></li>\n<li><a href=\"#progress\"><code class=\"language-inline-text\">progress</code></a></li>\n<li><a href=\"#kbd\"><code class=\"language-inline-text\">kbd</code></a></li>\n<li><a href=\"#bdo\"><code class=\"language-inline-text\">bdo</code></a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"s\"><a href=\"#s\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">s</code></h2>\n<p>Được dùng để đánh dấu một nội dung không còn chính xác nữa, ví dụ giá cũ. Nội dung sẽ bị gạch ngang</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>s</span><span class=\"token punctuation\">></span></span>10.000 đ<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>s</span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>9.999 đ<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>CSS để có format giống như tag <code class=\"language-inline-text\">&lt;s></code></p>\n<div class=\"gridsome-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.line-through</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">text-decoration</span><span class=\"token punctuation\">:</span> line-through<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"ruby-rt-rp\"><a href=\"#ruby-rt-rp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">ruby</code>, <code class=\"language-inline-text\">rt</code>, <code class=\"language-inline-text\">rp</code></h2>\n<p>Thêm phần ghi chú, lúc đầu được thiết kế để dùng thêm chú thích cho các ký tự không phải latin</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ruby</span><span class=\"token punctuation\">></span></span>帶翅膀<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rt</span><span class=\"token punctuation\">></span></span>Carmine<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rt</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ruby</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ruby</span><span class=\"token punctuation\">></span></span>的老鼠<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rt</span><span class=\"token punctuation\">></span></span>Falcone<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rt</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ruby</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--iNjF4CSp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1xmmeopz2m96ngxh7a6h.png\"></p>\n<h2 id=\"details\"><a href=\"#details\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">details</code></h2>\n<p>Cũng dùng để thêm chú thích, nhưng dưới dạng <em>collapse</em>, user có thể đóng/mở phần chú thích này</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>details</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>summary</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span>pointer<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>Xem diễn giải<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>summary</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n\t\tĐây là nội dung có ích lắm\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>details</span><span class=\"token punctuation\">></span></span> </code></pre></div>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hQRdd3Sa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xgal47336yb6ktmuccqm.png\"></p>\n<h2 id=\"optgroup\"><a href=\"#optgroup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">optgroup</code></h2>\n<p>Được dùng để gộp các element liên quan với nhau bên trong <code class=\"language-inline-text\">&lt;select></code></p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optgroup</span> <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Trái cây<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cam<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Cam<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dua-hau<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Dưa hấu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optgroup</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optgroup</span> <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Nước Ép<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ca-sau<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Cá sấu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>khung-long<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Khủng Long<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optgroup</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"meter\"><a href=\"#meter\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">meter</code></h2>\n<p>Hiển thị <code class=\"language-inline-text\">gauge</code> (cột năng lượng), như vầy nè</p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oG5gI0AM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/11rwsx8j10ccqaak6zhs.png\"></p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span> 0L \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fuel<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">min</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">low</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>33<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">high</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>66<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">optimum</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>80<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        at 50/100\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>meter</span><span class=\"token punctuation\">></span></span> 5L\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span> 0L \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fuel<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">min</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">low</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>33<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">high</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>66<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">optimum</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>80<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>50<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        at 50/100\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>meter</span><span class=\"token punctuation\">></span></span> 5L\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span> 0L \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fuel<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">min</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">low</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>33<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">high</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>66<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">optimum</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>80<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>80<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        at 50/100\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>meter</span><span class=\"token punctuation\">></span></span> 5L\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"progress\"><a href=\"#progress\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">progress</code></h2>\n<p>Như tên đã nói lên tất cả, dùng để hiển thị tiến trình, cũng hơi na ná với <code class=\"language-inline-text\">meter</code> há</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>File progress:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>progress</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>70<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> 70% <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>progress</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--guaJQXSD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6wm0r9c5ez7iasz6gj3q.png\"></p>\n<h2 id=\"kbd\"><a href=\"#kbd\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">kbd</code></h2>\n<p>Được thiết kế <em>kẹp</em>  phím tắt, nội dung bên trong sẽ được mặc định hiện thị bằng font <code class=\"language-inline-text\">monospace</code></p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Press <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>kbd</span><span class=\"token punctuation\">></span></span>Ctrl<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>kbd</span><span class=\"token punctuation\">></span></span> + <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>kbd</span><span class=\"token punctuation\">></span></span>C<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>kbd</span><span class=\"token punctuation\">></span></span> to copy text (Windows).<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--IDPlHZaK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vgqcbg81dptv46om81up.png\"></p>\n<h2 id=\"bdo\"><a href=\"#bdo\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code class=\"language-inline-text\">bdo</code></h2>\n<p>Viết tắt cho <code class=\"language-inline-text\">Bi-Directional Override</code>, hiển thị text ở dạng animate, đổi hướng hiển thị, một trong những tag ít sử dụng và <em>lạ</em> nhất so với những thằng đã kể trên</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bdo</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rtl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>May the force be with you.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bdo</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--g9ok-gPV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/i54v3vic225493ihkkuy.gif\"></p>\n<p><a href=\"https://dev.to/samsundar/8-unknown-html-tags-that-are-actually-quite-useful-2l45\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">8 Unknown HTML tags that are actually quite useful</a></p>\n","cover_image":""}},{"node":{"id":"c8a93009b5744dc61180bda6cbd817fb","title":"React Transition","path":"/2022-05-07-cach-dung-usetransition-trong-react/","date":"2022-05-07","timeToRead":3,"desc":"Một tính năng mới trong React 18, cho phép chúng ta đánh giấu một thay đổi là transition","content":"<h2 id=\"tại-sao\"><a href=\"#t%E1%BA%A1i-sao\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tại sao?</h2>\n<p>Một vấn đề rất thực tế mà chúng ta hay gặp khi viết <em>search component</em>, chúng ta sẽ thêm cơ chế <em>debounce</em> khi gọi xuống API sau khi user nhập giá trị vào <code class=\"language-inline-text\">input</code>, <em>debounce</em> tức là hổng đi làm liền mà đợi cho đến hết thời gian thì mới làm.</p>\n<p>Trước đây, React không có phân biệt giữa cái gì cần làm liền và cái gì có thể để sau rồi làm, dân tình gọi là sống vội. Giờ đây, thấy việc sống vội như thế là mà lối sống sai lầm, nên mở ra khái niệm <em>sống chậm</em>, thông thả mà làm. Như món nào cần gấp thì bạn bay ra tạp quá gần nhà mua liền, món nào chưa cần ngay thì đưa vào danh sách mua sắm cuối tháng đi siêu thị.</p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6-YH79KT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t359lpszuvb3k6dlm6q0.gif\"></p>\n<p>Những công chuyện nào được coi là <em>sống chậm</em> React sẽ không làm liền và không hiển thị <em>Suspense fallback</em> component.</p>\n<p>2 API mới, một hook và một cái dùng trong trường hợp không thể dùng hook</p>\n<ul>\n<li>React.startTransition</li>\n<li>React.useTransition</li>\n</ul>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isPending<span class=\"token punctuation\">,</span> startTransition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>isPending <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Spinner</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClick<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Chúng ta có một danh sách <em>employee name</em>, khi user nhập vào input, chúng ta thực hiện <em>filter</em> lại danh sách này.</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">FilterList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> name <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">changeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> value <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setQuery</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>innput</span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>changeHandler<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>names<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n\t\t        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ListItem</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">name</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">highlight</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n\t\t      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ListItem</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> highlight <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>highlight<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>highlight<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> index <span class=\"token operator\">+</span> highlight<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> highlight<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://codesandbox.io/s/heavy-update-as-urgent-ejwbg?file=/src/FilterList.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Demo</a></p>\n<p>Khi user nhập quá nhanh, chúng ta sẽ thấy UI có vẻ hơi <em>lag</em> và nó không hiển thị được kết quá ngay.</p>\n<p>Ở đây <code class=\"language-inline-text\">&lt;ListItem /></code> đã được update liên tục khi user nhập vào input, việc này là không cần thiết, nó chỉ cần cập nhập lại sau khi user đã kết thúc nhập liệu, một cách khác là bỏ quả tất cả những lần cập nhập ở giữa, chỉ giữ lại lần cập nhập sau cùng.</p>\n<p>Để sửa lại</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useTransition <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">FilterList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> names <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>highlight<span class=\"token punctuation\">,</span> setHighlight<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isPending<span class=\"token punctuation\">,</span> startTransition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">changeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> value <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setQuery</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setHighlight</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>changeHandler<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>names<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ListItem</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">name</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">highlight</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>highlight<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://codesandbox.io/s/heavy-update-as-non-urgent-ifobc?file=/src/FilterList.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Demo</a>.</p>\n<p><a href=\"https://dmitripavlutin.com/react-usetransition/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Don't Stop Me Now: How to Use React useTransition() hook</a></p>\n","cover_image":""}},{"node":{"id":"43406148266add9ca30a703612341dbb","title":"Tất cả những gì bạn cần biết khi làm user avatar trong React","path":"/2022-05-01-tat-ca-nhung-gi-can-biet-de-lam-viec-voi-avatar-trong-react/","date":"2022-05-01","timeToRead":4,"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#t%E1%BA%A1o-avatar-m%E1%BA%B7c-%C4%91%E1%BB%8Bnh\">Tạo avatar mặc định</a></li>\n<li><a href=\"#cho-user-upload-avatar\">Cho user upload avatar</a></li>\n<li><a href=\"#crop-%E1%BA%A3nh\">Crop ảnh</a></li>\n<li><a href=\"#to%C3%A0n-b%E1%BB%99-source-code\">Toàn bộ source code</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"tạo-avatar-mặc-định\"><a href=\"#t%E1%BA%A1o-avatar-m%E1%BA%B7c-%C4%91%E1%BB%8Bnh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tạo avatar mặc định</h2>\n<p>Trong trường hợp user chưa upload avatar, chúng ta sẽ hiển thị một avatar mặc định, sử dụng <a href=\"https://www.npmjs.com/package/jdenticon\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jdenticon</a> nó sẽ cho chúng ta bộ hình sau</p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--kYzqAMFa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jrn6svy3k9b3qznrgkla.png\"></p>\n<div class=\"gridsome-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ComponentProps<span class=\"token punctuation\">,</span> <span class=\"token constant\">FC</span><span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> AutoAvatar<span class=\"token operator\">:</span> <span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span>\n  ComponentProps<span class=\"token operator\">&lt;</span><span class=\"token string\">'img'</span><span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span> userId<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> size<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> userId<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>imgProps <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>base64<span class=\"token punctuation\">,</span> setBase64<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// dùng dynamic import để tối ưu</span>\n  <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jdenticon'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> toSvg <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> svgString <span class=\"token operator\">=</span> <span class=\"token function\">toSvg</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> base64 <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>svgString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setBase64</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> base64 <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgb(225,225,225)'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span>\n        <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>imgProps<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">data:image/svg+xml;base64,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>base64<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">alt</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'User Avatar'</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> size<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> size<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'inline-block'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      Loading...\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Thư viện này khoản 45kb, để webpack dynamic load khi cần thiết cho tiết kiệm\nGiá trị <strong>base64</strong> trả về chúng ta có thể gán cho <code class=\"language-inline-text\">src</code> của thẻ <code class=\"language-inline-text\">&lt;img /></code></p>\n<h2 id=\"cho-user-upload-avatar\"><a href=\"#cho-user-upload-avatar\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cho user upload avatar</h2>\n<p>Nếu chỉ dùng <code class=\"language-inline-text\">&lt;input type=\"file\" /></code> UI nó sẽ khá xấu, chúng ta <em>dấu</em> nó đi và thay bằng một <code class=\"language-inline-text\">&lt;button /></code> để dễ chỉnh CSS hơn. Sử dụng <code class=\"language-inline-text\">ref</code> để trigger sự kiện <em>click</em> trên <code class=\"language-inline-text\">input</code></p>\n<div class=\"gridsome-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>createRef<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ImageSelect</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> fileRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> onFileInputChange<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ChangeEventHandler<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token operator\">?.</span>files<span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n        <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>fileRef<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onFileInputChange<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/png,image/jpeg,image/gif<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n        <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> fileRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Cool Button\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"crop-ảnh\"><a href=\"#crop-%E1%BA%A3nh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Crop ảnh</h2>\n<p>Trước khi gửi ảnh xuống backend dể lưu lại, chúng ta sẽ cho phép user <code class=\"language-inline-text\">crop</code> ảnh bằng <a href=\"https://fengyuanchen.github.io/cropperjs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cropper.js</a> và <a href=\"https://www.npmjs.com/package/react-cropper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">react-cropper</a></p>\n<p><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--B3T2HPu8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rmvn8upi2y1onvpsvclt.gif\"></p>\n<div class=\"gridsome-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>createRef<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>Cropper<span class=\"token punctuation\">,</span> ReactCropperElement<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-cropper\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'cropperjs/dist/cropper.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ImageCrop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cropperRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>ReactCropperElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Cropper</span></span>\n      <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>&lt;the iamge src><span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">autoCropArea</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">aspectRatio</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">viewMode</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">guides</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>cropperRef<span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Một số thiết đặt</p>\n<ul>\n<li><code class=\"language-inline-text\">autoCropArea = 1</code> mặc định là chọn toàn bộ hình</li>\n<li><code class=\"language-inline-text\">aspectRatio = 1</code> tỉ lệ crop mong muốn, chọn 1:1, vuông</li>\n<li><code class=\"language-inline-text\">viewMode = 3</code> không cho phép chọn vào vùng nằm ngoài hình</li>\n<li><code class=\"language-inline-text\">guides = false</code> không hiển thị mấy đường <em>grid</em></li>\n</ul>\n<div class=\"gridsome-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>createRef<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>Cropper<span class=\"token punctuation\">,</span> ReactCropperElement<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-cropper\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'cropperjs/dist/cropper.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ImageCrop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cropperRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>ReactCropperElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>cropped<span class=\"token punctuation\">,</span> setCropped<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onSaveClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> imageElement<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token operator\">=</span> cropperRef<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cropper<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token operator\">=</span> imageElement<span class=\"token operator\">?.</span>cropper<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setCropped</span><span class=\"token punctuation\">(</span>cropper<span class=\"token punctuation\">.</span><span class=\"token function\">getCroppedCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Cropper</span></span>\n        <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"https://picsum.photos/500/300\"</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">autoCropArea</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">aspectRatio</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">viewMode</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">guides</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>cropperRef<span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onSaveClick<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Crop</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>cropped <span class=\"token operator\">&amp;&amp;</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>cropped<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">alt</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"It's cropped\"</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">/></span></span>\n      <span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Để lấy image cho việc upload, sử dụng <code class=\"language-inline-text\">blob</code>. Còn nếu chỉ cần hiển thị thì dùng <code class=\"language-inline-text\">dataUrl</code> như ở trên</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">cropper<span class=\"token punctuation\">.</span><span class=\"token function\">getCroppedCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"toàn-bộ-source-code\"><a href=\"#to%C3%A0n-b%E1%BB%99-source-code\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Toàn bộ source code</h2>\n<div class=\"gridsome-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>createRef<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'./App.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>Cropper<span class=\"token punctuation\">,</span> ReactCropperElement<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-cropper\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'cropperjs/dist/cropper.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'./roundedCropper.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// chuyển file qua base64</span>\n<span class=\"token keyword\">const</span> file2Base64 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token operator\">:</span> File<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">.</span>result<span class=\"token operator\">?.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ref đến file input</span>\n  <span class=\"token keyword\">const</span> fileRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// hình được chọn</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>uploaded<span class=\"token punctuation\">,</span> setUploaded<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// kết quả của image sau khi crop</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>cropped<span class=\"token punctuation\">,</span> setCropped<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ref đến crop element</span>\n  <span class=\"token keyword\">const</span> cropperRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>ReactCropperElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> onFileInputChange<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ChangeEventHandler<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token operator\">?.</span>files<span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">file2Base64</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setUploaded</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onCrop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> imageElement<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token operator\">=</span> cropperRef<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cropper<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token operator\">=</span> imageElement<span class=\"token operator\">?.</span>cropper<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setCropped</span><span class=\"token punctuation\">(</span>cropper<span class=\"token punctuation\">.</span><span class=\"token function\">getCroppedCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>App<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span>\n          uploaded <span class=\"token operator\">?</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Cropper</span></span>\n                <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>uploaded<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">autoCropArea</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">aspectRatio</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">viewMode</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">guides</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>cropperRef<span class=\"token punctuation\">}</span></span>\n              <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onCrop<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Crop</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token punctuation\">{</span>cropped <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>cropped<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Cropped!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token operator\">:</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n                <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>fileRef<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onFileInputChange<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/png,image/jpeg,image/gif<span class=\"token punctuation\">\"</span></span>\n              <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n                <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> fileRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n              <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Upload something!\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><a href=\"https://tolgee.io/blog/manage-user-avatar\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">All you need to know to deal with user avatars 👤 in React</a></li>\n</ul>\n","cover_image":""}},{"node":{"id":"539b556649530f0970013d8a6d4121dc","title":"Setup CloudFront cho ứng dụng","path":"/2022-04-30-setup-cloudfront-cho-und-dung/","date":"2022-04-30","timeToRead":3,"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-dns\">Cấu hình DNS</a></li>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-cloudfront-distribution\">Cấu hình CloudFront distribution</a></li>\n</ul>\n<!-- /TOC -->\n<p>Chúng ta sẽ cùng cấu hình để đưa toàn bộ ứng dụng lên CloudFront, với những dữ liệu không nên cache như <em>data</em>, <em>auth</em>,... sẽ được <em>proxy</em> (chuyển tiếp) đến server.</p>\n<h2 id=\"cấu-hình-dns\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-dns\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cấu hình DNS</h2>\n<p>Mục tiêu cuối cùng của chúng ta là đưa toàn bộ ứng dụng lên CloudFront. Tức là khi user truy cập vào domain, họ sẽ load ứng dụng từ CloudFront chứ không phải từ server. Trước tiên chúng ta phải vào <em>Route 53</em> để thay đổi lại DNS</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645834717715_image.png?resize=1024%2C280&#x26;ssl=1\"></p>\n<p>Chọn <strong>Hosted Zone</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645994751238_image.png?w=821&#x26;ssl=1\"></p>\n<p>Click vào <strong>Create Hosted zone</strong> và nhập vào domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645908142161_image.png?resize=1024%2C237&#x26;ssl=1\"></p>\n<p>Chúng ta đang nói với AWS hãy quản lý domain này cho tôi, AWS đưa cho chúng ta giá trị NS (name server) mà nó sẽ <em>route traffic</em> đến. Chúng ta sẽ cần đến chỗ quản lý domain, tùy thuộc vào nơi chúng ta đăng ký domain, giao diện quản lý có thể khác nhau, chúng ta cập nhập lại giá trị <em>NS</em> này cho domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645835018979_image.png?w=762&#x26;ssl=1\"></p>\n<p>Trước khi thay đổi, nhớ lưu lại backup giá trị NS gốc</p>\n<h2 id=\"cấu-hình-cloudfront-distribution\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-cloudfront-distribution\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cấu hình CloudFront distribution</h2>\n<p>Chúng ta sẽ điền vào phần <em>origin domain</em>, đừng nhập giá trị <strong>top-level domain</strong> như <code class=\"language-inline-text\">your-app.com</code>, nó sẽ là giá trị sub domain, như <code class=\"language-inline-text\">your-app.herokuapp.com</code> (nếu được host trên herokuapp.com)</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645841894888_image.png?resize=1024%2C292&#x26;ssl=1\"></p>\n<p>Nếu có ý định dùng <code class=\"language-inline-text\">HTTPs</code> thì nhớ thay đổi phân <strong>Protocol</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645934723593_image.png?resize=1024%2C817&#x26;ssl=1\"></p>\n<p>Phần dưới đây cực kỳ quan trọng, nếu ứng dụng của chúng ta có authen, ghi dữ liệu, nói chung những phương thức khác ngoài <code class=\"language-inline-text\">GET</code>, thì nhớ chọn lại <strong>Allowed HTTP methods</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645841986703_image.png?w=730&#x26;ssl=1\"></p>\n<p>Chúng ta cũng cần thực hiện một vài thay đổi trên <strong>Cache key and origin requests</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842121040_image.png?resize=1024%2C763&#x26;ssl=1\"></p>\n<p><strong>Cache policy</strong> chúng ta cho phép giá trị TTL minimum là 0, như vậy với giá trị non-caching header được gửi lên sẽ có hiệu lực</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842200731_image.png?resize=1024%2C857&#x26;ssl=1\"></p>\n<p><strong>Origin request policy</strong>, để đảm bảo cookie và query string khi đến CloudFront sẽ được gửi xuống server (không serve từ CDN)</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842297987_image.png?resize=1024%2C686&#x26;ssl=1\">\n<strong>Response headers policy</strong>, chúng ta chọn <strong>CORS With Preflight</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842362649_image.png?resize=1024%2C684&#x26;ssl=1\"></p>\n<p>Chúng ta vẫn phải chứng minh với AWS là chúng ta là chủ sở hữu của domain, trước hết chúng ta yêu cầu một SSL certificate</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932319102_image.png?resize=1024%2C862&#x26;ssl=1\"></p>\n<p>Chọn <strong>Request certificate</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645845081306_image.png?resize=1024%2C360&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645845178014_image.png?resize=1024%2C553&#x26;ssl=1\"></p>\n<p>Cung cấp tên miền, chọn kiểu validate bằng <em>DNS</em></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932453934_image.png?resize=882%2C1024&#x26;ssl=1\"></p>\n<p>Chọn <strong>Request</strong>, chọn vào Certificate ID vừa được tạo ra</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932554825_image.png?resize=1024%2C211&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932616235_image.png?resize=1024%2C227&#x26;ssl=1\"></p>\n<p>Để xác minh domain chính chủ, chúng ta cần đưa giá trị CNAME này vào trong Route 53</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932927217_image.png?resize=1024%2C462&#x26;ssl=1\"></p>\n<p>Chúng ta tạo một dòng CNAME với giá trị trong certificate ở trên</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932742028_image.png?resize=1024%2C637&#x26;ssl=1\"></p>\n<p>Sau khi xác minh xong AWS sẽ cập nhập status trên domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933155607_image.png?resize=1024%2C202&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933066086_image.png?resize=1024%2C156&#x26;ssl=1\"></p>\n<p>Xong, giờ quay lại màn hình CloudFront distribution, trong mục <strong>SSL certificate</strong> chọn vào certificate chúng ta đã tạo</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933691496_image.png?resize=1024%2C727&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933782796_image.png?resize=1024%2C440&#x26;ssl=1\"></p>\n<p>Việc còn lại là báo với Route 53 để nó route domain vào CloudFront, vào Route 53 tạo thêm một dòng DNS\nChọn <strong>A record type</strong>, đánh dấu dòng này là một <strong>alias</strong> và map alias này đến CloudFront. Bên trong mục <strong>Route traffic to</strong> chúng ta sẽ có tùy chọn <strong>Alias to CloudFront distribution</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933944994_image.png?resize=1024%2C538&#x26;ssl=1\"></p>\n<p>OK, xong rồi đó.</p>\n<p>Để báo với CloudFront đừng cache những request cụ thể nào, chúng ta gửi trong header <code class=\"language-inline-text\">Cache-Control: no-cache</code>. Ví dụ sử dụng Express middleware</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"no-cache\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">expressGraphql</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">schema</span><span class=\"token operator\">:</span> executableSchema<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">graphiql</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">rootValue</span><span class=\"token operator\">:</span> root\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<ul>\n<li><a href=\"https://css-tricks.com/setting-up-cloudfront-to-host-your-web-app/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Setting Up CloudFront to Host Your Web App</a></li>\n</ul>\n","cover_image":""}},{"node":{"id":"edf4266cd7225277113199cb85829abb","title":"Bỏ túi 6 đoạn code chỉ với một dòng rất hữu ích trong JavaScript","path":"/2022-03-04-bo-tui-6-doan-code-huu-ich-trong-js/","date":"2022-03-04","timeToRead":1,"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#tr%E1%BB%99n-ng%E1%BA%ABu-nhi%C3%AAn-m%E1%BB%99t-m%E1%BA%A3ng\">Trộn ngẫu nhiên một mảng</a></li>\n<li><a href=\"#copy-v%C3%A0o-clipboard\">Copy vào clipboard</a></li>\n<li><a href=\"#x%C3%A1c-%C4%91%E1%BB%8Bnh-window-c%C3%B3-%C4%91ang-ch%E1%BB%8Dn-ch%E1%BA%BF-%C4%91%E1%BB%99-darkmode\">Xác định window có đang chọn chế độ DarkMode</a></li>\n<li><a href=\"#scroll-l%C3%AAn-%C4%91%E1%BA%A7u-trang\">Scroll lên đầu trang</a></li>\n<li><a href=\"#cu%E1%BB%99n-xu%E1%BB%91ng-cu%E1%BB%91i-trang\">Cuộn xuống cuối trang</a></li>\n<li><a href=\"#t%E1%BA%A1o-m%C3%A3-m%C3%A0u-ng%E1%BA%ABu-nhi%C3%AAn\">Tạo mã màu ngẫu nhiên</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"trộn-ngẫu-nhiên-một-mảng\"><a href=\"#tr%E1%BB%99n-ng%E1%BA%ABu-nhi%C3%AAn-m%E1%BB%99t-m%E1%BA%A3ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Trộn ngẫu nhiên một mảng</h2>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">shuffleArray</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">arr</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> arr<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">shuffleArray</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"copy-vào-clipboard\"><a href=\"#copy-v%C3%A0o-clipboard\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Copy vào clipboard</h2>\n<blockquote>\n<p>Chạy trên trình duyệt có hỗ trợ <code class=\"language-inline-text\">navigator.clipboard</code></p>\n</blockquote>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">copyToClipboard</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  navigator<span class=\"token punctuation\">.</span>clipboard<span class=\"token operator\">?.</span>writeText <span class=\"token operator\">&amp;&amp;</span> navigator<span class=\"token punctuation\">.</span>clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">writeText</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">copyToClipboard</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"xác-định-window-có-đang-chọn-chế-độ-darkmode\"><a href=\"#x%C3%A1c-%C4%91%E1%BB%8Bnh-window-c%C3%B3-%C4%91ang-ch%E1%BB%8Dn-ch%E1%BA%BF-%C4%91%E1%BB%99-darkmode\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Xác định window có đang chọn chế độ DarkMode</h2>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isDarkMode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  window<span class=\"token punctuation\">.</span>matchMedia <span class=\"token operator\">&amp;&amp;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">matchMedia</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"(prefers-color-scheme: dark)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">isDarkMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"scroll-lên-đầu-trang\"><a href=\"#scroll-l%C3%AAn-%C4%91%E1%BA%A7u-trang\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Scroll lên đầu trang</h2>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">scrollToTop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  element<span class=\"token punctuation\">.</span><span class=\"token function\">scrollIntoView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">behavior</span><span class=\"token operator\">:</span> <span class=\"token string\">\"smooth\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">block</span><span class=\"token operator\">:</span> <span class=\"token string\">\"start\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"cuộn-xuống-cuối-trang\"><a href=\"#cu%E1%BB%99n-xu%E1%BB%91ng-cu%E1%BB%91i-trang\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cuộn xuống cuối trang</h2>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">scrollToBottom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  element<span class=\"token punctuation\">.</span><span class=\"token function\">scrollIntoView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">behavior</span><span class=\"token operator\">:</span> <span class=\"token string\">\"smooth\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">block</span><span class=\"token operator\">:</span> <span class=\"token string\">\"end\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"tạo-mã-màu-ngẫu-nhiên\"><a href=\"#t%E1%BA%A1o-m%C3%A3-m%C3%A0u-ng%E1%BA%ABu-nhi%C3%AAn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tạo mã màu ngẫu nhiên</h2>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateRandomHexColor</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0xffffff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n","cover_image":""}},{"node":{"id":"6d279ec5ee3e089ef43d2aa38bb7816e","title":"Ứng dụng hay của flatMap","path":"/2022-02-03-ung-dung-hay-cua-flatmap/","date":"2022-02-03","timeToRead":1,"desc":"Thay thế hàm filter và map bằng flatMap","content":"<p>Sử dụng <code class=\"language-inline-text\">flatMap</code> có thể giúp code ngắn hơn, ví dụ trong tình huống bên dưới</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// filter các giá trị âm</span>\n<span class=\"token comment\">// nhân đôi các giá trị dương còn lại</span>\n<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span> <span class=\"token operator\">=></span> num <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span> <span class=\"token operator\">=></span> num <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// -> [2, 6, 10]</span></code></pre></div>\n<p>Cách này không có gì sai, nhưng nếu muốn viết bằng một phương pháp khác thì sao?</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>num <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// -> [2, 6, 10]</span></code></pre></div>\n<p>Nếu muốn rút ngắn hơn nữa</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span>num <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"token comment\">// -> [2, 6, 10]</span></code></pre></div>\n<p>Tuy nhiên, nếu xét về mặt viết-sao-cho-dễ-đọc thì có vẻ dùng <code class=\"language-inline-text\">filter</code> và <code class=\"language-inline-text\">map</code> sẽ tốt hơn, <code class=\"language-inline-text\">flatMap</code> được cái viết ngắn hơn.</p>\n<p>Túm lại, ưng mắt cách nào hơn thì bạn viết cách đó.</p>\n<ul>\n<li><a href=\"https://www.stefanjudis.com/snippets/filter-and-map-array-values-with-a-flatmap-one-liner/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Filter and map Array values with a flatMap one-liner</a></li>\n</ul>\n","cover_image":""}},{"node":{"id":"691018d928912ef0c296b5f00948cd37","title":"Cách mà babel preset-env, core-js, browserslistrc làm việc với nhau","path":"/2022-02-02-babel-preset-env-core-js-browerslistrc-lam-viec/","date":"2022-02-02","timeToRead":3,"desc":"","content":"<h2 id=\"thiết-đặt-babel\"><a href=\"#thi%E1%BA%BFt-%C4%91%E1%BA%B7t-babel\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Thiết đặt babel</h2>\n<p>Với input là code js với các syntax mới, babel sẽ <em>transform</em> thành code mà trình duyệt có thể hiểu được.</p>\n<p>Chúng ta sẽ cần các gói babel cần thiết</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i @babel/core @babel/preset-env @babel/cli --save-dev</code></pre></div>\n<p>Bên trong file config của babel, <code class=\"language-inline-text\">babel.config.json</code> chúng ta sẽ tìm thấy phần thiết đặt <code class=\"language-inline-text\">preset-env</code></p>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"@babel/preset-env\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>@babel/preset-env</strong> là một bộ các plugin của babel để nó có thể <strong>transform</strong> các syntax mới, <strong>tùy theo trình duyệt mà chúng ta chỉ định</strong></p>\n<p>Trình duyệt được chỉ định có thể set trong file <code class=\"language-inline-text\">babel.config.json</code> hoặc dùng một file riêng <code class=\"language-inline-text\">.browserslistrc</code>, hoặc trong <code class=\"language-inline-text\">package.json</code></p>\n<p>Dùng file package.json</p>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"browserslist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"defaults\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"not IE 11\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"maintained node versions\"</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Dùng file .browserslistrc</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">defaults\nnot IE 11\nmaintained node versions</code></pre></div>\n<p>Ví dụ với đoạn code như sau</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">arr</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Sau khi transform với thiết đặt browser là IE11, chúng ta sẽ có</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">_toConsumableArray</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">_arrayWithoutHoles</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">_iterableToArray</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">_unsupportedIterableToArray</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">_nonIterableSpread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">_nonIterableSpread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">_unsupportedIterableToArray</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o<span class=\"token punctuation\">,</span> minLen</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>o<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> o <span class=\"token operator\">===</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">_arrayLikeToArray</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">,</span> minLen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">var</span> n <span class=\"token operator\">=</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token string\">\"Object\"</span> <span class=\"token operator\">&amp;&amp;</span> o<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">)</span> n <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token string\">\"Map\"</span> <span class=\"token operator\">||</span> n <span class=\"token operator\">===</span> <span class=\"token string\">\"Set\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token string\">\"Arguments\"</span> <span class=\"token operator\">||</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">_arrayLikeToArray</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">,</span> minLen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">_iterableToArray</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">iter</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> Symbol <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span> <span class=\"token operator\">&amp;&amp;</span> Symbol<span class=\"token punctuation\">.</span>iterator <span class=\"token keyword\">in</span> <span class=\"token function\">Object</span><span class=\"token punctuation\">(</span>iter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>iter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">_arrayWithoutHoles</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">_arrayLikeToArray</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">_arrayLikeToArray</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arr<span class=\"token punctuation\">,</span> len</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> len <span class=\"token operator\">></span> arr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> len <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> arr2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> arr2<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">return</span> arr2<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">arr</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">printArr</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> _console<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">(</span>_console <span class=\"token operator\">=</span> console<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>_console<span class=\"token punctuation\">,</span> <span class=\"token function\">_toConsumableArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Babel đã cố gắng hết sức, tuy nhiên <code class=\"language-inline-text\">printArr</code> là kiểu <strong>array-like (na ná array)</strong> chứ không thực sự là một <strong>array</strong></p>\n<p>Các trình duyệt cũ sẽ không chạy được kiểu <em>na ná</em> array như vậy.</p>\n<p>Đây là lúc <strong>core-js</strong> phát huy tác dụng</p>\n<p><strong>core-js là tập hợp các polyfill</strong> cho các tính năng chưa được trình duyệt cập nhập.</p>\n<p>Cài đặt</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i core-js</code></pre></div>\n<p>Sau đó import vào file dùng bootstrap như <code class=\"language-inline-text\">src/index.js</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">\"core-js\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">arr</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">printArr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Bổ sung config cho babel để dùng core-js trong lúc transform <code class=\"language-inline-text\">babel.config.json</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"useBuiltIns\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"entry\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"corejs\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Kết quả chúng ta sẽ nhận được</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.description\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.async-iterator\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.has-instance\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.is-concat-spreadable\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.iterator\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.match\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.replace\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.search\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"core-js/modules/es.symbol.species\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//...</span></code></pre></div>\n<p>Khi import một file core-js, chúng ta sẽ có được tất cả những polyfill cần thiết cho trình duyệt đã chỉ định.</p>\n<p>Tạm kết, sử dụng những CLI như <code class=\"language-inline-text\">create-react=app</code> hay Vue CLI, mọi thứ đã được config sẵn, tuy nhiên biết cơ chế và cách làm thủ công là cần thiết, chắc chắn sẽ có lúc chúng ta cần dùng.</p>\n<p><a href=\"https://www.valentinog.com/blog/preset-env/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How babel preset-env, core-js, and browserslistrc work together</a></p>\n","cover_image":""}},{"node":{"id":"8a1551a47737f4d1cf9dc50fa514c3e5","title":"Quản lý state: nhận định boolean tốt và không tốt","path":"/2021-05-31-huong-dan-viet-boolean/","date":"2021-05-31","timeToRead":1,"desc":"","content":"<p>Tóm tắt nếu bạn lười đọc:</p>\n<blockquote>\n<p><code class=\"language-inline-text\">boolean</code> không tốt đại diện cho <code class=\"language-inline-text\">state</code>, <code class=\"language-inline-text\">boolean</code> tốt là kết quả tính từ <code class=\"language-inline-text\">state</code></p>\n</blockquote>\n<p>Một ví dụ dễ thấy nhất với <code class=\"language-inline-text\">boolean</code> không tốt là cách thiết kế <code class=\"language-inline-text\">state</code> như vầy</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> isComplete <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> hasError <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Thoạt nhìn chúng ta sẽ nghĩ nó tốt. Chúng ta đưa ra 3 <code class=\"language-inline-text\">state</code> khác nhau ứng với 3 giá trị <code class=\"language-inline-text\">boolean</code> riêng biệt, chỉ duy nhất một giá trị là <code class=\"language-inline-text\">true</code> </p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeFetch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    isComplete <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    hasErrored <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nhưng khi nghĩ kỹ lại, chúng ta sẽ nhận được 2 giá trị <code class=\"language-inline-text\">true</code> nếu <code class=\"language-inline-text\">makeFetch</code> được gọi lại lần nữa</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\nisComplete <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\nhasError <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Vậy làm sao để thiết kế một <code class=\"language-inline-text\">boolean</code> tốt cho trường hợp trên?</strong></p>\n<p><code class=\"language-inline-text\">State</code> ở đây chúng ta sẽ có tất cả các giá trị sau</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> statusEnum <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">idle</span><span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">loading</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">complete</span><span class=\"token operator\">:</span> <span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Và chúng ta dùng nó trong hàm <code class=\"language-inline-text\">makeFetch</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeFetch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  status <span class=\"token operator\">=</span> statusEnum<span class=\"token punctuation\">.</span>loading<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    status <span class=\"token operator\">=</span> statusEnum<span class=\"token punctuation\">.</span>complete<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    status <span class=\"token operator\">=</span> statusEnum<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Cần giá trị <code class=\"language-inline-text\">boolean</code> bạn <em>tính</em> từ giá trị <code class=\"language-inline-text\">state</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isLoading</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">status</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> status <span class=\"token operator\">===</span> statusEnum<span class=\"token punctuation\">.</span>loading<span class=\"token punctuation\">;</span></code></pre></div>\n","cover_image":""}},{"node":{"id":"e35584fe8d93774b9a4cfcce81d825d5","title":"Hỏi nhanh đáp gọn về REST","path":"/2021-01-15-rest-faq-hoi-nhanh-dap-gon-ve-rest/","date":"2021-01-15","timeToRead":3,"desc":"Chuyên mục hỏi nhanh - đáp gọn, nếu bạn chưa biết gì về REST","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#m%E1%BB%99t-v%C3%A0i-%C4%91%E1%BA%B7c-t%C3%ADnh-ch%C3%ADnh-c%E1%BB%A7a-rest\">Một vài đặc tính chính của REST?</a></li>\n<li><a href=\"#c%C3%A1c-th%C3%A0nh-ph%E1%BA%A7n-ch%C3%ADnh-c%E1%BB%A7a-m%E1%BB%99t-http-response\">Các thành phần chính của một http response</a></li>\n<li><a href=\"#c%C3%A1c-th%C3%A0nh-ph%E1%BA%A7n-ch%C3%ADnh-c%E1%BB%A7a-m%E1%BB%99t-http-request\">Các thành phần chính của một http request</a></li>\n<li><a href=\"#stateless-l%C3%A0-g%C3%AC\">Stateless là gì?</a></li>\n<li><a href=\"#stateless-c%C3%B3-g%C3%AC-hay\">Stateless có gì hay?</a></li>\n<li><a href=\"#v%C3%A0i-c%C3%A1i-status-code-ph%E1%BB%95-bi%E1%BA%BFn\">Vài cái status code phổ biến?</a></li>\n<li><a href=\"#c%C3%A1i-g%C3%AC-cache-%C4%91%C6%B0%E1%BB%A3c-c%C3%A1i-g%C3%AC-kh%C3%B4ng\">Cái gì cache được, cái gì không?</a></li>\n<li><a href=\"#kh%C3%A1c-nhau-gi%E1%BB%AFa-ajax-v%C3%A0-rest\">Khác nhau giữa AJAX và REST?</a></li>\n<li><a href=\"#keep-alive-l%C3%A0-g%C3%AC-v%C3%A0-l%E1%BB%A3i-%C3%ADch-c%E1%BB%A7a-n%C3%B3\">Keep-Alive là gì và lợi ích của nó?</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"một-vài-đặc-tính-chính-của-rest\"><a href=\"#m%E1%BB%99t-v%C3%A0i-%C4%91%E1%BA%B7c-t%C3%ADnh-ch%C3%ADnh-c%E1%BB%A7a-rest\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Một vài đặc tính chính của REST?</h2>\n<ul>\n<li>REST là dạng <strong>stateless</strong>, server sẽ không có thông tin <em>status</em> (nói cách khác là không lưu giữ user session)</li>\n<li>Nếu <em>Web service</em> chủ yếu dùng POST để thao tác, thì REST dùng <code class=\"language-inline-text\">GET</code> để truy xuất đến resource</li>\n</ul>\n<h2 id=\"các-thành-phần-chính-của-một-http-response\"><a href=\"#c%C3%A1c-th%C3%A0nh-ph%E1%BA%A7n-ch%C3%ADnh-c%E1%BB%A7a-m%E1%BB%99t-http-response\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Các thành phần chính của một http response</h2>\n<ul>\n<li>Status / Response Code</li>\n<li>HTTP Version</li>\n<li>Response header</li>\n<li>Response body</li>\n</ul>\n<h2 id=\"các-thành-phần-chính-của-một-http-request\"><a href=\"#c%C3%A1c-th%C3%A0nh-ph%E1%BA%A7n-ch%C3%ADnh-c%E1%BB%A7a-m%E1%BB%99t-http-request\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Các thành phần chính của một http request</h2>\n<ul>\n<li>Method (<code class=\"language-inline-text\">GET</code>, <code class=\"language-inline-text\">POST</code>, <code class=\"language-inline-text\">PUT</code>, <code class=\"language-inline-text\">DELETE</code>)</li>\n<li>URI</li>\n<li>HTTP Version</li>\n<li>Request Header</li>\n<li>Request Body</li>\n</ul>\n<h2 id=\"stateless-là-gì\"><a href=\"#stateless-l%C3%A0-g%C3%AC\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Stateless là gì?</h2>\n<p>Theo định nghĩa của RESTful, server không lưu trữ bất kỳ thông tin gì về client state, đặc trưng này gọi là <strong>stateless</strong>. Phía client gửi thông tin cần thiết trên mỗi request</p>\n<h2 id=\"stateless-có-gì-hay\"><a href=\"#stateless-c%C3%B3-g%C3%AC-hay\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Stateless có gì hay?</h2>\n<ol>\n<li><strong>Scale</strong> khả năng đáp ứng của API lên cho hàng triệu <em>concurrent user</em> bằng cách deploy lên nhiều server khác nhau. Bất kỳ server nào cũng có thể handle một request từ client vì tất cả thông tin cần thiết điều được gửi từ phía client.</li>\n<li><strong>Đơn giản hóa API</strong> nhờ vào việc gở bỏ việc đồng bộ logic của <em>state</em></li>\n<li><strong>Dễ cache hơn</strong>, phía server có thể quyết định cache hay không một kết quả HTTP request dựa vào thông tin của một request, những request trước đó không ảnh hưởng đến khả năng <em>cache</em> của request hiện tại.</li>\n</ol>\n<h2 id=\"vài-cái-status-code-phổ-biến\"><a href=\"#v%C3%A0i-c%C3%A1i-status-code-ph%E1%BB%95-bi%E1%BA%BFn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Vài cái status code phổ biến?</h2>\n<ul>\n<li>201 created</li>\n<li>204 No content</li>\n<li>400 Bad request</li>\n<li>403 Forbidden</li>\n<li>404 Not found</li>\n<li>405 Method not allowed</li>\n<li>409 Conflict</li>\n<li>500 internal server error</li>\n</ul>\n<h2 id=\"cái-gì-cache-được-cái-gì-không\"><a href=\"#c%C3%A1i-g%C3%AC-cache-%C4%91%C6%B0%E1%BB%A3c-c%C3%A1i-g%C3%AC-kh%C3%B4ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cái gì cache được, cái gì không?</h2>\n<ul>\n<li><code class=\"language-inline-text\">GET</code> cache được</li>\n<li><code class=\"language-inline-text\">POST</code> mặc định là không, nhưng có thể dùng <strong>expires header</strong> hoặc <strong>cache-control header</strong> nếu muốn bật cache</li>\n<li><code class=\"language-inline-text\">PUT/DELETE</code> không</li>\n</ul>\n<h2 id=\"khác-nhau-giữa-ajax-và-rest\"><a href=\"#kh%C3%A1c-nhau-gi%E1%BB%AFa-ajax-v%C3%A0-rest\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Khác nhau giữa AJAX và REST?</h2>\n<p>AJAX là một <strong>kỹ thuật thực hiện phía client</strong> để cập nhập giao diện, trong khi REST là <strong>một kiểu kiến trúc</strong> để truyền và xử lý HTTP Request.</p>\n<h2 id=\"keep-alive-là-gì-và-lợi-ích-của-nó\"><a href=\"#keep-alive-l%C3%A0-g%C3%AC-v%C3%A0-l%E1%BB%A3i-%C3%ADch-c%E1%BB%A7a-n%C3%B3\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Keep-Alive là gì và lợi ích của nó?</h2>\n<p>Mặc định một HTTP connection sẽ <strong>tự đóng sau khi request đã complete</strong>, nghĩa là phía server sẽ close TCP connection sau khi đã gửi đi response. Để giữ connection này cho nhiều request, dùng thuộc tính <code class=\"language-inline-text\">keep-alive</code> trên header</p>\n<p>Ví dụ</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Message Trace:\n-------------------------------------------\n~$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-I</span> https://www.domain.com/file.html\nHTTP/1.1 <span class=\"token number\">200</span> OK\nConnection: Keep-Alive\nContent-Type: text/html<span class=\"token punctuation\">;</span> <span class=\"token assign-left variable\">charset</span><span class=\"token operator\">=</span>UTF-8\nDate: Thu, <span class=\"token number\">15</span> Jan <span class=\"token number\">2015</span> <span class=\"token number\">16</span>:45:29 GMT\nContent-Length: <span class=\"token number\">1845</span>\nKeep-Alive: <span class=\"token assign-left variable\">timeout</span><span class=\"token operator\">=</span><span class=\"token number\">10</span>, <span class=\"token assign-left variable\">max</span><span class=\"token operator\">=</span><span class=\"token number\">20</span>\nServer: Apache/2.4.9 <span class=\"token punctuation\">(</span>Unix<span class=\"token punctuation\">)</span> PHP/5.6.2\n-------------------------------------------</code></pre></div>\n<p><em>Lợi ích</em></p>\n<ul>\n<li><strong>Giảm tải việc sử dụng CPU</strong>, mỗi lần thiết lập một TCP connection sẽ cần tiêu hao CPU và bộ nhớ.</li>\n<li><strong>Cải thiện tốc độ trang web</strong>: đáp ứng nhiều file sử dụng cùng một connection cho phép giảm tải và nâng cao tốc độ của ứng dụng</li>\n<li><strong>HTTPS</strong>: muốn dùng keep-alive bắt buộc phải là HTTPS, cũng có thể xem là một ưu điểm cho vấn đề bảo mật</li>\n</ul>\n","cover_image":""}},{"node":{"id":"1e87f736220a3d127bcf506ae3c80b0d","title":"Hỏi nhanh đáp gọn về webpack","path":"/2021-01-13-webpack-faq-hoi-nhanh-dap-gon-voi-webpack/","date":"2021-01-13","timeToRead":2,"desc":"Chuyên mục hỏi nhanh - đáp gọn, nếu bạn chưa biết gì về webpack","content":"<p><em>🐸 Những module pattern nào webpack hỗ trợ?</em></p>\n<p><code class=\"language-inline-text\">common.js</code> và es6</p>\n<p>🐸 Có được phép có nhiều entry point trong cùng 1 file config?*</p>\n<p>Có</p>\n<p><em>🐸 Làm sao để tạo file config webpack tự động?</em></p>\n<p><code class=\"language-inline-text\">webpack-cli init</code></p>\n<p><em>🐸 Loader trong webpack là gì?</em></p>\n<p>transform những module nào không phải là JS vào trong bundle</p>\n<p><em>🐸 Loader chạy sync hay async</em></p>\n<p>Cả hai</p>\n<p><em>🐸 Khác nhau giữa loader và plugin</em></p>\n<p>Loader dùng để pre-processing, plugin phức tạp hơn và nó can thiệp nhiều vào quá trình compile.</p>\n<p><em>🐸 Làm sao để tách một số data ra khỏi bundle thành một file riêng biệt, ví dụ như file css</em></p>\n<p>Sử dụng <a href=\"https://github.com/webpack-contrib/extract-text-webpack-plugin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ExtractTextWebpackPlugin</a>. Tất cả css sẽ không còn nằm inline trong file JS bundle, nó sẽ là một file riêng (style.css chẳng hạn)</p>\n<p><em>🐸 Hot module replacement là gì?</em></p>\n<p>Tính năng cho phép cập nhập module mà không cần reload</p>\n<p><em>🐸 parallel-webpack là gì và nó ảnh hưởng thế nào đến quá trình build</em></p>\n<p><a href=\"https://github.com/trivago/parallel-webpack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">parallel-webpack</a> sẽ giúp config với nhiều entry point, cho phép webpack build parallel, nâng cao tốc độ build</p>\n<p><em>🐸 Mô tả một cách ngắn gọn long-term caching và làm sao sử dụng nó trong webpack?</em></p>\n<p>Browser sẽ cache static file bên dưới local để cải thiện tốc độ load, để đảm bảo nếu có bản build mới, trình duyệt biết và download file mới, tên  file thường được đặt như sau</p>\n<div class=\"gridsome-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.js?build=1\napp.js?build=2\n\n// hoặc\napp.js.2a6c1fee4b5b0d2c9285.js\napp.js.70b594fe8b07bcedaa98.js</code></pre></div>\n<p>Để làm việc này, trong webpack chúng ta đặt config</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[name].[hash].js\"</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>🐸 Khác nhau giữa hash và chunkhash?</em></p>\n<p>[hash] tạo ra một id ngẫu nhiên cho từng lần build và sử dụng cho tất cả  chunk. Nếu thay [hash] bằng [chunkhash] nó sẽ tạo ra mỗi chunk một id ngẫu nhiên.</p>\n<p><em>🐸 Mô tả CommonsChunk Plugin?</em></p>\n<p>Là một tính năng có sẵn của webpack, cho phép tạo file riêng (gọi là chunk) cho những module dùng chung. Hỗ trợ caching và nâng cao tốc độ load</p>\n<p><em>🐸Diễn giải đoạn code bên dưới</em></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>ContextReplacementPlugin</span><span class=\"token punctuation\">(</span>\n     <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">moment[\\/\\\\]locale</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n     <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(en-gb|en-us)\\.js</span><span class=\"token regex-delimiter\">/</span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Báo với webpack, chỉ include những file có tên khớp với điều kiện <code class=\"language-inline-text\">/(en-gb|en-us)\\.js/</code>, trong đường dẫn <code class=\"language-inline-text\">/moment[\\/\\\\]locale/</code> khi bundle</p>\n<p><em>🐸 Làm sao để remove những css selector không dùng đến?</em></p>\n<p>Dùng plugin <a href=\"https://github.com/webpack-contrib/purifycss-webpack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">purifycss-webpack</a></p>\n","cover_image":""}}]}}},"context":{}}