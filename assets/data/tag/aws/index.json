{"hash":"41d494f24d0a7d48ff651f8ed64a032d16747c1a","data":{"tag":{"title":"aws","belongsTo":{"edges":[{"node":{"id":"933ee8a3a9e6b3f4f384e1dc4805c7d1","title":"PhÃ¢n biá»‡t sá»± khÃ¡c nhau giá»¯a Identity vÃ  Resource Base Policy trong AWS IAM","path":"/2022-09-25-phan-biet-identity-va-resource-base-policy/","date":"2022-09-25","timeToRead":2,"desc":"Series má»™t sá»‘ kiáº¿n thá»©c cáº§n cÃ³ Ä‘á»ƒ láº¥y chá»©ng chá»‰ AWS","content":"<p><strong>IDENTITY</strong>-based policy gÃ¡n cho <code class=\"language-inline-text\">user</code>, <code class=\"language-inline-text\">group</code>, hoáº·c <code class=\"language-inline-text\">role</code> (gá»i chung lÃ  <code class=\"language-inline-text\">identity</code>). Chá»‰ Ä‘á»‹nh nhá»¯ng quyá»n gÃ¬ mÃ  <em>identity</em> cÃ³ thá»ƒ lÃ m\n<strong>RESOURCE</strong>-based policy gÃ¡n cho <em>resource</em>, vÃ­ dá»¥ nhÆ° S3 bucket, SQS queue, VPC endpooint</p>\n<p>Trong tÃ¬nh huá»‘ng <code class=\"language-inline-text\">user</code> <em>khÃ´ng Ä‘Æ°á»£c cáº¥p quyá»n</em> trÃªn S3 bucket A (khÃ´ng Ä‘Æ°á»£c cáº¥p khÃ´ng Ä‘á»“ng nghÄ©a vá»›i viá»‡c bá»‹ cáº¥m), nhÆ°ng resource policy Ä‘ang gÃ¡n cho bucket A cho phÃ©p má»i user upload vÃ o bucket nÃ y, thÃ¬ <code class=\"language-inline-text\">user</code> váº«n cÃ³ thá»ƒ upload</p>\n<p>VÃ­ dá»¥, cÃ³ <em>identity policy</em></p>\n<ul>\n<li>User A: List, Read trÃªn resource A</li>\n<li>User B: List, Read trÃªn resource B, C</li>\n<li>User C: List, Read, Write trÃªn Resource A,B,C</li>\n<li>User D: KhÃ´ng cÃ³ policy nÃ o cáº£</li>\n</ul>\n<p>Tiáº¿p Ä‘Ã³ chÃºng ta cÃ³ <em>resource policy</em></p>\n<ul>\n<li>Resource A: User A = (List, Read), User C = (List, Read)</li>\n<li>Resource B: User B = (List, Write), User D = (List, Read)</li>\n<li>Resouce C: User B = Denied Access, User D: Full Access</li>\n</ul>\n<p>ThÃ¬ káº¿t quáº£ tá»« 2 policy khi Ã¡p dá»¥ng sáº½ lÃ </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>LIST</th>\n<th>READ</th>\n<th>WRITE</th>\n<th>DENIED</th>\n<th>FULL ACCCESS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>User A</td>\n<td>RES A</td>\n<td>RES A</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n</tr>\n<tr>\n<td>User B</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>RES C</td>\n<td>ğŸš«</td>\n</tr>\n<tr>\n<td>User C</td>\n<td>RES A,B,C</td>\n<td>RES A,B,C</td>\n<td>RES A,B,C</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n</tr>\n<tr>\n<td>User D</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>RES C</td>\n</tr>\n</tbody>\n</table>\n<p>Khi <strong>identity</strong>-based policy káº¿t há»£p vá»›i <strong>Permission Boundary</strong>, láº¥y pháº§n chung giá»¯a hai táº­p</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/permissions_boundary.png\"></p>\n<p>Khi <strong>Resource</strong>-based policy káº¿t há»£p vá»›i <em>identity</em>-based policy vÃ  permission boundary, nÃ³ hÆ¡i ngoÃ i lá» má»™t chÃºt, láº¥y táº¥t cáº£ nhá»¯ng pháº§n chung giá»¯a ba táº­p há»£p cá»™ng vá»›i táº¥t cáº£ nhá»¯ng gÃ¬ cÃ³ trong resource-base policy</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/EffectivePermissions-rbp-boundary-id.png\"></p>\n<p>Khi káº¿t há»£p giá»¯a táº­p <em>Service Control Policy</em>, <em>Permission boundary</em> vÃ  <em>identity-base policy</em>, chÃºng ta chá»‰ láº¥y pháº§n tá»­ chung cá»§a cáº£ 3</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/EffectivePermissions-scp-boundary-id.png\"></p>\n<p>Tham kháº£o thÃªm <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"># Permissions boundaries for IAM entities</a></p>\n","cover_image":""}},{"node":{"id":"7ac3739a0f8e1c0f98a919794db694ac","title":"Lá»±a chá»n giá»¯a Redis vÃ  Memcached","path":"/2022-09-10-redis-vs-memcached/","date":"2022-09-10","timeToRead":1,"desc":"Series má»™t sá»‘ kiáº¿n thá»©c cáº§n cÃ³ Ä‘á»ƒ láº¥y chá»©ng chá»‰ AWS","content":"<p>Cáº£ 2 Ä‘iá»u ráº¥t dá»… sá»­ dá»¥ng vÃ  cÃ³ chung cÃ´ng dá»¥ng tÄƒng cÆ°á»ng tá»‘c Ä‘á»™, tuy nhiÃªn cÃ³ nhá»¯ng khÃ¡c biá»‡t ráº¥t quan trá»ng chÃºng ta cáº§n biáº¿t.</p>\n<p><strong>Redis</strong> vÃ  <strong>Memcached</strong> lÃ  2 thÆ° viá»‡n nguá»“n má»Ÿ phá»• biáº¿n khi cáº§n kho dá»¯ liá»‡u <em>in-memory</em>. Memcached Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i Ä‘á»‹nh hÆ°á»›ng Ä‘Æ¡n giáº£n hÃ³a nháº¥t, trong khi Redis sáº½ há»— trá»£ nhiá»u tÃ­nh nÄƒng vÃ  phÃ¹ há»£p vá»›i nhiá»u tÃ¬nh huá»‘ng.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Memcached</th>\n<th>Redis</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cáº¥u trÃºc dá»¯ liá»‡u phá»©c táº¡p</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Multithreaded</td>\n<td>âœ…</td>\n<td></td>\n</tr>\n<tr>\n<td>Snapshots</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Replication</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Transaction</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Pub/Sub</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Geospatial</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"chá»n-memcached-náº¿u-chÃºng-ta-gáº·p-yÃªu-cáº§u\"><a href=\"#ch%E1%BB%8Dn-memcached-n%E1%BA%BFu-ch%C3%BAng-ta-g%E1%BA%B7p-y%C3%AAu-c%E1%BA%A7u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chá»n Memcached náº¿u chÃºng ta gáº·p yÃªu cáº§u</h3>\n<ul>\n<li>ÄÆ¡n giáº£n hÃ³a</li>\n<li>Cháº¡y trÃªn nhá»¯ng <em>node</em> lá»›n vá»›i nhiá»u core, nhiá»u thread</li>\n<li>Kháº£ nÄƒng scale out/in</li>\n<li>ThÃªm/xÃ³a node theo yÃªu cáº§u</li>\n<li>PhÃ¢n biá»‡t dá»¯ liá»‡u giá»¯a cÃ¡c <em>shard</em></li>\n</ul>\n<h3 id=\"chá»n-redis-náº¿u-chÃºng-ta-gáº·p-yÃªu-cáº§u\"><a href=\"#ch%E1%BB%8Dn-redis-n%E1%BA%BFu-ch%C3%BAng-ta-g%E1%BA%B7p-y%C3%AAu-c%E1%BA%A7u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chá»n Redis náº¿u chÃºng ta gáº·p yÃªu cáº§u</h3>\n<ul>\n<li>Nhiá»u kiá»ƒu dá»¯ liá»‡u phá»©c táº¡p nhÆ° <code class=\"language-inline-text\">string</code>, <code class=\"language-inline-text\">hash</code>, <code class=\"language-inline-text\">list</code>, <code class=\"language-inline-text\">set</code></li>\n<li>Cáº§n pháº£i <strong>sáº¯p xáº¿p</strong> dá»¯ liá»‡u</li>\n<li>Cá»‘ Ä‘á»‹nh <em>key</em> cá»§a store</li>\n<li>Cáº§n táº¡o <strong>replicate</strong> Ä‘á»ƒ tá»‘i Æ°u viá»‡c Ä‘á»c dá»¯ liá»‡u</li>\n<li>Tá»± Ä‘á»™ng <strong>failover</strong> náº¿u node chÃ­nh cháº¿t</li>\n<li>Cáº§n <strong>pub/sub</strong></li>\n<li>Kháº£ nÄƒng <strong>backup/restore</strong></li>\n</ul>\n","cover_image":""}},{"node":{"id":"9cbb507063e9cbfe980133e85fe58558","title":"AWS SCP lÃ  gÃ¬","path":"/2022-09-06-aws-scp-permission-boundary-iam/","date":"2022-09-06","timeToRead":2,"desc":"Series má»™t sá»‘ kiáº¿n thá»©c cáº§n cÃ³ Ä‘á»ƒ láº¥y chá»©ng chá»‰ AWS","content":"<h2 id=\"aws-scp-lÃ -gÃ¬\"><a href=\"#aws-scp-l%C3%A0-g%C3%AC\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>AWS SCP lÃ  gÃ¬</h2>\n<p>SCP lÃ  má»™t táº­p há»£p cÃ¡c rule <strong>cáº¥p quyá»n</strong> sá»­ dá»¥ng resource AWS trÃªn táº¥t cáº£ account trong má»™t AWS Organization</p>\n<h2 id=\"táº¡i-sao-sá»­-dá»¥ng-scp\"><a href=\"#t%E1%BA%A1i-sao-s%E1%BB%AD-d%E1%BB%A5ng-scp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Táº¡i sao sá»­ dá»¥ng SCP</h2>\n<p>Khi má»™t tá»• chá»©c cÃ³ nhiá»u account cáº§n quáº£n lÃ½, viá»‡c quáº£n lÃ½ sáº½ khÃ³ khÄƒn náº¿u chá»‰ sá»­ dá»¥ng IAM</p>\n<p>IAM cho phÃ©p chÃºng ta kiá»ƒm soÃ¡t quyá»n háº¡n trÃªn tá»«ng user vÃ  role cá»§a má»™t account, nhÆ°ng náº¿u chÃºng ta cáº§n quáº£n lÃ½ quyá»n háº¡n trÃªn nhiá»u role/nhiá»u account cÃ¹ng lÃºc sáº½ cáº§n Ä‘áº¿n má»™t cÃ´ng cá»¥ bao quÃ¡t hÆ¡n</p>\n<blockquote>\n<blockquote>\n<p>OU (Organizational Unit) = tá»• há»£p cÃ¡c account Ä‘Æ°á»£c quáº£n lÃ½, SCP sáº½ Ã¡p cÃ¡c rule trÃªn tá»«ng OU</p>\n</blockquote>\n</blockquote>\n<p><img src=\"https://towardsthecloud.com/wp-content/uploads/aws-org-scp-diagram-1024x928.webp\"></p>\n<p>NhÆ° hÃ¬nh trÃªn OU sáº½ thÆ°á»ng Ä‘Æ°á»£c Ä‘á»‹nh danh nhÆ° cÃ¡c Ä‘Æ¡n vá»‹ <em>ban ngÃ nh</em> trong má»™t tá»• chá»©c, chÃºng ta cÃ³ <em>Ä‘á»™i</em> náº±m trong <code class=\"language-inline-text\">Core</code>, Ä‘á»™i lÃ m <code class=\"language-inline-text\">Application</code>, Ä‘á»™i <code class=\"language-inline-text\">Development</code></p>\n<blockquote>\n<p>LÆ°u Ã½ chá»‰ cÃ³ thá»ƒ Ã¡p tá»‘i Ä‘a <strong>5</strong> SCP trÃªn má»™t root/OU/account</p>\n</blockquote>\n<p>VÃ­ dá»¥ khai bÃ¡o má»™t policy <em>deny</em> viá»‡c sá»­ dá»¥ng AWS Shield service</p>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Statement1\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Deny\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"shield:*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>VÃ¬ SCP cÅ©ng cÃ³ thá»ƒ Ã¡p dá»¥ng trÃªn root account, nÃªn hÃ£y ráº¥t cáº©n tháº­n vÃ  test ká»¹ trÆ°á»›c khi Ã¡p dá»¥ng policy nÃ o Ä‘Ã³ trÃªn root account, trÃ¡nh trÆ°á»ng há»£p máº¥t cÃ¡c quyá»n quan trá»ng</p>\n<h2 id=\"scp-vs-permission-boundary-vs-iam-userrole-permission\"><a href=\"#scp-vs-permission-boundary-vs-iam-userrole-permission\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SCP vs Permission Boundary vs IAM User/Role Permission</h2>\n<p>SCP khÃ´ng pháº£i chá»‰ Ä‘á»ƒ cáº¥p quyá»n, nÃ³ cÃ²n cÃ³ thá»ƒ <em>deny</em>, cÃ³ thá»ƒ hÃ¬nh dung nÃ³ nhÆ° má»™t danh sÃ¡ch cÃ³ thá»ƒ lÃ m gÃ¬ vÃ  khÃ´ng Ä‘Æ°á»£c lÃ m gÃ¬ (<strong>Deny/Allow action</strong>) trÃªn má»™t nhÃ³m Ä‘á»‘i tÆ°á»£ng trong <strong>Organization</strong></p>\n<p><img src=\"https://cloudacademy.com/wp-content/uploads/2021/03/Screenshot-2021-03-05-at-16.55.23.png\"></p>\n<table>\n<thead>\n<tr>\n<th>SCP</th>\n<th>IAM Policies</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>DÃ¹ng vá»›i OU</td>\n<td>DÃ¹ng vá»›i Principal (Ai)</td>\n</tr>\n<tr>\n<td>KhÃ´ng thay tháº¿ IAM Policy</td>\n<td>identity-base -> dÃ¹ng vá»›i user, group, role. resource-base -> dÃ¹ng vá»›i AWS resource nhÆ° S3</td>\n</tr>\n<tr>\n<td>DÃ¹ng Ä‘Æ°á»£c vá»›i Root account</td>\n<td>KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i Root account</td>\n</tr>\n<tr>\n<td>Má»™t account con chá»‰ cÃ³ sá»‘ quyá»n nhÆ° account cha hoáº·c Ã­t hÆ¡n</td>\n<td>Chá»‰ 1 trong 2: allow hoáº·c deny, náº¿u allow thÃ¬ ngáº§m hiá»ƒu pháº§n cÃ²n láº¡i deny, náº¿u deny ngáº§m hiá»u pháº§n cÃ²n láº¡i allow</td>\n</tr>\n</tbody>\n</table>\n<p>CÃ²n vá» Permission Boundaries nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng cho user/role (má»™t IAM entity), nÃ³ cáº¥p <strong>maximum permission mÃ  identity-base cÃ³ thá»ƒ cáº¥p cho má»™t IAM entity</strong>, nÃ³ khÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i <strong>resource-base</strong>, trong khi Ä‘Ã³ SCP cÃ³ thá»ƒ Ã¡p dá»¥ng trÃªn cáº£ identity-base vÃ  resource-base</p>\n<h2 id=\"tÃ³m-táº¯t-thuáº­t-ngá»¯\"><a href=\"#t%C3%B3m-t%E1%BA%AFt-thu%E1%BA%ADt-ng%E1%BB%AF\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>TÃ³m táº¯t thuáº­t ngá»¯</h2>\n<table>\n<thead>\n<tr>\n<th>Thuáº­t ngá»¯</th>\n<th>Giáº£i thÃ­ch</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>resource-base policy</td>\n<td>policy dÃ¹ng vá»›i user, group, role</td>\n</tr>\n<tr>\n<td>identity-base policy</td>\n<td>policy dÃ¹ng vá»›i cÃ¡c service cá»§a AWS</td>\n</tr>\n<tr>\n<td>Organization</td>\n<td>ÄÆ¡n vá»‹ chÃºng ta khai báº£o Ä‘á»ƒ tiá»‡n quáº£n lÃ½</td>\n</tr>\n</tbody>\n</table>\n","cover_image":""}},{"node":{"id":"539b556649530f0970013d8a6d4121dc","title":"Setup CloudFront cho á»©ng dá»¥ng","path":"/2022-04-30-setup-cloudfront-cho-und-dung/","date":"2022-04-30","timeToRead":3,"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-dns\">Cáº¥u hÃ¬nh DNS</a></li>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-cloudfront-distribution\">Cáº¥u hÃ¬nh CloudFront distribution</a></li>\n</ul>\n<!-- /TOC -->\n<p>ChÃºng ta sáº½ cÃ¹ng cáº¥u hÃ¬nh Ä‘á»ƒ Ä‘Æ°a toÃ n bá»™ á»©ng dá»¥ng lÃªn CloudFront, vá»›i nhá»¯ng dá»¯ liá»‡u khÃ´ng nÃªn cache nhÆ° <em>data</em>, <em>auth</em>,... sáº½ Ä‘Æ°á»£c <em>proxy</em> (chuyá»ƒn tiáº¿p) Ä‘áº¿n server.</p>\n<h2 id=\"cáº¥u-hÃ¬nh-dns\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-dns\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cáº¥u hÃ¬nh DNS</h2>\n<p>Má»¥c tiÃªu cuá»‘i cÃ¹ng cá»§a chÃºng ta lÃ  Ä‘Æ°a toÃ n bá»™ á»©ng dá»¥ng lÃªn CloudFront. Tá»©c lÃ  khi user truy cáº­p vÃ o domain, há» sáº½ load á»©ng dá»¥ng tá»« CloudFront chá»© khÃ´ng pháº£i tá»« server. TrÆ°á»›c tiÃªn chÃºng ta pháº£i vÃ o <em>Route 53</em> Ä‘á»ƒ thay Ä‘á»•i láº¡i DNS</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645834717715_image.png?resize=1024%2C280&#x26;ssl=1\"></p>\n<p>Chá»n <strong>Hosted Zone</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645994751238_image.png?w=821&#x26;ssl=1\"></p>\n<p>Click vÃ o <strong>Create Hosted zone</strong> vÃ  nháº­p vÃ o domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645908142161_image.png?resize=1024%2C237&#x26;ssl=1\"></p>\n<p>ChÃºng ta Ä‘ang nÃ³i vá»›i AWS hÃ£y quáº£n lÃ½ domain nÃ y cho tÃ´i, AWS Ä‘Æ°a cho chÃºng ta giÃ¡ trá»‹ NS (name server) mÃ  nÃ³ sáº½ <em>route traffic</em> Ä‘áº¿n. ChÃºng ta sáº½ cáº§n Ä‘áº¿n chá»— quáº£n lÃ½ domain, tÃ¹y thuá»™c vÃ o nÆ¡i chÃºng ta Ä‘Äƒng kÃ½ domain, giao diá»‡n quáº£n lÃ½ cÃ³ thá»ƒ khÃ¡c nhau, chÃºng ta cáº­p nháº­p láº¡i giÃ¡ trá»‹ <em>NS</em> nÃ y cho domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645835018979_image.png?w=762&#x26;ssl=1\"></p>\n<p>TrÆ°á»›c khi thay Ä‘á»•i, nhá»› lÆ°u láº¡i backup giÃ¡ trá»‹ NS gá»‘c</p>\n<h2 id=\"cáº¥u-hÃ¬nh-cloudfront-distribution\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-cloudfront-distribution\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cáº¥u hÃ¬nh CloudFront distribution</h2>\n<p>ChÃºng ta sáº½ Ä‘iá»n vÃ o pháº§n <em>origin domain</em>, Ä‘á»«ng nháº­p giÃ¡ trá»‹ <strong>top-level domain</strong> nhÆ° <code class=\"language-inline-text\">your-app.com</code>, nÃ³ sáº½ lÃ  giÃ¡ trá»‹ sub domain, nhÆ° <code class=\"language-inline-text\">your-app.herokuapp.com</code> (náº¿u Ä‘Æ°á»£c host trÃªn herokuapp.com)</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645841894888_image.png?resize=1024%2C292&#x26;ssl=1\"></p>\n<p>Náº¿u cÃ³ Ã½ Ä‘á»‹nh dÃ¹ng <code class=\"language-inline-text\">HTTPs</code> thÃ¬ nhá»› thay Ä‘á»•i phÃ¢n <strong>Protocol</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645934723593_image.png?resize=1024%2C817&#x26;ssl=1\"></p>\n<p>Pháº§n dÆ°á»›i Ä‘Ã¢y cá»±c ká»³ quan trá»ng, náº¿u á»©ng dá»¥ng cá»§a chÃºng ta cÃ³ authen, ghi dá»¯ liá»‡u, nÃ³i chung nhá»¯ng phÆ°Æ¡ng thá»©c khÃ¡c ngoÃ i <code class=\"language-inline-text\">GET</code>, thÃ¬ nhá»› chá»n láº¡i <strong>Allowed HTTP methods</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645841986703_image.png?w=730&#x26;ssl=1\"></p>\n<p>ChÃºng ta cÅ©ng cáº§n thá»±c hiá»‡n má»™t vÃ i thay Ä‘á»•i trÃªn <strong>Cache key and origin requests</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842121040_image.png?resize=1024%2C763&#x26;ssl=1\"></p>\n<p><strong>Cache policy</strong> chÃºng ta cho phÃ©p giÃ¡ trá»‹ TTL minimum lÃ  0, nhÆ° váº­y vá»›i giÃ¡ trá»‹ non-caching header Ä‘Æ°á»£c gá»­i lÃªn sáº½ cÃ³ hiá»‡u lá»±c</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842200731_image.png?resize=1024%2C857&#x26;ssl=1\"></p>\n<p><strong>Origin request policy</strong>, Ä‘á»ƒ Ä‘áº£m báº£o cookie vÃ  query string khi Ä‘áº¿n CloudFront sáº½ Ä‘Æ°á»£c gá»­i xuá»‘ng server (khÃ´ng serve tá»« CDN)</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842297987_image.png?resize=1024%2C686&#x26;ssl=1\">\n<strong>Response headers policy</strong>, chÃºng ta chá»n <strong>CORS With Preflight</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842362649_image.png?resize=1024%2C684&#x26;ssl=1\"></p>\n<p>ChÃºng ta váº«n pháº£i chá»©ng minh vá»›i AWS lÃ  chÃºng ta lÃ  chá»§ sá»Ÿ há»¯u cá»§a domain, trÆ°á»›c háº¿t chÃºng ta yÃªu cáº§u má»™t SSL certificate</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932319102_image.png?resize=1024%2C862&#x26;ssl=1\"></p>\n<p>Chá»n <strong>Request certificate</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645845081306_image.png?resize=1024%2C360&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645845178014_image.png?resize=1024%2C553&#x26;ssl=1\"></p>\n<p>Cung cáº¥p tÃªn miá»n, chá»n kiá»ƒu validate báº±ng <em>DNS</em></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932453934_image.png?resize=882%2C1024&#x26;ssl=1\"></p>\n<p>Chá»n <strong>Request</strong>, chá»n vÃ o Certificate ID vá»«a Ä‘Æ°á»£c táº¡o ra</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932554825_image.png?resize=1024%2C211&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932616235_image.png?resize=1024%2C227&#x26;ssl=1\"></p>\n<p>Äá»ƒ xÃ¡c minh domain chÃ­nh chá»§, chÃºng ta cáº§n Ä‘Æ°a giÃ¡ trá»‹ CNAME nÃ y vÃ o trong Route 53</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932927217_image.png?resize=1024%2C462&#x26;ssl=1\"></p>\n<p>ChÃºng ta táº¡o má»™t dÃ²ng CNAME vá»›i giÃ¡ trá»‹ trong certificate á»Ÿ trÃªn</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932742028_image.png?resize=1024%2C637&#x26;ssl=1\"></p>\n<p>Sau khi xÃ¡c minh xong AWS sáº½ cáº­p nháº­p status trÃªn domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933155607_image.png?resize=1024%2C202&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933066086_image.png?resize=1024%2C156&#x26;ssl=1\"></p>\n<p>Xong, giá» quay láº¡i mÃ n hÃ¬nh CloudFront distribution, trong má»¥c <strong>SSL certificate</strong> chá»n vÃ o certificate chÃºng ta Ä‘Ã£ táº¡o</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933691496_image.png?resize=1024%2C727&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933782796_image.png?resize=1024%2C440&#x26;ssl=1\"></p>\n<p>Viá»‡c cÃ²n láº¡i lÃ  bÃ¡o vá»›i Route 53 Ä‘á»ƒ nÃ³ route domain vÃ o CloudFront, vÃ o Route 53 táº¡o thÃªm má»™t dÃ²ng DNS\nChá»n <strong>A record type</strong>, Ä‘Ã¡nh dáº¥u dÃ²ng nÃ y lÃ  má»™t <strong>alias</strong> vÃ  map alias nÃ y Ä‘áº¿n CloudFront. BÃªn trong má»¥c <strong>Route traffic to</strong> chÃºng ta sáº½ cÃ³ tÃ¹y chá»n <strong>Alias to CloudFront distribution</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933944994_image.png?resize=1024%2C538&#x26;ssl=1\"></p>\n<p>OK, xong rá»“i Ä‘Ã³.</p>\n<p>Äá»ƒ bÃ¡o vá»›i CloudFront Ä‘á»«ng cache nhá»¯ng request cá»¥ thá»ƒ nÃ o, chÃºng ta gá»­i trong header <code class=\"language-inline-text\">Cache-Control: no-cache</code>. VÃ­ dá»¥ sá»­ dá»¥ng Express middleware</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"no-cache\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">expressGraphql</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">schema</span><span class=\"token operator\">:</span> executableSchema<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">graphiql</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">rootValue</span><span class=\"token operator\">:</span> root\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<ul>\n<li><a href=\"https://css-tricks.com/setting-up-cloudfront-to-host-your-web-app/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Setting Up CloudFront to Host Your Web App</a></li>\n</ul>\n","cover_image":""}}]}}},"context":{}}