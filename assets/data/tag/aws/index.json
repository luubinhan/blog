{"hash":"e1532d0aebaf3bcf47bbf8a08cbde03cecbbc9cf","data":{"tag":{"title":"aws","belongsTo":{"edges":[{"node":{"id":"28b28757469522f8f7ff7248ce3b6343","title":"HÆ°á»›ng dáº«n delegate domain vá»›i AWS","path":"/2024-04-05-huong-dan-delegate-domain-trong-aws/","date":"2024-04-05","timeToRead":1,"desc":"Trong bÃ i hÃ´m nay chÃºng ta cÃ¹ng tÃ¬m hiá»ƒu cÃ¡ch delegate má»™t domain trong AWS","content":"<p>TrÆ°á»›c tiÃªn chÃºng ta cáº§n biáº¿t delegate domain sáº½ giáº£i quyáº¿t bÃ i toÃ¡n gÃ¬</p>\n<p>MÃ¬nh láº¥y vÃ­ dá»¥, CÃ´ng ty Furfel Ä‘ang sá»Ÿ há»¯u tÃªn miá»n <code class=\"language-inline-text\">furfel.net</code>, lÃ  trang web chÃ­nh cá»§a cÃ´ng ty\nCÃ´ng ty thuÃª cÃ´ng ty Dev phÃ¡t triá»ƒn thÃªm má»™t sá»‘ dá»‹ch vá»¥ trÃªn tÃªn miá»n con <code class=\"language-inline-text\">dev.furfel.net</code>\nCÃ´ng ty Furfel sáº½ trao toÃ n bá»™ quyá»n quyáº¿t Ä‘á»‹nh trÃªn tÃªn miá»n <code class=\"language-inline-text\">dev.furfel.net</code> cho cÃ´ng ty Dev, vÃ  chá»‰ náº¯m quyá»n trÃªn tÃªn miá»n cha lÃ  <code class=\"language-inline-text\">furfel.net</code></p>\n<p>ÄÃ¢y lÃ  bÃ i toÃ¡n mÃ  <strong>delegate domain</strong> sáº½ giáº£i quyáº¿t</p>\n<p>Äá»ƒ delegate domain trong AWS thÃ¬ kiáº¿n trÃºc tá»•ng quÃ¡t sáº½ nhÆ° hÃ¬nh bÃªn dÆ°á»›i</p>\n<p><img src=\"https://i.imgur.com/w5fQhyQl.png\"></p>\n<p>BÃªn trong Route 53, chÃºng ta sáº½ táº¡o má»™t <strong>Public Hosted Zone</strong>, lÆ°u Ã½ lÃ  <strong>public</strong> vá»›i tÃªn <strong>giá»‘ng hoÃ n toÃ n vá»›i domain chÃ­nh</strong>, theo vÃ­ dá»¥ sáº½ lÃ  <code class=\"language-inline-text\">furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fael6xqiv8gyd9rnk83g1.jpg\" alt=\"Public Hosted Zone furfel.net\"></p>\n<p>Sau khi táº¡o xong hosted zone <code class=\"language-inline-text\">furfel.net</code>, chÃºng ta mang giÃ¡ trá»‹ NS (name server) cá»§a hosted zone vá»«a táº¡o Ä‘Æ°a cho cÃ´ng ty Ä‘ang náº¯m quyá»n trÃªn tÃªn miá»n <code class=\"language-inline-text\">furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fael6xqiv8gyd9rnk83g1.jpg\" alt=\"Copy giÃ¡ trá»‹ Nameserver cá»§a publich hosted zone vá»«a táº¡o\"></p>\n<p>CÃ´ng ty Furfel sáº½ vÃ o pháº§n quáº£n lÃ½ tÃªn miá»n vÃ  Ä‘Æ°a toÃ n bá»™ giÃ¡ trá»‹ nameserver vÃ o nhÆ° má»™t <em>external name server</em> lÃ  xem nhÆ° Ä‘Ã£ delegate xong sub domain cho cÃ´ng ty Dev</p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ffuq5hfcya9thvarrizn9.jpg\" alt=\"ÄÆ°a giÃ¡ trá»‹ NS vÃ o trong tÃªn miá»n chÃ­nh\"></p>\n<p>CÃ´ng ty Dev Ä‘á»ƒ thÃªm tÃªn miá»n <code class=\"language-inline-text\">dev.furfel.net</code>, viá»‡c cáº§n lÃ m lÃ  táº¡o thÃªm má»™t public hosted zone má»›i, vá»›i tÃªn <code class=\"language-inline-text\">dev.furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ftwj6kpdp0vym6edjmmw9.jpg\" alt=\"Public Hosted Zone dev.furfel.net\"></p>\n<p>Copy toÃ n bá»™ giÃ¡ trá»‹ NS cá»§a hosted zone <code class=\"language-inline-text\">dev.furfel.net</code>, rá»“i quay láº¡i hosted zone <code class=\"language-inline-text\">furfel.net</code></p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fdfjgs3ryjwnvszvwghzb.jpg\" alt=\"NS cá»§a dev.furfel.net\"></p>\n<p>ThÃªm má»™t record má»›i tÃªn dev, type lÃ  NS vÃ  paste giÃ¡ trá»‹ Nameserver vá»«a copy</p>\n<p><img src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F9qg56ridyrk3192mk9sn.jpg\" alt=\"ThÃªm record má»›i tÃªn dev bÃªn trong hosted zone dev.furfel.net\"></p>\n","cover_image":""}},{"node":{"id":"9f8cb439930920e69ea8b3a3edab670c","title":"LÆ°u Ã½ khi sá»­ dá»¥ng AWS Lambda Ä‘á»ƒ trÃ¡nh máº¥t tiá»n","path":"/2023-08-04-tranh-mat-tien-voi-lambda/","date":"2023-08-04","timeToRead":5,"desc":"Khi chÃºng ta sá»­ dá»¥ng Ä‘Ãºng lÃºc Ä‘Ãºng nÆ¡i, nhá»¯ng dá»‹ch vá»¥ serverless nhÆ° Lambda sáº½ ráº» hÆ¡n so vá»›i há»‡ thá»‘ng bÃ¬nh thÆ°á»ng, chÃºng ta váº«n nghe quáº£ng cÃ¡o nhan nháº£n serverless thÃ¬ xÃ i nhiÃªu tráº£ nhiÃªu, an toÃ n hÆ¡n, kháº£ nÄƒng má»Ÿ rá»™ng vÃ  phá»¥c há»“i tá»‘t hÆ¡n cÃ¡ch truyá»n thá»‘ng, cÃ³ tháº­t sá»± Ä‘Ãºng nhÆ° quáº£ng cÃ¡o khÃ´ng?","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#kh%C3%B4ng-%C4%91%E1%BB%83-%C3%BD-chi-ph%C3%AD-logging-v%C3%A0-monitor\">KhÃ´ng Ä‘á»ƒ Ã½ chi phÃ­ logging vÃ  monitor</a></li>\n<li><a href=\"#%C4%91%E1%BB%8Dc-k%E1%BB%B9-h%C6%B0%E1%BB%9Bng-d%E1%BA%ABn-s%E1%BB%AD-d%E1%BB%A5ng-tr%C6%B0%E1%BB%9Bc-khi-d%C3%B9ng\">Äá»c ká»¹ hÆ°á»›ng dáº«n sá»­ dá»¥ng trÆ°á»›c khi dÃ¹ng</a></li>\n<li><a href=\"#kh%C3%B4ng-ch%E1%BB%8Bu-b%E1%BA%ADt-th%C3%B4ng-b%C3%A1o\">KhÃ´ng chá»‹u báº­t thÃ´ng bÃ¡o</a></li>\n<li><a href=\"#lambda-g%E1%BB%8Di-lambda-theo-c%C6%A1-ch%E1%BA%BF-synchronous\">Lambda gá»i Lambda theo cÆ¡ cháº¿ Synchronous</a></li>\n<li><a href=\"#kh%C3%B4ng-cache\">KhÃ´ng cache</a></li>\n<li><a href=\"#c%E1%BA%A5p-qu%C3%A1-nhi%E1%BB%81u-t%C3%A0i-nguy%C3%AAn\">Cáº¥p quÃ¡ nhiá»u tÃ i nguyÃªn</a></li>\n<li><a href=\"#ki%E1%BA%BFn-tr%C3%BAc-c%E1%BB%A7-chu%E1%BB%91i\">Kiáº¿n trÃºc cá»§ chuá»‘i</a></li>\n</ul>\n<!-- /TOC -->\n<p>VÃ¢ng Ä‘Ãºng nhÆ°ng khÃ´ng pháº£i trong má»i hoÃ n cáº£nh, chiáº¿c chÃ¬a khÃ³a váº¡n nÄƒngcÃ³ thá»ƒ giáº£i quyáº¿t má»i yÃªu cáº§u há»‡ thá»‘ng. Khi thiáº¿t káº¿ má»™t há»‡ thá»‘ng chÃºng ta pháº£i cÃ¢n nháº¯c Ä‘áº¿n viá»‡c cho nÃ³ tiáº¿n hÃ³a theo nhu cáº§u, cÅ©ng giá»‘ng nhÆ° nhá»¯ng pháº§n má»m chÃºng ta viáº¿t ra Ä‘iá»u pháº£i thay Ä‘á»•i Ä‘á»ƒ thÃ­ch nghi vÃ  Ä‘Ã¡p á»©ng nhu cáº§u má»›i cá»§a khÃ¡ch hÃ ng</p>\n<p>ChÃºng ta cÃ¹ng Ä‘i qua má»™t vÃ i lá»—i hay gáº·p vÃ  cÃ¡ch kháº¯c phá»¥c Ä‘á»ƒ tiáº¿t kiá»‡m chi phÃ­ tá»‘i Ä‘a</p>\n<h2 id=\"khÃ´ng-Ä‘á»ƒ-Ã½-chi-phÃ­-logging-vÃ -monitor\"><a href=\"#kh%C3%B4ng-%C4%91%E1%BB%83-%C3%BD-chi-ph%C3%AD-logging-v%C3%A0-monitor\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>KhÃ´ng Ä‘á»ƒ Ã½ chi phÃ­ logging vÃ  monitor</h2>\n<p>Ghi log vÃ  monitor á»©ng dá»¥ng Ä‘á»ƒ cÃ³ thá»ƒ tÃ¬m lá»—i vÃ  phÃ¡t hiá»‡n nguyÃªn nhÃ¢n gÃ¢y lá»—i lÃ  báº¯t buá»™c, nhÆ°ng nÃ³ Ä‘i Ä‘Ã´i vá»›i chi phÃ­. AWS CloudWatch tÃ­nh phÃ­ cáº£ 2 pháº§n ghi log vÃ  lÆ°u trá»¯ log</p>\n<p>Báº¡n sáº½ ngáº¡c nhiÃªn khi phÃ¡t hiá»‡n ra ráº±ng chi phÃ­ cho CloudWatch Ä‘Ã´i khi cÃ²n cao hÆ¡n cáº£ cho Lambda vÃ  API Gateway</p>\n<p>Äá»ƒ giáº£i quyáº¿t:</p>\n<ol>\n<li>Log <code class=\"language-inline-text\">INFO</code> hay <code class=\"language-inline-text\">ERROR</code> chá»‰ trÃªn mÃ´i trÆ°á»ng production</li>\n<li>Chá»‰ giá»¯ log tháº­t sá»± há»¯u Ã­ch nháº¥t Ä‘á»ƒ debug trÃªn production</li>\n<li>LÆ°u log trong 30 ngÃ y lÃ  vá»«a Ä‘á»§ Ä‘á»ƒ debug mÃ  khÃ´ng lÃ m Ä‘á»™i chi phÃ­ lÆ°u trá»¯</li>\n</ol>\n<p>Náº¿u Ä‘Ã£ cÃ³ log Ä‘Æ°á»£c lÆ°u á»Ÿ má»™t bÃªn thá»© 3 khÃ¡c cÃ³ thá»ƒ bá» qua log CloudWatch</p>\n<h2 id=\"Ä‘á»c-ká»¹-hÆ°á»›ng-dáº«n-sá»­-dá»¥ng-trÆ°á»›c-khi-dÃ¹ng\"><a href=\"#%C4%91%E1%BB%8Dc-k%E1%BB%B9-h%C6%B0%E1%BB%9Bng-d%E1%BA%ABn-s%E1%BB%AD-d%E1%BB%A5ng-tr%C6%B0%E1%BB%9Bc-khi-d%C3%B9ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Äá»c ká»¹ hÆ°á»›ng dáº«n sá»­ dá»¥ng trÆ°á»›c khi dÃ¹ng</h2>\n<p>Äá»ƒ khá»i â€œháº¿t há»“nâ€ lÃºc nháº­n bill cuá»‘i thÃ¡ng, chÃºng ta cáº§n biáº¿t khi báº­t má»™t tÃ­nh nÄƒng lÃªn sáº½ phÃ¡t sinh thÃªm nhá»¯ng phá»¥ phÃ­, ráº¥t nhiá»u phÃ­ chá»‰ Ä‘Æ°á»£c Ã¡p dá»¥ng trong nhá»¯ng Ä‘iá»u kiá»‡n cá»¥ thá»ƒ. VÃ­ dá»¥ nhÆ° chá»n <em>provisioned concurrency</em> cho Lambda sáº½ thÃªm má»™t sá»‘ phá»¥ phÃ­</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1_ER0It8JsAuL3D1ECFlUBog-768x349.jpg\"></p>\n<p>Äá»«ng nÃ³ng vá»™i hÃ£y luÃ´n nhá»› cháº­m láº¡i má»™t nhá»‹p rá»“i tÃ¬m hiá»ƒu cho Ä‘áº§y Ä‘á»§ trÆ°á»›c khi muá»‘n sá»­ dá»¥ng má»™t dá»‹ch vá»¥ nÃ o khÃ¡c.</p>\n<h2 id=\"khÃ´ng-chá»‹u-báº­t-thÃ´ng-bÃ¡o\"><a href=\"#kh%C3%B4ng-ch%E1%BB%8Bu-b%E1%BA%ADt-th%C3%B4ng-b%C3%A1o\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>KhÃ´ng chá»‹u báº­t thÃ´ng bÃ¡o</h2>\n<p>Má»i ngÆ°á»i cÅ©ng hay quÃªn dÃ¹ng tÃ­nh nÄƒng <em>billing alarm</em> cá»§a AWS. Má»™t cÃ´ng cá»¥ tuyá»‡t vá»i Ä‘á»ƒ bÃ¡o liá»n cho chÃºng ta Ä‘á»ƒ biáº¿t Ä‘Æ°á»£c nhá»¯ng khoáº£n chi chÃºng ta Ä‘Ã£ bá» ra cÃ³ vÆ°á»£t ngoÃ i táº§m kiá»ƒm soÃ¡t khÃ´ng</p>\n<p>CÃ i Ä‘áº·t Billing Alarm nÃªn lÃ  Ä‘iá»u Ä‘áº§u tiÃªn chÃºng ta cáº§n lÃ m khi sá»­ dá»¥ng AWS trÆ°á»›c khi má»i thá»© ra vÆ°á»£t ra ngoÃ i táº§m kiá»ƒm soÃ¡t.</p>\n<h2 id=\"lambda-gá»i-lambda-theo-cÆ¡-cháº¿-synchronous\"><a href=\"#lambda-g%E1%BB%8Di-lambda-theo-c%C6%A1-ch%E1%BA%BF-synchronous\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Lambda gá»i Lambda theo cÆ¡ cháº¿ Synchronous</h2>\n<p>Má»™t Lambda gá»i má»™t Lambda khÃ¡c synchronous nghÄ©a lÃ  Lambda Ä‘áº§u nguá»“n sáº½ <em>ngá»“i Ä‘á»£i</em> Lambda thá»© 2 cháº¡y xong trÆ°á»›c khi nÃ³ tiáº¿p tá»¥c cháº¡y. NÃ³ lÃ m Ä‘á»™i lÃªn chi phÃ­ khÃ¡ nhiá»u vÃ¬ thá»i gian ngá»“i Ä‘á»£i váº«n bá»‹ tÃ­nh phÃ­, giá»‘ng nhÆ° lÃªn xe taxi báº¡n ngá»“i Ä‘á»£i nhÆ°ng Ä‘á»“ng há»“ Ä‘áº¿m tiá»n váº«n nháº£y dÃ¹ xe khÃ´ng cháº¡y.</p>\n<p>HÃ£y luÃ´n nhá»› gá»i Lambda asynchronous báº¥t cá»© á»Ÿ Ä‘Ã¢u cho phÃ©p</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1__Z1-AG9GVnzRSQW_a77yYQ-768x334.png\"></p>\n<h2 id=\"khÃ´ng-cache\"><a href=\"#kh%C3%B4ng-cache\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>KhÃ´ng cache</h2>\n<p>Caching lÃ  ngÆ°á»i báº¡n thÃ¢n thiáº¿t, hay kháº¯c cá»‘t ghi tÃ¢m Ä‘iá»u nÃ y, caching nghÄ©a lÃ  Lambda sáº½ khÃ´ng cáº§n gá»i vÃ  lÃ m gÃ¬ cáº£, káº¿t quáº£ Ä‘Æ°á»£c tráº£ tháº±ng ngay tá»« API Gateway hay CloudFront. BÃªn cáº¡nh Ä‘Ã³ á»Ÿ á»©ng dá»¥ng cÃ³ thá»ƒ cÃ¢n nháº¯c sá»­ dá»¥ng thÃªm dá»‹ch vá»¥ chuyÃªn cache nhÆ° ElastiCache hay Memento, hay DynamoDB Accelerator</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/0_9V50W4A0o6-r7bce-768x329.png\"></p>\n<h2 id=\"cáº¥p-quÃ¡-nhiá»u-tÃ i-nguyÃªn\"><a href=\"#c%E1%BA%A5p-qu%C3%A1-nhi%E1%BB%81u-t%C3%A0i-nguy%C3%AAn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cáº¥p quÃ¡ nhiá»u tÃ i nguyÃªn</h2>\n<p>Cáº¥p quÃ¡ nhiá»u memory cho Lambda cÅ©ng lÃ  má»™t lá»—i hay máº¯c. Lambda Ä‘Æ°á»£c tÃ­nh phÃ­ theo 2 tiÃªu chi: lÆ°á»£ng memory Ä‘Ã£ sá»­ dá»¥ng vÃ  thá»i gian cháº¡y cá»§a hÃ m.</p>\n<p>CÃ¢u há»i lÃ  cáº¥p bao nhiÃªu cho Ä‘á»§? CÃ´ng cá»¥ <a href=\"https://github.com/alexcasalboni/aws-lambda-power-tuning\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Lambda Power Tuning</a> sáº½ giÃºp chÃºng ta xÃ¡c Ä‘á»‹nh lÆ°á»£ng memory cáº§n thiáº¿t Ä‘á»ƒ cÃ¢n báº±ng giá»¯a chi phÃ­ vÃ  hiá»‡u nÄƒng</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/0_V70C8Qw83OYgW5FW.png\"></p>\n<h2 id=\"kiáº¿n-trÃºc-cá»§-chuá»‘i\"><a href=\"#ki%E1%BA%BFn-tr%C3%BAc-c%E1%BB%A7-chu%E1%BB%91i\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kiáº¿n trÃºc cá»§ chuá»‘i</h2>\n<p>Kiáº¿n trÃºc mÃ  cá»§ chuá»‘i quÃ¡ thÃ¬ háº­u quáº£ lÃ  nháº£n tiá»n, vá»«a tá»‘n chi phÃ­, hiá»‡u nÄƒng khÃ´ng tá»‘i Æ°u vÃ  láº¡i cÃ²n khÃ³ váº­n hÃ nh báº£o trÃ¬</p>\n<p>AWS cÃ³ ráº¥t nhiá»u service Ä‘á»ƒ thá»±c hiá»‡n gá»­i nháº­n message, nhÆ° SNS, SQS, EventBridge, Kinesis, Æ°u nhÆ°á»£c Ä‘iá»ƒm lÃ  khÃ¡c nhau vÃ  pháº£i hiá»ƒu Ä‘á»ƒ sá»­ dá»¥ng cho Ä‘Ãºng má»¥c Ä‘Ã­ch, khÃ´ng khÃ©o chÃºng ta lÃ  Ä‘i láº¥y giao cháº·t thá»‹t heo Ä‘i giáº¿t kiáº¿n</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1_WQOGHnPyWMfVIR3yO3D0zA-768x485.jpg\"></p>\n<p>TÆ°Æ¡ng tá»±, API Gateway cÅ©ng tá»‘n khÃ¡ khÃ¡ tiá»n so vá»›i ALB nhÆ°ng nÃ³ cÃ³ nhiá»u Ä‘á»“ chÆ¡i vÆ°á»£t trá»™i hÆ¡n, tiá»n nÃ o cá»§a Ä‘Ã³ thÃ´i, liá»‡u cÆ¡m gáº¥p máº¯m</p>\n<p><img src=\"https://lumigo.io/wp-content/uploads/2023/07/1_gpJi-nd7tx8etGi0nvKR2A-768x383.png\"></p>\n<p>Má»i sai lÃ m Ä‘iá»u lÃ  má»™t cÆ¡ há»™i Ä‘á»ƒ há»c há»i, nÃªn khÃ´ng sá»£ sai chá»‰ sá»£ khÃ´ng há»c Ä‘Æ°á»£c gÃ¬ tá»« nhá»¯ng gÃ¬ mÃ¬nh Ä‘Ã£ lÃ m sai. ChÃºc cÃ¡c báº¡n cÃ³ má»™t cuá»™c chÆ¡i Ä‘á»¡ tá»‘n tiá»n hÆ¡n trÃªn AWS</p>\n<p><a href=\"https://lumigo.io/blog/save-money-on-serverless-common-costly-mistakes-and-how-to-avoid-them/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Save money on Serverless: common costly mistakes and how to avoid them</a></p>\n","cover_image":""}},{"node":{"id":"bfa175b4ea3e9a150e447b42a8510c43","title":"Giá»›i thiá»‡u maximum concurrency cá»§a Lambda khi sá»­ dá»¥ng vá»›i SQS","path":"/2023-01-21-gioi-thieu-max-concurrency-lambda-sqs/","date":"2023-01-21","timeToRead":1,"desc":"Khi má»™t SQS gá»i lambda function chÃºng ta cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh sá»‘ lÆ°á»£ng tá»‘i Ä‘a concurrency cá»§a Lambda","content":"<h2 id=\"giá»›i-thiá»‡u\"><a href=\"#gi%E1%BB%9Bi-thi%E1%BB%87u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Giá»›i thiá»‡u</h2>\n<p>Vá»›i SQS standard, Lambda sáº½ <em>poll</em> message trÃªn queue, lÃºc Ä‘áº§u khá»Ÿi táº¡o 5 concurrency, khi message trÃªn SQS tÄƒng lÃªn, Lambda tiáº¿p tá»¥c tÄƒng sá»‘ lÆ°á»£ng concurrency lÃªn Ä‘á»ƒ Ä‘á»§ Ä‘Ã¡p á»©ng, tá»‘i Ä‘a <em>1000</em></p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Lambda-processing-standard-SQS-queues.png\"></p>\n<p>Chi phÃ­ sáº½ Ä‘á»™i lÃªn khi sá»‘ lÆ°á»£ng concurrency tÄƒng lÃªn quÃ¡ nhiá»u, Ä‘á»ƒ ngÄƒn cháº·n, chÃºng ta cÃ³ thá»ƒ <em>Ä‘Äƒng kÃ½</em> sá»‘ lÆ°á»£ng <strong>reserved concurrency</strong> cho tá»«ng Lambda function.</p>\n<p>Khi nÃ³ cháº¡m Ä‘áº¿n ngÆ°á»¡ng <strong>reserved concurrency</strong>, message sáº½ Ä‘Æ°á»£c Ä‘áº©y tráº£ vá» queue, sau Ä‘Ã³ sáº½ tiáº¿p tá»¥c retry hoáº·c gá»­i vÃ o DLQ (SQS Dead letter queue) náº¿u Ä‘Ã£ quÃ¡ sá»‘ láº§n retry cho phÃ©p</p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Lambda-reaching-reserved-concurrency-of-10.-1024x736.png\"></p>\n<p><strong>maximum concurrency</strong> cÅ©ng khÃ¡ giá»‘ng vá»›i reserved concurrency, chá»‰ khÃ¡c lÃ  nÃ³ chá»‰ hoáº¡t Ä‘á»™ng khi <strong>nÆ¡i gá»i Lambda lÃ  SQS</strong>, khi Ä‘áº¡t tá»›i ngÆ°á»¡ng <strong>maximum concurrency</strong> Lambda sáº½ ngá»«ng láº¥y message tá»« queue, nÃ³ sáº½ linh Ä‘á»™ng hÆ¡n náº¿u chÃºng ta cáº§n Ä‘iá»u chá»‰nh giá»›i háº¡n concurrency theo nÆ¡i gá»i</p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Maximum-concurrency-is-set-to-10-for-the-SQS-queue.-1024x604.png\"></p>\n<p>NgoÃ i viá»‡c háº¡n cháº¿ Lambda dÃ¹ng háº¿t <em>nguá»“n lá»±c</em> Ä‘á»ƒ xá»­ lÃ½ message trÃªn queue, chá»«a <em>sá»©c</em> Ä‘á»ƒ xá»­ lÃ½ nhá»¯ng cÃ´ng viá»‡c Ä‘áº¿n tá»« cÃ¡c nguá»“n khÃ¡c, nÃ³ cÃ²n trÃ¡nh Ä‘Æ°á»£c viá»‡c message bá»‹ Ä‘Æ°a vá» queue vÃ  Ä‘Æ°a vÃ o DLQ khÃ´ng cáº§n thiáº¿t</p>\n<h2 id=\"thiáº¿t-Ä‘áº·t\"><a href=\"#thi%E1%BA%BFt-%C4%91%E1%BA%B7t\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Thiáº¿t Ä‘áº·t</h2>\n<p>BÃªn trong mÃ n hÃ¬nh cáº¥u hÃ¬nh <strong>Trigger</strong> cá»§a Lambda</p>\n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/1b6453892473a467d07372d45eb05abc2031647a/2023/01/11/Configuring-the-maximum-concurrency-for-an-SQS-trigger-in-the-console.-879x1024.png\"></p>\n<p>Náº¿u sá»­ dá»¥ng CLI</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws lambda create-event-source-mapping --function-name my-function <span class=\"token function-name function\">--ScalingConfig</span> <span class=\"token punctuation\">{</span>MaxConcurrency<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">}</span> --event-source-arn arn:aws:sqs:us-east-2:123456789012:my-queue</code></pre></div>\n<p>Náº¿u sá»­ dá»¥ng Cloudformation</p>\n<div class=\"gridsome-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">Resources</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token key atrule\">MaxConcurrencyFunction</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Serverless<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Function\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Handler</span><span class=\"token punctuation\">:</span> MyLambdaFunction\n      <span class=\"token key atrule\">Events</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">SQSEventFromMax</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> SQS\n          <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Queue</span><span class=\"token punctuation\">:</span> MySQSQueueArn\n            <span class=\"token key atrule\">BatchSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token key atrule\">Enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n            <span class=\"token key atrule\">ScalingConfig</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">MaximumConcurrency</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></code></pre></div>\n","cover_image":""}},{"node":{"id":"933ee8a3a9e6b3f4f384e1dc4805c7d1","title":"PhÃ¢n biá»‡t sá»± khÃ¡c nhau giá»¯a Identity vÃ  Resource Base Policy trong AWS IAM","path":"/2022-09-25-phan-biet-identity-va-resource-base-policy/","date":"2022-09-25","timeToRead":2,"desc":"Series má»™t sá»‘ kiáº¿n thá»©c cáº§n cÃ³ Ä‘á»ƒ láº¥y chá»©ng chá»‰ AWS","content":"<p><strong>IDENTITY</strong>-based policy gÃ¡n cho <code class=\"language-inline-text\">user</code>, <code class=\"language-inline-text\">group</code>, hoáº·c <code class=\"language-inline-text\">role</code> (gá»i chung lÃ  <code class=\"language-inline-text\">identity</code>). Chá»‰ Ä‘á»‹nh nhá»¯ng quyá»n gÃ¬ mÃ  <em>identity</em> cÃ³ thá»ƒ lÃ m\n<strong>RESOURCE</strong>-based policy gÃ¡n cho <em>resource</em>, vÃ­ dá»¥ nhÆ° S3 bucket, SQS queue, VPC endpooint</p>\n<p>Trong tÃ¬nh huá»‘ng <code class=\"language-inline-text\">user</code> <em>khÃ´ng Ä‘Æ°á»£c cáº¥p quyá»n</em> trÃªn S3 bucket A (khÃ´ng Ä‘Æ°á»£c cáº¥p khÃ´ng Ä‘á»“ng nghÄ©a vá»›i viá»‡c bá»‹ cáº¥m), nhÆ°ng resource policy Ä‘ang gÃ¡n cho bucket A cho phÃ©p má»i user upload vÃ o bucket nÃ y, thÃ¬ <code class=\"language-inline-text\">user</code> váº«n cÃ³ thá»ƒ upload</p>\n<p>VÃ­ dá»¥, cÃ³ <em>identity policy</em></p>\n<ul>\n<li>User A: List, Read trÃªn resource A</li>\n<li>User B: List, Read trÃªn resource B, C</li>\n<li>User C: List, Read, Write trÃªn Resource A,B,C</li>\n<li>User D: KhÃ´ng cÃ³ policy nÃ o cáº£</li>\n</ul>\n<p>Tiáº¿p Ä‘Ã³ chÃºng ta cÃ³ <em>resource policy</em></p>\n<ul>\n<li>Resource A: User A = (List, Read), User C = (List, Read)</li>\n<li>Resource B: User B = (List, Write), User D = (List, Read)</li>\n<li>Resouce C: User B = Denied Access, User D: Full Access</li>\n</ul>\n<p>ThÃ¬ káº¿t quáº£ tá»« 2 policy khi Ã¡p dá»¥ng sáº½ lÃ </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>LIST</th>\n<th>READ</th>\n<th>WRITE</th>\n<th>DENIED</th>\n<th>FULL ACCCESS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>User A</td>\n<td>RES A</td>\n<td>RES A</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n</tr>\n<tr>\n<td>User B</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>RES C</td>\n<td>ğŸš«</td>\n</tr>\n<tr>\n<td>User C</td>\n<td>RES A,B,C</td>\n<td>RES A,B,C</td>\n<td>RES A,B,C</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n</tr>\n<tr>\n<td>User D</td>\n<td>RES B</td>\n<td>RES B</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>RES C</td>\n</tr>\n</tbody>\n</table>\n<p>Khi <strong>identity</strong>-based policy káº¿t há»£p vá»›i <strong>Permission Boundary</strong>, láº¥y pháº§n chung giá»¯a hai táº­p</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/permissions_boundary.png\"></p>\n<p>Khi <strong>Resource</strong>-based policy káº¿t há»£p vá»›i <em>identity</em>-based policy vÃ  permission boundary, nÃ³ hÆ¡i ngoÃ i lá» má»™t chÃºt, láº¥y táº¥t cáº£ nhá»¯ng pháº§n chung giá»¯a ba táº­p há»£p cá»™ng vá»›i táº¥t cáº£ nhá»¯ng gÃ¬ cÃ³ trong resource-base policy</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/EffectivePermissions-rbp-boundary-id.png\"></p>\n<p>Khi káº¿t há»£p giá»¯a táº­p <em>Service Control Policy</em>, <em>Permission boundary</em> vÃ  <em>identity-base policy</em>, chÃºng ta chá»‰ láº¥y pháº§n tá»­ chung cá»§a cáº£ 3</p>\n<p><img src=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/images/EffectivePermissions-scp-boundary-id.png\"></p>\n<p>Tham kháº£o thÃªm <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"># Permissions boundaries for IAM entities</a></p>\n","cover_image":""}},{"node":{"id":"7ac3739a0f8e1c0f98a919794db694ac","title":"Lá»±a chá»n giá»¯a Redis vÃ  Memcached","path":"/2022-09-10-redis-vs-memcached/","date":"2022-09-10","timeToRead":1,"desc":"Series má»™t sá»‘ kiáº¿n thá»©c cáº§n cÃ³ Ä‘á»ƒ láº¥y chá»©ng chá»‰ AWS","content":"<p>Cáº£ 2 Ä‘iá»u ráº¥t dá»… sá»­ dá»¥ng vÃ  cÃ³ chung cÃ´ng dá»¥ng tÄƒng cÆ°á»ng tá»‘c Ä‘á»™, tuy nhiÃªn cÃ³ nhá»¯ng khÃ¡c biá»‡t ráº¥t quan trá»ng chÃºng ta cáº§n biáº¿t.</p>\n<p><strong>Redis</strong> vÃ  <strong>Memcached</strong> lÃ  2 thÆ° viá»‡n nguá»“n má»Ÿ phá»• biáº¿n khi cáº§n kho dá»¯ liá»‡u <em>in-memory</em>. Memcached Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i Ä‘á»‹nh hÆ°á»›ng Ä‘Æ¡n giáº£n hÃ³a nháº¥t, trong khi Redis sáº½ há»— trá»£ nhiá»u tÃ­nh nÄƒng vÃ  phÃ¹ há»£p vá»›i nhiá»u tÃ¬nh huá»‘ng.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Memcached</th>\n<th>Redis</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cáº¥u trÃºc dá»¯ liá»‡u phá»©c táº¡p</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Multithreaded</td>\n<td>âœ…</td>\n<td></td>\n</tr>\n<tr>\n<td>Snapshots</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Replication</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Transaction</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Pub/Sub</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Geospatial</td>\n<td></td>\n<td>âœ…</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"chá»n-memcached-náº¿u-chÃºng-ta-gáº·p-yÃªu-cáº§u\"><a href=\"#ch%E1%BB%8Dn-memcached-n%E1%BA%BFu-ch%C3%BAng-ta-g%E1%BA%B7p-y%C3%AAu-c%E1%BA%A7u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chá»n Memcached náº¿u chÃºng ta gáº·p yÃªu cáº§u</h3>\n<ul>\n<li>ÄÆ¡n giáº£n hÃ³a</li>\n<li>Cháº¡y trÃªn nhá»¯ng <em>node</em> lá»›n vá»›i nhiá»u core, nhiá»u thread</li>\n<li>Kháº£ nÄƒng scale out/in</li>\n<li>ThÃªm/xÃ³a node theo yÃªu cáº§u</li>\n<li>PhÃ¢n biá»‡t dá»¯ liá»‡u giá»¯a cÃ¡c <em>shard</em></li>\n</ul>\n<h3 id=\"chá»n-redis-náº¿u-chÃºng-ta-gáº·p-yÃªu-cáº§u\"><a href=\"#ch%E1%BB%8Dn-redis-n%E1%BA%BFu-ch%C3%BAng-ta-g%E1%BA%B7p-y%C3%AAu-c%E1%BA%A7u\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chá»n Redis náº¿u chÃºng ta gáº·p yÃªu cáº§u</h3>\n<ul>\n<li>Nhiá»u kiá»ƒu dá»¯ liá»‡u phá»©c táº¡p nhÆ° <code class=\"language-inline-text\">string</code>, <code class=\"language-inline-text\">hash</code>, <code class=\"language-inline-text\">list</code>, <code class=\"language-inline-text\">set</code></li>\n<li>Cáº§n pháº£i <strong>sáº¯p xáº¿p</strong> dá»¯ liá»‡u</li>\n<li>Cá»‘ Ä‘á»‹nh <em>key</em> cá»§a store</li>\n<li>Cáº§n táº¡o <strong>replicate</strong> Ä‘á»ƒ tá»‘i Æ°u viá»‡c Ä‘á»c dá»¯ liá»‡u</li>\n<li>Tá»± Ä‘á»™ng <strong>failover</strong> náº¿u node chÃ­nh cháº¿t</li>\n<li>Cáº§n <strong>pub/sub</strong></li>\n<li>Kháº£ nÄƒng <strong>backup/restore</strong></li>\n</ul>\n","cover_image":""}},{"node":{"id":"9cbb507063e9cbfe980133e85fe58558","title":"AWS SCP lÃ  gÃ¬","path":"/2022-09-06-aws-scp-permission-boundary-iam/","date":"2022-09-06","timeToRead":2,"desc":"Series má»™t sá»‘ kiáº¿n thá»©c cáº§n cÃ³ Ä‘á»ƒ láº¥y chá»©ng chá»‰ AWS","content":"<h2 id=\"aws-scp-lÃ -gÃ¬\"><a href=\"#aws-scp-l%C3%A0-g%C3%AC\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>AWS SCP lÃ  gÃ¬</h2>\n<p>SCP lÃ  má»™t táº­p há»£p cÃ¡c rule <strong>cáº¥p quyá»n</strong> sá»­ dá»¥ng resource AWS trÃªn táº¥t cáº£ account trong má»™t AWS Organization</p>\n<h2 id=\"táº¡i-sao-sá»­-dá»¥ng-scp\"><a href=\"#t%E1%BA%A1i-sao-s%E1%BB%AD-d%E1%BB%A5ng-scp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Táº¡i sao sá»­ dá»¥ng SCP</h2>\n<p>Khi má»™t tá»• chá»©c cÃ³ nhiá»u account cáº§n quáº£n lÃ½, viá»‡c quáº£n lÃ½ sáº½ khÃ³ khÄƒn náº¿u chá»‰ sá»­ dá»¥ng IAM</p>\n<p>IAM cho phÃ©p chÃºng ta kiá»ƒm soÃ¡t quyá»n háº¡n trÃªn tá»«ng user vÃ  role cá»§a má»™t account, nhÆ°ng náº¿u chÃºng ta cáº§n quáº£n lÃ½ quyá»n háº¡n trÃªn nhiá»u role/nhiá»u account cÃ¹ng lÃºc sáº½ cáº§n Ä‘áº¿n má»™t cÃ´ng cá»¥ bao quÃ¡t hÆ¡n</p>\n<blockquote>\n<blockquote>\n<p>OU (Organizational Unit) = tá»• há»£p cÃ¡c account Ä‘Æ°á»£c quáº£n lÃ½, SCP sáº½ Ã¡p cÃ¡c rule trÃªn tá»«ng OU</p>\n</blockquote>\n</blockquote>\n<p><img src=\"https://towardsthecloud.com/wp-content/uploads/aws-org-scp-diagram-1024x928.webp\"></p>\n<p>NhÆ° hÃ¬nh trÃªn OU sáº½ thÆ°á»ng Ä‘Æ°á»£c Ä‘á»‹nh danh nhÆ° cÃ¡c Ä‘Æ¡n vá»‹ <em>ban ngÃ nh</em> trong má»™t tá»• chá»©c, chÃºng ta cÃ³ <em>Ä‘á»™i</em> náº±m trong <code class=\"language-inline-text\">Core</code>, Ä‘á»™i lÃ m <code class=\"language-inline-text\">Application</code>, Ä‘á»™i <code class=\"language-inline-text\">Development</code></p>\n<blockquote>\n<p>LÆ°u Ã½ chá»‰ cÃ³ thá»ƒ Ã¡p tá»‘i Ä‘a <strong>5</strong> SCP trÃªn má»™t root/OU/account</p>\n</blockquote>\n<p>VÃ­ dá»¥ khai bÃ¡o má»™t policy <em>deny</em> viá»‡c sá»­ dá»¥ng AWS Shield service</p>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Statement1\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Deny\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"shield:*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>VÃ¬ SCP cÅ©ng cÃ³ thá»ƒ Ã¡p dá»¥ng trÃªn root account, nÃªn hÃ£y ráº¥t cáº©n tháº­n vÃ  test ká»¹ trÆ°á»›c khi Ã¡p dá»¥ng policy nÃ o Ä‘Ã³ trÃªn root account, trÃ¡nh trÆ°á»ng há»£p máº¥t cÃ¡c quyá»n quan trá»ng</p>\n<h2 id=\"scp-vs-permission-boundary-vs-iam-userrole-permission\"><a href=\"#scp-vs-permission-boundary-vs-iam-userrole-permission\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SCP vs Permission Boundary vs IAM User/Role Permission</h2>\n<p>SCP khÃ´ng pháº£i chá»‰ Ä‘á»ƒ cáº¥p quyá»n, nÃ³ cÃ²n cÃ³ thá»ƒ <em>deny</em>, cÃ³ thá»ƒ hÃ¬nh dung nÃ³ nhÆ° má»™t danh sÃ¡ch cÃ³ thá»ƒ lÃ m gÃ¬ vÃ  khÃ´ng Ä‘Æ°á»£c lÃ m gÃ¬ (<strong>Deny/Allow action</strong>) trÃªn má»™t nhÃ³m Ä‘á»‘i tÆ°á»£ng trong <strong>Organization</strong></p>\n<p><img src=\"https://cloudacademy.com/wp-content/uploads/2021/03/Screenshot-2021-03-05-at-16.55.23.png\"></p>\n<table>\n<thead>\n<tr>\n<th>SCP</th>\n<th>IAM Policies</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>DÃ¹ng vá»›i OU</td>\n<td>DÃ¹ng vá»›i Principal (Ai)</td>\n</tr>\n<tr>\n<td>KhÃ´ng thay tháº¿ IAM Policy</td>\n<td>identity-base -> dÃ¹ng vá»›i user, group, role. resource-base -> dÃ¹ng vá»›i AWS resource nhÆ° S3</td>\n</tr>\n<tr>\n<td>DÃ¹ng Ä‘Æ°á»£c vá»›i Root account</td>\n<td>KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i Root account</td>\n</tr>\n<tr>\n<td>Má»™t account con chá»‰ cÃ³ sá»‘ quyá»n nhÆ° account cha hoáº·c Ã­t hÆ¡n</td>\n<td>Chá»‰ 1 trong 2: allow hoáº·c deny, náº¿u allow thÃ¬ ngáº§m hiá»ƒu pháº§n cÃ²n láº¡i deny, náº¿u deny ngáº§m hiá»u pháº§n cÃ²n láº¡i allow</td>\n</tr>\n</tbody>\n</table>\n<p>CÃ²n vá» Permission Boundaries nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng cho user/role (má»™t IAM entity), nÃ³ cáº¥p <strong>maximum permission mÃ  identity-base cÃ³ thá»ƒ cáº¥p cho má»™t IAM entity</strong>, nÃ³ khÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i <strong>resource-base</strong>, trong khi Ä‘Ã³ SCP cÃ³ thá»ƒ Ã¡p dá»¥ng trÃªn cáº£ identity-base vÃ  resource-base</p>\n<h2 id=\"tÃ³m-táº¯t-thuáº­t-ngá»¯\"><a href=\"#t%C3%B3m-t%E1%BA%AFt-thu%E1%BA%ADt-ng%E1%BB%AF\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>TÃ³m táº¯t thuáº­t ngá»¯</h2>\n<table>\n<thead>\n<tr>\n<th>Thuáº­t ngá»¯</th>\n<th>Giáº£i thÃ­ch</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>resource-base policy</td>\n<td>policy dÃ¹ng vá»›i user, group, role</td>\n</tr>\n<tr>\n<td>identity-base policy</td>\n<td>policy dÃ¹ng vá»›i cÃ¡c service cá»§a AWS</td>\n</tr>\n<tr>\n<td>Organization</td>\n<td>ÄÆ¡n vá»‹ chÃºng ta khai báº£o Ä‘á»ƒ tiá»‡n quáº£n lÃ½</td>\n</tr>\n</tbody>\n</table>\n","cover_image":""}},{"node":{"id":"539b556649530f0970013d8a6d4121dc","title":"Setup CloudFront cho á»©ng dá»¥ng","path":"/2022-04-30-setup-cloudfront-cho-und-dung/","date":"2022-04-30","timeToRead":3,"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-dns\">Cáº¥u hÃ¬nh DNS</a></li>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-cloudfront-distribution\">Cáº¥u hÃ¬nh CloudFront distribution</a></li>\n</ul>\n<!-- /TOC -->\n<p>ChÃºng ta sáº½ cÃ¹ng cáº¥u hÃ¬nh Ä‘á»ƒ Ä‘Æ°a toÃ n bá»™ á»©ng dá»¥ng lÃªn CloudFront, vá»›i nhá»¯ng dá»¯ liá»‡u khÃ´ng nÃªn cache nhÆ° <em>data</em>, <em>auth</em>,... sáº½ Ä‘Æ°á»£c <em>proxy</em> (chuyá»ƒn tiáº¿p) Ä‘áº¿n server.</p>\n<h2 id=\"cáº¥u-hÃ¬nh-dns\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-dns\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cáº¥u hÃ¬nh DNS</h2>\n<p>Má»¥c tiÃªu cuá»‘i cÃ¹ng cá»§a chÃºng ta lÃ  Ä‘Æ°a toÃ n bá»™ á»©ng dá»¥ng lÃªn CloudFront. Tá»©c lÃ  khi user truy cáº­p vÃ o domain, há» sáº½ load á»©ng dá»¥ng tá»« CloudFront chá»© khÃ´ng pháº£i tá»« server. TrÆ°á»›c tiÃªn chÃºng ta pháº£i vÃ o <em>Route 53</em> Ä‘á»ƒ thay Ä‘á»•i láº¡i DNS</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645834717715_image.png?resize=1024%2C280&#x26;ssl=1\"></p>\n<p>Chá»n <strong>Hosted Zone</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645994751238_image.png?w=821&#x26;ssl=1\"></p>\n<p>Click vÃ o <strong>Create Hosted zone</strong> vÃ  nháº­p vÃ o domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645908142161_image.png?resize=1024%2C237&#x26;ssl=1\"></p>\n<p>ChÃºng ta Ä‘ang nÃ³i vá»›i AWS hÃ£y quáº£n lÃ½ domain nÃ y cho tÃ´i, AWS Ä‘Æ°a cho chÃºng ta giÃ¡ trá»‹ NS (name server) mÃ  nÃ³ sáº½ <em>route traffic</em> Ä‘áº¿n. ChÃºng ta sáº½ cáº§n Ä‘áº¿n chá»— quáº£n lÃ½ domain, tÃ¹y thuá»™c vÃ o nÆ¡i chÃºng ta Ä‘Äƒng kÃ½ domain, giao diá»‡n quáº£n lÃ½ cÃ³ thá»ƒ khÃ¡c nhau, chÃºng ta cáº­p nháº­p láº¡i giÃ¡ trá»‹ <em>NS</em> nÃ y cho domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645835018979_image.png?w=762&#x26;ssl=1\"></p>\n<p>TrÆ°á»›c khi thay Ä‘á»•i, nhá»› lÆ°u láº¡i backup giÃ¡ trá»‹ NS gá»‘c</p>\n<h2 id=\"cáº¥u-hÃ¬nh-cloudfront-distribution\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-cloudfront-distribution\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cáº¥u hÃ¬nh CloudFront distribution</h2>\n<p>ChÃºng ta sáº½ Ä‘iá»n vÃ o pháº§n <em>origin domain</em>, Ä‘á»«ng nháº­p giÃ¡ trá»‹ <strong>top-level domain</strong> nhÆ° <code class=\"language-inline-text\">your-app.com</code>, nÃ³ sáº½ lÃ  giÃ¡ trá»‹ sub domain, nhÆ° <code class=\"language-inline-text\">your-app.herokuapp.com</code> (náº¿u Ä‘Æ°á»£c host trÃªn herokuapp.com)</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645841894888_image.png?resize=1024%2C292&#x26;ssl=1\"></p>\n<p>Náº¿u cÃ³ Ã½ Ä‘á»‹nh dÃ¹ng <code class=\"language-inline-text\">HTTPs</code> thÃ¬ nhá»› thay Ä‘á»•i phÃ¢n <strong>Protocol</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645934723593_image.png?resize=1024%2C817&#x26;ssl=1\"></p>\n<p>Pháº§n dÆ°á»›i Ä‘Ã¢y cá»±c ká»³ quan trá»ng, náº¿u á»©ng dá»¥ng cá»§a chÃºng ta cÃ³ authen, ghi dá»¯ liá»‡u, nÃ³i chung nhá»¯ng phÆ°Æ¡ng thá»©c khÃ¡c ngoÃ i <code class=\"language-inline-text\">GET</code>, thÃ¬ nhá»› chá»n láº¡i <strong>Allowed HTTP methods</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645841986703_image.png?w=730&#x26;ssl=1\"></p>\n<p>ChÃºng ta cÅ©ng cáº§n thá»±c hiá»‡n má»™t vÃ i thay Ä‘á»•i trÃªn <strong>Cache key and origin requests</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842121040_image.png?resize=1024%2C763&#x26;ssl=1\"></p>\n<p><strong>Cache policy</strong> chÃºng ta cho phÃ©p giÃ¡ trá»‹ TTL minimum lÃ  0, nhÆ° váº­y vá»›i giÃ¡ trá»‹ non-caching header Ä‘Æ°á»£c gá»­i lÃªn sáº½ cÃ³ hiá»‡u lá»±c</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842200731_image.png?resize=1024%2C857&#x26;ssl=1\"></p>\n<p><strong>Origin request policy</strong>, Ä‘á»ƒ Ä‘áº£m báº£o cookie vÃ  query string khi Ä‘áº¿n CloudFront sáº½ Ä‘Æ°á»£c gá»­i xuá»‘ng server (khÃ´ng serve tá»« CDN)</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842297987_image.png?resize=1024%2C686&#x26;ssl=1\">\n<strong>Response headers policy</strong>, chÃºng ta chá»n <strong>CORS With Preflight</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645842362649_image.png?resize=1024%2C684&#x26;ssl=1\"></p>\n<p>ChÃºng ta váº«n pháº£i chá»©ng minh vá»›i AWS lÃ  chÃºng ta lÃ  chá»§ sá»Ÿ há»¯u cá»§a domain, trÆ°á»›c háº¿t chÃºng ta yÃªu cáº§u má»™t SSL certificate</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932319102_image.png?resize=1024%2C862&#x26;ssl=1\"></p>\n<p>Chá»n <strong>Request certificate</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645845081306_image.png?resize=1024%2C360&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645845178014_image.png?resize=1024%2C553&#x26;ssl=1\"></p>\n<p>Cung cáº¥p tÃªn miá»n, chá»n kiá»ƒu validate báº±ng <em>DNS</em></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932453934_image.png?resize=882%2C1024&#x26;ssl=1\"></p>\n<p>Chá»n <strong>Request</strong>, chá»n vÃ o Certificate ID vá»«a Ä‘Æ°á»£c táº¡o ra</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932554825_image.png?resize=1024%2C211&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932616235_image.png?resize=1024%2C227&#x26;ssl=1\"></p>\n<p>Äá»ƒ xÃ¡c minh domain chÃ­nh chá»§, chÃºng ta cáº§n Ä‘Æ°a giÃ¡ trá»‹ CNAME nÃ y vÃ o trong Route 53</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932927217_image.png?resize=1024%2C462&#x26;ssl=1\"></p>\n<p>ChÃºng ta táº¡o má»™t dÃ²ng CNAME vá»›i giÃ¡ trá»‹ trong certificate á»Ÿ trÃªn</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645932742028_image.png?resize=1024%2C637&#x26;ssl=1\"></p>\n<p>Sau khi xÃ¡c minh xong AWS sáº½ cáº­p nháº­p status trÃªn domain</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933155607_image.png?resize=1024%2C202&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933066086_image.png?resize=1024%2C156&#x26;ssl=1\"></p>\n<p>Xong, giá» quay láº¡i mÃ n hÃ¬nh CloudFront distribution, trong má»¥c <strong>SSL certificate</strong> chá»n vÃ o certificate chÃºng ta Ä‘Ã£ táº¡o</p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933691496_image.png?resize=1024%2C727&#x26;ssl=1\">\n<img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933782796_image.png?resize=1024%2C440&#x26;ssl=1\"></p>\n<p>Viá»‡c cÃ²n láº¡i lÃ  bÃ¡o vá»›i Route 53 Ä‘á»ƒ nÃ³ route domain vÃ o CloudFront, vÃ o Route 53 táº¡o thÃªm má»™t dÃ²ng DNS\nChá»n <strong>A record type</strong>, Ä‘Ã¡nh dáº¥u dÃ²ng nÃ y lÃ  má»™t <strong>alias</strong> vÃ  map alias nÃ y Ä‘áº¿n CloudFront. BÃªn trong má»¥c <strong>Route traffic to</strong> chÃºng ta sáº½ cÃ³ tÃ¹y chá»n <strong>Alias to CloudFront distribution</strong></p>\n<p><img src=\"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/04/s_9EC4D5B81B6CD9C28657A6DEAF8D3C9C2A6DFB1D0DE42C8A4034DB1807C8212F_1645933944994_image.png?resize=1024%2C538&#x26;ssl=1\"></p>\n<p>OK, xong rá»“i Ä‘Ã³.</p>\n<p>Äá»ƒ bÃ¡o vá»›i CloudFront Ä‘á»«ng cache nhá»¯ng request cá»¥ thá»ƒ nÃ o, chÃºng ta gá»­i trong header <code class=\"language-inline-text\">Cache-Control: no-cache</code>. VÃ­ dá»¥ sá»­ dá»¥ng Express middleware</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"no-cache\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">expressGraphql</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">schema</span><span class=\"token operator\">:</span> executableSchema<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">graphiql</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">rootValue</span><span class=\"token operator\">:</span> root\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<ul>\n<li><a href=\"https://css-tricks.com/setting-up-cloudfront-to-host-your-web-app/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Setting Up CloudFront to Host Your Web App</a></li>\n</ul>\n","cover_image":""}}]}}},"context":{}}