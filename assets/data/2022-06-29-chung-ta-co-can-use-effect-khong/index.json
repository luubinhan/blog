{"hash":"aa1b14b28c6a95ff3b4e2423c3c2ee3502c18cfa","data":{"post":{"title":"Ch√∫ng ta c√≥ c·∫ßn useEffect kh√¥ng","path":"/2022-06-29-chung-ta-co-can-use-effect-khong/","slug":"2022-06-29-chung-ta-co-can-use-effect-khong","date":"2022-06-29","timeToRead":5,"tags":[{"id":"react","title":"react","path":"/tag/react/"},{"id":"javascript","title":"javascript","path":"/tag/javascript/"}],"desc":"","content":"<p><code class=\"language-inline-text\">useEffect</code> ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ph·ª•c v·ª• ƒë·ªìng b·ªô h√≥a component v·ªõi <em>th·∫ø gi·ªõi b√™n ngo√†i</em>, nh∆∞ network, DOM, n·∫øu kh√¥ng c√≥ s·ª± tham gia c·ªßa c√°c y·∫øu t·ªë <em>b√™n ngo√†i</em>, v√≠ d·ª• nh∆∞ <em>state</em> c·∫ßn thay ƒë·ªïi khi <em>prop</em> thay ƒë·ªïi, ch√∫ng ta kh√¥ng c·∫ßn d√πng ƒë·∫øn useEffect. H·∫°n ch·∫ø l·ªói, code ch·∫°y nhanh h∆°n, d·ªÖ hi·ªÉu h∆°n l√† nh·ªØng ∆∞u ƒëi·ªÉm khi c√≥ √≠t effect.</p>\n<h2 id=\"b·ªè-nh·ªØng-effect-kh√¥ng-c·∫ßn-thi·∫øt\"><a href=\"#b%E1%BB%8F-nh%E1%BB%AFng-effect-kh%C3%B4ng-c%E1%BA%A7n-thi%E1%BA%BFt\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>B·ªè nh·ªØng effect kh√¥ng c·∫ßn thi·∫øt</h2>\n<p>M·ªôt s·ªë tr∆∞·ªùng h·ª£p kh√¥ng c·∫ßn effect hay b·∫Øt g·∫∑p</p>\n<ul>\n<li><strong>Transform data</strong>, v√≠ d·ª• ch√∫ng ta c·∫ßn filter tr√™n m·ªôt danh s√°ch, ch√∫ng ta s·∫Ω c√≥ xu h∆∞·ªõng ƒë∆∞a vi·ªác transform n√†y v√†o trong m·ªôt effect v·ªõi dependency l√† <code class=\"language-inline-text\">array</code></li>\n</ul>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">TodoList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> todos<span class=\"token punctuation\">,</span> filter <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// üî¥ Tr√°nh xa s·ª≠ d·ª•ng c√°ch n√†y</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>visibleTodos<span class=\"token punctuation\">,</span> setVisibleTodos<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gridsome-highlight-code-line\">\t\t<span class=\"token function\">setVisibleTodos</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFilteredTodos</span><span class=\"token punctuation\">(</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span>\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ‚úÖ ƒê√∫ng ra ch·ªâ c·∫ßn</span>\n<span class=\"token keyword\">const</span> visibleTodos <span class=\"token operator\">=</span> <span class=\"token function\">getFilteredTodos</span><span class=\"token punctuation\">(</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ‚úÖ N·∫øu vi·ªác `getFilteredTodos` t·ªën kh√° nhi·ªÅu th·ªùi gian ƒë·ªÉ ch·∫°y</span>\n<span class=\"token keyword\">const</span> visibleTodos <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getFilteredTodos</span><span class=\"token punctuation\">(</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>V√≠ d·ª• kh√°c, k·∫øt h·ª£p <code class=\"language-inline-text\">fullName</code> v√† <code class=\"language-inline-text\">lastName</code> th√†nh <code class=\"language-inline-text\">userName</code></p>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>firstName<span class=\"token punctuation\">,</span> setFirstName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vui'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>lastName<span class=\"token punctuation\">,</span> setLastName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'laptrinh'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// üî¥ Tr√°nh xa s·ª≠ d·ª•ng c√°ch n√†y</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>fullName<span class=\"token punctuation\">,</span> setFullName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gridsome-highlight-code-line\">\t<span class=\"token function\">setFullName</span><span class=\"token punctuation\">(</span>firstName <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> lastName<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>firstName<span class=\"token punctuation\">,</span> lastName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>T·∫°i sao ph·∫°i ph·ª©c t·∫°p m·ªôt c√°ch kh√¥ng c·∫ßn thi·∫øt nh∆∞ th·∫ø trong khi ch√∫ng ta ch·ªâ c·∫ßn vi·∫øt</p>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>firstName<span class=\"token punctuation\">,</span> setFirstName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vui'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>lastName<span class=\"token punctuation\">,</span> setLastName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'laptrinh'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ‚úÖ ƒê√∫ng ra ch·ªâ c·∫ßn</span>\n<span class=\"gridsome-highlight-code-line\"><span class=\"token keyword\">const</span> fullName <span class=\"token operator\">=</span> firstName <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> lastName</span></code></pre></div>\n<ul>\n<li><strong>User event</strong>, v√≠ d·ª• ch√∫ng ta s·∫Ω g·ªçi <code class=\"language-inline-text\">api/buy</code> khi user click v√†o n√∫t <em>mua s·∫£n ph·∫©m</em>, sau ƒë√≥ hi·ªÉn th·ªã m·ªôt th√¥ng b√°o ƒë·∫øn user, m·∫∑c d√π vi·ªác g·∫Øn s·ª± ki·ªán <code class=\"language-inline-text\">onClick</code> tr√™n button r·∫•t hi·ªÉn nhi√™n, nh∆∞ng c√≥ s·∫Ω c√≥ ng∆∞·ªùi d√πng effect</li>\n</ul>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// üî¥ Tr√°nh xa s·ª≠ d·ª•ng c√°ch n√†y</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span>isInCart<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gridsome-highlight-code-line\">\t\t<span class=\"token function\">showToast</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ƒê√£ th√™m v√†o gi·ªè h√†ng</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></span>\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>product<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleBuyClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">addToCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleCheckoutClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">addToCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">navigateTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/checkout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ‚úÖ ƒê√∫ng ra ch·ªâ c·∫ßn</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">buyProduct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">addToCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">showToast</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ƒê√£ th√™m v√†o gi·ªè h√†ng</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleBuyClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">buyProduct</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleCheckoutClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">buyProduct</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">navigateTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/checkout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>M·ªôt v√≠ d·ª• kh√°c, c·∫£ hai <code class=\"language-inline-text\">POST</code> request ƒë·ªÅu c√≥ th·ªÉ xem l√† side effect, tuy nhi√™n ch·ªâ c√≥ m·ªôt tr∆∞·ªùng h·ª£p n√™n d√πng <code class=\"language-inline-text\">useEffect</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// ‚úÖ Tr∆∞·ªùng h·ª£p n√†y ok</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/analytics/event'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">eventName</span><span class=\"token operator\">:</span> <span class=\"token string\">'visit_form'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// üî¥ Tr√°nh xa s·ª≠ d·ª•ng c√°ch n√†y</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>jsonToSubmit<span class=\"token punctuation\">,</span> setJsonToSubmit<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>jsonToSubmit <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/register/'</span><span class=\"token punctuation\">,</span> jsonToSubmit<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>jsonToSubmit<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>V·ªõi tr∆∞·ªùng h·ª£p 2, vi·ªác ph·∫£i ch·∫°y <code class=\"language-inline-text\">post('api/register'</code> ho√†n to√†n kh√¥ng ph·∫£i do ch√∫ng ta ph·∫£i <strong>hi·ªÉn th·ªã</strong> component, m√† n√≥ c·∫ßn ch·∫°y v√¨ user click submit. ƒê·ª´ng l√†m ph·ª©c t·∫°p v·∫•n ƒë·ªÅ m·ªôt c√°ch kh√¥ng c·∫ßn thi·∫øt</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// ‚úÖ R·∫•t hi·ªÉn nhi√™n</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleSubmit</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\te<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/register'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>our_form_data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><strong>Kh·ªüi ch·∫°y ·ª©ng d·ª•ng</strong>, khi ·ª©ng d·ª•ng b·∫Øt ƒë·∫ßu ch·∫°y, ch√∫ng ta mu·ªën m·ªôt s·ªë h√†m ch·∫°y ƒë√∫ng 1 l·∫ßn ƒë·∫ßu ti√™n</li>\n</ul>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// üî¥</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">loadDatafromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">checkAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tuy nhi√™n n√≥ l·∫°i ch·∫°y 2 l·∫ßn tr√™n m√¥i tr∆∞·ªùng development ƒë·∫•y c√°c b·∫°n ·∫°! <a href=\"https://beta.reactjs.org/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">B√†i n√†y c√≥ gi·∫£i th√≠ch n√®</a>, m·∫∑c d√π tr√™n production s·∫Ω kh√¥ng x·∫£y ra (z·ª°n ki·ªÉu n√†y kh√¥ng vui ƒë√¢u m·∫•y b√°c team React ·∫°)</p>\n<p>Ch√∫ng ta n√™n hi·ªÉu s·ª± kh√°c nhau gi·ªØa <strong>ch·∫°y m·ªôt l·∫ßn khi app kh·ªüi t·∫°o</strong> kh√°c v·ªõi <strong>ch·∫°y m·ªôt l·∫ßn khi component mount</strong>. ƒê·ªÉ ch·∫°y ƒê√öNG 1 L·∫¶N khi app kh·ªüi t·∫°o, ch√∫ng ta s·ª≠a l·∫°i nh∆∞ v·∫ßy</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> didInit <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>didInit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tdidInit <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\t\t\t<span class=\"token comment\">// ‚úÖ</span>\n\t\t\t<span class=\"token function\">loadDatafromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">checkAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ho·∫∑c c√≥ th·ªÉ ch·∫°y tr∆∞·ªõc khi app render lu√¥n</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// ‚úÖ</span>\n\t<span class=\"token function\">loadDatafromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">checkAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><strong>Subscribe</strong> tr√™n nh·ªØng d·ªØ li·ªáu b√™n ngo√†i\nNh·ªØng d·ªØ li·ªáu b√™n ngo√†i m·ªôt react component, nh∆∞ t·ª´ browser API, ch√∫ng ta v·∫´n th∆∞·ªùng d√πng effect nh∆∞ v√≠ d·ª•</li>\n</ul>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">useOnlineStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isOnline<span class=\"token punctuation\">,</span> setIsOnLine<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// üî¥</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">function</span> <span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">setIsOnline</span><span class=\"token punctuation\">(</span>navigator<span class=\"token punctuation\">.</span>onLine<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\t\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token keyword\">return</span> isOnline\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>C√°ch vi·∫øt n√†y kh√¥ng h·∫≥n sai ho√†n to√†n, ch·ªâ l√† c√≥ m·ªôt c√°ch t·ªëi ∆∞u h∆°n ƒë∆∞·ª£c React h·ªó tr·ª£ trong tr∆∞·ªùng h·ª£p c·∫ßn ph·∫£i subscribe tr√™n external store: <code class=\"language-inline-text\">useSyncExternalStore</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useOnlineStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// ‚úÖ</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">useSyncExternalStore</span><span class=\"token punctuation\">(</span>\n\t\tsubscribe<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> navigator<span class=\"token punctuation\">.</span>onLine<span class=\"token punctuation\">,</span> <span class=\"token comment\">// l·∫•y value t·ª´ client nh∆∞ th·∫ø n√†o</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// l·∫•y value n√†y t·ª´ server nh∆∞ th·∫ø n√†o\t</span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ƒê·ªçc th√™m v·ªÅ useSyncExternalStore</a></p>\n<ul>\n<li><strong>Fetch data</strong>, ƒë√¢y c√≥ th·ªÉ l√† m·ªôt trong nh·ªØng c√°ch s·ª≠ d·ª•ng effect ph·ªï bi·∫øn nh·∫•t hi·ªán t·∫°i</li>\n</ul>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> query <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>results<span class=\"token punctuation\">,</span> setResults<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">,</span> setPage<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// üî¥</span>\n    <span class=\"token function\">fetchResults</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">json</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setResults</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleNextPageClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setPage</span><span class=\"token punctuation\">(</span>page <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ƒêo·∫°n code n√†y s·∫Ω r∆°i v√†o t√¨nh hu·ªëng <em>race condition</em> n·∫øu nh∆∞ user nh·∫≠p qu√° nhanh (gi√° tr·ªã <code class=\"language-inline-text\">query</code> thay ƒë·ªïi theo input c·ªßa user), l√∫c n√†y ch√∫ng ta s·∫Ω c·∫ßn ƒë·∫øn <code class=\"language-inline-text\">debounce</code>, ngo√†i ra ch√∫ng ta s·∫Ω c√≤n ph·∫£i nghƒ© ƒë·∫øn chuy·ªán <em>cache</em> data ƒë√£ l·∫•y v·ªÅ ƒë·ªÉ t·ªëi ∆∞u, v√¢ng v√¢ng m√¢y m√¢y nhi·ªÅu th·ª© kh√°c ph·∫£i x·ª≠ l√Ω. ƒê√¢u ph·∫£i t·ª± nhi√™n m√† c√°c framework nh∆∞ Next.js, Gatsby, Remix, Razzie ƒë·ªÅu gi·ªõi thi·ªáu nh·ªØng c√°ch fetch data c·ªßa ri√™ng ch√∫ng</p>\n<p>M·∫°nh d·∫°ng ƒë·ªÅ xu·∫•t s·ª≠ d·ª•ng nh·ªØng th∆∞ vi·ªán th·ª© 3 ƒë·ªÉ <code class=\"language-inline-text\">fetch</code> data thay v√¨ d√πng  <code class=\"language-inline-text\">useEffect</code>, nh∆∞ <a href=\"https://react-query.tanstack.com/reference/useQuery\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">useQuery</a>, ho·∫∑c <em>b√®o nh·∫•t</em> c≈©ng ph·∫£i d√πng custom hook <a href=\"https://usehooks-ts.com/react-hook/use-fetch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">useFetch</a></p>\n<h2 id=\"k·∫øt-lu·∫≠n\"><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>K·∫øt lu·∫≠n</h2>\n<p>Khi s·ª≠ d·ª•ng <code class=\"language-inline-text\">useEffect</code> ch√∫ng ta ph·∫£i h·∫øt s·ª©c ƒë·ªÉ √Ω xem ph·∫ßn n√†o c√≥ th·ªÉ t√°ch ra th√†nh custom hook, ph·∫ßn n√†o n√™n b·ªè lu√¥n, c√†ng √≠t <code class=\"language-inline-text\">useEffect</code> code c√†ng d·ªÖ hi·ªÉu v√† d·ªÖ maintain</p>\n<p><a href=\"https://beta.reactjs.org/learn/you-might-not-need-an-effect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">You Might Not Need an Effect</a></p>\n","cover_image":"","related":[{"id":"9d87d27381e3669ee806ffebb81e98ed","path":"/2019-10-25-gioi-thieu-javascript-khong-dung-jquery/","title":"B·∫°n kh√¥ng c·∫ßn jQuery","desc":"Kh√¥ng c·∫ßn jQuery, b·∫°n th·ªÉ th·ªÉ d√πng javascript thu·∫ßn ƒë·ªÉ th·ª±c hi·ªán nh·ªØng thao t√°c tr∆∞·ªõc ƒë√¢y b·∫°n nghƒ© ph·∫£i c√≥ jQuery c∆°"},{"id":"e75a99f44846b3fabeee36d8b1eb0b64","path":"/2020-09-26-kien-thuc-rest-api-can-thiet-khi-di-phong-van/","title":"Ki·∫øn th·ª©c cƒÉn b·∫£n REST API cho FE developer","desc":"2020 REST API v·∫´n ƒëang l√† chu·∫©n m·ª±c giao ti·∫øp c·ªßa API tr√™n n·ªÅn web (chi·∫øm 69% so v·ªõi c√°c API kh√°c), nh∆∞ v·∫≠y ƒë√£ ƒë·ªß thuy·∫øt ph·ª•c c√°c b·∫°n n·∫Øm th·∫≠t r√µ ki·∫øn th·ª©c REST API ch∆∞a?"},{"id":"5056f121bf99a2d9c1b987942c928592","path":"/2020-07-21-5-cau-hoi-phong-van-javascript/","title":"5 c√¢u h·ªèi javascript v√† c√°ch ƒë√°nh b·∫°i ch√∫ng","desc":"M·ªói c√¥ng ty m·ªói ki·ªÉu ph·ªèng v·∫•n, ƒëi·ªÅu hay b·ªã ph√†n n√†n trong c√°c bu·ªïi ph·ªèng v·∫•n l√† ph·∫ßn l·ªõn n√≥ kh√¥ng li√™n quan t·ªõi nh·ªØng c√¥ng vi·ªác h·∫±ng ng√†y m√† v·ªã tr√≠ ƒë√≥ ƒë√≤i h·ªèi."},{"id":"e50caffffbea9c79e5698cd929baa00a","path":"/2020-03-23-tat-tan-tat-huong-dan-ve-use-effect/","title":"useEffect t·ª´ a t·ªõi z","desc":"ƒê√¢y l√† m·ªôt b√†i vi·∫øt t∆∞∆°ng ƒë·ªëi d√†i d√≤ng v·ªÅ useEffect, b·∫°n c·∫ßn bi·∫øt v√† ƒë√£ ƒë·ªçc qua t√†i li·ªáu v·ªÅ useEffect tr√™n trang ch√≠nh th·ª©c c·ªßa React tr∆∞·ªõc, v√† n·∫øu ch·ªâ th·ª±c s·ª± c·∫ßn bi·∫øt s·ª≠ d·ª•ng useEffect ra sao, b·∫°n kh√¥ng c·∫ßn ƒë·ªçc b√†i vi·∫øt ph√¢n t√°ch m·ªï x·∫ª s√¢u ki·ªÉu n√†y."}]}},"context":{}}