{"hash":"2614a9f464f28805085bbbd764f6609c0dea9377","data":{"post":{"title":"ChÃºng ta cÃ³ cáº§n useEffect khÃ´ng","path":"/2022-06-29-chung-ta-co-can-use-effect-khong/","slug":"2022-06-29-chung-ta-co-can-use-effect-khong","date":"2022-06-29","timeToRead":5,"tags":[{"id":"react","title":"react","path":"/tag/react/"},{"id":"javascript","title":"javascript","path":"/tag/javascript/"}],"desc":"Má»™t sá»‘ trÆ°á»ng há»£p khÃ´ng cáº§n effect hay báº¯t gáº·p","content":"<p><code class=\"language-inline-text\">useEffect</code> Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ phá»¥c vá»¥ Ä‘á»“ng bá»™ hÃ³a component vá»›i <em>tháº¿ giá»›i bÃªn ngoÃ i</em>, nhÆ° network, DOM, náº¿u khÃ´ng cÃ³ sá»± tham gia cá»§a cÃ¡c yáº¿u tá»‘ <em>bÃªn ngoÃ i</em>, vÃ­ dá»¥ nhÆ° <em>state</em> cáº§n thay Ä‘á»•i khi <em>prop</em> thay Ä‘á»•i, chÃºng ta khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n useEffect. Háº¡n cháº¿ lá»—i, code cháº¡y nhanh hÆ¡n, dá»… hiá»ƒu hÆ¡n lÃ  nhá»¯ng Æ°u Ä‘iá»ƒm khi cÃ³ Ã­t effect.</p>\n<!-- TOC -->\n<ul>\n<li><a href=\"#transform-data\">Transform data</a></li>\n<li><a href=\"#user-event\">User event</a></li>\n<li><a href=\"#kh%E1%BB%9Fi-ch%E1%BA%A1y-%E1%BB%A9ng-d%E1%BB%A5ng\">Khá»Ÿi cháº¡y á»©ng dá»¥ng</a></li>\n<li><a href=\"#subscrib-tr%C3%AAn-nh%E1%BB%AFng-d%E1%BB%AF-li%E1%BB%87u-b%C3%AAn-ngo%C3%A0i\">Subscrib trÃªn nhá»¯ng dá»¯ liá»‡u bÃªn ngoÃ i</a></li>\n<li><a href=\"#fetch-data\">Fetch data</a></li>\n<li><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\">Káº¿t luáº­n</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"transform-data\"><a href=\"#transform-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Transform data</h2>\n<p>VÃ­ dá»¥ chÃºng ta cáº§n filter trÃªn má»™t danh sÃ¡ch, chÃºng ta sáº½ cÃ³ xu hÆ°á»›ng Ä‘Æ°a viá»‡c transform nÃ y vÃ o trong má»™t effect vá»›i dependency lÃ  <code class=\"language-inline-text\">array</code></p>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">TodoList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> todos<span class=\"token punctuation\">,</span> filter <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// ğŸ”´ TrÃ¡nh xa sá»­ dá»¥ng cÃ¡ch nÃ y</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>visibleTodos<span class=\"token punctuation\">,</span> setVisibleTodos<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gridsome-highlight-code-line\">\t\t<span class=\"token function\">setVisibleTodos</span><span class=\"token punctuation\">(</span><span class=\"token function\">getFilteredTodos</span><span class=\"token punctuation\">(</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span>\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// âœ… ÄÃºng ra chá»‰ cáº§n</span>\n<span class=\"token keyword\">const</span> visibleTodos <span class=\"token operator\">=</span> <span class=\"token function\">getFilteredTodos</span><span class=\"token punctuation\">(</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// âœ… Náº¿u viá»‡c `getFilteredTodos` tá»‘n khÃ¡ nhiá»u thá»i gian Ä‘á»ƒ cháº¡y</span>\n<span class=\"token keyword\">const</span> visibleTodos <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getFilteredTodos</span><span class=\"token punctuation\">(</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>todos<span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>VÃ­ dá»¥ khÃ¡c, káº¿t há»£p <code class=\"language-inline-text\">fullName</code> vÃ  <code class=\"language-inline-text\">lastName</code> thÃ nh <code class=\"language-inline-text\">userName</code></p>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>firstName<span class=\"token punctuation\">,</span> setFirstName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vui'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>lastName<span class=\"token punctuation\">,</span> setLastName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'laptrinh'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ğŸ”´ TrÃ¡nh xa sá»­ dá»¥ng cÃ¡ch nÃ y</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>fullName<span class=\"token punctuation\">,</span> setFullName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gridsome-highlight-code-line\">\t<span class=\"token function\">setFullName</span><span class=\"token punctuation\">(</span>firstName <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> lastName<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>firstName<span class=\"token punctuation\">,</span> lastName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Táº¡i sao pháº¡i phá»©c táº¡p má»™t cÃ¡ch khÃ´ng cáº§n thiáº¿t nhÆ° tháº¿ trong khi chÃºng ta chá»‰ cáº§n viáº¿t</p>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>firstName<span class=\"token punctuation\">,</span> setFirstName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vui'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>lastName<span class=\"token punctuation\">,</span> setLastName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'laptrinh'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// âœ… ÄÃºng ra chá»‰ cáº§n</span>\n<span class=\"gridsome-highlight-code-line\"><span class=\"token keyword\">const</span> fullName <span class=\"token operator\">=</span> firstName <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> lastName</span></code></pre></div>\n<h2 id=\"user-event\"><a href=\"#user-event\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>User event</h2>\n<p>VÃ­ dá»¥ chÃºng ta sáº½ gá»i <code class=\"language-inline-text\">api/buy</code> khi user click vÃ o nÃºt <em>mua sáº£n pháº©m</em>, sau Ä‘Ã³ hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o Ä‘áº¿n user, máº·c dÃ¹ viá»‡c gáº¯n sá»± kiá»‡n <code class=\"language-inline-text\">onClick</code> trÃªn button ráº¥t hiá»ƒn nhiÃªn, nhÆ°ng cÃ³ sáº½ cÃ³ ngÆ°á»i dÃ¹ng effect</p>\n<div class=\"gridsome-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ğŸ”´ TrÃ¡nh xa sá»­ dá»¥ng cÃ¡ch nÃ y</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span>isInCart<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gridsome-highlight-code-line\">\t\t<span class=\"token function\">showToast</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ÄÃ£ thÃªm vÃ o giá» hÃ ng</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></span>\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>product<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleBuyClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">addToCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleCheckoutClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">addToCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">navigateTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/checkout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// âœ… ÄÃºng ra chá»‰ cáº§n</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">buyProduct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">addToCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">showToast</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ÄÃ£ thÃªm vÃ o giá» hÃ ng</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleBuyClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">buyProduct</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleCheckoutClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">buyProduct</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">navigateTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/checkout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Má»™t vÃ­ dá»¥ khÃ¡c, cáº£ hai <code class=\"language-inline-text\">POST</code> request Ä‘á»u cÃ³ thá»ƒ xem lÃ  side effect, tuy nhiÃªn chá»‰ cÃ³ má»™t trÆ°á»ng há»£p nÃªn dÃ¹ng <code class=\"language-inline-text\">useEffect</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// âœ… TrÆ°á»ng há»£p nÃ y ok</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/analytics/event'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">eventName</span><span class=\"token operator\">:</span> <span class=\"token string\">'visit_form'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ğŸ”´ TrÃ¡nh xa sá»­ dá»¥ng cÃ¡ch nÃ y</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>jsonToSubmit<span class=\"token punctuation\">,</span> setJsonToSubmit<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>jsonToSubmit <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/register/'</span><span class=\"token punctuation\">,</span> jsonToSubmit<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>jsonToSubmit<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Vá»›i trÆ°á»ng há»£p 2, viá»‡c pháº£i cháº¡y <code class=\"language-inline-text\">post('api/register'</code> hoÃ n toÃ n khÃ´ng pháº£i do chÃºng ta pháº£i <strong>hiá»ƒn thá»‹</strong> component, mÃ  nÃ³ cáº§n cháº¡y vÃ¬ user click submit. Äá»«ng lÃ m phá»©c táº¡p váº¥n Ä‘á» má»™t cÃ¡ch khÃ´ng cáº§n thiáº¿t</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// âœ… Ráº¥t hiá»ƒn nhiÃªn</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleSubmit</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\te<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/register'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>our_form_data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"khá»Ÿi-cháº¡y-á»©ng-dá»¥ng\"><a href=\"#kh%E1%BB%9Fi-ch%E1%BA%A1y-%E1%BB%A9ng-d%E1%BB%A5ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Khá»Ÿi cháº¡y á»©ng dá»¥ng</h2>\n<p>Khi á»©ng dá»¥ng báº¯t Ä‘áº§u cháº¡y, chÃºng ta muá»‘n má»™t sá»‘ hÃ m cháº¡y Ä‘Ãºng 1 láº§n Ä‘áº§u tiÃªn</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// ğŸ”´</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">loadDatafromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">checkAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tuy nhiÃªn nÃ³ láº¡i cháº¡y 2 láº§n trÃªn mÃ´i trÆ°á»ng development Ä‘áº¥y cÃ¡c báº¡n áº¡! <a href=\"https://beta.reactjs.org/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BÃ i nÃ y cÃ³ giáº£i thÃ­ch nÃ¨</a>, máº·c dÃ¹ trÃªn production sáº½ khÃ´ng xáº£y ra (zá»¡n kiá»ƒu nÃ y khÃ´ng vui Ä‘Ã¢u máº¥y bÃ¡c team React áº¡)</p>\n<p>ChÃºng ta nÃªn hiá»ƒu sá»± khÃ¡c nhau giá»¯a <strong>cháº¡y má»™t láº§n khi app khá»Ÿi táº¡o</strong> khÃ¡c vá»›i <strong>cháº¡y má»™t láº§n khi component mount</strong>. Äá»ƒ cháº¡y ÄÃšNG 1 Láº¦N khi app khá»Ÿi táº¡o, chÃºng ta sá»­a láº¡i nhÆ° váº§y</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> didInit <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>didInit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tdidInit <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\t\t\t<span class=\"token comment\">// âœ…</span>\n\t\t\t<span class=\"token function\">loadDatafromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">checkAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Hoáº·c cÃ³ thá»ƒ cháº¡y trÆ°á»›c khi app render luÃ´n</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// âœ…</span>\n\t<span class=\"token function\">loadDatafromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">checkAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"subscrib-trÃªn-nhá»¯ng-dá»¯-liá»‡u-bÃªn-ngoÃ i\"><a href=\"#subscrib-tr%C3%AAn-nh%E1%BB%AFng-d%E1%BB%AF-li%E1%BB%87u-b%C3%AAn-ngo%C3%A0i\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Subscrib trÃªn nhá»¯ng dá»¯ liá»‡u bÃªn ngoÃ i</h2>\n<p>Nhá»¯ng dá»¯ liá»‡u bÃªn ngoÃ i má»™t react component, nhÆ° tá»« browser API, chÃºng ta váº«n thÆ°á»ng dÃ¹ng effect nhÆ° vÃ­ dá»¥</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">useOnlineStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isOnline<span class=\"token punctuation\">,</span> setIsOnLine<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// ğŸ”´</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">function</span> <span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">setIsOnline</span><span class=\"token punctuation\">(</span>navigator<span class=\"token punctuation\">.</span>onLine<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\t\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token keyword\">return</span> isOnline\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>CÃ¡ch viáº¿t nÃ y khÃ´ng háº³n sai hoÃ n toÃ n, chá»‰ lÃ  cÃ³ má»™t cÃ¡ch tá»‘i Æ°u hÆ¡n Ä‘Æ°á»£c React há»— trá»£ trong trÆ°á»ng há»£p cáº§n pháº£i subscribe trÃªn external store: <code class=\"language-inline-text\">useSyncExternalStore</code></p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'online'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\t\twindow<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'offline'</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useOnlineStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// âœ…</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">useSyncExternalStore</span><span class=\"token punctuation\">(</span>\n\t\tsubscribe<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> navigator<span class=\"token punctuation\">.</span>onLine<span class=\"token punctuation\">,</span> <span class=\"token comment\">// láº¥y value tá»« client nhÆ° tháº¿ nÃ o</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// láº¥y value nÃ y tá»« server nhÆ° tháº¿ nÃ o\t</span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Äá»c thÃªm vá» useSyncExternalStore</a></p>\n<h2 id=\"fetch-data\"><a href=\"#fetch-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Fetch data</h2>\n<p>ÄÃ¢y cÃ³ thá»ƒ lÃ  má»™t trong nhá»¯ng cÃ¡ch sá»­ dá»¥ng effect phá»• biáº¿n nháº¥t hiá»‡n táº¡i</p>\n<div class=\"gridsome-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">SearchResults</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> query <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>results<span class=\"token punctuation\">,</span> setResults<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">,</span> setPage<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ğŸ”´</span>\n    <span class=\"token function\">fetchResults</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">json</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setResults</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleNextPageClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setPage</span><span class=\"token punctuation\">(</span>page <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Äoáº¡n code nÃ y sáº½ rÆ¡i vÃ o tÃ¬nh huá»‘ng <em>race condition</em> náº¿u nhÆ° user nháº­p quÃ¡ nhanh (giÃ¡ trá»‹ <code class=\"language-inline-text\">query</code> thay Ä‘á»•i theo input cá»§a user), lÃºc nÃ y chÃºng ta sáº½ cáº§n Ä‘áº¿n <code class=\"language-inline-text\">debounce</code>, ngoÃ i ra chÃºng ta sáº½ cÃ²n pháº£i nghÄ© Ä‘áº¿n chuyá»‡n <em>cache</em> data Ä‘Ã£ láº¥y vá» Ä‘á»ƒ tá»‘i Æ°u, vÃ¢ng vÃ¢ng mÃ¢y mÃ¢y nhiá»u thá»© khÃ¡c pháº£i xá»­ lÃ½. ÄÃ¢u pháº£i tá»± nhiÃªn mÃ  cÃ¡c framework nhÆ° Next.js, Gatsby, Remix, Razzie Ä‘á»u giá»›i thiá»‡u nhá»¯ng cÃ¡ch fetch data cá»§a riÃªng chÃºng</p>\n<p>Máº¡nh dáº¡ng Ä‘á» xuáº¥t sá»­ dá»¥ng nhá»¯ng thÆ° viá»‡n thá»© 3 Ä‘á»ƒ <code class=\"language-inline-text\">fetch</code> data thay vÃ¬ dÃ¹ng  <code class=\"language-inline-text\">useEffect</code>, nhÆ° <a href=\"https://react-query.tanstack.com/reference/useQuery\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">useQuery</a>, hoáº·c <em>bÃ¨o nháº¥t</em> cÅ©ng pháº£i dÃ¹ng custom hook <a href=\"https://usehooks-ts.com/react-hook/use-fetch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">useFetch</a></p>\n<h2 id=\"káº¿t-luáº­n\"><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Káº¿t luáº­n</h2>\n<p>Khi sá»­ dá»¥ng <code class=\"language-inline-text\">useEffect</code> chÃºng ta pháº£i háº¿t sá»©c Ä‘á»ƒ Ã½ xem pháº§n nÃ o cÃ³ thá»ƒ tÃ¡ch ra thÃ nh custom hook, pháº§n nÃ o nÃªn bá» luÃ´n, cÃ ng Ã­t <code class=\"language-inline-text\">useEffect</code> code cÃ ng dá»… hiá»ƒu vÃ  dá»… maintain</p>\n<p><a href=\"https://beta.reactjs.org/learn/you-might-not-need-an-effect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">You Might Not Need an Effect</a></p>\n","cover_image":"","related":[{"id":"9d87d27381e3669ee806ffebb81e98ed","path":"/2019-10-25-gioi-thieu-javascript-khong-dung-jquery/","title":"Báº¡n khÃ´ng cáº§n jQuery","desc":"KhÃ´ng cáº§n jQuery, báº¡n thá»ƒ thá»ƒ dÃ¹ng javascript thuáº§n Ä‘á»ƒ thá»±c hiá»‡n nhá»¯ng thao tÃ¡c trÆ°á»›c Ä‘Ã¢y báº¡n nghÄ© pháº£i cÃ³ jQuery cÆ¡"},{"id":"e75a99f44846b3fabeee36d8b1eb0b64","path":"/2020-09-26-kien-thuc-rest-api-can-thiet-khi-di-phong-van/","title":"Kiáº¿n thá»©c cÄƒn báº£n REST API cho FE developer","desc":"2020 REST API váº«n Ä‘ang lÃ  chuáº©n má»±c giao tiáº¿p cá»§a API trÃªn ná»n web (chiáº¿m 69% so vá»›i cÃ¡c API khÃ¡c), nhÆ° váº­y Ä‘Ã£ Ä‘á»§ thuyáº¿t phá»¥c cÃ¡c báº¡n náº¯m tháº­t rÃµ kiáº¿n thá»©c REST API chÆ°a?"},{"id":"5056f121bf99a2d9c1b987942c928592","path":"/2020-07-21-5-cau-hoi-phong-van-javascript/","title":"5 cÃ¢u há»i javascript vÃ  cÃ¡ch Ä‘Ã¡nh báº¡i chÃºng","desc":"Má»—i cÃ´ng ty má»—i kiá»ƒu phá»ng váº¥n, Ä‘iá»u hay bá»‹ phÃ n nÃ n trong cÃ¡c buá»•i phá»ng váº¥n lÃ  pháº§n lá»›n nÃ³ khÃ´ng liÃªn quan tá»›i nhá»¯ng cÃ´ng viá»‡c háº±ng ngÃ y mÃ  vá»‹ trÃ­ Ä‘Ã³ Ä‘Ã²i há»i."},{"id":"e50caffffbea9c79e5698cd929baa00a","path":"/2020-03-23-tat-tan-tat-huong-dan-ve-use-effect/","title":"useEffect tá»« a tá»›i z","desc":"ÄÃ¢y lÃ  má»™t bÃ i viáº¿t tÆ°Æ¡ng Ä‘á»‘i dÃ i dÃ²ng vá» useEffect, báº¡n cáº§n biáº¿t vÃ  Ä‘Ã£ Ä‘á»c qua tÃ i liá»‡u vá» useEffect trÃªn trang chÃ­nh thá»©c cá»§a React trÆ°á»›c, vÃ  náº¿u chá»‰ thá»±c sá»± cáº§n biáº¿t sá»­ dá»¥ng useEffect ra sao, báº¡n khÃ´ng cáº§n Ä‘á»c bÃ i viáº¿t phÃ¢n tÃ¡ch má»• xáº» sÃ¢u kiá»ƒu nÃ y."}]}},"context":{}}