{"hash":"33153471da56228ddf4e2462835c7a1a5271f1bd","data":{"post":{"title":"Bắt sự kiện click bên ngoài Component React","path":"/bat-su-kien-click-ben-ngoai-component-react/","date":"2020-01-30","timeToRead":1,"tags":[{"id":"thu-thuat","title":"thu-thuat","path":"/tag/thu-thuat/"},{"id":"react","title":"react","path":"/tag/react/"}],"desc":"Thủ thuật nhỏ để bắt sự kiện click có nằm ngoài component không","content":"<p>Nếu bạn tự làm một react component như <em>dropdown</em>, <em>modal</em>, <em>popover</em>, không sớm thì muộn bạn sẽ rơi vào tình huống sao \"Bắt sự kiện click bên ngoài component để đóng nó (modal, popover, dropdown) lại\"</p>\n<p><img src=\"https://miro.medium.com/max/546/1*7dmOCdkoDLfnWz6hBF0fYA.png\"></p>\n<p>Đây là những gì bạn cần làm</p>\n<ol>\n<li>Để biết sự kiện nằm trong hay ngoài component, chúng ta phải lấy được DOM của element, dùng <code class=\"language-text\">ref</code> để lấy tham chiếu đến DOM <em>thực</em> của component</li>\n</ol>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> node <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token spread operator\">...</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        ...\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span></code></pre>\n<ol start=\"2\">\n<li>Thêm một event listener cho sự kiện click ( <em>mousedown</em> )</li>\n</ol>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//  thêm khi đã mount</span>\n    <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mousedown\"</span><span class=\"token punctuation\">,</span> handleClick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// dọn dẹp</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mousedown\"</span><span class=\"token punctuation\">,</span> handleClick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre>\n<ol start=\"3\">\n<li>Bên trong <code class=\"language-text\">handleClick</code> <strong>node.current.contains(e.target)</strong> sẽ trả về <code class=\"language-text\">true</code> nếu click xuất phát bên trong ref <code class=\"language-text\">node</code></li>\n</ol>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span><span class=\"token property-access\">current</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">contains</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">target</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// outside</span>\n    <span class=\"token spread operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p><a href=\"https://codesandbox.io/s/w62xl39907\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a>\n<a href=\"https://medium.com/@pitipatdop/little-neat-trick-to-capture-click-outside-react-component-5604830beb7f\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Little Neat trick to capture click outside with React Hook</a></p>\n","cover_image":"","related":[{"id":"4f5128f52679191e40ab274c3db1314d","path":"/bao-mat-web-mot-so-kieu-tan-cong/","title":"Bảo mật web - Một số kiểu tấn công","desc":"Tổng quát các vấn đề bạn cần quan tâm để bảo mật ứng dụng web"},{"id":"9dff911f3d4c998b2e2d39eff8025ade","path":"/huong-dan-handle-event-listener-can-ban-cho-cac-ban-moi-bat-dau-voi-javascript/","title":"Hướng dẫn handle event listener căn bản cho các bạn mới bắt đầu với javascript","desc":"Căn bản nhưng cần thiết"},{"id":"e75a99f44846b3fabeee36d8b1eb0b64","path":"/kien-thuc-can-ban-rest-api-cho-fe-developer/","title":"Kiến thức căn bản REST API cho FE developer","desc":"2020 REST API vẫn đang là chuẩn mực giao tiếp của API trên nền web (chiếm 69% so với các API khác), như vậy đã đủ thuyết phục các bạn nắm thật rõ kiến thức REST API chưa?"},{"id":"aef50f5a2dd43730cf89e8a944b6adec","path":"/toi-uu-component-react-bang-react-memo-use-memo-va-use-callback/","title":"Tối ưu component React bằng React.memo, useMemo và useCallback","desc":"Sử dụng những hàm có sẵn của React để viết component ngon hơn"}]}},"context":{}}