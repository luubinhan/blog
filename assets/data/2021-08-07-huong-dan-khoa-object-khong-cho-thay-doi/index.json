{"hash":"96c8dea8aa6d6e6f9c0c563edfb92dcd7958f442","data":{"post":{"title":"Các cách lock một property hay object của JS","path":"/2021-08-07-huong-dan-khoa-object-khong-cho-thay-doi/","slug":"/2021-08-07-huong-dan-khoa-object-khong-cho-thay-doi","date":"2021-08-07","timeToRead":2,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"},{"id":"hoc-thuat","title":"hoc-thuat","path":"/tag/hoc-thuat/"},{"id":"medium","title":"medium","path":"/tag/medium/"}],"desc":"","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#kh%C3%B3a-property-c%E1%BB%A7a-object\">Khóa property của object</a></li>\n<li><a href=\"#kh%C3%B3a-to%C3%A0n-b%E1%BB%99-object\">Khóa toàn bộ object</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"khóa-property-của-object\"><a href=\"#kh%C3%B3a-property-c%E1%BB%A7a-object\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Khóa property của object</h2>\n<p>Set giá trị một object trong js, chúng ta chỉ cần biết đến <code class=\"language-inline-text\">property: value</code></p>\n<p>Vậy nếu muốn <em>khóa</em> <em>property</em> này không cho phép chỉnh sửa thì sao?</p>\n<p>Mỗi property trong object sẽ được <em>khuyến mãi</em> thêm 3 <em>flag attribute</em> <strong>đặc biệt</strong> - <strong>descriptor</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> descriptor <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// kết quả</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"writable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  \t<span class=\"token string-property property\">\"enumerable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  \t<span class=\"token string-property property\">\"configurable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><strong>writable</strong>: = <code class=\"language-inline-text\">true</code> thì chúng ta cập nhập được <code class=\"language-inline-text\">value</code></li>\n<li><strong>enumerable</strong>: = <code class=\"language-inline-text\">true</code> thì khi loop chúng ta sẽ <strong>thấy</strong> nó</li>\n<li><strong>configurable</strong>: = <code class=\"language-inline-text\">true</code> thì có thể <em>delete</em> được, các <em>attribute</em> <code class=\"language-inline-text\">writable</code>, <code class=\"language-inline-text\">enumerable</code> có thể chỉnh sửa</li>\n</ul>\n<p>Để thay đổi giá trị cho các attribute này, chúng ta thực hiện thông qua hàm <code class=\"language-inline-text\">Object.defineProperty(obj, propertyName, descriptor)</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"gridsome-highlight-code-line\">Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span></span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span><span class=\"token punctuation\">,</span>\n<span class=\"gridsome-highlight-code-line\">    <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></span><span class=\"gridsome-highlight-code-line\">    <span class=\"token literal-property property\">enumerable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></span><span class=\"gridsome-highlight-code-line\">    <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// không còn change giá trị của name được nữa</span>\nuser<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Peter\"</span><span class=\"token punctuation\">;</span> \n<span class=\"token comment\">// Error: Cannot assign to read only property 'name'</span>\n\n<span class=\"token comment\">// không còn thấy khi loop</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> key <span class=\"token keyword\">in</span> user<span class=\"token punctuation\">)</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ví dụ một property có attribute <code class=\"language-inline-text\">configurable=false</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// tự động gán false hết cho các attribute</span>\n<span class=\"token keyword\">let</span> descriptor <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">,</span> <span class=\"token string\">'PI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\n{\n  \"value\": 3.141592653589793,\n  \"writable\": false,\n  \"enumerable\": false,\n  \"configurable\": false\n}\n*/</span>\n\nMath<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> \n<span class=\"token comment\">// Error, because it has writable: false</span>\n\n<span class=\"token comment\">// ko thể thay đổi attribute writable nữa</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">,</span> <span class=\"token string\">\"PI\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Error, because of configurable: false</span></code></pre></div>\n<blockquote>\n<p>Nếu chỉ set <code class=\"language-inline-text\">configurable = false</code> thì vẫn thay đổi giá trị được, nó chỉ không cho thay đổi attribute và delete</p>\n</blockquote>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nuser<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Pete\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// vẫn được</span>\n<span class=\"token keyword\">delete</span> user<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error</span></code></pre></div>\n<p>Nếu muốn khai báo nhiều property cùng lúc, dùng <code class=\"language-inline-text\">Object.defineProperties()</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperties</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">prop1</span><span class=\"token operator\">:</span> descriptor1<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">prop2</span><span class=\"token operator\">:</span> descriptor2\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Ví dụ</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperties</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"John\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">surname</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Smith\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lấy tất cả descriptor, <code class=\"language-inline-text\">Object.getOwnDescriptors(obj)</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> clone <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptors</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"khóa-toàn-bộ-object\"><a href=\"#kh%C3%B3a-to%C3%A0n-b%E1%BB%99-object\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Khóa toàn bộ object</h2>\n<p>Để khóa hẳn một object, chúng ta có đến tận 3 phương thức</p>\n<ul>\n<li><code class=\"language-inline-text\">Object.preventExtension(obj)</code> không cho thể các property mới</li>\n<li><code class=\"language-inline-text\">Object.seal(obj)</code> không cho thêm/xóa các property, <code class=\"language-inline-text\">configurable: false</code></li>\n<li><code class=\"language-inline-text\">Object.freeze(obj)</code> không cho thêm/xóa/thay đổi property, <code class=\"language-inline-text\">configurable: false, writable: false</code></li>\n</ul>\n<p><a href=\"https://javascript.info/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://javascript.info/</a></p>\n","cover_image":"","related":[{"id":"82024782340394829e370035b38d7c55","path":"/2020-11-09-3-cach-khai-bao-function-trong-js/","title":"Các cách khai báo function trong JS","desc":""},{"id":"70f3e2bd989634dc3f0a0ae306169ed8","path":"/2021-08-10-javascript-prototype-object/","title":"Prototype của object","desc":""},{"id":"e7c293f2b5f883e552990038574c3c90","path":"/2020-08-14-mixins/","title":"Mixin của JS","desc":""},{"id":"f95e66fe5b94e458e4d0f50ce5148c94","path":"/2019-08-07-nguyen-tac-chung-cua-thiet-ke/","title":"Principle của các sản phẩm nổi tiếng","desc":"Phù hợp cho các bạn thiết kế nào ko muốn làm code dạo, design dạo nữa, bạn muốn cái gì đó cao hơn ở tầng khái niệm"}]}},"context":{}}