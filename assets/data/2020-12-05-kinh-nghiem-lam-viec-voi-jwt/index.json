{"hash":"9aeee0a3b55006b00a80cc09aa73da4e17f71410","data":{"post":{"title":"Ghi chú về JWT","path":"/2020-12-05-kinh-nghiem-lam-viec-voi-jwt/","slug":"2020-12-05-kinh-nghiem-lam-viec-voi-jwt","date":"2020-12-05","timeToRead":4,"tags":[{"id":"hoc-thuat","title":"hoc-thuat","path":"/tag/hoc-thuat/"},{"id":"web","title":"web","path":"/tag/web/"},{"id":"javascript","title":"javascript","path":"/tag/javascript/"}],"desc":"JWT đã không còn mới lạ ở năm 2020, tóm tắt một những vấn đề chính cần quan tâm khi làm việc với JWT","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#c%C6%A1-b%E1%BA%A3n-c%E1%BA%A7n-n%E1%BA%AFm\">Cơ bản, cần nắm</a></li>\n<li><a href=\"#ph%C3%ADa-backend\">Phía Backend</a></li>\n<li>\n<p><a href=\"#ph%C3%ADa-client-d%C3%B9ng-spa\">Phía client dùng SPA</a></p>\n<ul>\n<li><a href=\"#so-s%C3%A1nh-%C4%91%E1%BB%8Bnh-danh-b%E1%BA%B1ng-session-v%C3%A0-token\">So sánh định danh bằng Session và Token</a></li>\n<li><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81-v%E1%BB%9Bi-xss-v%C3%A0-csrf-khi-d%C3%B9ng-jwt\">Vấn đề với XSS và CSRF khi dùng JWT</a></li>\n<li><a href=\"#c%C3%B3-c%E1%BA%A7n-https-v%E1%BB%9Bi-jwt\">Có cần HTTPS với JWT?</a></li>\n<li><a href=\"#khi-n%C3%A0o-kh%C3%B4ng-n%C3%AAn-d%C3%B9ng-jwt\">Khi nào không nên dùng JWT</a></li>\n<li><a href=\"#th%C6%B0-vi%E1%BB%87n-ngon\">Thư viện ngon</a></li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"cơ-bản-cần-nắm\"><a href=\"#c%C6%A1-b%E1%BA%A3n-c%E1%BA%A7n-n%E1%BA%AFm\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cơ bản, cần nắm</h2>\n<p>JWT có thể nhớ nôm na là một JSON đã <strong>encrypt</strong> => gọi là <em>token</em>, chứa thông tin giúp backend có thể định danh bạn là ai, bạn có quyền gì</p>\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Lmyom2tH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://paper-attachments.dropbox.com/s_1048F41B3AC814B927887FF3C86602B940107555916A37D85A0BACB9135A34EA_1606545347515_jwt.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Lmyom2tH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://paper-attachments.dropbox.com/s_1048F41B3AC814B927887FF3C86602B940107555916A37D85A0BACB9135A34EA_1606545347515_jwt.png\" alt=\"img\"></a></p>\n<p>Nguyên nhân ra đời của JWT là để giải quyết bài toán <strong>định danh</strong> trong <em>microservice</em></p>\n<h2 id=\"phía-backend\"><a href=\"#ph%C3%ADa-backend\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Phía Backend</h2>\n<p>Ở phía Backend có 2 vấn đề chính cần quan tâm</p>\n<ol>\n<li>Tạo như thế nào</li>\n<li>Validate ra làm sao</li>\n</ol>\n<p>Việc tạo, sử dụng những thư viện có sẵn (<a href=\"https://www.npmjs.com/package/jsonwebtoken\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jsonwebtoken</a> nếu bạn đang dùng Node.js), Ưchỉ cần quan tâm những giá trị <em>đã</em>  hoặc <em>muốn</em> nhét thêm trong JSON</p>\n<p>Một trường tối quan trong trong JSON là <code class=\"language-inline-text\">expiresIn</code>, cho phép token sẽ expire sau bao lâu.</p>\n<p>Việc validate, thì dùng thư viện nào tạo token, nó sẽ có luôn phương thức để kiểm tra token đó có hợp lệ không.</p>\n<h2 id=\"phía-client-dùng-spa\"><a href=\"#ph%C3%ADa-client-d%C3%B9ng-spa\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Phía client dùng SPA</h2>\n<h3 id=\"so-sánh-định-danh-bằng-session-và-token\"><a href=\"#so-s%C3%A1nh-%C4%91%E1%BB%8Bnh-danh-b%E1%BA%B1ng-session-v%C3%A0-token\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>So sánh định danh bằng Session và Token</h3>\n<p>Giống nhau</p>\n<ol>\n<li>Chức năng như nhau, để định danh</li>\n<li>Sau khi định danh ở Backend, nó trả về token cho client</li>\n<li>Gửi kèm token trên khi muốn dùng một service ở phía backend</li>\n</ol>\n<p>Khác nhau</p>\n<ul>\n<li>Session thì dữ liệu và trạng thái đăng nhập của user được lưu ở bộ nhớ phía server. Không phù hợp với RESTful APIs, mỗi service đều phải <code class=\"language-inline-text\">stateless</code>, anh là ai, anh từ đâu tới đều phải đưa chứng minh nhân dân chứ chúng tôi không ai rảnh đầu ngồi nhớ mặt hết những ai ra vào service.</li>\n<li>Session sẽ lưu thông tin về user ở <strong>cookie</strong> của trình duyệt, vấn đề là các service có thể khác domain, trình duyệt không biết và sẽ không đưa thông tin cookie cho các domain khác</li>\n</ul>\n<h3 id=\"vấn-đề-với-xss-và-csrf-khi-dùng-jwt\"><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81-v%E1%BB%9Bi-xss-v%C3%A0-csrf-khi-d%C3%B9ng-jwt\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Vấn đề với XSS và CSRF khi dùng JWT</h3>\n<p>Hết sức thận trọng khi xử lý JWT trong code, token là mồi ngon cho XSS và CSRF</p>\n<p>Tuyệt đối không dùng local storage để lưu JWT trên phía frontend. Localstorage có thể được truy xuất bằng JS cùng domain, attacker có thể dùng điểm này để inject thêm mã để lấy local storage. (XSS)</p>\n<p>Vì cookie được gửi trên tất cả <em>request</em>, attacker có thể lợi dụng điểm này để gửi một link yêu cầu đổi password (CSRF)</p>\n<p>Nếu không còn lựa chọn nào khác, lưu trong bộ nhớ, lưu ý sẽ mất khi user refresh.</p>\n<p>Cookie thật ra không phải là không dùng được, nhưng dùng thì phải kiểm tra</p>\n<ul>\n<li>Dùng <code class=\"language-inline-text\">httpOnly</code> để cookie không thể được truy cập thông qua JS</li>\n<li>Dùng <code class=\"language-inline-text\">SameSite</code> để hạn chế  cấp phát cookie đi các domain chỉ định. Nếu phải đưa qua nhiều domain khác nhau, dùng <em>Lax</em>, nó cho phép gọi truyền cookie khác domain nếu là <code class=\"language-inline-text\">GET</code></li>\n</ul>\n<p>Nếu muốn 100% an toàn tuyệt đối, phải trả một cái giá không rẻ, như tắt cross-domain request.</p>\n<p>Nếu sử dụng <code class=\"language-inline-text\">axios</code>, và backend tạo cookie đúng chuẩn, để axios lo phần đó cho an toàn, không cần lo việc xử lý token, cookie một cách thủ công, thiếu chuyên nghiệp.</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">axios<span class=\"token punctuation\">.</span>defaults<span class=\"token punctuation\">.</span>withCredentials <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"https://github.com/deleteman/sample-jwt-auth-vue\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code tham khảo</a></p>\n<h3 id=\"có-cần-https-với-jwt\"><a href=\"#c%C3%B3-c%E1%BA%A7n-https-v%E1%BB%9Bi-jwt\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Có cần HTTPS với JWT?</h3>\n<p>HTTPS có đảm bảo an toàn tuyệt đối cho site, là yêu cầu bắt buộc khi sử dụng JWT?</p>\n<p>100% bảo mật là con số chưa ai dám nhận, hay nói toẹt ra là không thể. Sẽ luôn có đâu đó một con người tài giỏi, thông minh hơn bạn, họ sẽ tìm được cách tấn công phù hợp. May mắn thay những người xuất chúng như vậy họ cũng có đạo đức cao và không rảnh để làm những việc quá tầm thường. Đừng có lên mạng mà \"Anh đố chú hack được site anh!\"</p>\n<p>HTTPS là cơ chế <strong>encrypt</strong> thông tin đi-về giữa client và server, đảm bảo không có người ngoài nào có thể dòm ngó và đọc được bạn đang gửi gì, nhưng nếu nó đã chui được vào nhà bạn rồi thì thành thật mà nói HTTPS cũng không phải là cánh cửa chỉ có bạn mở được.</p>\n<h3 id=\"khi-nào-không-nên-dùng-jwt\"><a href=\"#khi-n%C3%A0o-kh%C3%B4ng-n%C3%AAn-d%C3%B9ng-jwt\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Khi nào không nên dùng JWT</h3>\n<p>Nếu bạn đang muốn sử dụng một stateful backend, JWT là thừa thãi không cần thiết.</p>\n<p>JWT sinh ra và phù hợp nhất với stateless API</p>\n<h3 id=\"thư-viện-ngon\"><a href=\"#th%C6%B0-vi%E1%BB%87n-ngon\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Thư viện ngon</h3>\n<p>Vue: <a href=\"https://www.npmjs.com/package/vuejs-jwt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">vuejs-jwt</a></p>\n<p>React: <a href=\"https://www.npmjs.com/package/react-jwt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">react-jwt</a></p>\n<p>Angular: <a href=\"https://www.npmjs.com/package/@auth0/angular-jwt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">angular-jwt</a></p>\n<p>Ghi chú từ bài viết <a href=\"https://dev.to/deleteman123/jwt-authentication-best-practices-3lf9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JWT Authentication Best Practices</a></p>\n","cover_image":"","related":[{"id":"276dac0cac0bf3c19d5a53f3cd08f1e4","path":"/2020-12-08-rollup-parcel-webpack/","title":"Ghi chú về 3 module bundler rollup, parcel, webpack","desc":""},{"id":"6644501b4848c8e7978f0b7f037b94af","path":"/2020-12-09-ghi-chu-chp-package-json/","title":"Ghi chú file package.json của node module","desc":""},{"id":"d8a89e9d260680d5e60955d1a8a2b306","path":"/2021-04-16-css-clamp-giai-thich-va-ung-dung/","title":"CSS Clamp giải thích và ứng dụng","desc":"hàm clamp() của CSS rất hữu dụng khi xử lý các vấn đề liên quan đến responsive, là một tính năng mới hay ho bạn cũng nên biết đế áp dụng"}]}},"context":{}}