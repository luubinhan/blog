{"hash":"11fd49ff7dfa599f2ece96e1f20e52693dbc054b","data":{"post":{"title":"Phân biệt sự khác nhau giữa await-return-return await","path":"/2020-07-30-phan-biet-su-khac-nhau-giua-await-return-await/","slug":"/2020-07-30-phan-biet-su-khac-nhau-giua-await-return-await","date":"2020-07-30","timeToRead":2,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"},{"id":"hoc-thuat","title":"hoc-thuat","path":"/tag/hoc-thuat/"}],"desc":"Nắm rõ async không bao giờ là một kiến thức thừa.","content":"<p>Khi viết một async function, có sự khác nhau giữa <code class=\"language-inline-text\">await</code> và <code class=\"language-inline-text\">return</code> và <code class=\"language-inline-text\">return await</code>, các bạn nên biết để sử dụng cho đúng</p>\n<p>Chúng ta có một async function <code class=\"language-inline-text\">waitAndMaybeReject</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">waitAndMaybeReject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// wait 1 giây</span>\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> isHeads <span class=\"token operator\">=</span> <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isHeads<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token string\">\"Thành công zòi\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Xui thôi!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Sau 1 giây, nó sẽ trả về một <code class=\"language-inline-text\">Promise</code>, <em>hên hên</em> thì resolve cho giá trị <em>Thành công zòi</em>, xui xui thì cho giá trị <em>Xui thôi!</em>.</p>\n<p>Giờ khi chúng ta gọi hàm <code class=\"language-inline-text\">waitAndMaybeReject()</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">waitAndMaybeReject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Oh No!\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Khi viết như vậy, chúng ta sẽ luôn nhận được kết quả <strong>fulfill với giá trị undefined, không có waiting</strong></p>\n<p>Bởi vì chúng ta không có <strong>await</strong> trên kết quả trả về của <code class=\"language-inline-text\">waitAndMaybeReject()</code>, nói chúng là chúng ta ko có phục thuộc gì vào việc gọi hàm <code class=\"language-inline-text\">waitAndMaybeReject()</code>. Code như vậy là sai nghe các bạn.</p>\n<p>Rồi giờ chúng ta sẽ <strong>await</strong> trên kết quả của hàm <code class=\"language-inline-text\">waitAndMaybeReject()</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">waitAndMaybeReject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Oh No!\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Hàm này khi thực thi nó sẽ chạy như sau, <strong>đợi 1 giây</strong>, sau đó hoặc là trả về <strong>fulfill với undefined</strong>, hoặc <strong>fulfill với 'Oh No!'</strong></p>\n<p>Bởi vì chúng ta <em>chỉ await trên <code class=\"language-inline-text\">waitAndMaybeReject()</code></em>, việc <em>xui xui</em> bị reject trong <code class=\"language-inline-text\">waitAndMaybeReject</code> sẽ throw ra lỗi và được túm lấy trong hàm <code class=\"language-inline-text\">test</code>. Và vì không làm gì hết khi <code class=\"language-inline-text\">waitAndMaybeReject()</code> khi được resolve, nên chúng ta nhận về <em>undefined</em></p>\n<p>Rồi, giờ tới trường hợp <code class=\"language-inline-text\">return</code></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">waitAndMaybeReject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Oh No!\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nó sẽ thực thi như sau, <strong>đợi một giây</strong>, sau đó hoặc là <strong>fulfill với giá trị Thành công zòi</strong> hoặc <strong>reject với giá trị Xui thôi!</strong></p>\n<p>Với việc <code class=\"language-inline-text\">return waitAndMaybeReject</code>, chúng ta đã chuyển tiếp hết kết quả trả về của <code class=\"language-inline-text\">waitAndMaybeReject</code>, đồng nghĩa với việc <code class=\"language-inline-text\">catch</code> bên trong hàm <code class=\"language-inline-text\">test</code> chả bao giờ chạy tới.</p>\n<p><code class=\"language-inline-text\">return await</code> thì sao?</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token function\">waitAndMaybeReject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Oh No!\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nó sẽ thực thi như sau, <strong>đợi sau một giây</strong> sau đó trả về <strong>fulfill với giá trị Thành công zòi</strong> hoặc <strong>fulfill với giá trị Oh No!</strong></p>\n<p>Vì chúng ta <code class=\"language-inline-text\">await</code> trên kết quả cả <code class=\"language-inline-text\">waitAndMaybeReject()</code>, reject của hàm <code class=\"language-inline-text\">waitAndMaybeReject()</code> sẽ đẩy về throw của hàm <code class=\"language-inline-text\">test</code>, kết quả là <strong>Oh No!</strong>. Nếu <code class=\"language-inline-text\">waitAndMaybeReject</code> được resolve, chúng ta return kết quả này, chính là <strong>Thành công zòi</strong></p>\n<p>Có thể viết như thế này cho dễ hình dung hơn</p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> fulfilledValue <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">waitAndMaybeReject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> fulfilledValue<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"Oh No!\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Lưu ý cuối cùng: Nếu không dùng try/catch mà return await sẽ rất dư thừa</p>\n</blockquote>\n<p><a href=\"https://jakearchibald.com/2017/await-vs-return-vs-return-await/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">await vs return vs return await</a></p>\n","cover_image":"","related":[{"id":"5392f292106070559f38f68ef156425e","path":"/2020-09-01-phan-biet-giua-npm-va-npx/","title":"Sự khác nhau giữa npm và npx?","desc":"Bài viết này sẽ giải thích ngắn gọn nhất có thể sự khác nhau về mục đích của 2 thằng này"},{"id":"2a76cc1592a0e7b9c770d44021f6c9dd","path":"/2020-05-30-5-diem-khac-nhau-giua-arrow-function-va-function-thong-thuong/","title":"5 điểm khác nhau giữa function thường và arrow function","desc":"Lựa chọn cách viết nào cho phù hợp theo tính huống đang cần là cái chúng ta sẽ có được câu trả lời khi đi qua 5 điểm khác biệt này"},{"id":"8905cbcbcbfca00a569175a000425311","path":"/2017-09-25-10-khai-niem-javascript-can-biet/","title":"7 khái niệm JavaScript cần biết","desc":"Một vài khái niệm căn bản trong javascript cần nắm nếu bạn là frontend developer"},{"id":"d63cff185db98b9e7840ee8d3f1c1191","path":"/2018-05-07-huong-dan-async-await-giai-thich-vi-du/","title":"Giải thích async/await của javascript","desc":"Hướng dẫn các bạn nắm vững async/await trong javascript, kèm ví dụ cụ thể"}]}},"context":{}}