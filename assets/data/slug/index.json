{"hash":"07b5001d3b2d2df5ce1b9bbd1a099b0760e8b129","data":{"post":{"title":"","path":"/slug/","date":null,"timeToRead":2,"tags":[],"desc":"","content":"<p>Một trong những cách bạn ít nghe tới khi tối ưu tốc độ website, và bạn cũng có thể không đồng tình với quan điểm này: <strong>inline css</strong>. <strong>Tại sao?</strong> và <strong>bằng cách nào</strong> mà việc inline css lại giúp cải thiện tốc độ?</p>\n<h2 id=\"css-ảnh-hưởng-thế-nào-đến-tốc-độ\"><a href=\"#css-%E1%BA%A3nh-h%C6%B0%E1%BB%9Fng-th%E1%BA%BF-n%C3%A0o-%C4%91%E1%BA%BFn-t%E1%BB%91c-%C4%91%E1%BB%99\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>CSS ảnh hưởng thế nào đến tốc độ</h2>\n<p>Nếu JS và image thường sẽ được nhắc nhiều trong việc làm chậm tốc độ, ảnh hưởng đến các kết quả đo lường, CSS cũng không ngoại lệ.</p>\n<p>Khi trình duyệt truy cập vào một URL, đầu tiên nó sẽ get về file HTML, <strong>parsing</strong> file này, dừng lại khi gặp những <strong>dependency</strong>.</p>\n<p>CSS là một <a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-blocking-css\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">render-blocking resource</a>, khi bạn thêm css bằng <code class=\"language-text\">&lt;link href=&quot;style.css&quot; /&gt;</code> trong thẻ <code class=\"language-text\">&lt;head/&gt;</code>, trình duyệt sẽ trigger một request đến phía server để lấy file stylesheet này về trước khi render tiếp phần còn lại.</p>\n<h2 id=\"bạn-có-thể-làm-gì\"><a href=\"#b%E1%BA%A1n-c%C3%B3-th%E1%BB%83-l%C3%A0m-g%C3%AC\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Bạn có thể làm gì?</h2>\n<p>Khi nói đến tối ưu tốc độ, thì lời khuyên là hãy đo tốc độ hiện tại trước bằng các <a href=\"https://web.dev/user-centric-performance-metrics/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">metric</a> phổ biến, sau đó đưa ra mục tiêu cụ thể khi tối ưu.</p>\n<p>Thực tế đôi khi sẽ khác so với lý thuyết của bài này, nên bạn cứ measure -> thử -> measure lại -> thử tiếp.</p>\n<h2 id=\"inline-như-thế-nào\"><a href=\"#inline-nh%C6%B0-th%E1%BA%BF-n%C3%A0o\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Inline như thế nào</h2>\n<p>Inline CSS như đã nói sẽ giúp bớt đi một request lên server. Tuy nhiên inline như thế nào?</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Some text<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Tuy nhiên đây không phải là cách nên làm, trớ trêu thay bạn làm như vậy nó sẽ dính issue với đơn vị <em>runtime responsiveness</em> trong các công cụ measure tốc độ.</p>\n<p>Nếu không sử dụng external css, mà inline vào từng element, nó sẽ dẫn đến chuyện nhiều style bị duplicate, và dẫn tới thời gian <a href=\"https://web.dev/first-contentful-paint/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">first content paint</a> tăng</p>\n<p><strong>Vậy inline kiểu nào ?</strong></p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  ...\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n<span class=\"token selector\">body</span><span class=\"token punctuation\">{</span><span class=\"token property\">background</span><span class=\"token punctuation\">:</span><span class=\"token hexcode color\">#fff</span><span class=\"token punctuation\">;</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span><span class=\"token hexcode color\">#000</span><span class=\"token punctuation\">;</span><span class=\"token property\">margin</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token selector\"><span class=\"token class\">.link</span></span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span><span class=\"token hexcode color\">#1a0dab</span><span class=\"token punctuation\">}</span><span class=\"token selector\"><span class=\"token class\">.ts</span></span><span class=\"token punctuation\">{</span><span class=\"token property\">border-collapse</span><span class=\"token punctuation\">:</span>collapse<span class=\"token punctuation\">}</span><span class=\"token selector\"><span class=\"token class\">.ts</span> td</span><span class=\"token punctuation\">{</span><span class=\"token property\">padding</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token selector\"><span class=\"token class\">.g</span></span><span class=\"token punctuation\">{</span><span class=\"token property\">line-height</span><span class=\"token punctuation\">:</span><span class=\"token number\">1.2</span><span class=\"token punctuation\">;</span><span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span>left<span class=\"token punctuation\">;</span><span class=\"token property\">width</span><span class=\"token punctuation\">:</span><span class=\"token number\">600</span><span class=\"token unit\">px</span><span class=\"token punctuation\">}</span><span class=\"token selector\"><span class=\"token class\">.ti</span></span><span class=\"token punctuation\">{</span><span class=\"token property\">display</span><span class=\"token punctuation\">:</span>inline<span class=\"token punctuation\">;</span><span class=\"token property\">display</span><span class=\"token punctuation\">:</span>inline-table<span class=\"token punctuation\">}</span>\n  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Tuy nhiên nếu, trong một số trường hợp, bạn có thể sử dụng <code class=\"language-text\">defer</code> trên external style nếu nó không thực sự sử dụng ở trang hiện tại (pre-load)</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  ...\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token comment\">/* inlined styles */</span>\n  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>styles.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">onload</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>this.media=<span class=\"token punctuation\">'</span>all<span class=\"token punctuation\">'</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Với cách external style, trình duyệt có thể cache lại để tiết kiệm số network request.</p>\n<h2 id=\"các-công-cụ-hổ-trợ\"><a href=\"#c%C3%A1c-c%C3%B4ng-c%E1%BB%A5-h%E1%BB%95-tr%E1%BB%A3\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Các công cụ hổ trợ</h2>\n<p>Một số công cụ giúp xác định đâu là critical css, chúng ta cần inline</p>\n<ul>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/coverage\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Tìm các JS và CSS code không sử dụng</a></li>\n<li><a href=\"https://github.com/pocketjoso/penthouse\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Penthouse - Công cụ giúp tạo css critical</a></li>\n<li><a href=\"https://github.com/addyosmani/critical\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Critical - Giúp extract và inline CSS nào nằm ở above-the-fold(phần hiển thị phía trên thanh cuộn)</a></li>\n</ul>\n<p><a href=\"https://blog.logrocket.com/improve-site-performance-inlining-css/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Improve site performance by inlining your CSS</a></p>\n","cover_image":"","related":[{"id":"deef3a1fd7c4a8e0d6971a90bc9bdaf3","path":"/2019-02-17-danh-gia-wordpress-va-static-site/","title":"Wordpress vs Static site","desc":"Chúng ta cùng nhau điểm qua cái hay, cái dở của từng thằng để nghiền ngẫm xem nó phù hợp trong trường hợp nào."},{"id":"5e3c368c783a403a32943f42293ddde0","path":"/2018-09-12-huong-dan-build-notify-system-voi-react-redux/","title":"Làm toast notification system trong React/Redux","desc":"Có lẽ ko có ứng dụng web nào lại ko cần thông báo đến user kết quả của một thao tác nào đó, xây một notification system để sử dụng là hết sức cần thiết"},{"id":"596a942891a971c827be75655f6b0ffa","path":"/2020-02-09-5-kinh-nghiem-khi-lam-viec-voi-arrow-function/","title":"5 kinh nghiệm khi viết arrow function","desc":"Sử dụng arrow function đã quá phổ biến, ai cũng biết nó là gì, không cần một bài giới thiệu vài dòng nữa, bài viết này chia sẻ 5 kinh nghiệm để bạn làm việc với arrow function thêm mượt mà"}]}},"context":{}}