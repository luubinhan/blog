{"hash":"0395a9475e6dcec202a1209b8bd40b74ee081359","data":{"post":{"title":"Kiểm tra element có nằm trong viewport không bằng javascript","path":"/kiem-tra-element-co-nam-trong-viewport-khong-bang-javascript/","date":"2019-05-07","timeToRead":2,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"}],"desc":"Học cách viết một helper function để kiểm tra element nằm trong viewport","content":"<p>\"Nằm trong viewport\" nghĩa là nó đang hiển thị bên trong phần <strong>nhìn thấy được</strong> của trình duyệt, function này cần thiết khi chúng ta cần tới lazy loading, hiệu ứng này kia.</p>\n<p>Phần quan trọng nhất của function này là dùng <code class=\"language-text\">Element.getBoundingClientRect()</code>, nó cho chúng ta giá trị position của element so với viewport. Nó trả về một object chứa <code class=\"language-text\">height</code>, <code class=\"language-text\">width</code>, khoảng cách đến <code class=\"language-text\">top</code>, <code class=\"language-text\">right</code>, <code class=\"language-text\">bottom</code>, <code class=\"language-text\">left</code> với viewport</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// chọn element</span>\n<span class=\"token keyword\">var</span> h1 <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// lấy position của element trên</span>\n<span class=\"token keyword\">var</span> bounding <span class=\"token operator\">=</span> h1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>bounding<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// {</span>\n<span class=\"token comment\">//  height: 118,</span>\n<span class=\"token comment\">//  width: 591.359375,</span>\n<span class=\"token comment\">//  top: 137,</span>\n<span class=\"token comment\">//  bottom: 255,</span>\n<span class=\"token comment\">//  left: 40.3125,</span>\n<span class=\"token comment\">//  right: 631.671875</span>\n<span class=\"token comment\">// }</span></code></pre>\n<p>Nếu một element nằm trong viewport được xác định như sau</p>\n<ul>\n<li><code class=\"language-text\">top</code>, <code class=\"language-text\">left</code> >= 0</li>\n<li><code class=\"language-text\">right</code> &#x3C;= độ rộng của viewport</li>\n<li><code class=\"language-text\">bottom</code> &#x3C;= độ cao của viewport</li>\n</ul>\n<p>Để check độ rộng của viewport, chúng ta có 2 cách, một số trình duyệt hỗ trợ <code class=\"language-text\">window.innerWidth</code>, một số khác hỗ trợ <code class=\"language-text\">document.documentElement.clientWidth</code>, số còn lại thì support cả 2. Rắc rối nhở!</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerWidth</span> <span class=\"token operator\">||</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">documentElement</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">clientWidth</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Cũng tương tự với giá trị viewport height</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHeight</span> <span class=\"token operator\">||</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">documentElement</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">clientHeight</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Chúng ta kiểm tra xem element có nằm trong viewport không</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n    bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">top</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">left</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">right</span> <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerWidth</span> <span class=\"token operator\">||</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">documentElement</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">clientWidth</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n    bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">bottom</span> <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHeight</span> <span class=\"token operator\">||</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">documentElement</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">clientHeight</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Trong viewport!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Không nằm trong viewport... whoa la la'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Chúng ta gom lại vào một function helper để dành xài</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">isInViewport</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">elem</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> bounding <span class=\"token operator\">=</span> elem<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">top</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n        bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">left</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n        bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">bottom</span> <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHeight</span> <span class=\"token operator\">||</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">documentElement</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">clientHeight</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n        bounding<span class=\"token punctuation\">.</span><span class=\"token property-access\">right</span> <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerWidth</span> <span class=\"token operator\">||</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">documentElement</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">clientWidth</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Sử dụng function này, chúng ta có thể làm lazy load image</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>figure</span> <span class=\"token attr-name\">data-image</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url/to/my/image.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hình sẽ được load khi scroll tới đây..<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>figure</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> image <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[data-image]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isInViewport</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        image<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;img src=\"'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-image'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\">'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://gomakethings.com/how-to-test-if-an-element-is-in-the-viewport-with-vanilla-javascript/\">How to test if an element is in the viewport with vanilla JavaScript</a></p>\n","cover_image":""}},"context":{}}