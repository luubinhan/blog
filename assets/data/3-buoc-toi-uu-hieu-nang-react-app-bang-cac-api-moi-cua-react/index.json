{"hash":"5ee00dc0b71878963f9b5fb39ff7b4fecc0fc2a1","data":{"post":{"title":"3 bước tối ưu hiệu năng React App bằng các API mới của React","path":"/3-buoc-toi-uu-hieu-nang-react-app-bang-cac-api-moi-cua-react/","date":"2019-06-17","timeToRead":3,"tags":[{"id":"react","title":"react","path":"/tag/react/"},{"id":"thu-thuat","title":"thu-thuat","path":"/tag/thu-thuat/"}],"desc":"Bài viết hướng dẫn tối ưu hiệu năng bằng memo, useMemo, useCallback","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#Reactmemo\">React.memo</a></li>\n<li><a href=\"#useMemo\">useMemo</a></li>\n<li><a href=\"#useCallback\">useCallback</a></li>\n</ul>\n<!-- /TOC -->\n<p>Khi sử dụng function component, React cung cấp 3 phương thức để tối ưu: <code class=\"language-text\">React.memo</code>, <code class=\"language-text\">useMemo</code>, và <code class=\"language-text\">useCallback</code>, chúng ta cùng điểm qua 3 thằng này</p>\n<p>Xét ví dụ</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">ListPage</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> title <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token maybe-class-name\">Header</span> title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token maybe-class-name\">List</span> listItems<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre>\n<p>Component như trên (<code class=\"language-text\">&lt;ListPage /&gt;</code>), khi nhận một <code class=\"language-text\">data</code> mới, tất cả component con bên trong là <code class=\"language-text\">Header</code> và <code class=\"language-text\">List</code> sẽ re-render, mặc dù cái <code class=\"language-text\">title</code> không hề thay đổi. Nếu <code class=\"language-text\">Header</code> không tốn quá nhiều thời gian để render thì ko có vấn đề. Ngược lại dĩ nhiên là nếu render <code class=\"language-text\">Header</code> tốn rất nhiều thời gian, chúng ta phải <strong>xây lại</strong> để tối ưu hơn.</p>\n<h2 id=\"reactmemo\"><a href=\"#reactmemo\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>React.memo</h2>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">MyComponent</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">memo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">MyComponent</span></span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* render using props */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><code class=\"language-text\">React.memo</code> là một HOC, <a href=\"https://luubinhan.github.io/blog/2018-11-04-gioi-thieu-react-memo-moi-trong-react-16\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">đọc lại bài này</a>, nó sẽ <strong>nhớ</strong> kết quả render của component. Nếu component trả về một output giống hệt cho cùng một prop, đưa nó vào <code class=\"language-text\">React.memo</code> sẽ tiết kiệm tí thời gian.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">Header</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> title <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token maybe-class-name\">Header</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Wrap lại trong <code class=\"language-text\">React.memo</code></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">Header</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> title <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">memo</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">Header</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<h2 id=\"usememo\"><a href=\"#usememo\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>useMemo</h2>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> memoizedValue <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">computeExpensiveValue</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Cũng tương tự nó sẽ nhớ kết quả trả về, tuy nhiên nó sẽ có thêm phần gọi là <code class=\"language-text\">array dependencies</code>, là một danh sách các <strong>thằng</strong> mà nó phụ thuộc, nếu giá trị phụ thuộc thay đổi nó mới rọi render lại, không thể trả thẳng kết quả lần trước</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> widgetList <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> \n        widgets<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">w</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token spread operator\">...</span>w<span class=\"token punctuation\">,</span>\n        totalPrice<span class=\"token operator\">:</span> <span class=\"token function\">someComplexFunction</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">.</span><span class=\"token property-access\">price</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        estimatedDeliveryDate<span class=\"token operator\">:</span> <span class=\"token function\">someOtherComplexFunction</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">.</span><span class=\"token property-access\">warehouse</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>widgets<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Trong ví dụ trên, 1 component nhận một danh sách các widget, các widget này trước khi truyền vào sẽ được thêm vào 2 giá trị là <em>total price</em> và <em>delivery date</em>. Nếu giá trị các widget không thay đổi khi render lại component, thì không cần thiết phải chạy qua các hàm <code class=\"language-text\">someComplexFunction</code>, <code class=\"language-text\">someOtherComplexFunction</code>. Sử dụng <code class=\"language-text\">useMemo</code> để ghi nhớ kết quả và bỏ qua trong trường hợp đó.</p>\n<h2 id=\"usecallback\"><a href=\"#usecallback\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>useCallback</h2>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> memoizedCallback <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Mục đích để chặn các lần render không cần thiết giữa component cha và con</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">Parent</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showExtraDetails<span class=\"token punctuation\">,</span> setShowExtraDetails<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token maybe-class-name\">Child</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token function\">showData</span><span class=\"token punctuation\">(</span>showExtraDetails<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>1 component như vậy sẽ re-render cả cha và con cùng lúc, thậm chí component con có là <code class=\"language-text\">PureComponent</code> được wrap bên trong <code class=\"language-text\">React.memo</code> đi nữa, bởi vì <code class=\"language-text\">onClick</code> sẽ khác nhau trên mỗi lần render. Sử dụng <code class=\"language-text\">useCallback</code> chúng ta viết lại như sau</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">Parent</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showExtraDetails<span class=\"token punctuation\">,</span> setShowExtraDetails<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> handleClick <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">showData</span><span class=\"token punctuation\">(</span>showExtraDetails<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span>showExtraDetails<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token maybe-class-name\">Child</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleClick<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Như vậy hàm <code class=\"language-text\">handleClick</code> sẽ giống nhau cho các lần render khác nhau, nó chỉ khác khi <code class=\"language-text\">showExtraDetails</code> thay đổi.</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://headway.io/blog/react-optimize-components-memo-usememo-usecallback\">React: Optimize Components with React.memo, useMemo, and useCallback</a></p>\n","cover_image":"","related":[{"id":"ed20ea853375e5181c942b2bd43f7653","path":"/cai-thien-performance-cua-react-app/","title":"Cải thiện performance của React App","desc":"Trong bài này, chúng ta cùng đi qua các bước để fix những issue liên quan đến performance thường thấy."},{"id":"d7c5a1be37f6b7aa2083d3afe80563b9","path":"/nhung-tinh-nang-co-ban-cua-firebase/","title":"Những tính năng cở bản của Firebase","desc":"Năm 2016 google giới thiệu Firebase. Khi bắt đầu phát triển ứng dụng điện thoại, bạn sẽ cần đến server và một developer để làm việc với server"},{"id":"9dff911f3d4c998b2e2d39eff8025ade","path":"/huong-dan-handle-event-listener-can-ban-cho-cac-ban-moi-bat-dau-voi-javascript/","title":"Hướng dẫn handle event listener căn bản cho các bạn mới bắt đầu với javascript","desc":"Căn bản nhưng cần thiết"},{"id":"1ae2a37d4f8455d37c67ec40ca86232b","path":"/tim-hieu-phuong-thuc-slice-cua-mang-trong-javascript/","title":"Tìm hiểu phương thức slice của mảng trong javascript","desc":"Bài viết phù họp cho các bạn mới biết javascript, không phù hợp cho bạn nào đã quá rành"},{"id":"aef50f5a2dd43730cf89e8a944b6adec","path":"/toi-uu-component-react-bang-react-memo-use-memo-va-use-callback/","title":"Tối ưu component React bằng React.memo, useMemo và useCallback","desc":"Sử dụng những hàm có sẵn của React để viết component ngon hơn"},{"id":"74eccd52dfa4898b304e40431a0beb83","path":"/tai-sao-cac-ban-nen-hoc-vue/","title":"Tại sao các bạn nên học Vue","desc":"Một vài suy nghĩ cá nhân của mình về mấy cái hay ho của Vue"},{"id":"67335fb1f2a382145c69b99fe4e01d34","path":"/su-dung-react-context-nhu-the-nao-cho-hieu-qua/","title":"Sử dụng React Context như thế nào cho hiệu quả","desc":"Để có thể quản lý được state của ứng dụng một cách tốt nhất, chúng ta cần sự phân chia phù hợp giữa local state (internal state của component) và state cửa ứng dụng đặt trong React Context. Một vài điều muốn chia sẽ để nâng cao khả năng bảo trì và trải nghiệm nếu sử dụng đến context trong React."},{"id":"0a408624be828657679088cbca8986c7","path":"/tiep-tuc-luan-ban-ve-cach-to-chuc-thu-muc-dat-ten-component-trong-react/","title":"Tiếp tục luận bàn về cách tổ chức thư mục, đặt tên component trong React","desc":"Hổm đã viết về vấn đề này rồi, giờ lại viết tiếp, vì bản thân React cũng không ra bất cứ rule nào về việc này, bạn tự do tổ chức sao mà mình thấy hợp lý, bài trước là của tác giả đó thấy vậy là hay, bài này thì tác giả thích tổ chức thế này"},{"id":"1919bceb9000f1bff00371b6a3dfd527","path":"/do-phuc-tap-cua-thuat-toan/","title":"Độ phức tạp của thuật toán","desc":"Một cách chuẩn hóa trong ngành lập trình để đánh giá độ phức tạp của giải thuật"}]}},"context":{}}