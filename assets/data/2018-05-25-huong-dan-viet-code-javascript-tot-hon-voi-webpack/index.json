{"hash":"5d40f4d8ed43f512e4021e3d8491c32126632fe7","data":{"post":{"title":"Webpack là gì và tại sao ta phải xài nó","path":"/2018-05-25-huong-dan-viet-code-javascript-tot-hon-voi-webpack/","slug":"/2018-05-25-huong-dan-viet-code-javascript-tot-hon-voi-webpack","date":"2018-05-25","timeToRead":5,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"},{"id":"webpack","title":"webpack","path":"/tag/webpack/"}],"desc":"Bài này sẽ nói rõ tại sao Webpack là sự lựa chọn sáng suốt cho bundle javascript","content":"<h1 id=\"trong-series-này\"><a href=\"#trong-series-n%C3%A0y\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Trong Series này</h1>\n<ol>\n<li><a href=\"2018-05-25-viet-code-javascript-tot-hon-voi-webpack\">Webpack là gì và tại sao ta phải xài nó</a></li>\n<li><a href=\"2018-05-27-huong-dan-webpack-4-cho-nguoi-moi-bat-dau\">Dùng Loaders, code slitting trong webpack</a></li>\n<li><a href=\"2018-05-28-huong-dan-webpack-4-cho-nguoi-moi-bat-dau-phan-3\">Plugins, Development Server</a></li>\n</ol>\n<!-- TOC -->\n<ul>\n<li>\n<p><a href=\"#trong-series-n%C3%A0y\">Trong Series này</a></p>\n<ul>\n<li>\n<p><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81\">Vấn đề</a></p>\n<ul>\n<li><a href=\"#c%C3%A1ch-t%E1%BB%91t-h%C6%A1n\">Cách tốt hơn</a></li>\n</ul>\n</li>\n<li><a href=\"#webpack-vs-gulp\">Webpack vs. Gulp</a></li>\n<li><a href=\"#vi%E1%BA%BFt-code-module\">Viết code Module</a></li>\n<li><a href=\"#c%E1%BA%A5u-h%C3%ACnh-webpack\">Cấu hình Webpack</a></li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"vấn-đề\"><a href=\"#v%E1%BA%A5n-%C4%91%E1%BB%81\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Vấn đề</h2>\n<p>Viết code client-side nếu không có các công cụ hỗ trợ thì trước sau vì cũng giống như đống hỗn độn trên desktop, để maintain và người khác có thể vào đọc hiểu được thì việc code được tổ chức tốt là điều ai cũng biết, lý thuyết là thế, nhưng nếu cứ làm việc theo kiểu cũ cứ quăng script tràng lan bằng thẻ <code class=\"language-inline-text\">&lt;script></code> sẽ chẳng dễ gì sắp xếp và nhớ nổi cái nào là cái nào nếu, add thêm cỡ chục files, <em>best practice</em> khuyên rằng hạn chế số lượng file script càng ít càng tốt, tốt nhất là 1 file duy nhất.</p>\n<p>Trước đây có nhiều giải pháp cho vấn đề như là Gulp, dùng để bunch toàn bộ javascript thành 1 file. Nhưng chưa đủ. Với Gulp chúng ta đã đẩy các dependency ngang hàng nhau, và phụ thuộc vào biến global để chia sẽ dữ liệu giữa các files.</p>\n<h3 id=\"cách-tốt-hơn\"><a href=\"#c%C3%A1ch-t%E1%BB%91t-h%C6%A1n\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cách tốt hơn</h3>\n<p>Nếu trước đây chưa từng sử dụng mấy cái tool để quản lý asset ở frontend, tốt nhất là học luôn Webpack, bỏ qua Gulp, Gruntjs luôn. Còn nếu nếu đã từng dùng mấy task runner kiểu Gulp, Gruntjs, thì chuyển qua dùng webpack cũng không khó khăn lắm, chỉ là khác nhau cách tổ chức và quản lý dependency.</p>\n<h2 id=\"webpack-vs-gulp\"><a href=\"#webpack-vs-gulp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Webpack vs. Gulp</h2>\n<p>Chắc đã từng nghe tới câu này: <strong>Gulp là task runner, Webpack là module bundler</strong>, ý nhĩa thật sự sau câu này là gì?</p>\n<p>Gulp là công cụ tự động hóa tốt, cho phép chúng ta setup một mớ các tiến trình phức tạp cần thực hiện (một cách tự động) bằng javascript, rồi chạy nó bằng một lệnh duy nhất. Vấn đề với Gulp là nếu code file A depend vào code ở file B, bạn cần báo cáo với Gulp để nó include file A trước, và khi bạn thêm càng lúc càng nhiều file depend chồng chéo kiểu này, cây dependency là lớn dần, và sẽ gần như không thể maintain được nữa, vì chúng ta phải config bằng tay, nếu sử dụng file manifest với plugin <code class=\"language-inline-text\">asset-builder</code> cũng không thể cứu vãn.</p>\n<p><img src=\"https://res.cloudinary.com/forestry-demo/image/fetch/c_limit,dpr_auto,f_auto,q_80,w_674/https://forestry.io/uploads/2018/03/webpack_fighter_of_the_gulpstack_champion_of_the_bundle.png\"></p>\n<p>Bài toán dependency này đã được Webpack giải quyết triệt để. Những gì bạn cần làm là báo với Webpack file <strong>entry</strong> point mình cần bundle là gì, chuyện bạn <em>import module</em> lúc code sẽ do webpack đảm nhiệm chuyện dựng lên dependency graph, webpack sẽ bundle cho bạn 1 file duy nhất bạn cần. Chúng ta khỏi phải báo cáo với webpack thứ tự các file nào cần trước hay sau, để đó Webpack lo!</p>\n<p>Ngắn gọn là: với Gulp dependency bị giới hạn vì nó yêu cầu mình tự chỉ định sự phụ thuộc, Webpack thì nó dùng logic để tính toán rồi bundle đúng thứ tự.</p>\n<h2 id=\"viết-code-module\"><a href=\"#vi%E1%BA%BFt-code-module\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Viết code Module</h2>\n<p>Để Webpack hoạt động như phép màu như vậy, chúng ta chỉ cần viết javascript của mình dạng <em>module</em>. Viết module trong javascript là tách các file ra thành nhiều file, việc sử dụng code giữa các file sẽ thực hiện bằng <strong>export</strong> và <strong>import</strong></p>\n<p>Webpack hỗ trợ 2 chuẩn module hóa hiện giờ là <strong>EcmaScript</strong> và  <strong>CommonJS</strong>. Ví dụ bên dưới để hình dung cách viết module trong file <code class=\"language-inline-text\">hello.js</code> rồi <strong>import</strong> vào trong file <code class=\"language-inline-text\">app.js</code> bằng cả 2 kiểu viết EcmaScript và CommonJS</p>\n<p>Viết kiểu <strong>EcmaScript</strong></p>\n<p><strong>hello.js</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello Binh An!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>app.js</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>hello<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./hello'</span>\n<span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Viết kiểu <strong>CommonJS</strong></p>\n<p><strong>hello.js</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello Bình An!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>app.js</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> hello <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"cấu-hình-webpack\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-webpack\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Cấu hình Webpack</h2>\n<p>Một điểm hay của webpack là nếu có ai đó đã config rồi thì những người sau không cần phải vào file config để hiểu cách tổ chức code, chỉ cần hiểu được cách tổ chức code của project.</p>\n<p>Giờ thử config đơn giản nhất để hiểu một số thành phần quan trọng nhất của webpack</p>\n<p>Tổ chức project như vầy</p>\n<div class=\"gridsome-highlight\" data-language=\"basic\"><pre class=\"language-basic\"><code class=\"language-basic\">src<span class=\"token operator\">/</span>\n    app.js\nwebpack.config.js</code></pre></div>\n<p>Mặt định Webpack sẽ tìm file config với tên là <strong>webpack.config.js</strong>. Tiếp chúng ta cần cài <strong>webpack</strong> và <strong>webpack-cli</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev webpack webpack-cli</code></pre></div>\n<p>Trong file <strong>webpack.config.js</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token string\">'./src/app.js'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'bundle.js'</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>2 phần quan trọng nhất mà phải biết là <strong>entry</strong> - file source nằm ở đâu và <strong>output</strong> - file sẽ bundle ở đâu. Sử dụng module <code class=\"language-inline-text\">path</code> để biết vị trí thực tế lúc chạy.</p>\n<p>Chạy CLI để bundle</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./node_modules/webpack-cli/bin/webpack.js</code></pre></div>\n<p>Nó sẽ đọc source trong file <code class=\"language-inline-text\">src/app.js</code> rồi compile vào <code class=\"language-inline-text\">dist/bundle.js</code>. Thư mục sau khi chạy xong sẽ có</p>\n<div class=\"gridsome-highlight\" data-language=\"basic\"><pre class=\"language-basic\"><code class=\"language-basic\">dist<span class=\"token operator\">/</span>\n    bundle.js\nsrc<span class=\"token operator\">/</span>\n    app.js\npackage.json\nwebpack.config.js</code></pre></div>\n<p>Để rút chạy đoạn CLI dài ngoằn <code class=\"language-inline-text\">./node_modules/webpack-cli/bin/webpack.js</code> có thể thêm một custom script trong file <strong>package.json</strong>. Bạn có thể chạy nó bằng <code class=\"language-inline-text\">npm run SCRIPT_NAME</code></p>\n<p>Thêm vào trong <strong>package.json</strong></p>\n<div class=\"gridsome-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>    \n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/webpack-cli/bin/webpack.js\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"watch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/webpack-cli/bin/webpack.js --watch\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Giờ chúng ta có thể chạy bằng lệnh <code class=\"language-inline-text\">npm run build</code>, ở trên chúng ta cũng vừa thêm đoạn <code class=\"language-inline-text\">npm run watch</code>, thêm option <code class=\"language-inline-text\">--watch</code> để khi có bất kỳ thay đổi nào nó sẽ tự động detect và compile lại.</p>\n<p>!!!! CUNG HỶ !!!!!</p>\n<p>Bạn đã chạm được vào cánh cửa đầu tiên của webpack, webpack còn nhiều khả năng nữa, tuy nhiên module bundle là core feature, bài tiếp theo chúng ta sẽ khám phá nhiều hơn như loaders, plugins, development server.</p>\n<p><a href=\"2017-10-18-import-va-export-trong-javascript\">Tìm hiểu thêm về import và export</a></p>\n<p><a href=\"https://forestry.io/blog/write-better-javascript-with-webpack/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Link bài gốc</a></p>\n<p>Tác giả: DJ Walker</p>\n","cover_image":"","related":[{"id":"dec66a9345d632cbe065f67437fb0729","path":"/2018-02-14-huong-dan-redux-la-gi-tai-sao-phai-dung/","title":"Redux là gì và tại sao phải dùng?","desc":"Nếu đã đụng tới React thì sớm muộn gì bạn cũng sẽ nghe đến Redux"},{"id":"e8d6fde53064af1e5d851657253dfd98","path":"/2019-09-20-gioi-thieu-iife-cua-javascript/","title":"IIFE trong javascript là cái gì vại","desc":"Giới thiệu về Íp-Phi trong javascript, tuy không còn dùng nhiều nữa, nhưng vẫn là một kiến thức tốt cần biết"},{"id":"9cbb507063e9cbfe980133e85fe58558","path":"/2022-09-06-aws-scp-permission-boundary-iam/","title":"AWS SCP là gì","desc":"Series một số kiến thức cần có để lấy chứng chỉ AWS"},{"id":"ef07fe54df031b8956b57411b846eb64","path":"/2023-01-15-giai-thich-react-concurrent-rendering-la-gi/","title":"Concurrent rendering trong React là gì?","desc":"Bài viết này chúng ta sẽ cũng tìm hiểu React Concurrent, vấn đề nó giải quyết là gì và nó chạy như thế nào, ứng dụng thực tế"}]}},"context":{}}