{"hash":"f3d26dfb4f330edfbc40b8db8c37744563cc4adf","data":{"post":{"title":"Giới thiệu về window.requestAnimationFrame","path":"/gioi-thieu-ve-window-request-animation-frame/","slug":"/2019-05-24-gioi-thieu-ve-request-animation","date":"2019-05-24","timeToRead":1,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"}],"desc":"","content":"<p>Khi muốn thực hiện một vòng lặp thời gian trong javascript, chúng ta nghĩ ngay đến <code class=\"language-text\">setInterval()</code>. Tuy nhiên khi mục đích của chúng ta là làm animation, để thực hiện animation mượt mà, chúng ta cần vòng lặp 60 frame/1 giây, như thế này</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// chay animation ở đây</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token operator\">/</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Tuy nhiên chúng ta có một cách tốt hơn cách trên, dùng <code class=\"language-text\">window.requestAnimationFrame()</code></p>\n<p>Tại sao nó tốt hơn</p>\n<ul>\n<li>Trình duyệt có thể optimize nó để animation thiệt mượt mà</li>\n<li>Những animation nào đang chạy sẽ dừng lại khi tab đó ko còn active\n<code class=\"language-text\">window.requestAnimationFrame()</code> sẽ yêu cầu trình duyệt thực hiện một animation và chạy một function trước khi <strong>repaint</strong></li>\n</ul>\n<p>Ví dụ đơn giản nhất</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">repeatOften</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// thực hiện animation nào đó</span>\n  <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>repeatOften<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>repeatOften<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Gọi phương thức này khi chúng ta đã sẵn sàng thực hiện animation. Hàm thực thi animation sẽ được gọi trước khi trình duyệt repaint. Khi đang nằm ở tab không active của trình duyệt, nó sẽ bị pause lại (hoặc trong thẻ <code class=\"language-text\">iframe</code>) để tiết kiệm pin</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> start <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> element <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span>‘SomeElementYouWantToAnimate’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">step</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">timestamp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>start<span class=\"token punctuation\">)</span> start <span class=\"token operator\">=</span> timestamp<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> progress <span class=\"token operator\">=</span> timestamp <span class=\"token operator\">-</span> start<span class=\"token punctuation\">;</span>\n  element<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">transform</span> <span class=\"token operator\">=</span> <span class=\"token string\">'translateX('</span> <span class=\"token operator\">+</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">min</span><span class=\"token punctuation\">(</span>progress <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px)'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>progress <span class=\"token operator\">&lt;</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>step<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>step<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><code class=\"language-text\">window.requestAnimationFrame()</code> trả về một <strong>ID</strong>, chúng ta có thể cancel nó như với <code class=\"language-text\">setTimeout</code> và <code class=\"language-text\">setInterval</code> bằng <code class=\"language-text\">window.cancelAnimationFrame(truyền vào id)</code></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> animateID <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>repeatOften<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span>animateID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Tài liệu và ví dụ tham khảo</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://css-tricks.com/using-requestanimationframe/\">Using requestAnimationFrame</a></p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\">window​.request​Animation​Frame()\n</a></p>\n","cover_image":"","related":[{"id":"6d5aa5f38fabe4c7ea0a45fedf201568","path":"/gioi-thieu-ve-reactive-programing-trong-javascript/","title":"Giới thiệu về Reactive Programing trong javascript","desc":"Reactive programing là khái niệm khá trừu tượng và khó tiếp cận với người mới bắt đầu, chuẩn bị tinh thần đọc bài này vài lần trong vài ngày thì mới mong thẩm thấu hết"},{"id":"e9d2a9d4a3ed5b8ecc39c580a3f2ffb8","path":"/gioi-thieu-markdown/","title":"Giới thiệu Markdown","desc":"Markdown vở lòng cho bạn nào chưa biết"},{"id":"0be257d7b6339261c05ba76120350279","path":"/gioi-thieu-react-router/","title":"Giới thiệu React Router","desc":"React không phải một framework, nó chỉ là một thư viện javascript, bởi vì vậy nó không thể giải quyết tất cả các yêu cầu một ứng dụng. Việc mà React làm rất tốt là tạo component và cách thức quản lý state của component, nhưng để tạo một Single Page App (sẽ viết tắt là SPA) phức tạp, nó cần những thư viện khác nữa, đầu tiên cần nhắc đến là React Router"},{"id":"5d93819d1a5c10be427112a7e0bf625b","path":"/gioi-thieu-react-memo/","title":"Giới thiệu React.memo","desc":"Api mới của React 16.6"}]}},"context":{}}