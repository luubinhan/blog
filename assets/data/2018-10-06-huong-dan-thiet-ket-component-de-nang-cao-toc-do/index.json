{"hash":"6000b69201124b9452c41d38889aba5b11cf5e89","data":{"post":{"title":"Nâng cao tốc độ Component","path":"/2018-10-06-huong-dan-thiet-ket-component-de-nang-cao-toc-do/","date":"2018-10-06","timeToRead":3,"tags":[{"id":"react","title":"react","path":"/tag/react/"},{"id":"performance","title":"performance","path":"/tag/performance/"}],"desc":"Bài viết của team làm Facebook Ads chia sẽ, cùng điểm qua các vấn đề căn bản để tối ưu component","content":"<!-- TOC -->\n<ul>\n<li><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-shouldcomponentupdate-v%C3%A0-reactpurecomponent\">Sử dụng <code class=\"language-text\">shouldComponentUpdate</code> và <code class=\"language-text\">React.PureComponent</code></a></li>\n<li><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-d%E1%BB%AF-li%E1%BB%87u-immutability-%C4%91%E1%BB%83-so-s%C3%A1nh\">Sử dụng dữ liệu Immutability để so sánh</a></li>\n<li><a href=\"#chuy%C3%AAn-bi%E1%BB%87t-h%C3%B3a-%C4%91%E1%BB%83-maintain-v%C3%A0-c%E1%BA%A3i-thi%E1%BB%87n-hi%E1%BB%87u-n%C4%83ng\">Chuyên biệt hóa để maintain và cải thiện hiệu năng</a></li>\n<li><a href=\"#%C4%91%E1%BB%99c-l%E1%BA%ADp-tr%C3%AAn-t%E1%BB%ABng-children\">Độc lập trên từng <code class=\"language-text\">children</code></a></li>\n</ul>\n<!-- /TOC -->\n<h1 id=\"sử-dụng-shouldcomponentupdate-và-reactpurecomponent\"><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-shouldcomponentupdate-v%C3%A0-reactpurecomponent\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sử dụng <code class=\"language-text\">shouldComponentUpdate</code> và <code class=\"language-text\">React.PureComponent</code></h1>\n<p><strong>re-render</strong> là thứ sẽ tiêu tốn công sức và chúng ta phải hạn chế nó tối đa, bằng hook <code class=\"language-text\">shouldComponentUpdate(nextProps, nextState)</code></p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">shouldComponentUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nextProps<span class=\"token punctuation\">,</span> nextState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">!</span><span class=\"token function\">shallowEqual</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span><span class=\"token punctuation\">,</span> nextProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n    <span class=\"token operator\">!</span><span class=\"token function\">shallowEqual</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span><span class=\"token punctuation\">,</span> nextState<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Pure component là những component chỉ dùng giá trị <code class=\"language-text\">props</code> và <code class=\"language-text\">state</code> để <code class=\"language-text\">render</code>, không cần tính toán logic, nó cũng sẽ không có hook <code class=\"language-text\">shouldComponentUpdate</code>, React sẽ dùng kiểu so sánh <strong>tương đối</strong></p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// chỉ phụ thuộc vào props và state khi render</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>width<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">width</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">rows</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Vì vậy phải đảm bảo các <code class=\"language-text\">children</code> của một PureComponent cùng là một PureComponent, nếu không có trường hợp nó sẽ không render đúng.</p>\n<p>Ví dụ như bên dưới, 2 object này React sẽ so sánh được</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  size<span class=\"token operator\">:</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span>\n  color<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// .vs</span>\n<span class=\"token punctuation\">{</span>\n  size<span class=\"token operator\">:</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span>\n  color<span class=\"token operator\">:</span> <span class=\"token string\">'red'</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Nhưng object thế này thì thua</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  isActive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  balance<span class=\"token operator\">:</span> <span class=\"token string\">'1500000'</span><span class=\"token punctuation\">,</span>\n  picture<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  age<span class=\"token operator\">:</span> <span class=\"token number\">29</span><span class=\"token punctuation\">,</span>\n  name<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    first<span class=\"token operator\">:</span> <span class=\"token string\">'An'</span><span class=\"token punctuation\">,</span>\n    last<span class=\"token operator\">:</span> <span class=\"token string\">'Luu'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  contact<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">email</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      phone<span class=\"token operator\">:</span> <span class=\"token string\">'123456'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      email<span class=\"token operator\">:</span> <span class=\"token string\">'anluu@gmail'</span><span class=\"token punctuation\">,</span>\n      address<span class=\"token operator\">:</span> <span class=\"token string\">'123 Sai Gon'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h1 id=\"sử-dụng-dữ-liệu-immutability-để-so-sánh\"><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-d%E1%BB%AF-li%E1%BB%87u-immutability-%C4%91%E1%BB%83-so-s%C3%A1nh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sử dụng dữ liệu Immutability để so sánh</h1>\n<p>Cách làm áp dụng ở đây tương tự như việc trả hàng hóa</p>\n<p><img src=\"https://uidesign.gearbest.com/gb_blog/2101-2400/2375/6-tips-about-applying-for-a-product-return-on-GearBest-Z00.jpg\"></p>\n<p>Nếu gói hàng bị trả chưa khui gì cả, người bán hàng chỉ cần kiểm tra xung quanh đảm bảo gói hàng chưa bị khui thì họ sẽ xem như nó còn nguyên vẹn, không cần kiểm tra bên trong.</p>\n<p>Tương tự, nếu chúng ta dùng dữ liệu Immuatable, chúng ta có thể nhanh chóng biết được 2 object hay mảng đó có khác nhau hay không.</p>\n<p>Để biết thêm về Immutable, <a href=\"https://facebook.github.io/immutable-js/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">đọc thêm ở đây</a></p>\n<h1 id=\"chuyên-biệt-hóa-để-maintain-và-cải-thiện-hiệu-năng\"><a href=\"#chuy%C3%AAn-bi%E1%BB%87t-h%C3%B3a-%C4%91%E1%BB%83-maintain-v%C3%A0-c%E1%BA%A3i-thi%E1%BB%87n-hi%E1%BB%87u-n%C4%83ng\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Chuyên biệt hóa để maintain và cải thiện hiệu năng</h1>\n<p>Chuyên biệt hóa là việc tách nhỏ các component ra, mỗi một component đảm nhiệm một công việc cụ thể</p>\n<p>Ví dụ, thay vì viết 1 component là <code class=\"language-text\">ScrollingTable</code></p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ScrollingTable</span></span>\n  <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>123<span class=\"token punctuation\">\"</span></span><span class=\"token style-attr language-css\"><span class=\"token attr-name\">\n  <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token color\">blue</span></span><span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">scrollTop</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span><span class=\"token property-access\">offsetTop</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre>\n<p>Nên viết thành 2 component</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OuterScroller</span></span> <span class=\"token attr-name\">scrollTop</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span><span class=\"token property-access\">offsetTop</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">InnerTable</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>123<span class=\"token punctuation\">\"</span></span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token color\">blue</span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">OuterScroller</span></span><span class=\"token punctuation\">></span></span></code></pre>\n<h1 id=\"độc-lập-trên-từng-children\"><a href=\"#%C4%91%E1%BB%99c-l%E1%BA%ADp-tr%C3%AAn-t%E1%BB%ABng-children\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Độc lập trên từng <code class=\"language-text\">children</code></h1>\n<p>Có thể hình dùng việc lồng ghép các component theo kiểu parent-children giống như một cái cây-thân-nhánh-lá</p>\n<p><img src=\"https://media.istockphoto.com/vectors/tree-background-vector-id518399734?k=6&#x26;m=518399734&#x26;s=612x612&#x26;w=0&#x26;h=qxXFy440iXG-CXB9jlC-TyWPKU0NRWLa3cGYu_-ukQI=\"></p>\n<p>Khi lồng ghép quá nhiều dẫn đến việc để so sánh và biết được sự khác nhau giữa <strong>cây cũ</strong> và <strong>cây mới</strong> là vô cùng tốn sức</p>\n<p>Không những vậy, các component children sẽ thay đổi thường xuyên. Lấy ví dụ</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">var</span> <span class=\"token maybe-class-name\">Parent</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\"><span class=\"token maybe-class-name\">Component</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">shouldComponentUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nextProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span> <span class=\"token operator\">!==</span> nextProps<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Parent</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">child</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Parent</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Tất nhiên đây là ví dụ để bạn dễ hình dung rằng các component children thường xuyên thay đổi, việc kiểm tra <code class=\"language-text\">shouldComponentUpdate</code> lúc này rất khó nói trước là <code class=\"language-text\">true</code> hay <code class=\"language-text\">false</code></p>\n<p>Khuyến khích sử dụng ContainerComponent để kết nối vào store và Component chỉ đảm nhiệm việc render HTML</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// BudgetWidgetContainer</span>\n<span class=\"token keyword\">var</span> <span class=\"token maybe-class-name\">BudgetWidgetContainer</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\"><span class=\"token maybe-class-name\">PureComponent</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>  \n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BudgetWidget</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">amount</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><code class=\"language-text\">&lt;BudgetWidget/&gt;</code> không quan tâm value từ đâu có, nó chỉ việc render HTML, chúng ta có thể sử dụng component như vậy ở nhiều nơi, chúng ta chỉ cần viết lại Container Component</p>\n<p><a href=\"https://www.youtube.com/watch?v=KYzlpRvWZ6c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Xem video gốc của bài viết</a></p>\n","cover_image":"","related":[{"id":"d684d9a5c1536a976f9dd7c607b40c27","path":"/2018-07-09-huong-dan-optimize-toc-do-website-voi-chrome-devtools/","title":"Nâng cao tốc độ website với Chrome DevTools","desc":"Hướng dẫn sử dụng Chrome DevTools để phân tích và tối ưu hóa tốc độ website"},{"id":"d1bfc3e5e4598b7902ec8f15e0fb3f4a","path":"/2020-06-18-10-cau-hoi-javascript-de-nang-cao-kien-thuc-cua-ban/","title":"10 câu hỏi javascript để nâng cao trình độ","desc":"Cùng ôn luyện kiến thức javascript bằng 10 câu hỏi lắc léo"},{"id":"d7c5a1be37f6b7aa2083d3afe80563b9","path":"/2018-08-06-huong-dan-bat-dau-voi-firebase/","title":"Những tính năng cở bản của Firebase","desc":"Năm 2016 google giới thiệu Firebase. Khi bắt đầu phát triển ứng dụng điện thoại, bạn sẽ cần đến server và một developer để làm việc với server"},{"id":"0a408624be828657679088cbca8986c7","path":"/2018-06-18-huong-dan-luan-ban-ve-cach-to-chuc-thu-muc-dat-ten/","title":"Tiếp tục luận bàn về cách tổ chức thư mục, đặt tên component trong React","desc":"Hổm đã viết về vấn đề này rồi, giờ lại viết tiếp, vì bản thân React cũng không ra bất cứ rule nào về việc này, bạn tự do tổ chức sao mà mình thấy hợp lý, bài trước là của tác giả đó thấy vậy là hay, bài này thì tác giả thích tổ chức thế này"}]}},"context":{}}