{"hash":"f761b32cc486b7bfe2ae86510c063c7ac35e02e7","data":{"post":{"title":"Hướng dẫn webpack 4 cho người mới bắt đầu - Phần 2","path":"/huong-dan-webpack-4-cho-nguoi-moi-bat-dau-phan-2/","slug":"/2018-05-27-huong-dan-webpack-4-cho-nguoi-moi-bat-dau","date":"2018-05-27","timeToRead":5,"tags":[{"id":"javascript","title":"javascript","path":"/tag/javascript/"},{"id":"webpack","title":"webpack","path":"/tag/webpack/"}],"desc":"Phần 2 trong series về webpack, mình sẽ nói về code slitting, loaders","content":"<p>Trong Series này</p>\n<ol>\n<li><a href=\"2018-05-25-viet-code-javascript-tot-hon-voi-webpack\">Webpack là gì và tại sao ta phải xài nó</a></li>\n<li><a href=\"2018-05-27-huong-dan-webpack-4-cho-nguoi-moi-bat-dau\">Dùng Loaders, code slitting trong webpack</a></li>\n<li><a href=\"2018-05-28-huong-dan-webpack-4-cho-nguoi-moi-bat-dau-phan-3\">Plugins, Development Server</a></li>\n</ol>\n<!-- TOC -->\n<ul>\n<li><a href=\"#loaders\">Loaders</a></li>\n<li><a href=\"#babel-loader\">Babel Loader</a></li>\n<li><a href=\"#sass-loader\">SASS Loader</a></li>\n<li><a href=\"#image\">Image</a></li>\n<li><a href=\"#code-splitting\">Code splitting</a></li>\n</ul>\n<!-- /TOC -->\n<p>Chúng ta mở lại file <strong>package.json</strong>, sửa lại chút</p>\n<pre class=\"language-diff\"><code class=\"language-diff\">{\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ...\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"scripts\": {\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">     \"develop\": \"webpack --mode development --watch\",\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     \"build\": \"webpack --mode production\"\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   },\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ...\n</span></span>}</code></pre>\n<p>Với cách setup này, chỉ cần chạy <code>npm run develop</code> chúng ta sẽ chạy webpack ở development mode và bật tính năng detect thay đổi để chạy lại.</p>\n<p>Khi chạy <code>npm run build</code> chúng ta sẽ chạy webpack ở mode production, khi chạy ở mode này code sẽ được minified lại bằng Uglify JS, size nhỏ hơn khi chạy dev mode.</p>\n<h1 id=\"loaders\"><a href=\"#loaders\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Loaders</h1>\n<p>Loaders là gì? loaders là những thư viện sẽ can thiệp trước lúc chúng ta import file, nó cho phép webpack mở rộng khả năng không chỉ còn là bundle javascript thôi, mà cả những static resource khác, như css, image, svg, ...</p>\n<h1 id=\"babel-loader\"><a href=\"#babel-loader\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Babel Loader</h1>\n<p>Thời điểm hiện tại chắc ai cũng viết JS kiểu mới, để transpile cái ES6 mà ta viết, chúng ta sẽ cần <code>babel-loader</code></p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev babel-loader  @babel/core @babel/preset-env</code></pre>\n<p>Mở lại file <strong>webpack.config.js</strong></p>\n<pre class=\"language-diff\"><code class=\"language-diff\">const path = require('path')\n\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> module.exports = {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   entry: './src/index.js',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   output: {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     filename: 'bundle.js',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     path: path.resolve(__dirname, 'dist')\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   },\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   module: {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     rules: [\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         test: /\\.js$/,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         exclude: /(node_modules|bower_components)/,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         use: {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           loader: 'babel-loader',\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         }\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       }\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     ]\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   }\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span></span></code></pre>\n<p>Để cấu hình cách transpile của babel, chúng ta add thêm file <code>.babelrc</code> vào cùng thư mục với <strong>webpack.config.js</strong></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/env\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"syntax-dynamic-import\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Đoạn trên chúng ta đang cấu hình để khi Babel transpile, nó không đổi câu <code>import</code> và <code>export</code> về ES5 và cho phép import linh động, sau này dùng đến trong phần slitting code</p>\n<p>Giờ thì cứ vô tư viết ES6 nhé, vì khi bundle, webpack sẽ transpile code của chúng về thành ES5</p>\n<h1 id=\"sass-loader\"><a href=\"#sass-loader\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SASS Loader</h1>\n<p>Trước tiên cài một số package để làm việc với SASS</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev style-loader css-loader sass-loader node-sass</code></pre>\n<p><strong>webpack.config.js</strong></p>\n<pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">module.exports = {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ...\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   module: {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     rules: [\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       ...\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">       {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         test: /\\.scss$/,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         use: [{\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           loader: 'style-loader'\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         }, {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           loader: 'css-loader'\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         }, {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           loader: 'sass-loader'\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         }]\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       }\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     ]\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   }\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span></span></code></pre>\n<p>Mấy cái loader này sẽ được thực hiện theo thứ tự</p>\n<ul>\n<li><code>sass-loader</code> transforms Sass thành CSS.</li>\n<li><code>css-loader</code> parses CSS vào JavaScript và resolve dependencies.</li>\n<li><code>style-loader</code> chèn CSS vào bên trong thẻ <code>&#x3C;style></code></li>\n</ul>\n<p>Có thể hình dung nó như một function với callback là một function khác</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">styleLoader</span><span class=\"token punctuation\">(</span><span class=\"token function\">cssLoader</span><span class=\"token punctuation\">(</span><span class=\"token function\">sassLoader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Sau khi cấu hình như vậy chúng ta có thể import file  <code>.scss</code> bên trong file javascript</p>\n<pre class=\"language-diff\"><code class=\"language-diff\">import { groupBy } from 'lodash-es'\nimport people from './people'\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> import './style.scss'\n</span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> ...</span></span></code></pre>\n<p>Tại sao chúng ta lại đi import CSS vào trong file js? Nếu bạn thời kỳ trước việc chèn hầm bà lằng kiểu này là cực kỳ bị lên án, nhưng bây giờ thời thế khác, một số lý do để trọn CSS vào trong js trong development</p>\n<ul>\n<li>Một component javascript sẽ có thể phụ thuộc vào CSS, images, SVG. Nếu được đóng gói thành 1 cục, chúng ta dễ mang nó sử dụng ở nơi khác hơn</li>\n<li>Nếu chúng ta không sử dụng component, đoạn css import trong component cũng sẽ không được import luôn, tránh những việc load css ở tất cả</li>\n<li>Trước đây nếu dùng OOP trong CSS, việc chỉnh sửa một đoạn css sẽ dễ bị side effect, ảnh hướng đến những chổ ta không mong muốn. CSS module để CSS chỉ hoạt động local thôi</li>\n<li>Giảm số lượng HTTP request xuống</li>\n</ul>\n<h1 id=\"image\"><a href=\"#image\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Image</h1>\n<p>Dùng <code>file-loader</code> để đọc file image. Với HTML chuẩn, image được sử dụng bằng 2 cách là dùng tag <code>img</code> hoặc thuộc tính <code>background-image</code>. Với Webpack, chúng ta có thể optimize cho trường hợp dung lượng image với kích thước nhỏ thành dạng <code>string</code> bên trong javascript luôn. Lúc này trình duyệt không cần load riêng file image nữa</p>\n<p>Cài cái loader</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">nmp <span class=\"token function\">install</span> --save-dev file-loader</code></pre>\n<p>webpack.config.js</p>\n<pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">module.exports = {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ...\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   module: {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     rules: [\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       ...\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">       {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         test: /\\.(png|svg|jpg|gif)$/,\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         use: [\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">             loader: 'file-loader'\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           }\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">         ]\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       }\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     ]\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   }\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span></span></code></pre>\n<p>Trong lúc code chúng ta vẫn viết bình thường</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">codeURL</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./code.png'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token spread operator\">...</span>\n<span class=\"token method function property-access\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>codeURL<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token spread operator\">...</span></code></pre>\n<p>Kết quả bundle</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>data:image/png;base64,iVBO...<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>Có thể đọc thêm trên docs của <code>file-loader</code> để xem cách chỉnh kích thước nào thì chuyển nội dung ảnh thành data URI. File loader còn thể thể xử lý trên một số dạng file khác nữa, chứ không chỉ là hình thôi không.</p>\n<h1 id=\"code-splitting\"><a href=\"#code-splitting\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Code splitting</h1>\n<p>Trích từ trang chủ webpack</p>\n<blockquote>\n<p>Code splitting là một trong những tính năng hấp dẫn nhất của Webpack. Tính năng này cho phép bạn tách code ra thành nhiều file bundle để load khi cần thiết hoặc load song song. Cái này có thể dùng để giảm kích thước file bundle và kiểm soát được load resource hợp lý hơn, nếu sử dụng đúng cách, sẽ giảm đảng kể thời gian load trang</p>\n</blockquote>\n<p>Trước giờ chúng ta chỉ setup để bundle ra 1 file duy nhất từ <code>src/index.js</code> ra file <code>dist/bundle.js</code>. Khi ứng dúng phình ra, chúng ta cần tách code ra thành nhiều file, toàn bộ code đầu cần phải load hết ngay từ đầu đâu nhỉ? Dùng <a href=\"https://webpack.js.org/guides/code-splitting/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code Slitting</a> và <a href=\"https://webpack.js.org/guides/lazy-loading/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Lazy Loading</a> để chỉ load khi cần.</p>\n<pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">  const path = require('path')\n</span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> module.exports = {\n</span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">   entry: './src/index.js',\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   entry: {\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     app: './src/app.js'\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   },\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   output: {\n</span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">     filename: 'bundle.js',\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">     filename: '[name].bundle.js',\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     path: path.resolve(__dirname, 'dist')\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   },\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ...\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span></span></code></pre>\n<p>Với setup như thế này, nếu chúng ta có 2 file trong thư mục <code>src</code> là <code>app.js</code> và <code>chat.js</code>, webpack sẽ bundle ra 2 file <code>chat.bundle.js</code>, <code>app.bundle.js</code></p>\n<p>Bài sau nói tiếp plugins nhé, kết thúc với loaders ở đây</p>\n<p><a href=\"https://www.sitepoint.com/beginners-guide-webpack-module-bundling/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Link bài gốc</a>\nTác giả: Mark Brown</p>\n<p>Chỉnh sửa theo sự hiểu của mình một tí</p>\n","cover_image":"","related":[{"id":"4a83ae2c626a625e60998ef95d851361","path":"/huong-dan-webpack-4-cho-nguoi-moi-bat-dau-phan-3/","title":"Hướng dẫn webpack 4 cho người mới bắt đầu - Phần 3","desc":"Bài này sẽ nói Plugins, Development, HotModuleReplacement trong Webpack"},{"id":"1406377b5fd99a7421072e35b009a6c6","path":"/huong-dan-viet-dieu-kien-security-rules-cho-cloud-firestore-phan-2/","title":"Hướng dẫn viết điều kiện security rules cho Cloud Firestore - Phần 2","desc":"Series hướng dẫn sử dụng các service Firebase"},{"id":"0b0388dbdd5fb8e368d89c778ff54334","path":"/gioi-thieu-vuex-cho-nguoi-moi-bat-dau/","title":"Giới thiệu Vuex cho người mới bắt đầu","desc":"Mình không giới thiệu cụ thể từng phần trong Vuex, các bạn cần nắm redux store của React để hiểu được bài này, các khái niệm và nguyên tắc gần như là giống nhau, khác cách đặt tên thôi."},{"id":"9dff911f3d4c998b2e2d39eff8025ade","path":"/huong-dan-handle-event-listener-can-ban-cho-cac-ban-moi-bat-dau-voi-javascript/","title":"Hướng dẫn handle event listener căn bản cho các bạn mới bắt đầu với javascript","desc":"Căn bản nhưng cần thiết"}]}},"context":{}}