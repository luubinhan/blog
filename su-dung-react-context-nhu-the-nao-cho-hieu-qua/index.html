<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Sử dụng React Context như thế nào cho hiệu quả - VuiLapTrinh.com</title><meta name="gridsome:hash" content="039ed75c2c8087ca7192f8a19b292859b6e783d9"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Tutorials, Blog, Hướng dẫn, chia sẽ kinh nghiệm về Frontend, react, vue, ux, ui"><meta data-vue-tag="ssr" name="description" content="Để có thể quản lý được state của ứng dụng một cách tốt nhất, chúng ta cần sự phân chia phù hợp giữa local state (internal state của component) và state cửa ứng dụng đặt trong React Context. Một vài điều muốn chia sẽ để nâng cao khả năng bảo trì và trải nghiệm nếu sử dụng đến context trong React."><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Sử dụng React Context như thế nào cho hiệu quả"><meta data-vue-tag="ssr" property="og:description" cotent="Để có thể quản lý được state của ứng dụng một cách tốt nhất, chúng ta cần sự phân chia phù hợp giữa local state (internal state của component) và state cửa ứng dụng đặt trong React Context. Một vài điều muốn chia sẽ để nâng cao khả năng bảo trì và trải nghiệm nếu sử dụng đến context trong React."><meta data-vue-tag="ssr" property="og:image" content=""><meta data-vue-tag="ssr" property="image" content=""><meta data-vue-tag="ssr" name="twitter:card" content="summary"><meta data-vue-tag="ssr" name="twitter:creator" content="@luubinhan"><meta data-vue-tag="ssr" name="fb:app_id" content="445556375516928"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="16x16" href="/assets/static/luckyluu.ce0531f.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="32x32" href="/assets/static/luckyluu.ac8d93a.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="96x96" href="/assets/static/luckyluu.b9532cc.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="76x76" href="/assets/static/luckyluu.f22e9f3.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="152x152" href="/assets/static/luckyluu.62d22cb.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="120x120" href="/assets/static/luckyluu.1539b60.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="167x167" href="/assets/static/luckyluu.dc0cdc5.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="180x180" href="/assets/static/luckyluu.7b22250.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link rel="preload" href="/assets/css/0.styles.1aecfbe2.css" as="style"><link rel="preload" href="/assets/js/app.95975331.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.58b24a66.js" as="script"><link rel="prefetch" href="/assets/js/page--src-pages-404-vue.681877db.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.2601dd53.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.676ed86a.js"><link rel="stylesheet" href="/assets/css/0.styles.1aecfbe2.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="fb-root"></div>
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v8.0&appId=445556375516928&autoLogAppEvents=1"
      nonce="NM6X5rUi"
    ></script>
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute("data-theme", newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem("theme");
        } catch (err) {}

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem("theme", newTheme);
          } catch (err) {}
        };

        var darkQuery = window.matchMedia("(prefers-color-scheme: dark)");
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? "dark" : "light");
        });

        setTheme(preferredTheme || (darkQuery.matches ? "dark" : "light"));
      })();
    </script>

    <div id="app" data-server-rendered="true" class="layout-blog"><div class="sidebar" data-v-393213ba><div class="sidebar__inner" data-v-393213ba><a href="/" class="go-home active" data-v-393213ba>VuiLapTrinh.com</a><button type="button" aria-expanded="false" aria-label="nav" class="navbar-toggle collapsed" data-v-393213ba><div class="hamburger hamburger-1" data-v-393213ba><span class="line" data-v-393213ba></span><span class="line" data-v-393213ba></span><span class="line" data-v-393213ba></span></div></button><div class="navigation-component" data-v-393213ba><ul class="nav primary-menu collapsed" data-v-393213ba><li class="javascript" data-v-393213ba><a aria-label="Kiến thức Javascript" title="Kiến thức Javascript" target="" data-v-393213ba><span class="primary-menu__icon" data-v-393213ba><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" data-v-393213ba data-v-393213ba><path d="M255.908 485.999c-6.116 0-12.323-1.642-17.708-4.746l-56.319-33.316c-8.397-4.747-4.29-6.389-1.551-7.303 11.226-3.925 13.508-4.745 25.465-11.592 1.279-.729 2.922-.457 4.199.366l43.266 25.648c1.552.912 3.741.912 5.202 0l168.592-97.304c1.553-.913 2.555-2.738 2.555-4.563V158.583c0-1.917-1.002-3.651-2.645-4.654L258.463 56.716c-1.551-.913-3.65-.913-5.202 0L84.852 154.019c-1.644.913-2.647 2.738-2.647 4.655v194.515c0 1.825 1.003 3.65 2.647 4.473l46.188 26.653c25.102 12.504 40.436-2.191 40.436-17.068V175.195c0-2.738 2.19-4.837 4.93-4.837h21.359c2.647 0 4.928 2.099 4.928 4.837v192.143c0 33.407-18.256 52.576-49.928 52.576-9.768 0-17.435 0-38.794-10.588l-44.179-25.467c-10.954-6.299-17.708-18.074-17.708-30.76V158.583c0-12.596 6.754-24.462 17.708-30.76L238.2 30.519c10.679-6.024 24.828-6.024 35.416 0l168.594 97.394c10.953 6.298 17.707 18.073 17.707 30.761v194.515c0 12.596-6.754 24.371-17.707 30.761l-168.594 97.303a35.5 35.5 0 01-17.708 4.746zm136.098-191.775c0-36.421-24.646-46.096-76.4-52.941-52.396-6.938-57.689-10.498-57.689-22.729 0-10.131 4.473-23.641 43.266-23.641 34.596 0 47.375 7.485 52.668 30.853.457 2.19 2.467 3.833 4.746 3.833h21.91c1.367 0 2.645-.547 3.559-1.552.914-1.003 1.369-2.373 1.275-3.743-3.375-40.252-30.121-58.965-84.158-58.965-48.103 0-76.764 20.264-76.764 54.311 0 36.876 28.569 47.101 74.664 51.662 55.225 5.387 59.514 13.511 59.514 24.373 0 18.805-15.15 26.835-50.658 26.835-44.635 0-54.403-11.227-57.689-33.406-.365-2.373-2.374-4.107-4.837-4.107h-21.817a4.81 4.81 0 00-4.836 4.836c0 28.39 15.426 62.254 89.271 62.254 53.305-.092 83.975-21.181 83.975-57.873z" fill="#539e43" data-v-393213ba data-v-393213ba></path></svg></span><!----><!----><!----><!----><!----><span class="primary-menu__label" data-v-393213ba>Javascript</span></a></li><li class="react" data-v-393213ba><a aria-label="Kiến thức React" title="Kiến thức React" target="" data-v-393213ba><!----><span class="primary-menu__icon" data-v-393213ba><svg id="Layer_2" version="1.1" viewBox="0 0 600 600" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" data-v-393213ba data-v-393213ba><circle cx="299.5" cy="299.6" r="50.2" class="st0" data-v-393213ba data-v-393213ba></circle><path d="M299.5 414.6c-70.5 0-132.1-8.3-178.2-24.1-29.9-10.2-55.3-23.8-73.4-39.3-19.2-16.4-29.4-34.3-29.4-51.6 0-33.2 36.4-65.7 97.5-86.9 50-17.4 115.2-27.1 183.4-27.1 67 0 131.3 9.4 181 26.6 29.1 10 53.6 23 71 37.4 18.9 15.8 28.9 33.1 28.9 50 0 34.5-40.7 69.4-106.3 91.1-46.4 15.4-108.4 23.9-174.5 23.9zm0-205c-64.7 0-128.7 9.4-175.5 25.7-56.2 19.6-81.4 46.4-81.4 64.3 0 18.6 27.1 47.9 86.5 68.2 43.6 14.9 102.6 22.8 170.4 22.8 63.6 0 122.9-8 167-22.7 61.7-20.5 89.9-49.8 89.9-68.3 0-9.5-7.2-20.7-20.3-31.6-15.1-12.6-37.1-24.1-63.4-33.2-47.3-16.2-108.8-25.2-173.2-25.2z" class="st0" data-v-393213ba data-v-393213ba></path><path d="M185.6 549.8c-10.2 0-19.2-2.2-26.8-6.6-28.7-16.6-38.7-64.4-26.6-127.9 9.9-52.1 34.1-113.3 68.2-172.4 33.5-58 73.7-109 113.4-143.5 23.2-20.2 46.7-35 67.9-42.8 23.1-8.5 43.1-8.5 57.7-.1 29.9 17.2 39.8 70 25.8 137.6-9.9 48-33.5 105.9-66.5 163.2-35.2 61-73.2 110.2-109.9 142.3-23.8 20.8-48.3 36-70.7 43.9-11.7 4.2-22.7 6.3-32.5 6.3zm25.1-300.9l10.4 6c-32.3 56-56.2 116.1-65.4 164.9-11.1 58.5-.4 93.7 15 102.6 3.8 2.2 8.8 3.4 14.9 3.4 19.9 0 51.2-12.6 87.4-44.2 34.7-30.3 71-77.5 104.9-136.2 31.8-55.1 54.4-110.5 63.8-156 13.1-63.7 1.8-102.7-14.3-112-8.2-4.7-21.5-4.1-37.5 1.8-18.5 6.8-39.4 20.1-60.4 38.4-37.7 32.8-76.2 81.6-108.4 137.4l-10.4-6.1z" class="st0" data-v-393213ba data-v-393213ba></path><path d="M413.4 550.1c-27.2 0-61.7-16.4-97.7-47.4-40.2-34.6-81.1-86.1-115.3-145.2-33.6-58-57.6-118.3-67.7-170-5.9-30.2-7-57.9-3.2-80.2 4.2-24.3 14.1-41.6 28.8-50.1 29.8-17.3 80.5.5 132.1 46.4 36.6 32.5 75 81.9 108.1 139.1 35.3 61 59 118.5 68.4 166.3 6.1 31 7.1 59.8 2.8 83.2-4.6 24.9-15 42.6-30 51.3-7.5 4.4-16.4 6.6-26.3 6.6zM221.2 345.5c32.4 56 72.6 106.7 110.2 139 45.1 38.8 80.9 47.2 96.4 38.2 16.1-9.3 27.9-47.4 15.7-109-9-45.2-31.7-100.2-65.7-158.9-31.9-55.1-68.6-102.4-103.3-133.2-48.6-43.2-88-52.9-104.1-43.6-8.2 4.7-14.3 16.6-17.2 33.4-3.3 19.4-2.3 44.2 3.1 71.5 9.6 49.1 32.6 106.8 64.9 162.6z" class="st0" data-v-393213ba data-v-393213ba></path></svg></span><!----><!----><!----><!----><span class="primary-menu__label" data-v-393213ba>React</span></a></li><li class="vue" data-v-393213ba><a aria-label="Kiến thức Vue" title="Kiến thức Vue" target="" data-v-393213ba><!----><!----><!----><!----><span class="primary-menu__icon" data-v-393213ba><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" data-v-393213ba data-v-393213ba><path fill="#41b883" d="M392.46 59.011H313.5l-57.499 90.972-49.285-90.972H26.001l230 393.978L485.999 59.011z" data-v-393213ba data-v-393213ba></path><path fill="#35495e" d="M83.192 91.867h55.241l117.568 203.511L373.464 91.867h55.241l-172.704 295.92L83.192 91.867z" data-v-393213ba data-v-393213ba></path></svg></span><!----><span class="primary-menu__label" data-v-393213ba>Vue</span></a></li><li class="htmlCss" data-v-393213ba><a aria-label="Kiến thức HTML/CSS" title="Kiến thức HTML/CSS" target="" data-v-393213ba><!----><!----><!----><span class="primary-menu__icon" data-v-393213ba><svg version="1.0" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" data-v-393213ba data-v-393213ba><path fill="#E44D26" d="M27.377 28.889L16.001 32 4.625 28.889 2 0h28.002z" data-v-393213ba data-v-393213ba></path><path fill="#FF6C39" d="M16 2v27.75l9.232-2.742L27.688 2z" data-v-393213ba data-v-393213ba></path><path fill="#FFF" d="M24.363 6H7.607L8 10l.619 7h10.884l-.355 3.984L16 21.99l-3.143-1.006L12.648 19H8.803l.459 4.987L16 25.99l6.728-2.004.99-10.986H12.252l-.25-3H24z" data-v-393213ba data-v-393213ba></path></svg></span><!----><!----><span class="primary-menu__label" data-v-393213ba>HTML/CSS</span></a></li><li class="uxUi" data-v-393213ba><a aria-label="Kiến thức UX/UI" title="Kiến thức UX/UI" target="" data-v-393213ba><!----><!----><!----><!----><!----><span class="primary-menu__icon" data-v-393213ba><svg viewBox="0 0 512 454.633" xmlns="http://www.w3.org/2000/svg" data-v-393213ba data-v-393213ba><path d="M202.271 243.812c-9.741 10.73-12.13 18.428-24.884 38.588 8.237 5.752 24.104 19.055 35.095 41.959 21.953-12.592 32.188-14.514 43.821-24.309C332.24 236.092 518.244 6.836 511.839.204c-6.766-7.05-242.704 170.268-309.568 243.608zM155.442 300.209c-32.998-5.832-65.547 15.028-87.288 67.147C46.382 419.471 7.532 440.337.001 439.061c40.553 14.67 164.202 52.194 194.939-90.655-13.037-34.26-39.498-48.197-39.498-48.197z" data-v-393213ba data-v-393213ba></path></svg></span><span class="primary-menu__label" data-v-393213ba>UX/UI</span></a></li><li class="about" data-v-393213ba><a href="https://luubinhan.github.io/" target="_blank" data-v-393213ba>About</a></li></ul></div></div><div id="footer" data-v-393213ba><footer class="footer" data-v-393213ba><section class="footer-inner" data-v-393213ba><div class="social-links" data-v-393213ba><a href="https://www.youtube.com/channel/UC0Te8s0b0aplS1ZoVLfjKHA" target="_blank" rel="noopener noreferrer" class="link-youtube" data-v-393213ba><span class="link-youtube__icon" data-v-393213ba><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" data-v-393213ba data-v-393213ba><path d="M512 256c0 141.4-114.6 256-256 256S0 397.4 0 256 114.6 0 256 0s256 114.6 256 256z" fill="#CD201F" data-v-393213ba data-v-393213ba></path><path d="M391.1 194.6c-2.3-19.9-7.1-25.7-10.5-28.4-5.4-4.2-15.2-5.7-28.3-6.6-21-1.4-56.7-2.3-95.2-2.3-38.6 0-74.2.8-95.2 2.3-13.1.9-22.9 2.4-28.3 6.6-3.4 2.7-8.1 8.5-10.5 28.4-3.4 28.7-3.4 94.1 0 122.8 2.4 19.9 7.1 25.7 10.5 28.4 5.4 4.2 15.2 5.7 28.3 6.6 21 1.4 56.6 2.3 95.2 2.3s74.2-.9 95.2-2.3c13.1-.9 22.9-2.4 28.3-6.6 3.4-2.6 8.1-8.5 10.5-28.4 3.4-28.7 3.4-94.1 0-122.8zm-167 104.3V213l82.4 42.9-82.4 43z" fill="#FFF" data-v-393213ba data-v-393213ba></path></svg></span>
            Youtube
          </a></div><div class="credit" data-v-393213ba>Copyright © 2019. luckyluu</div></section></footer></div></div><div class="master"><main class="inner"><div class="master__search"><div class="search-wrapper"><div class="mb-2"><div class="post-tags"><a href="/tag/javascript" class="post-tags__link"><span>#</span>
    Javascript
  </a><a href="/tag/dam-dao" class="post-tags__link"><span>#</span>
    Đàm đạo chém gió chuyện nghề
  </a><a href="/tag/css" class="post-tags__link"><span>#</span>
    CSS từ căn bản tới nâng cao
  </a><a href="/tag/thu-thuat" class="post-tags__link"><span>#</span>
    Thủ thuật
  </a><a href="/tag/hoc-thuat" class="post-tags__link"><span>#</span>
    Kiến thức nền tảng
  </a><a href="/tag/react" class="post-tags__link"><span>#</span>
    React
  </a><a href="/tag/vuejs" class="post-tags__link"><span>#</span>
    Vue JS
  </a><a href="/tag/chrome" class="post-tags__link"><span>#</span>
    Chrome DevTools
  </a></div></div><div class="search__container"><input type="text" placeholder="Tìm bài viết..." value="" class="search__input"><!----></div><div class="search__list"><!----><!----></div></div></div><div class="single-post"><div class="single-post-container"><article><header><div class="post-title"><h1 class="post-title__text single-post-title">
              Sử dụng React Context như thế nào cho hiệu quả
            </h1><div class="post-meta">
  Đăng ngày
  <time dateTime="2020-03-08" itemprop="dateModified" content="2020-03-08">2020-03-08</time>.
  
    Mất khoảng
    <strong>9 phút</strong> để đọc.
  </div></div></header><div class="post content-box"><div class="post__header"><!----></div><div class="blog-post"><div class="post-content"><!-- TOC -->
<ul>
<li><a href="#provider-component">Provider Component</a></li>
<li><a href="#consumer-hook">Consumer Hook</a></li>
<li><a href="#typescript--flow">TypeScript / Flow</a></li>
<li><a href="#v%E1%BA%ADy-c%C3%B2n-dispatch-type">Vậy còn dispatch <code class="language-text">type</code>?</a></li>
<li><a href="#v%E1%BA%ADy-c%C3%B2n-c%C3%A1c-async-action-th%C3%AC-sao-">Vậy còn các async action thì sao ?</a></li>
<li><a href="#c%E1%BA%A3m-th%E1%BA%A5y-t%C3%A1ch-state-v%C3%A0-dispatch-r%E1%BA%A5t-kh%C3%B3-ch%E1%BB%8Bu">Cảm thấy tách state và dispatch rất khó chịu</a></li>
<li><a href="#to%C3%A0n-b%E1%BB%99-source-code">Toàn bộ source code</a></li>
</ul>
<!-- /TOC -->
<p>Chúng ta có một <em>module</em> (một nhánh trên cây react component cho dể hình dung) muốn sử dụng Context là <code class="language-text">count</code>, chúng ta tạo file <code class="language-text">count-context.js</code></p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// src/count-context.js</span>
<span class="token keyword module">import</span> <span class="token maybe-class-name">React</span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">CountStateContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">CountDispatchContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Điều muốn nói đầu tiên là chúng ta cố tình <strong>không khai báo giá trị khởi tạo</strong> cho <code class="language-text">CountStateContext</code>, nếu muốn bạn có thể gọi <code class="language-text">React.createContext({count: 0})</code>. Khai báo một <code class="language-text">defaultValue</code> chỉ hữu dụng trong trường hợp như bên dưới</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CountDisplay</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">CountStateContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Vì không khai báo giá trị khởi tạo, chúng ta sẽ nhận lỗi khi viết destructure giá trị trả về từ <code class="language-text">useContext</code>. Vì giá trị mặc định là <code class="language-text">undefined</code> và chúng ta không thể destructure <code class="language-text">undefined</code></p>
<p>Không ai trong chúng ta muốn nhận lỗi do không có giá trị khởi tạo. Tuy nhiên, nếu chỉ sử dụng giá trị mặc định được cung cấp, lợi ích sẽ không nhiều bằng việc linh động giá trị này. Kinh nghiệm thực tế cho thấy khi khởi tạo và sử dụng context trong ứng dụng, chúng ta muốn các consumer context (component sử dụng <code class="language-text">useContext</code>) có thể cung cấp thêm các giá trị mới.</p>
<p><em>Trong tài liệu chính thức của React có đề cập, "cung cấp giá trị mặc định có thế giúp việc test component độc lập mà không cần bộc chúng lại (component lồng vào nhau)". Không cùng quan điểm với ý kiến này, cá nhân tác giả (Kent C. Dodds) cho rằng tốt hơn nên bộc component với các context cần thiết khi test. Hãy nhớ là mỗi lần chúng ta làm gì đó bên trong test, chúng ta không làm những việc như vậy trong ứng dụng, chúng ta giảm bớt sự tự tin mà unit test mang lại.</em></p>
<blockquote>
<p>Lưu ý: nếu đang sử dụng Flow hay TypeScript, không cung cấp giá trị mặc định sẽ bị nhận ngay thẻ "cảnh cáo", rất phiền toái nếu sử dụng <code class="language-text">React.useContext</code>. Đọc tiếp phần dưới sẽ chỉ cách khắc phục</p>
</blockquote>
<p>Mục đích của <code class="language-text">CountDispatchContext</code> là để làm gì. Mình đã sử dụng context trong một thời gian, và nói chuyện với một số người đang làm việc với nó, có thể chia sẻ với bạn là đây là <strong>cách đơn giản nhất</strong> để tránh các rắc rối với context (đặc biệt khi bạn bắt đầu sử dụng <code class="language-text">dispatch</code> trong effect) khi bạn bắt đầu tách state và dispatch trong context. <strong>Hãy tin mình!</strong></p>
<h2 id="provider-component"><a href="#provider-component" aria-hidden="true"><span class="icon icon-link"></span></a>Provider Component</h2>
<p>Để các component bên dưới có thể sử dụng context module, chúng ta phải <em>bộc</em> các component lại về trong cùng một context, sử dụng với Provider Component, cái này thì ai cũng biết</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountProvider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountDisplay</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountProvider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><code class="language-text">CountProvider</code> được đưa ra để xài như thế nào cho hiệu quả thì lại ích ai quan tâm, đây là cách mà <code class="language-text">CountProvider</code> được đưa ra cho thế giới</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// src/count-context.js</span>
<span class="token keyword module">import</span> <span class="token maybe-class-name">React</span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">CountStateContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">CountDispatchContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">countReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"increment"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">"decrement"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unhandled action type: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CountProvider</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useReducer</span><span class="token punctuation">(</span>countReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountStateContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountDispatchContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountDispatchContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountStateContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword module">export</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">CountProvider</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h2 id="consumer-hook"><a href="#consumer-hook" aria-hidden="true"><span class="icon icon-link"></span></a>Consumer Hook</h2>
<p>Các thư viện sử dụng context tìm thấy trên mạng đa phần sẽ dùng cách này</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token maybe-class-name">React</span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">SomethingContext</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">"some-context-package"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">YourComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> something <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">SomethingContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Để nâng cao trải nghiệm khi chúng ta sử dụng, câu lệnh này <code class="language-text">React.useContext(SomethingContext)</code> cần phải thay thế. Nếu có thể viết như thế này, sẽ tuyệt vời hơn rất nhiều</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token maybe-class-name">React</span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> useSomething <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">"some-context-package"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">YourComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> something <span class="token operator">=</span> <span class="token function">useSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Để có thể dùng <code class="language-text">useSomething()</code> như bên trên, chúng ta sẽ cần viết lại context như sau</p>
<pre class="language-jsx{32-38,40-46,48}"><code class="language-jsx{32-38,40-46,48}">// src/count-context.js
import React from "react";

const CountStateContext = React.createContext();
const CountDispatchContext = React.createContext();

function countReducer(state, action) {
  switch (action.type) {
    case "increment": {
      return { count: state.count + 1 };
    }
    case "decrement": {
      return { count: state.count - 1 };
    }
    default: {
      throw new Error(`Unhandled action type: ${action.type}`);
    }
  }
}

function CountProvider({ children }) {
  const [state, dispatch] = React.useReducer(countReducer, { count: 0 });
  return (
    <CountStateContext.Provider value={state}>
      <CountDispatchContext.Provider value={dispatch}>
        {children}
      </CountDispatchContext.Provider>
    </CountStateContext.Provider>
  );
}

function useCountState() {
  const context = React.useContext(CountStateContext);
  if (context === undefined) {
    throw new Error("useCountState must be used within a CountProvider");
  }
  return context;
}

function useCountDispatch() {
  const context = React.useContext(CountDispatchContext);
  if (context === undefined) {
    throw new Error("useCountDispatch must be used within a CountProvider");
  }
  return context;
}

export { CountProvider, useCountState, useCountDispatch };</code></pre>
<p>Chúng ta tạo <code class="language-text">useCountState</code> và <code class="language-text">useCountDispatch</code> hook sử dụng <code class="language-text">React.useContext</code> để lấy được giá trị context cung cấp từ <code class="language-text">CountProvider</code>. Tuy nhiên, nếu không có giá trị, chúng ta hiển thị thông báo lỗi để báo hook chỉ được sử dụng trong function component được render bên trong <code class="language-text">CountProvider</code>. Lỗi này rất hay quên, nên nhắc trước cho tốt.</p>
<p>Nếu cần sử dụng với React &#x3C; 16.8.0, chúng ta dùng render-prop với Consumer Component như sau</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CountConsumer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountStateContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token parameter">context</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"CountConsumer must be used within a CountProvider"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">children</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountStateContext.Consumer</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>Nếu bạn đã dùng React cũ, hoặc là nâng cấp mới nhất, hoặc giữ nguyên tình trạng hiện tại cho an toàn?</strong></p>
<h2 id="typescript--flow"><a href="#typescript--flow" aria-hidden="true"><span class="icon icon-link"></span></a>TypeScript / Flow</h2>
<p>Như đã hứa ở trên, với vấn đề <code class="language-text">defaultValue</code> khi sử dụng TypeScript và Flow. Giải quyết như sau</p>
<pre class="language-tsx{9-12,40-44,48-52}"><code class="language-tsx{9-12,40-44,48-52}">// src/count-context.tsx
import * as React from 'react'

type Action = {type: 'increment'} | {type: 'decrement'}
type Dispatch = (action: Action) => void
type State = {count: number}
type CountProviderProps = {children: React.ReactNode}

const CountStateContext = React.createContext<State| undefined>(undefined)
const CountDispatchContext = React.createContext(<Dispatch | undefined>(
undefined,
)

function countReducer(state: State, action: Action) {
  switch (action.type) {
    case 'increment': {
      return {count: state.count + 1}
    }
    case 'decrement': {
      return {count: state.count - 1}
    }
    default: {
      throw new Error(`Unhandled action type: ${action.type}`)
    }
  }
}

function CountProvider({children}: CountProviderProps) {
  const [state, dispatch] = React.useReducer(countReducer, {count: 0})

  return (
    <CountStateContext.Provider value={state}>
      <CountDispatchContext.Provider value={dispatch}>
        {children}
      </CountDispatchContext.Provider>
    </CountStateContext.Provider>
  )
}

function useCountState() {
  const context = React.useContext(CountStateContext)
  if (context === undefined) {
    throw new Error('useCountState must be used within a CountProvider')
  }
  return context
}

function useCountDispatch() {
  const context = React.useContext(CountDispatchContext)
  if (context === undefined) {
    throw new Error('useCountDispatch must be used within a CountProvider')
  }
  return context
}

export {CountProvider, useCountState, useCountDispatch}</code></pre>
<p>Với cách viết này, ai cũng có thể sử dụng <code class="language-text">useCountState</code> hoặc <code class="language-text">useCountDispatch</code> mà không cần kiểm tra <code class="language-text">undefined</code></p>
<p><a href="https://codesandbox.io/s/bitter-night-i5mhj" target="_blank" rel="nofollow noopener noreferrer">Xem CodeSandbox</a></p>
<h2 id="vậy-còn-dispatch-type"><a href="#v%E1%BA%ADy-c%C3%B2n-dispatch-type" aria-hidden="true"><span class="icon icon-link"></span></a>Vậy còn dispatch <code class="language-text">type</code>?</h2>
<p>Nếu bạn từng viết Redux, sẽ thắc mắc "vậy action creator đâu?". Nếu <em>thích</em> bạn có thể tự viết nếu muốn. Nhưng mình không phải là <em>fan</em> của action creator (cô thư ký xinh đẹp trong <a href="http://vuilaptrinh.com/2019-05-28-giai-thich-pattern-flux-trong-react/" target="_blank" rel="nofollow noopener noreferrer">bài giải thích về Flux Pattern của mình</a>. Mình luôn cảm thấy em này khá dư thừa, không cần thiết phải phức tạp thêm một tổ chức đã quá phức tạp như Flux (<strong>hoàn hảo không phải là không còn gì để thêm nữa mà là ko còn gì có thể bỏ đi mà</strong>). Nếu sử dụng TypeScript hoặc Flow, nó sẽ giúp chúng ta tự điền action type có thể điền</p>
<p><img src="https://kentcdodds.com/static/d99d4329b1d7ebd2e63bf76471f540ab/e3189/auto-complete.png" alt="Sử dụng React Context như thế nào cho hiệu quả"></p>
<p><img src="https://kentcdodds.com/static/0d45ecb53470729181863636bdafc2b9/e3189/type-error.png" alt="Sử dụng React Context như thế nào cho hiệu quả"></p>
<p>Mình thích kiểu gọi <code class="language-text">dispatch</code> như thế này, nếu để ý bạn sẽ biết <code class="language-text">dispatch</code> sẽ không thay đổi trong suốt quá trình tồn tại của component, nghĩa là bạn có thể truyền nó vào mảng phụ thuộc của <code class="language-text">useEffect</code> vô tư.</p>
<h2 id="vậy-còn-các-async-action-thì-sao-"><a href="#v%E1%BA%ADy-c%C3%B2n-c%C3%A1c-async-action-th%C3%AC-sao-" aria-hidden="true"><span class="icon icon-link"></span></a>Vậy còn các async action thì sao ?</h2>
<p>Một câu hỏi hay, bạn gặp tình huống cần xử lý là một async (thao tác bất đồng bộ như network request) và bạn cần dispatch nhiều action cùng lúc, dispatch một action nào đó phụ thuộc vào kết quả từ dispatch trước đó? Bạn có thể làm điều đó trong component, tuy nhiên <em>xử lý thủ công</em> như thế trên từng component rất là phiền.</p>
<p>Mình đề nghị tạo một helper function trong context module, nhận <code class="language-text">dispatch</code> và tất cả những dữ liệu bạn cần, helper function (AKA middleware) này sẽ chịu trách nhiệm xử lý tất cả những việc đã nêu trên (theo kiểu state machine)</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// user-context.js</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> user<span class="token punctuation">,</span> updates</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"start update"</span><span class="token punctuation">,</span> updates <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> updatedUser <span class="token operator">=</span> <span class="token keyword">await</span> userClient<span class="token punctuation">.</span><span class="token method function property-access">updateUser</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> updates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"finish update"</span><span class="token punctuation">,</span> updatedUser <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"fail update"</span><span class="token punctuation">,</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">UserProvider</span><span class="token punctuation">,</span> useUserDispatch<span class="token punctuation">,</span> useUserState<span class="token punctuation">,</span> updateUser <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Sử dụng nó sẽ như thế này</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// user-profile.js</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> useUserState<span class="token punctuation">,</span> useUserDispatch<span class="token punctuation">,</span> updateUser <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">"./user-context"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UserSettings</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> status<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useUserState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> userDispatch <span class="token operator">=</span> <span class="token function">useUserDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateUser</span><span class="token punctuation">(</span>userDispatch<span class="token punctuation">,</span> user<span class="token punctuation">,</span> formState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="cảm-thấy-tách-state-và-dispatch-rất-khó-chịu"><a href="#c%E1%BA%A3m-th%E1%BA%A5y-t%C3%A1ch-state-v%C3%A0-dispatch-r%E1%BA%A5t-kh%C3%B3-ch%E1%BB%8Bu" aria-hidden="true"><span class="icon icon-link"></span></a>Cảm thấy tách state và dispatch rất khó chịu</h2>
<p>Nhiều người phàn nàn tách state và dispatch riêng rất khó chịu</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useCountState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useCountDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Tại sao không <em>đơn giản</em> là làm thế này</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Tất nhiên bạn có thể</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">useCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token function">useCountState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">useCountDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Cái này tùy cách nhìn nhận của từng người viết, không có chuyện ai đúng ai sai, chỉ là bạn cảm thấy <em>thoải mái</em>, <em>vui</em> hơn với cách viết nào thôi.</p>
<h2 id="toàn-bộ-source-code"><a href="#to%C3%A0n-b%E1%BB%99-source-code" aria-hidden="true"><span class="icon icon-link"></span></a>Toàn bộ source code</h2>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// src/count-context.js</span>
<span class="token keyword module">import</span> <span class="token maybe-class-name">React</span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">CountStateContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">CountDispatchContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">countReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"increment"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">"decrement"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unhandled action type: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CountProvider</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useReducer</span><span class="token punctuation">(</span>countReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountStateContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountDispatchContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountDispatchContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountStateContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useCountState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">CountStateContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"useCountState must be used within a CountProvider"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useCountDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">CountDispatchContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"useCountDispatch must be used within a CountProvider"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">CountProvider</span><span class="token punctuation">,</span> useCountState<span class="token punctuation">,</span> useCountDispatch <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Ở đây, mình đang cố tính không <code class="language-text">export CountContext</code>, chúng ta chỉ cung cấp một cách để cung cấp giá trị trong context và một cách để lấy về giá trị này. Việc này đảm bảo người sử dụng giá trị context đúng theo cái cách chúng ta muốn, cho phép chúng ta hạn chế một số code không cần thiết khi lúc nào cũng phải khai báo <code class="language-text">useContext</code> nào.</p>
<p>Hy vọng bài viết mang đến nhiều điều hữu ích cho bạn.</p>
<p><strong>Tâm niệm rằng:</strong></p>
<ul>
<li>Không nên đặt trọn niềm tin 100% vào context có thể giải quyết <strong>tất cả</strong> vấn đề liên quan đến chia sẻ state</li>
<li>Context không nhất thiết là một global state cho toàn bộ ứng dụng, nó có thể được áp dụng trên một phần của cây component cụ thể nào đó.</li>
<li>Bạn có thể (và bạn nên) chia các logic khác nhau trên các context khác nhau.</li>
</ul>
<p><a href="https://codesandbox.io/s/react-codesandbox-je6cc" target="_blank" rel="nofollow noopener noreferrer">Code Sandbox cho bạn nào cần vọc vạch</a></p>
<p><a href="https://kentcdodds.com/blog/how-to-use-react-context-effectively" target="_blank" rel="nofollow noopener noreferrer">How to use React Context effectively</a></p>
<p><a href="https://kentcdodds.com/blog/application-state-management-with-react" target="_blank" rel="nofollow noopener noreferrer">Application State Management with React</a></p>
<p><a href="https://kentcdodds.com/blog/how-to-optimize-your-context-value" target="_blank" rel="nofollow noopener noreferrer">How to optimize your context value</a></p>
</div></div><div class="post__footer"><div class="post-tags"><a href="/tag/react/" class="post-tags__link"><span>#</span>
    react
  </a><a href="/tag/thu-thuat/" class="post-tags__link"><span>#</span>
    thu-thuat
  </a></div></div><div class="single-post__share"><a class="share-network-email" style="background-color:#333333;"><i class="mst-icon icon-mail"></i><span>Email</span></a><a class="share-network-facebook" style="background-color:#1877f2;"><i class="mst-icon icon-facebook"></i><span>Facebook</span></a><a class="share-network-linkedin" style="background-color:#007bb5;"><i class="mst-icon icon-linkedin"></i><span>LinkedIn</span></a><a class="share-network-pocket" style="background-color:#ef4056;"><i class="mst-icon icon-get-pocket"></i><span>Pocket</span></a><a class="share-network-skype" style="background-color:#00aff0;"><i class="mst-icon icon-skype"></i><span>Skype</span></a><a class="share-network-twitter" style="background-color:#1da1f2;"><i class="mst-icon icon-twitter"></i><span>Twitter</span></a></div></div></article><div class="section-below-post"><div class="post-comments"><div data-href="https://vuilaptrinh.com/su-dung-react-context-nhu-the-nao-cho-hieu-qua/" data-numposts="10" data-width="100%" class="fb-comments"></div><div id="disqus_thread" style="min-height:200px;"></div></div><div class="related-posts"><h4>Bài liên quan</h4><ul class="related-posts__container"><li class="related-posts__media"><div class="related-posts__index">1.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/su-dung-css-content-nhu-the-nao-cho-dung/">Sử dụng CSS content như thế nào cho đúng</a></h4><p>Thuộc tính content trong CSS thường được sử dụng cùng với 2 ghost element là after và before, những giá trị nào có thể đưa vào cho thuộc tính content này</p></div></li><li class="related-posts__media"><div class="related-posts__index">2.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/hieu-ve-hook-use-ref-cua-react-nhu-the-nao-cho-dung/">Hiểu về hook useRef của React như thế nào cho đúng</a></h4><p>Nếu nghe useRef bạn nghĩ ngay trong đầu là để dùng với việc truy xuất DOM thật, bạn cần đọc bài này.</p></div></li><li class="related-posts__media"><div class="related-posts__index">3.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/su-dung-local-storage-tren-website-nhu-the-nao/">Sử dụng localStorage trên website như thế nào</a></h4><p>Kiến thức căn bản sử dụng localStorage để lưu thông tin cần thiết xuống trình duyệt</p></div></li><li class="related-posts__media"><div class="related-posts__index">4.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/tai-sao-su-dung-flow-va-su-dung-flow-nhu-the-nao-trong-react/">Tại sao sử dụng Flow, và sử dụng Flow như thế nào trong React</a></h4><p>Tại sao chúng ta cần type checking trong javascript, tại sao Flow lại là lựa chọn của nhiều developer hiện nay</p></div></li></ul></div><div class="author post-author"><a href="https://luubinhan.github.io/" target="_blank"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-52311ff214b737f722259e901102d6b3'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-52311ff214b737f722259e901102d6b3)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAQUBAQEAAAAAAAAAAAAABwEDBAUGCAAC/8QAMxAAAQMCAwcBBgYDAAAAAAAAAQIDEQAEBRIhBhMxQVFhcQciIzJCgbEIFDORodEWgsH/xAAZAQEBAQEBAQAAAAAAAAAAAAAEAwUGAAH/xAAhEQABBAMAAgMBAAAAAAAAAAABAAIDEQQSISJBBRNRMf/aAAwDAQACEQMRAD8A6Pr1fOalmvLyUAk6AnxS5VROUx4oR%2bvmPXNjZYbhti48DcKUt9LRIJAHsgkaxMmO1ByzxnG8PeQ/a3d5bOIIUVJdUOHMifvWjB8c6aMP2q0CfPbC/TW119SVz9YetmOMLYRfWWH3TaSA4pKVNrWOuhgH6UYtkNrsK2stFvYU65nbjesOpyrbnhPIjuKhPhSwDZw4qw5kU5ph6r%2blpCYFNOLKflV5o1JSXMkDlS5xy1qtDo4mfrWe2/xhWEbJ3t400%2b6oZWyGpkBRiTGoSNJj/tVbEXEN/VMyAC1iPUTaS2xjG3bO3IS3ay2HNJc1lR6xPDx3oa4g0RvVlQcSfhFRLrEF3V0LpSAh10layOMzw7eKl3jqLhxsxLaRw4610MUYiAa1ZMxMosrPugpJJ0nlwiiJ%2bH69eZ28NulfuX7R0LTOhygKB8yKxWLaWoC0BJKpgfL2rdfh8sV3G1F9iBTLNnalGbkFuEADzAVVMpwOO6/xCx4izJaAuiSsT8UV8KKyBznmKih1J714OqIiCa5jVdJsqk4ggL9oRPSqDbty4/w/GnLVzKPyypBkaEif4p5N2RwA/anlPtvsrafAW0tJStChKVA8QR0p4ZqQQil1ilz5Y5nGloXKkcNev908G8iUoSCUiiHtVhFhhdou6wu2O6JyuNg/pzwUCdY5a8JrAXtwErWi3RmIEZwZE9utaccm/QEVzKVZjVrltN4JyJMqFdGemuz7OzmyFjbBGS5eQLm6PMuLAMf6iE/SgBavuMPNOON75wKC0tr4GDPtdqO%2bxm0i8ew0O3O7RfJnett6J4mCnXhH81DNDzGK/i%2b4/wBbZSb7S1xQ2IIVBHWvb2BAIioBcVxMCml3KgYFZQZadtSzAK460hCpkk%2bBTzahmmnXnRA0APmadsj0ol1uE2T6r5SEWgbO9K%2bARGs0H7stto3luczSyS3mEKUJIBI66VrvUnGWlJZwlKsuaHnjmgafCk/f9qwD6y%2b2pbjhKU%2bylWaJ8dabjxmtne0HInolrVcYThj18w5clKzl1KOZ/sVLRtJ%2bQbQ7akpum/01oEA9c3bvULB8WtGbRYuW1vvBOVtTivm48eVUt9Z3dwpKlIbaZIhJQZEdJq7fJxDxxHcdWgxnvtFbZz1ItsQCWMWyWb8hJcn3ZV3Pyz14eK2e9WpUBJoGYHhVpmCQyCtTZBMaHz1oq7DYxvmBh11IeZT7pR%2bZA5eR9vFCyoGs8owm4sz38kK//9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" data-srcset="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript></a><h2 class="author__site-title">VuiLapTrinh.com</h2><p class="author__intro">Nếu đọc bài viết thấy hay, bạn xài bớt cái bọc ni lông, ra đường mua tờ vé số giúp các cô các bác là đã cảm ơn mình</p></div></div></div></div></main></div><div class="layout-blog__aside"><div class="layout-blog__aside-inner"><div class="search-wrapper"><div class="mb-2"><div class="post-tags"><a href="/tag/javascript" class="post-tags__link"><span>#</span>
    Javascript
  </a><a href="/tag/dam-dao" class="post-tags__link"><span>#</span>
    Đàm đạo chém gió chuyện nghề
  </a><a href="/tag/css" class="post-tags__link"><span>#</span>
    CSS từ căn bản tới nâng cao
  </a><a href="/tag/thu-thuat" class="post-tags__link"><span>#</span>
    Thủ thuật
  </a><a href="/tag/hoc-thuat" class="post-tags__link"><span>#</span>
    Kiến thức nền tảng
  </a><a href="/tag/react" class="post-tags__link"><span>#</span>
    React
  </a><a href="/tag/vuejs" class="post-tags__link"><span>#</span>
    Vue JS
  </a><a href="/tag/chrome" class="post-tags__link"><span>#</span>
    Chrome DevTools
  </a></div></div><div class="search__container"><input type="text" placeholder="Tìm bài viết..." value="" class="search__input"><!----></div><div class="search__list"><!----><!----></div></div><div class="layout-blog__aside-footer"></div></div></div></div> <script src="/assets/js/app.95975331.js" defer></script><script src="/assets/js/page--src-templates-post-vue.58b24a66.js" defer></script>
  </body>
</html>
