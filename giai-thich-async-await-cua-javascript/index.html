<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Giải thích async/await của javascript - VuiLapTrinh.com</title><meta name="gridsome:hash" content="0395a9475e6dcec202a1209b8bd40b74ee081359"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Tutorials, Blog, Hướng dẫn, chia sẽ kinh nghiệm về Frontend, react, vue, ux, ui"><meta data-vue-tag="ssr" name="desc" content="Hướng dẫn các bạn nắm vững async/await trong javascript, kèm ví dụ cụ thể"><link rel="preload" href="/assets/css/0.styles.4e7b3092.css" as="style"><link rel="preload" href="/assets/js/app.88e72233.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.0d21aba4.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.204466f8.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.0b0d171f.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.854eb99f.js"><link rel="stylesheet" href="/assets/css/0.styles.4e7b3092.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true" class="layout-blog"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text">
    ← VuiLapTrinh.com
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="single-post"><div class="single-post-container"><article><header><div class="post-title"><h1 class="post-title__text single-post-title">Giải thích async/await của javascript</h1><div class="post-meta">
  Đăng ngày 2018-05-07.
  
    Mất khoảng
    <strong>6 phút</strong> để đọc.
  </div></div></header><div class="post content-box"><div class="post__header"><!----></div><div className="blog-post"><div class="post-content"><div class="post__content"><!-- TOC -->
<ul>
<li><a href="#gi%E1%BB%9Bi-thi%E1%BB%87u">Giới thiệu</a></li>
<li><a href="#promise">Promise</a></li>
<li><a href="#v%E1%BA%A5n-%C4%91%E1%BB%81-k%E1%BA%BFt-h%E1%BB%A3p-nhi%E1%BB%81u-promise">Vấn đề: Kết hợp nhiều Promise</a></li>
<li><a href="#h%C3%A0m-async">Hàm Async</a></li>
<li><a href="#await">Await</a></li>
<li><a href="#x%E1%BB%AD-l%C3%BD-khi-c%C3%B3-l%E1%BB%97i">Xử lý khi có lỗi</a></li>
<li><a href="#await-b%C3%AAn-trong-loop">Await bên trong loop</a></li>
</ul>
<!-- /TOC -->
<h1 id="giới-thiệu"><a href="#gi%E1%BB%9Bi-thi%E1%BB%87u" aria-hidden="true"><span class="icon icon-link"></span></a>Giới thiệu</h1>
<p><code class="language-text">Async/await</code> sinh ra để giải quyết đống lộn xộn <strong>callback</strong> của <code class="language-text">Promise</code>. Cú pháp <code class="language-text">async/await</code> sẽ giúp chúng ta diễn giải logic này một cách dễ đọc hơn, dễ maintain hơn.</p>
<p>Trước khi bắt đầu, cũng nhìn lại một cách tổng quát Promise là gì, nếu đã nắm vững Promise, bạn có thể bỏ qua phần này.</p>
<h1 id="promise"><a href="#promise" aria-hidden="true"><span class="icon icon-link"></span></a>Promise</h1>
<p><strong>Promise</strong> trong Javascript giống như <code class="language-text">Future</code> trong Java, <code class="language-text">Task</code> trong C#, một kiểu <strong>abstraction</strong> cho phép các đoạn code chạy bất tuần tự, đầy đủ thì có thể xem thêm bài viết của mình <a href="2017-10-12-javascript-promise">ở đây về Promise trong Javascript</a></p>
<p><strong>Promise</strong> thường được dùng trong các thao tác I/O và network, ví dụ: đọc file, tạo một HTTP request.</p>
<p>Bình thường, do Javascript chạy kiểu single threat, mỗi một threat chỉ thực hiện một xử lý, Promise sẽ đảm bảo không chặn như vậy (còn cách nó làm như thế nào, bạn đọc bài ở link trên sẽ hiểu), thay vào đó nó sẽ gọi hàm callback mà chúng ta gắn vào trong <code class="language-text">then</code>.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Giờ xem xét đoạn code sau</p>
<pre class="language-js"><code class="language-js"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Bắt đầu chạy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Không thể biết được Promise đã kết thúc chưa..."</span><span class="token punctuation">)</span></code></pre>
<p>Nếu chạy đoạn code này nhiều lần, chúng ta sẽ nhận những kết quả khác nhau, có khi đoạn <code class="language-text">console.log(result)</code> chạy trước, có khi chạy sau.</p>
<p><strong>Không có một cách nào hợp lý để chúng ta block lại các xử lý cho đến khi <code class="language-text">Promise</code> kết thúc</strong>. Muốn vậy chúng ta phải đưa đoạn code phía sau Promise vào bên trong hàm callback</p>
<p><img src="https://nikgrozev.com/images/blog/async-await/SimplePromiseExample.png" alt="Hướng dẫn các bạn nắm vững asyn await trong javascript, kèm ví dụ cụ thể"></p>
<p>Nếu chúng ta đưa đoạn code vào trong <code class="language-text">then</code>, nó chỉ được gọi khi Promise đó trả về <code class="language-text">success</code>, nếu <code class="language-text">error</code> thì nghĩ chạy luôn. Phải đưa thêm xử lý vào <code class="language-text">catch</code></p>
<pre class="language-js"><code class="language-js"><span class="token function">rp</span><span class="token punctuation">(</span><span class="token string">'http://example.com'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h1 id="vấn-đề-kết-hợp-nhiều-promise"><a href="#v%E1%BA%A5n-%C4%91%E1%BB%81-k%E1%BA%BFt-h%E1%BB%A3p-nhi%E1%BB%81u-promise" aria-hidden="true"><span class="icon icon-link"></span></a>Vấn đề: Kết hợp nhiều Promise</h1>
<p>Sử dụng 1 Promise thì không vấn đề vì, nếu cần xử lý cho một logic bất tuần tự phức tạp hơn, chúng ta sẽ phải gọp nhiều Promise.</p>
<p>Ví dụ chúng ta cần ứng dụng thực hiện</p>
<ol>
<li>Tạo một HTTP request, đợi đến khi hoàn tất, in kết quả ra</li>
<li>Sau đó tạo thêm 2 HTTP request chạy song song</li>
<li>Sau khi cả 2 request này hoàn tất, in kết quả ra</li>
</ol>
<pre class="language-js"><code class="language-js"><span class="token comment">// tạo first request</span>
<span class="token keyword">const</span> call1Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

call1Promise<span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result1</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> call2Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> call3Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>call2Promise<span class="token punctuation">,</span> call3Promise<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">arr</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// cả 2 promise 2, 3 đã hoàn tất</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><img src="https://nikgrozev.com/images/blog/async-await/CombinedPromises.png" alt="Hướng dẫn các bạn nắm vững asyn await trong javascript, kèm ví dụ cụ thể"></p>
<p>Và nếu chúng ta thêm một vài thao tác xử lý bất tuần tự nữa, thêm câu <code class="language-text">catch</code> nữa, mọi thứ sẽ bắt đầu rối như canh hẹ luôn.</p>
<h1 id="hàm-async"><a href="#h%C3%A0m-async" aria-hidden="true"><span class="icon icon-link"></span></a>Hàm Async</h1>
<p><strong>Async function</strong> là một cách để chúng ta định nghĩa một <strong>hàm trả về 1 Promise đã được resolve</strong></p>
<p>Ví dụ, 2 hàm sau là hoàn toàn như nhau</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">'TEST'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// hàm asyncF này = với hàm f ở trên</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">asyncF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'TEST'</span>
<span class="token punctuation">}</span></code></pre>
<p>Tương tự, hàm <code class="language-text">async</code> sẽ <em>throw</em> một exception giống như <code class="language-text">reject</code> của promise</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">reject</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// asyncF = f</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">asyncF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token string">'Error'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h1 id="await"><a href="#await" aria-hidden="true"><span class="icon icon-link"></span></a>Await</h1>
<p>Bên trong hàm <code class="language-text">async</code> ta có thể sử dụng thêm từ khóa là <code class="language-text">await</code>, và chỉ có thể sử dụng <code class="language-text">await</code> trong hàm <code class="language-text">async</code> thôi nhé, nó sẽ cho phép ta chỉ định một tác vụ phải <strong>đợi tao chạy xong</strong>.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// sau khi promise được resolved, kết quả đó sẽ dược đưa về cho response</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// bên ngoài hàm async ta phải dùng then chứ không thể gọi await, nhớ là hàm f trả về promise</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Finished'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Giờ chúng ta viết lại hàm xử lý lồng nhiều Promise ở trên</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// đưa nó vô hàm async</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">solution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// đợi và print kết quả</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// chạy bất tuần tự 2 đứa này</span>
    <span class="token keyword">const</span> call2Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> call3Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// đợi khi cả 2 thằng trên chạy xong và được resolve</span>
    <span class="token keyword">const</span> response2 <span class="token operator">=</span> <span class="token keyword">await</span> call2Promise<span class="token punctuation">;</span>
    <span class="token keyword">const</span> response3 <span class="token operator">=</span> <span class="token keyword">await</span> call3Promise<span class="token punctuation">;</span>

    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>response2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>response3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// gọi hàm async</span>
<span class="token function">solution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Finished'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Nó sẽ tương tự như cách sử dụng <code class="language-text">Promise.all(...).then(...)</code> chỉ là ta viết khác đi.</p>
<p><img src="https://nikgrozev.com/images/blog/async-await/AsyncAwaitExample.png"></p>
<h1 id="xử-lý-khi-có-lỗi"><a href="#x%E1%BB%AD-l%C3%BD-khi-c%C3%B3-l%E1%BB%97i" aria-hidden="true"><span class="icon icon-link"></span></a>Xử lý khi có lỗi</h1>
<p>Trong ví dụ trên chúng ta đã mặc định là 2 hàm <code class="language-text">call2Promise</code> và <code class="language-text">call3Promise</code> luôn thành công, nếu lỡ bất kỳ thằng nào chết, nó sẽ <code class="language-text">reject</code> ngay, dù có thằng nào đó thành công,</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token method function property-access">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>Nếu chúng ta dùng <code class="language-text">try/catch</code>, nếu một thằng bị lỗi nó cũng không văng ra ngoài luôn</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> call2Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> call3Promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'CALL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//vẫn được chạy dù 1 trong 2 thằng có lỗi</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h1 id="await-bên-trong-loop"><a href="#await-b%C3%AAn-trong-loop" aria-hidden="true"><span class="icon icon-link"></span></a>Await bên trong loop</h1>
<pre class="language-js"><code class="language-js"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'before async: '</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'after async: '</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>Bạn đoán thử xem đoạn code trên in ra kết quả gì?</p>
<pre class="language-text"><code class="language-text">before async:  0
before async:  1
before async:  2
after async:  3
after async:  3
after async:  3</code></pre>
<p>Không đúng nhé, khi gặp <code class="language-text">await</code>, nó sẽ đợi <code class="language-text">resolve</code> mới chạy tiếp vòng loop, nên kết quả đúng sẽ là</p>
<pre class="language-text"><code class="language-text">before async:  0
after async: 0
before async: 1
after async: 1
before async: 2
after async: 2</code></pre>
<p>Khi gặp <code class="language-text">async/await</code> trong vòng lặp, hay có nhiều <code class="language-text">await</code> bên trong hàm <code class="language-text">async</code>, thì nhớ là <strong>THẰNG Ở SAU CHỈ ĐƯỢC CHẠY KHI THẰNG TRƯỚC NÓ ĐÃ RESOLVE</strong>. Trường hợp mình hông muốn nó đợi như vậy, cho nó gọi cùng lúc luôn (song song) thì viết lại như sau</p>
<p>Block lại</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Không block</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token keyword">await</span> promise1<span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token keyword">await</span> promise2<span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Bạn có thắc mắc tại sao chỉ với việc tách biến thế này lại làm cho 2 <code class="language-text">await</code> chạy cùng lúc mà nó thằng trước không <code class="language-text">block</code> thằng chạy sau lại? </p>
<p>2 cách viết này là hoàn toàn khác nhau, thật ra mình cũng chưa đủ trình để giải thích cặn kẽ tại sao nó lại chạy được, hy vọng bạn nào đọc mà hiểu thì comment giải thích dùm mình. Còn theo cách hiểu của mình</p>
<p>Đây là cách chạy của đoạn code #1</p>
<p><a href="https://i.imgur.com/ZbSjV3V.jpg" target="_blank" rel="nofollow noopener noreferrer">Imgur - Giải thích async/await của javascript</a></p>
<p>Cách chạy của đoạn code #2
<a href="https://i.imgur.com/F2l59c0.jpg" target="_blank" rel="nofollow noopener noreferrer">Imgur - Giải thích async/await của javascript</a></p>
<p><a href="http://nikgrozev.com/2017/10/01/async-await/" target="_blank" rel="nofollow noopener noreferrer">Link tham khảo IKOLAY GROZEV</a>
<a href="https://stackoverflow.com/questions/43302584/why-doesnt-the-code-after-await-run-right-away-isnt-it-supposed-to-be-non-blo" target="_blank" rel="nofollow noopener noreferrer">Why doesn't the code after await run right away? Isn't it supposed to be non-blocking?</a></p>
</div></div></div><div class="post__footer"><div class="post-tags"><a href="/tag/javascript/" class="post-tags__link"><span>#</span> javascript
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-52311ff214b737f722259e901102d6b3'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-52311ff214b737f722259e901102d6b3)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAQUBAQEAAAAAAAAAAAAABwEDBAUGCAAC/8QAMxAAAQMCAwcBBgYDAAAAAAAAAQIDEQAEBRIhBhMxQVFhcQciIzJCgbEIFDORodEWgsH/xAAZAQEBAQEBAQAAAAAAAAAAAAAEAwUGAAH/xAAhEQABBAMAAgMBAAAAAAAAAAABAAIDEQQSISJBBRNRMf/aAAwDAQACEQMRAD8A6Pr1fOalmvLyUAk6AnxS5VROUx4oR%2bvmPXNjZYbhti48DcKUt9LRIJAHsgkaxMmO1ByzxnG8PeQ/a3d5bOIIUVJdUOHMifvWjB8c6aMP2q0CfPbC/TW119SVz9YetmOMLYRfWWH3TaSA4pKVNrWOuhgH6UYtkNrsK2stFvYU65nbjesOpyrbnhPIjuKhPhSwDZw4qw5kU5ph6r%2blpCYFNOLKflV5o1JSXMkDlS5xy1qtDo4mfrWe2/xhWEbJ3t400%2b6oZWyGpkBRiTGoSNJj/tVbEXEN/VMyAC1iPUTaS2xjG3bO3IS3ay2HNJc1lR6xPDx3oa4g0RvVlQcSfhFRLrEF3V0LpSAh10layOMzw7eKl3jqLhxsxLaRw4610MUYiAa1ZMxMosrPugpJJ0nlwiiJ%2bH69eZ28NulfuX7R0LTOhygKB8yKxWLaWoC0BJKpgfL2rdfh8sV3G1F9iBTLNnalGbkFuEADzAVVMpwOO6/xCx4izJaAuiSsT8UV8KKyBznmKih1J714OqIiCa5jVdJsqk4ggL9oRPSqDbty4/w/GnLVzKPyypBkaEif4p5N2RwA/anlPtvsrafAW0tJStChKVA8QR0p4ZqQQil1ilz5Y5nGloXKkcNev908G8iUoSCUiiHtVhFhhdou6wu2O6JyuNg/pzwUCdY5a8JrAXtwErWi3RmIEZwZE9utaccm/QEVzKVZjVrltN4JyJMqFdGemuz7OzmyFjbBGS5eQLm6PMuLAMf6iE/SgBavuMPNOON75wKC0tr4GDPtdqO%2bxm0i8ew0O3O7RfJnett6J4mCnXhH81DNDzGK/i%2b4/wBbZSb7S1xQ2IIVBHWvb2BAIioBcVxMCml3KgYFZQZadtSzAK460hCpkk%2bBTzahmmnXnRA0APmadsj0ol1uE2T6r5SEWgbO9K%2bARGs0H7stto3luczSyS3mEKUJIBI66VrvUnGWlJZwlKsuaHnjmgafCk/f9qwD6y%2b2pbjhKU%2bylWaJ8dabjxmtne0HInolrVcYThj18w5clKzl1KOZ/sVLRtJ%2bQbQ7akpum/01oEA9c3bvULB8WtGbRYuW1vvBOVtTivm48eVUt9Z3dwpKlIbaZIhJQZEdJq7fJxDxxHcdWgxnvtFbZz1ItsQCWMWyWb8hJcn3ZV3Pyz14eK2e9WpUBJoGYHhVpmCQyCtTZBMaHz1oq7DYxvmBh11IeZT7pR%2bZA5eR9vFCyoGs8owm4sz38kK//9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" data-srcset="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript><!----><p class="author__intro">Hiện tại site đang nâng cấp, các bạn xài tạm</p></div></article></div></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2020.</span><span class="footer__links">luckyluu</span></footer></div>
    <script src="/assets/js/app.88e72233.js" defer></script><script src="/assets/js/page--src-templates-post-vue.0d21aba4.js" defer></script>
  </body>
</html>