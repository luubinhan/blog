<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Sử dụng Flow để check type trong React Redux - VuiLapTrinh.com</title><meta name="gridsome:hash" content="bb9d7e5a46c25f220b2fd3c7f9d26cdf170dba2b"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Tutorials, Blog, Hướng dẫn, chia sẽ kinh nghiệm về Frontend, react, vue, ux, ui"><meta data-vue-tag="ssr" name="desc" content="Chúng ta sẽ không nói nhiều cách sử dụng Redux trong bài này, các bạn có thể xem các bài trước, ở đây mình chỉ đi đến vấn đề đưa Flow vào để check type trong Redux"><link rel="preload" href="/blog/assets/css/0.styles.6e7bce94.css" as="style"><link rel="preload" href="/blog/assets/js/app.dd109642.js" as="script"><link rel="preload" href="/blog/assets/js/page--src-templates-post-vue.980fbd47.js" as="script"><link rel="prefetch" href="/blog/assets/js/page--node-modules-gridsome-app-pages-404-vue.b044eecd.js"><link rel="prefetch" href="/blog/assets/js/page--src-pages-index-vue.bd4a2964.js"><link rel="prefetch" href="/blog/assets/js/page--src-templates-tag-vue.4999789e.js"><link rel="stylesheet" href="/blog/assets/css/0.styles.6e7bce94.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/blog/" class="logo active"><span class="logo__text">
    ← VuiLapTrinh.com
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">Sử dụng Flow để check type trong React Redux</h1><div class="post-meta">
  Đăng ngày 2018-09-13.
  
    Mất khoảng
    <strong>4 phút</strong> để đọc.
  </div></div><div class="post content-box"><div class="post__header"><!----></div><div class="post__content"><p><em>Bài viết mang tính chất tham khảo, hiện tại đội ngũ Facebook đã bỏ rơi Flow để theo TypeScript <a href="https://github.com/facebook/jest/pull/7554" target="_blank" rel="nofollow noopener noreferrer">https://github.com/facebook/jest/pull/7554</a></em></p>
<!-- TOC -->
<ul>
<li><a href="#constants">Constants</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#reducer">Reducer</a></li>
</ul>
<!-- /TOC -->
<h1 id="constants"><a href="#constants" aria-hidden="true"><span class="icon icon-link"></span></a>Constants</h1>
<p>constants/actionTypes.js</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* @flow */</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">PLAY</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'PLAY'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">PAUSE</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'PAUSE'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">STOP</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'STOP'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">BACKWARD</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'BACKWARD'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">FORWARD</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'FORWARD'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">UPDATE_TIME</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'UPDATE_TIME'</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">SELECT_TRACK</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'SELECT_TRACK'</span><span class="token punctuation">;</span></code></pre>
<p>Chuyện này có hơi dư thừa vì chúng ta biết chắc chắn các hằng số này sẽ luôn là <code class="language-text">string</code>, có bao giờ chúng ta lại đi đổi giá trị trong constants</p>
<p>Flow cho phép chúng ta khai báo các type sau:</p>
<ul>
<li><strong>string</strong></li>
<li><strong>number</strong></li>
<li><strong>boolean</strong></li>
<li><strong>Function</strong></li>
<li><strong>Array</strong></li>
<li><strong>Object</strong></li>
<li><strong>any</strong></li>
<li><strong>mixed</strong></li>
<li><strong>void</strong></li>
</ul>
<p>Nếu biến có thể <code class="language-text">null</code>, tức không bắt buộc thì thêm dấu <strong>?</strong> vào trước, ?string, ?number, ?boolean</p>
<h1 id="actions"><a href="#actions" aria-hidden="true"><span class="icon icon-link"></span></a>Actions</h1>
<p>playerActions.js </p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token punctuation">{</span>
  <span class="token constant">PLAY</span><span class="token punctuation">,</span>
  <span class="token constant">PAUSE</span><span class="token punctuation">,</span>
  <span class="token constant">STOP</span><span class="token punctuation">,</span>
  <span class="token constant">BACKWARD</span><span class="token punctuation">,</span>
  <span class="token constant">FORWARD</span><span class="token punctuation">,</span>
  <span class="token constant">UPDATE_TIME</span><span class="token punctuation">,</span>
  <span class="token constant">SELECT_TRACK</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'constants/actionTypes'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">PLAY</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">PAUSE</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">STOP</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">backward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">BACKWARD</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FORWARD</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">UPDATE_TIME</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">selectTrack</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">SELECT_TRACK</span><span class="token punctuation">,</span> track <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Với những function thế này, chúng ta phải chỉ định kiểu params truyền vào và kiểu return, mỗi một method chúng ta định nghĩa ra một custom type để sử dụng</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> type <span class="token maybe-class-name">PlayerAction</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> string<span class="token punctuation">;</span>
  track<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Track</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Có thể thấy Track cũng là một custom type khác mà chúng ta định nghĩa ở đâu đó rồi import vào như một module</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> type <span class="token maybe-class-name">Track</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> number<span class="token punctuation">;</span>
  artistId<span class="token operator">:</span> number<span class="token punctuation">;</span>
  title<span class="token operator">:</span> string<span class="token punctuation">;</span>
  key<span class="token operator">:</span> string<span class="token punctuation">;</span>
  bucket<span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Chúng ta sửa lại cái playerActions.js ở trên với Flow</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* @flow */</span>

<span class="token keyword module">import</span> <span class="token punctuation">{</span>
  <span class="token constant">PLAY</span><span class="token punctuation">,</span>
  <span class="token constant">PAUSE</span><span class="token punctuation">,</span>
  <span class="token constant">STOP</span><span class="token punctuation">,</span>
  <span class="token constant">BACKWARD</span><span class="token punctuation">,</span>
  <span class="token constant">FORWARD</span><span class="token punctuation">,</span>
  <span class="token constant">UPDATE_TIME</span><span class="token punctuation">,</span>
  <span class="token constant">SELECT_TRACK</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'constants/actionTypes'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> type <span class="token maybe-class-name">PlayerAction</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> string<span class="token punctuation">;</span>
  currentTime<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  track<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Track</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Import Track type from player, defines the properties a Track object</span>
<span class="token comment">// can have.</span>
<span class="token keyword module">import</span> type <span class="token punctuation">{</span> <span class="token maybe-class-name">Track</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'reducers/player'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">PLAY</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">PAUSE</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">STOP</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">backward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">BACKWARD</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FORWARD</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">UPDATE_TIME</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">selectTrack</span><span class="token punctuation">(</span><span class="token parameter">track<span class="token operator">:</span> <span class="token maybe-class-name">Track</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">SELECT_TRACK</span><span class="token punctuation">,</span> track <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h1 id="reducer"><a href="#reducer" aria-hidden="true"><span class="icon icon-link"></span></a>Reducer</h1>
<p>Một khi đã quen thuộc với cách định nghĩa type cho hàm như trên thì chúng ta sẽ dễ dàng chỉnh sửa lại reducer thôi, vì nó cũng tương tự.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* @flow */</span>

<span class="token keyword module">import</span> <span class="token punctuation">{</span>
  <span class="token constant">PLAY</span><span class="token punctuation">,</span>
  <span class="token constant">PAUSE</span><span class="token punctuation">,</span>
  <span class="token constant">STOP</span><span class="token punctuation">,</span>
  <span class="token constant">BACKWARD</span><span class="token punctuation">,</span>
  <span class="token constant">FORWARD</span><span class="token punctuation">,</span>
  <span class="token constant">UPDATE_TIME</span><span class="token punctuation">,</span>
  <span class="token constant">SELECT_TRACK</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'constants/actionTypes'</span><span class="token punctuation">;</span>

<span class="token comment">// Import the PlayerAction type form the actions/playerActions.js file, much</span>
<span class="token comment">// like we imported the Track type into our action previously.</span>
<span class="token keyword module">import</span> type <span class="token punctuation">{</span> <span class="token maybe-class-name">PlayerAction</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'actions/playerActions'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> type <span class="token maybe-class-name">Track</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> number<span class="token punctuation">;</span>
  artistId<span class="token operator">:</span> number<span class="token punctuation">;</span>
  title<span class="token operator">:</span> string<span class="token punctuation">;</span>
  key<span class="token operator">:</span> string<span class="token punctuation">;</span>
  bucket<span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Create a type alias called Dictionary. This will allow us to define data</span>
<span class="token comment">// that follows the model, a bit superfluous for this example, but good to</span>
<span class="token comment">// understand how it works:</span>
<span class="token comment">// {</span>
<span class="token comment">//   key: value</span>
<span class="token comment">// }</span>
type <span class="token maybe-class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token constant">K</span><span class="token punctuation">,</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// In our PlayerState definition we're also going to</span>
<span class="token comment">// define an instance of the Dictionary type</span>
<span class="token comment">// where the key int he object is a number, and</span>
<span class="token comment">// the value is of type Track.</span>
<span class="token keyword module">export</span> type <span class="token maybe-class-name">PlayerState</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  tracks<span class="token operator">:</span> <span class="token maybe-class-name">Dictonary</span><span class="token operator">&lt;</span>number<span class="token punctuation">,</span> <span class="token maybe-class-name">Track</span><span class="token operator">></span><span class="token punctuation">;</span>
  currentTrackId<span class="token operator">:</span> <span class="token operator">?</span>number<span class="token punctuation">;</span>
  currentTime<span class="token operator">:</span> number<span class="token punctuation">;</span>
  playing<span class="token operator">:</span> boolean<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Declare our initial player state which follows our PlayerState type.</span>
<span class="token keyword">const</span> initialState<span class="token operator">:</span> <span class="token maybe-class-name">PlayerState</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  tracks<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  currentTrackId<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
  currentTime<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  playing<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// This helper method will return the id of the next track</span>
<span class="token comment">// in our playlist. It receives a track dictionary from</span>
<span class="token comment">// the state, and the current track id. It maps out the</span>
<span class="token comment">// data to an array, and finds the next sequential index.</span>
<span class="token keyword">function</span> <span class="token function">getNextTrackId</span><span class="token punctuation">(</span>
  <span class="token parameter">tracks<span class="token operator">:</span> <span class="token maybe-class-name">Dictonary</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Track</span><span class="token punctuation">,</span> number<span class="token operator">></span><span class="token punctuation">,</span>
  currentTrackId<span class="token operator">:</span> number</span>
<span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token keyword">const</span> trackIds <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span>tracks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextTrackIndex <span class="token operator">=</span> trackIds<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>currentTrackId<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>nextTrackIndex <span class="token operator">>=</span> tracks<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextTrackIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> tracksIds<span class="token punctuation">[</span>nextTrackIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// This helper method will return the id of the</span>
<span class="token comment">// previous track in our playlist. It works exactly</span>
<span class="token comment">// like the previous helper function.</span>
<span class="token keyword">function</span> <span class="token function">getPreviousTrackId</span><span class="token punctuation">(</span>
  <span class="token parameter">tracks<span class="token operator">:</span> <span class="token maybe-class-name">Dictonary</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Track</span><span class="token punctuation">,</span> number<span class="token operator">></span><span class="token punctuation">,</span>
  currentTrackId<span class="token operator">:</span> number</span>
<span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token keyword">const</span> trackIds <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span>tracks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextTrackIndex <span class="token operator">=</span> trackIds<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>currentTrackId<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>nextTrackIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextTrackIndex <span class="token operator">=</span> trackIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> trackIds<span class="token punctuation">[</span>nextTrackIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// This is our reducer. There's nothing special to call out</span>
<span class="token comment">// here except that we are declaring our two input types</span>
<span class="token comment">// of PlayerState and PlayerAction, and that we must</span>
<span class="token comment">// return a valid instance of PlayerState.</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function">player</span><span class="token punctuation">(</span>
  <span class="token parameter">state<span class="token operator">:</span> <span class="token maybe-class-name">PlayerState</span> <span class="token operator">=</span> initialState<span class="token punctuation">,</span>
  action<span class="token operator">:</span> <span class="token maybe-class-name">PlayerAction</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PlayerState</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">PLAY</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      playing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token constant">PAUSE</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      playing<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token constant">STOP</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      playing<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      currentTime<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token constant">BACKWARD</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      currentTime<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      currentTrackId<span class="token operator">:</span> <span class="token function">getPreviousTrackId</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">tracks</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span><span class="token property-access">currentTrackId</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token constant">FORWARD</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      currentTime<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      currentTrackId<span class="token operator">:</span> <span class="token function">getNextTrackId</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">tracks</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span><span class="token property-access">currentTrackId</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token constant">UPDATE_TIME</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      currentTime<span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">currentTime</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token constant">SELECT_TRACK</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
      currentTime<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      currentTrackId<span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">track</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword module">default</span><span class="token operator">:</span>
    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Một lợi ích của việc define type mà mình rất thích là nó sẽ có cái hint trên IDE mỗi khi mình dùng gọi đến hàm hay params đó.</p>
<p><a href="/2018-09-10-huong-dan-lam-viec-voi-flow-react-type-checking">Đọc thêm: Tại sao sử dụng Flow, và sử dụng Flow như thế nào trong React</a></p>
<p><a href="https://medium.com/@cdebotton/redux-and-flowtype-69ff1dd09036" target="_blank" rel="nofollow noopener noreferrer">Tài liệu tham khảo</a></p>
</div><div class="post__footer"><div class="post-tags"><a href="/blog/tag/react/" class="post-tags__link"><span>#</span> react
		</a><a href="/blog/tag/redux/" class="post-tags__link"><span>#</span> redux
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-52311ff214b737f722259e901102d6b3'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-52311ff214b737f722259e901102d6b3)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAQUBAQEAAAAAAAAAAAAABwEDBAUGCAAC/8QAMxAAAQMCAwcBBgYDAAAAAAAAAQIDEQAEBRIhBhMxQVFhcQciIzJCgbEIFDORodEWgsH/xAAZAQEBAQEBAQAAAAAAAAAAAAAEAwUGAAH/xAAhEQABBAMAAgMBAAAAAAAAAAABAAIDEQQSISJBBRNRMf/aAAwDAQACEQMRAD8A6Pr1fOalmvLyUAk6AnxS5VROUx4oR%2bvmPXNjZYbhti48DcKUt9LRIJAHsgkaxMmO1ByzxnG8PeQ/a3d5bOIIUVJdUOHMifvWjB8c6aMP2q0CfPbC/TW119SVz9YetmOMLYRfWWH3TaSA4pKVNrWOuhgH6UYtkNrsK2stFvYU65nbjesOpyrbnhPIjuKhPhSwDZw4qw5kU5ph6r%2blpCYFNOLKflV5o1JSXMkDlS5xy1qtDo4mfrWe2/xhWEbJ3t400%2b6oZWyGpkBRiTGoSNJj/tVbEXEN/VMyAC1iPUTaS2xjG3bO3IS3ay2HNJc1lR6xPDx3oa4g0RvVlQcSfhFRLrEF3V0LpSAh10layOMzw7eKl3jqLhxsxLaRw4610MUYiAa1ZMxMosrPugpJJ0nlwiiJ%2bH69eZ28NulfuX7R0LTOhygKB8yKxWLaWoC0BJKpgfL2rdfh8sV3G1F9iBTLNnalGbkFuEADzAVVMpwOO6/xCx4izJaAuiSsT8UV8KKyBznmKih1J714OqIiCa5jVdJsqk4ggL9oRPSqDbty4/w/GnLVzKPyypBkaEif4p5N2RwA/anlPtvsrafAW0tJStChKVA8QR0p4ZqQQil1ilz5Y5nGloXKkcNev908G8iUoSCUiiHtVhFhhdou6wu2O6JyuNg/pzwUCdY5a8JrAXtwErWi3RmIEZwZE9utaccm/QEVzKVZjVrltN4JyJMqFdGemuz7OzmyFjbBGS5eQLm6PMuLAMf6iE/SgBavuMPNOON75wKC0tr4GDPtdqO%2bxm0i8ew0O3O7RfJnett6J4mCnXhH81DNDzGK/i%2b4/wBbZSb7S1xQ2IIVBHWvb2BAIioBcVxMCml3KgYFZQZadtSzAK460hCpkk%2bBTzahmmnXnRA0APmadsj0ol1uE2T6r5SEWgbO9K%2bARGs0H7stto3luczSyS3mEKUJIBI66VrvUnGWlJZwlKsuaHnjmgafCk/f9qwD6y%2b2pbjhKU%2bylWaJ8dabjxmtne0HInolrVcYThj18w5clKzl1KOZ/sVLRtJ%2bQbQ7akpum/01oEA9c3bvULB8WtGbRYuW1vvBOVtTivm48eVUt9Z3dwpKlIbaZIhJQZEdJq7fJxDxxHcdWgxnvtFbZz1ItsQCWMWyWb8hJcn3ZV3Pyz14eK2e9WpUBJoGYHhVpmCQyCtTZBMaHz1oq7DYxvmBh11IeZT7pR%2bZA5eR9vFCyoGs8owm4sz38kK//9k=' /%3e%3c/svg%3e" width="180" data-src="/blog/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" data-srcset="/blog/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/blog/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript><!----><p class="author__intro">Hiện tại site đang nâng cấp, các bạn xài tạm</p></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2020.</span><span class="footer__links">luckyluu</span></footer></div>
    <script src="/blog/assets/js/app.dd109642.js" defer></script><script src="/blog/assets/js/page--src-templates-post-vue.980fbd47.js" defer></script>
  </body>
</html>