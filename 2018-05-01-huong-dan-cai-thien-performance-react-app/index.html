<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Cải thiện performance của React App - VuiLapTrinh.com</title><meta name="gridsome:hash" content="3274fa32f48b39b818211d541fbcf5a00b3e3bc4"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Tutorials, Blog, Hướng dẫn, chia sẽ kinh nghiệm về Frontend, react, vue, ux, ui"><meta data-vue-tag="ssr" name="description" content="Trong bài này, chúng ta cùng đi qua các bước để fix những issue liên quan đến performance thường thấy."><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Cải thiện performance của React App"><meta data-vue-tag="ssr" property="og:description" cotent="Trong bài này, chúng ta cùng đi qua các bước để fix những issue liên quan đến performance thường thấy."><meta data-vue-tag="ssr" property="og:image" content=""><meta data-vue-tag="ssr" property="image" content=""><meta data-vue-tag="ssr" name="twitter:card" content="summary"><meta data-vue-tag="ssr" name="twitter:creator" content="@luubinhan"><meta data-vue-tag="ssr" name="fb:app_id" content="445556375516928"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="16x16" href="/assets/static/luckyluu.ce0531f.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="32x32" href="/assets/static/luckyluu.ac8d93a.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="96x96" href="/assets/static/luckyluu.b9532cc.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="76x76" href="/assets/static/luckyluu.f22e9f3.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="152x152" href="/assets/static/luckyluu.62d22cb.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="120x120" href="/assets/static/luckyluu.1539b60.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="167x167" href="/assets/static/luckyluu.dc0cdc5.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="180x180" href="/assets/static/luckyluu.7b22250.735bb1a8acbae8ddedf73f03eb1579c3.svg"><link rel="preload" href="/assets/css/0.styles.520e5028.css" as="style"><link rel="preload" href="/assets/js/app.06e8aecf.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.614d890f.js" as="script"><link rel="prefetch" href="/assets/js/page--src-pages-404-vue.5ece078c.js"><link rel="prefetch" href="/assets/js/page--src-pages-cheat-sheet-vue.c19fce0d.js"><link rel="prefetch" href="/assets/js/page--src-pages-gop-y-vue.4ea2977a.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.424882d3.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.75b1cac6.js"><link rel="stylesheet" href="/assets/css/0.styles.520e5028.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="fb-root"></div>
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v8.0&appId=445556375516928&autoLogAppEvents=1"
      nonce="NM6X5rUi"
    ></script>
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute("data-theme", newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem("theme");
        } catch (err) {}

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem("theme", newTheme);
          } catch (err) {}
        };

        var darkQuery = window.matchMedia("(prefers-color-scheme: dark)");
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? "dark" : "light");
        });

        setTheme(preferredTheme || (darkQuery.matches ? "dark" : "light"));
      })();
    </script>

    <div id="app" data-server-rendered="true" class="layout-blog"><div class="sidebar" data-v-c8086d88><div class="sidebar__inner" data-v-c8086d88><a href="/" class="go-home active" data-v-c8086d88>VuiLapTrinh.com</a><button type="button" aria-expanded="false" aria-label="nav" class="navbar-toggle collapsed" data-v-c8086d88><div class="hamburger hamburger-1" data-v-c8086d88><span class="line" data-v-c8086d88></span><span class="line" data-v-c8086d88></span><span class="line" data-v-c8086d88></span></div></button><div class="navigation-component" data-v-c8086d88><ul class="nav primary-menu collapsed" data-v-c8086d88><li class="javascript" data-v-c8086d88><a aria-label="Kiến thức Javascript" title="Kiến thức Javascript" target="" data-v-c8086d88><span class="primary-menu__icon" data-v-c8086d88><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" data-v-c8086d88 data-v-c8086d88><path d="M255.908 485.999c-6.116 0-12.323-1.642-17.708-4.746l-56.319-33.316c-8.397-4.747-4.29-6.389-1.551-7.303 11.226-3.925 13.508-4.745 25.465-11.592 1.279-.729 2.922-.457 4.199.366l43.266 25.648c1.552.912 3.741.912 5.202 0l168.592-97.304c1.553-.913 2.555-2.738 2.555-4.563V158.583c0-1.917-1.002-3.651-2.645-4.654L258.463 56.716c-1.551-.913-3.65-.913-5.202 0L84.852 154.019c-1.644.913-2.647 2.738-2.647 4.655v194.515c0 1.825 1.003 3.65 2.647 4.473l46.188 26.653c25.102 12.504 40.436-2.191 40.436-17.068V175.195c0-2.738 2.19-4.837 4.93-4.837h21.359c2.647 0 4.928 2.099 4.928 4.837v192.143c0 33.407-18.256 52.576-49.928 52.576-9.768 0-17.435 0-38.794-10.588l-44.179-25.467c-10.954-6.299-17.708-18.074-17.708-30.76V158.583c0-12.596 6.754-24.462 17.708-30.76L238.2 30.519c10.679-6.024 24.828-6.024 35.416 0l168.594 97.394c10.953 6.298 17.707 18.073 17.707 30.761v194.515c0 12.596-6.754 24.371-17.707 30.761l-168.594 97.303a35.5 35.5 0 01-17.708 4.746zm136.098-191.775c0-36.421-24.646-46.096-76.4-52.941-52.396-6.938-57.689-10.498-57.689-22.729 0-10.131 4.473-23.641 43.266-23.641 34.596 0 47.375 7.485 52.668 30.853.457 2.19 2.467 3.833 4.746 3.833h21.91c1.367 0 2.645-.547 3.559-1.552.914-1.003 1.369-2.373 1.275-3.743-3.375-40.252-30.121-58.965-84.158-58.965-48.103 0-76.764 20.264-76.764 54.311 0 36.876 28.569 47.101 74.664 51.662 55.225 5.387 59.514 13.511 59.514 24.373 0 18.805-15.15 26.835-50.658 26.835-44.635 0-54.403-11.227-57.689-33.406-.365-2.373-2.374-4.107-4.837-4.107h-21.817a4.81 4.81 0 00-4.836 4.836c0 28.39 15.426 62.254 89.271 62.254 53.305-.092 83.975-21.181 83.975-57.873z" fill="#539e43" data-v-c8086d88 data-v-c8086d88></path></svg></span><!----><!----><!----><!----><!----><span class="primary-menu__label" data-v-c8086d88>Javascript</span></a></li><li class="react" data-v-c8086d88><a aria-label="Kiến thức React" title="Kiến thức React" target="" data-v-c8086d88><!----><span class="primary-menu__icon" data-v-c8086d88><svg id="Layer_2" version="1.1" viewBox="0 0 600 600" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" data-v-c8086d88 data-v-c8086d88><circle cx="299.5" cy="299.6" r="50.2" class="st0" data-v-c8086d88 data-v-c8086d88></circle><path d="M299.5 414.6c-70.5 0-132.1-8.3-178.2-24.1-29.9-10.2-55.3-23.8-73.4-39.3-19.2-16.4-29.4-34.3-29.4-51.6 0-33.2 36.4-65.7 97.5-86.9 50-17.4 115.2-27.1 183.4-27.1 67 0 131.3 9.4 181 26.6 29.1 10 53.6 23 71 37.4 18.9 15.8 28.9 33.1 28.9 50 0 34.5-40.7 69.4-106.3 91.1-46.4 15.4-108.4 23.9-174.5 23.9zm0-205c-64.7 0-128.7 9.4-175.5 25.7-56.2 19.6-81.4 46.4-81.4 64.3 0 18.6 27.1 47.9 86.5 68.2 43.6 14.9 102.6 22.8 170.4 22.8 63.6 0 122.9-8 167-22.7 61.7-20.5 89.9-49.8 89.9-68.3 0-9.5-7.2-20.7-20.3-31.6-15.1-12.6-37.1-24.1-63.4-33.2-47.3-16.2-108.8-25.2-173.2-25.2z" class="st0" data-v-c8086d88 data-v-c8086d88></path><path d="M185.6 549.8c-10.2 0-19.2-2.2-26.8-6.6-28.7-16.6-38.7-64.4-26.6-127.9 9.9-52.1 34.1-113.3 68.2-172.4 33.5-58 73.7-109 113.4-143.5 23.2-20.2 46.7-35 67.9-42.8 23.1-8.5 43.1-8.5 57.7-.1 29.9 17.2 39.8 70 25.8 137.6-9.9 48-33.5 105.9-66.5 163.2-35.2 61-73.2 110.2-109.9 142.3-23.8 20.8-48.3 36-70.7 43.9-11.7 4.2-22.7 6.3-32.5 6.3zm25.1-300.9l10.4 6c-32.3 56-56.2 116.1-65.4 164.9-11.1 58.5-.4 93.7 15 102.6 3.8 2.2 8.8 3.4 14.9 3.4 19.9 0 51.2-12.6 87.4-44.2 34.7-30.3 71-77.5 104.9-136.2 31.8-55.1 54.4-110.5 63.8-156 13.1-63.7 1.8-102.7-14.3-112-8.2-4.7-21.5-4.1-37.5 1.8-18.5 6.8-39.4 20.1-60.4 38.4-37.7 32.8-76.2 81.6-108.4 137.4l-10.4-6.1z" class="st0" data-v-c8086d88 data-v-c8086d88></path><path d="M413.4 550.1c-27.2 0-61.7-16.4-97.7-47.4-40.2-34.6-81.1-86.1-115.3-145.2-33.6-58-57.6-118.3-67.7-170-5.9-30.2-7-57.9-3.2-80.2 4.2-24.3 14.1-41.6 28.8-50.1 29.8-17.3 80.5.5 132.1 46.4 36.6 32.5 75 81.9 108.1 139.1 35.3 61 59 118.5 68.4 166.3 6.1 31 7.1 59.8 2.8 83.2-4.6 24.9-15 42.6-30 51.3-7.5 4.4-16.4 6.6-26.3 6.6zM221.2 345.5c32.4 56 72.6 106.7 110.2 139 45.1 38.8 80.9 47.2 96.4 38.2 16.1-9.3 27.9-47.4 15.7-109-9-45.2-31.7-100.2-65.7-158.9-31.9-55.1-68.6-102.4-103.3-133.2-48.6-43.2-88-52.9-104.1-43.6-8.2 4.7-14.3 16.6-17.2 33.4-3.3 19.4-2.3 44.2 3.1 71.5 9.6 49.1 32.6 106.8 64.9 162.6z" class="st0" data-v-c8086d88 data-v-c8086d88></path></svg></span><!----><!----><!----><!----><span class="primary-menu__label" data-v-c8086d88>React</span></a></li><li class="vue" data-v-c8086d88><a aria-label="Kiến thức Vue" title="Kiến thức Vue" target="" data-v-c8086d88><!----><!----><!----><!----><span class="primary-menu__icon" data-v-c8086d88><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" data-v-c8086d88 data-v-c8086d88><path fill="#41b883" d="M392.46 59.011H313.5l-57.499 90.972-49.285-90.972H26.001l230 393.978L485.999 59.011z" data-v-c8086d88 data-v-c8086d88></path><path fill="#35495e" d="M83.192 91.867h55.241l117.568 203.511L373.464 91.867h55.241l-172.704 295.92L83.192 91.867z" data-v-c8086d88 data-v-c8086d88></path></svg></span><!----><span class="primary-menu__label" data-v-c8086d88>Vue</span></a></li><li class="htmlCss" data-v-c8086d88><a aria-label="Kiến thức HTML/CSS" title="Kiến thức HTML/CSS" target="" data-v-c8086d88><!----><!----><!----><span class="primary-menu__icon" data-v-c8086d88><svg version="1.0" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" data-v-c8086d88 data-v-c8086d88><path fill="#E44D26" d="M27.377 28.889L16.001 32 4.625 28.889 2 0h28.002z" data-v-c8086d88 data-v-c8086d88></path><path fill="#FF6C39" d="M16 2v27.75l9.232-2.742L27.688 2z" data-v-c8086d88 data-v-c8086d88></path><path fill="#FFF" d="M24.363 6H7.607L8 10l.619 7h10.884l-.355 3.984L16 21.99l-3.143-1.006L12.648 19H8.803l.459 4.987L16 25.99l6.728-2.004.99-10.986H12.252l-.25-3H24z" data-v-c8086d88 data-v-c8086d88></path></svg></span><!----><!----><span class="primary-menu__label" data-v-c8086d88>HTML/CSS</span></a></li><li class="uxUi" data-v-c8086d88><a aria-label="Kiến thức UX/UI" title="Kiến thức UX/UI" target="" data-v-c8086d88><!----><!----><!----><!----><!----><span class="primary-menu__icon" data-v-c8086d88><svg viewBox="0 0 512 454.633" xmlns="http://www.w3.org/2000/svg" data-v-c8086d88 data-v-c8086d88><path d="M202.271 243.812c-9.741 10.73-12.13 18.428-24.884 38.588 8.237 5.752 24.104 19.055 35.095 41.959 21.953-12.592 32.188-14.514 43.821-24.309C332.24 236.092 518.244 6.836 511.839.204c-6.766-7.05-242.704 170.268-309.568 243.608zM155.442 300.209c-32.998-5.832-65.547 15.028-87.288 67.147C46.382 419.471 7.532 440.337.001 439.061c40.553 14.67 164.202 52.194 194.939-90.655-13.037-34.26-39.498-48.197-39.498-48.197z" data-v-c8086d88 data-v-c8086d88></path></svg></span><span class="primary-menu__label" data-v-c8086d88>UX/UI</span></a></li><li class="about" data-v-c8086d88><a href="https://luubinhan.github.io/" target="_blank" data-v-c8086d88>About</a></li><li data-v-c8086d88><a href="/gop-y" data-v-c8086d88>Góp ý</a></li></ul></div></div><div id="footer" data-v-c8086d88><footer class="footer" data-v-c8086d88><section class="footer-inner" data-v-c8086d88><div class="social-links" data-v-c8086d88><a href="https://www.youtube.com/channel/UC0Te8s0b0aplS1ZoVLfjKHA" target="_blank" rel="noopener noreferrer" class="link-youtube" style="display: none;" data-v-c8086d88><span class="link-youtube__icon" data-v-c8086d88><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" data-v-c8086d88 data-v-c8086d88><path d="M512 256c0 141.4-114.6 256-256 256S0 397.4 0 256 114.6 0 256 0s256 114.6 256 256z" fill="#CD201F" data-v-c8086d88 data-v-c8086d88></path><path d="M391.1 194.6c-2.3-19.9-7.1-25.7-10.5-28.4-5.4-4.2-15.2-5.7-28.3-6.6-21-1.4-56.7-2.3-95.2-2.3-38.6 0-74.2.8-95.2 2.3-13.1.9-22.9 2.4-28.3 6.6-3.4 2.7-8.1 8.5-10.5 28.4-3.4 28.7-3.4 94.1 0 122.8 2.4 19.9 7.1 25.7 10.5 28.4 5.4 4.2 15.2 5.7 28.3 6.6 21 1.4 56.6 2.3 95.2 2.3s74.2-.9 95.2-2.3c13.1-.9 22.9-2.4 28.3-6.6 3.4-2.6 8.1-8.5 10.5-28.4 3.4-28.7 3.4-94.1 0-122.8zm-167 104.3V213l82.4 42.9-82.4 43z" fill="#FFF" data-v-c8086d88 data-v-c8086d88></path></svg></span>
            Youtube
          </a></div><div class="credit" data-v-c8086d88>Copyright © 2019. luckyluu</div></section></footer></div></div><div class="master"><main class="inner"><div class="master__search"><div class="search-wrapper"><div class="mb-2"><div class="post-tags"><a href="/tag/javascript" class="post-tags__link"><span>#</span>
    Javascript
  </a><a href="/tag/dam-dao" class="post-tags__link"><span>#</span>
    Đàm đạo chém gió chuyện nghề
  </a><a href="/tag/css" class="post-tags__link"><span>#</span>
    CSS từ căn bản tới nâng cao
  </a><a href="/tag/thu-thuat" class="post-tags__link"><span>#</span>
    Thủ thuật
  </a><a href="/tag/hoc-thuat" class="post-tags__link"><span>#</span>
    Kiến thức nền tảng
  </a><a href="/tag/react" class="post-tags__link"><span>#</span>
    React
  </a><a href="/tag/vuejs" class="post-tags__link"><span>#</span>
    Vue JS
  </a><a href="/tag/chrome" class="post-tags__link"><span>#</span>
    Chrome DevTools
  </a></div></div><div class="search__container"><input type="text" placeholder="Tìm bài viết..." value="" class="search__input"><!----></div><div class="search__list"><!----><!----></div></div></div><div class="single-post"><div class="single-post-container"><article><header><div class="post-title"><h1 class="post-title__text single-post-title">
              Cải thiện performance của React App
            </h1><div class="post-meta">
  Đăng ngày
  <time dateTime="2018-05-01" itemprop="dateModified" content="2018-05-01">2018-05-01</time>.
  
    Mất khoảng
    <strong>7 phút</strong> để đọc.
  </div></div></header><div class="post content-box"><div class="post__header"><!----></div><div class="blog-post"><div class="post-content"><!-- TOC -->
<ul>
<li><a href="#x%C3%A1c-%C4%91%E1%BB%8Bnh-c%C3%A1c-tr%C6%B0%E1%BB%9Dng-h%E1%BB%A3p-render-kh%C3%B4ng-c%E1%BA%A7n-thi%E1%BA%BFt">Xác định các trường hợp render không cần thiết</a></li>
<li><a href="#t%C3%A1ch-c%C3%A1c-component-update-th%C6%B0%E1%BB%9Dng-xuy%C3%AAn-th%C3%A0nh-c%C3%A1c-component-%C4%91%E1%BB%99c-l%E1%BA%ADp">Tách các component update thường xuyên thành các component độc lập</a></li>
<li><a href="#shouldcomponentupdate-v%C3%A0-purecomponent"><code class="language-text">shouldComponentUpdate</code> và PureComponent</a></li>
<li><a href="#tr%C3%A1nh-vi%E1%BB%87c-%C4%91%C6%B0a-m%E1%BB%99t-object-m%E1%BB%9Bi-nh%C6%B0-l%C3%A0-prop">Tránh việc đưa một object mới như là prop</a></li>
<li><a href="#production">Production</a></li>
<li><a href="#code-splitting">Code splitting</a></li>
<li><a href="#thay-%C4%91%E1%BB%95i-dom-qu%C3%A1-nhi%E1%BB%81u-l%E1%BA%A7n">Thay đổi DOM quá nhiều lần</a></li>
<li><a href="#callback">Callback</a></li>
</ul>
<!-- /TOC -->
<p>Toàn bộ source app ví dụ có thể lấy <a href="https://github.com/ohansemmanuel/Cardie-performace" target="_blank" rel="nofollow noopener noreferrer">ở đây https://github.com/ohansemmanuel/Cardie-performace</a>, khuyến khích các bạn nên tự lấy về và vọc.</p>
<p>Chạy lên nó sẽ có như vầy</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Yh4h7wXPOcbaDBKdVJxm-g.png" alt="Cải thiện performance của React App"></p>
<p>Khi click vào button nó sẽ update lại thông tin nghề nghiệp</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*o-8SuFxH2Tl37JG-wSOj0g.gif" alt="Cải thiện performance của React App"></p>
<h1 id="xác-định-các-trường-hợp-render-không-cần-thiết"><a href="#x%C3%A1c-%C4%91%E1%BB%8Bnh-c%C3%A1c-tr%C6%B0%E1%BB%9Dng-h%E1%BB%A3p-render-kh%C3%B4ng-c%E1%BA%A7n-thi%E1%BA%BFt" aria-hidden="true"><span class="icon icon-link"></span></a>Xác định các trường hợp render không cần thiết</h1>
<p>Phương pháp đơn giản nhất để kiểm tra là bật nút <code class="language-text">highlight update</code> trên React Dev tool.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*jfeS12BHr2dt5ooLeh5u3Q.gif" alt="Cải thiện performance của React App"></p>
<p>Cái viền màu xanh hiển thị xung quanh component cho biết nó đang gọi render.</p>
<p>Trong ví dụ này có thể thấy nguyên component <code class="language-text">App</code> được re-render, không đúng như chúng ta mong muốn.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*ofXx-J4tr7KXXlNozuW9OA.gif" alt="Cải thiện performance của React App"></p>
<p>Tốt nhất là đúng cái phần hiển thị thông tin nghề nghiệp gọi render.</p>
<h1 id="tách-các-component-update-thường-xuyên-thành-các-component-độc-lập"><a href="#t%C3%A1ch-c%C3%A1c-component-update-th%C6%B0%E1%BB%9Dng-xuy%C3%AAn-th%C3%A0nh-c%C3%A1c-component-%C4%91%E1%BB%99c-l%E1%BA%ADp" aria-hidden="true"><span class="icon icon-link"></span></a>Tách các component update thường xuyên thành các component độc lập</h1>
<p>Sau khi đã bắt được component nào đang re-render không cần thiết, tách component này theo phương pháp sau</p>
<p>Component <code class="language-text">App</code> connect với redux store bằng hàm <code class="language-text">connect</code>, nó nhận các props là <code class="language-text">name</code>, <code class="language-text">location</code>, <code class="language-text">likes</code> và <code class="language-text">description</code></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*EQLJ8lXEchp_USFfj2Em7A.png" alt="Cải thiện performance của React App"></p>
<p>Khi user click cái button, cái description bị thay đổi. Nó làm cho component <code class="language-text">App</code> re-render.</p>
<p>Nhớ lại kiến thức căn bản React, khi prop hoặc state thay đổi, cây virtual DOM được update</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*rv3Y1Au-GarKtoiTJSmWRA.png" alt="Cải thiện performance của React App">
<img src="https://cdn-images-1.medium.com/max/800/1*x6NfWjAOcqwoZs2GhbdTZw.png" alt="Cải thiện performance của React App">
<img src="https://cdn-images-1.medium.com/max/800/1*EpSSnv8Wjql-IcrNvzvz_A.png" alt="Cải thiện performance của React App"></p>
<p>Giờ để xử lý, chúng ta tạo một component mới, đặt là <code class="language-text">Profession</code>, để render thông tin description, chúng ta cần tổ chức lại để có cây virtual DOM như thế này</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*g8w3av5rclzcX9N387nxgQ.png" alt="Cải thiện performance của React App">
<img src="https://cdn-images-1.medium.com/max/1600/1*0kqtSR4WxvGy4yYBKyReIw.png" alt="Cải thiện performance của React App"></p>
<p>Thay vì <code class="language-text">&lt;App /&gt;</code> nhận prop là <code class="language-text">profession</code>, chuyển trách nhiệm này cho <code class="language-text">&lt;Profession /&gt;</code></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*tLbbgUgBavBm6FMpOzqL7Q.png" alt="Cải thiện performance của React App"></p>
<p>Kết quả sau khi tách component</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Poo-6-5-bfYQ0qYBcXoyiw.gif" alt="Cải thiện performance của React App"></p>
<h1 id="shouldcomponentupdate-và-purecomponent"><a href="#shouldcomponentupdate-v%C3%A0-purecomponent" aria-hidden="true"><span class="icon icon-link"></span></a><code class="language-text">shouldComponentUpdate</code> và PureComponent</h1>
<p>Các bài viết liên quan đến chủ đề performance, chắc chắn sẽ nhắc đến <code class="language-text">PureComponent</code>, bài này cũng không ngoại lệ.</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>Điều gì bạn cần quan tâm khi khai báo một component là <code class="language-text">PureComponent</code>? Đó là việc mất đi hàm <code class="language-text">shouldComponentUpdate</code>. Về nguyên tắc nó chỉ render lại khi <code class="language-text">prop</code> thay đổi</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Description</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> description <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>faint<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">I am</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text"> a </span><span class="token punctuation">{</span>description<span class="token punctuation">}</span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span></code></pre>
<p>Tác giả bài viết này còn chia nhỏ hơn nữa</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Description</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> description <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">I</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Am</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profession</span></span> <span class="token attr-name">profession</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>description<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*TpXci0NJ24imQqmsc7S-_A.png" alt="Cải thiện performance của React App"></p>
<p>Chúng ta cần nhớ lại 1 lần nữa: React định nghĩa thế nào là một PureComponent?</p>
<p>Hãy thử xem xét cách viết <code class="language-text">shouldComponentUpdate</code></p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ShouldNotUpdate</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">counter</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span> <span class="token operator">!==</span> nextProps<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I should be rendered only 1 time. actual times rendered: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">counter</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Kết quả trả về sẽ không phải counter = 1, nghĩa là hàm render thực sự sẽ chạy rất nhiều lần, tại sao lại vậy? bởi vì <code class="language-text">this.props.children !== nextProps.children</code> sẽ luôn luôn trả về <code class="language-text">true</code>, React sẽ tạo ra một instance mới, 1 <strong>ReactElement mới</strong> mỗi khi render</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ShouldNotUpdate</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">counter</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I should be rendered only 1 time. actual times rendered: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">counter</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Số lần render vẫn không giảm đi, tại sao? Đọc tiếp sẽ rõ.</p>
<h1 id="tránh-việc-đưa-một-object-mới-như-là-prop"><a href="#tr%C3%A1nh-vi%E1%BB%87c-%C4%91%C6%B0a-m%E1%BB%99t-object-m%E1%BB%9Bi-nh%C6%B0-l%C3%A0-prop" aria-hidden="true"><span class="icon icon-link"></span></a>Tránh việc đưa một object mới như là prop</h1>
<p>Nó sẽ xảy ra tình huống là <code class="language-text">prop</code> không thay đổi, nhưng React nghĩ là nó đã thay đổi, nên render lại. Ví dụ</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">I</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>faint<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">i</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// đâu đó truyền vào </span>
<span class="token keyword">class</span> <span class="token class-name">Description</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> i <span class="token operator">=</span> <span class="token punctuation">{</span>
	  value<span class="token operator">:</span> <span class="token string">"i"</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">I</span></span> <span class="token attr-name">i</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
	    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Am</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
	    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
	    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profession</span></span> <span class="token attr-name">profession</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*NymA8dLgtXQIHhk7AI2LzQ.png" alt="Cải thiện performance của React App"></p>
<p>Ngay cả khi <code class="language-text">&lt;I /&gt;</code> là một PureComponent, nó vẫn render khi <code class="language-text">profession</code> thay đổi.</p>
<p>Tại sao?</p>
<p>Khi <code class="language-text">&lt;Description /&gt;</code> nhận một prop mới, hàm render được gọi</p>
<p>Khi đến đoạn này <code class="language-text">&lt;I i={i} /&gt;</code>, giá trị của <code class="language-text">i</code> là một object hoàn toàn mới</p>
<p>Với <code class="language-text">PureComponent</code> nó chỉ dùng <strong>shallow compare</strong> giữa prop cũ và mới, tức là <code class="language-text">string</code> và <code class="language-text">number</code> thì so sánh theo giá trị, còn <code class="language-text">object</code> so sánh theo tham chiếu đến vùng nhớ</p>
<p>Giá trị của <code class="language-text">i</code> không khác, nhưng thực sự nó đã tham chiếu đến vùng nhớ khác</p>
<p>Điều này cũng giải thích cho việc tại sao cách làm như thế này không được khuyến khích</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token function"><span class="token maybe-class-name">Render</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/*do something*/</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>Function cũng là một <code class="language-text">object</code>, bạn đang truyền vào một <code class="language-text">object</code> mỗi lần render</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Do this, please</span>
<span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h1 id="production"><a href="#production" aria-hidden="true"><span class="icon icon-link"></span></a>Production</h1>
<p>Deploy thì luôn build bằng production nhỉ, ngoài ra ở phía server nên nén lại bằng Gzip. Nếu dùng Node/Express ở backend, cài thêm module <code class="language-text">compression</code> và sử dụng như Express middleware</p>
<h1 id="code-splitting"><a href="#code-splitting" aria-hidden="true"><span class="icon icon-link"></span></a>Code splitting</h1>
<p>Cái này mình có hướng dẫn rồi, đọc lại <a href="/2018-10-07-huong-dan-lazy-load-component-react">ở đây</a></p>
<h1 id="thay-đổi-dom-quá-nhiều-lần"><a href="#thay-%C4%91%E1%BB%95i-dom-qu%C3%A1-nhi%E1%BB%81u-l%E1%BA%A7n" aria-hidden="true"><span class="icon icon-link"></span></a>Thay đổi DOM quá nhiều lần</h1>
<p>Có bao giờ bạn từng sử dụng một <em>component</em> nhiều lần trong app, cảm thấy app hơi lag? Animation cảm giác chạy không mượt?</p>
<p>Khi xây các component phức tạp, bạn sẽ phải xử lý DOM một chút, khả năng sẽ vướng vào 2 issue sau</p>
<ol>
<li><a href="https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing" target="_blank" rel="nofollow noopener noreferrer">Trigger layout</a></li>
<li><a href="https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing#avoid_layout_thrashing" target="_blank" rel="nofollow noopener noreferrer">Layout Thrashing</a></li>
</ol>
<p>Hãy chạy thử hiệu ứng đang làm cho một component <strong>Collapse</strong> với khoản vài chục cái instance, sau đó chọn 6x slowdown trên dev tool để thấy sự khác biệt, 6x slowdown là giá trị tương ứng với tốc độ khi xem trên điện thoại</p>
<p><a href="https://cdn-images-1.medium.com/max/800/1*2xOju9iTPGs22U0joILHmQ.png" target="_blank" rel="nofollow noopener noreferrer">Cải thiện performance của React App</a></p>
<p>Component <strong>Collapse</strong>, ta thường sẽ làm là thay đổi độ cao của nó</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token function">updateHeight</span><span class="token punctuation">(</span><span class="token parameter">isOpen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">containerEl</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">contentEl</span><span class="token punctuation">.</span><span class="token property-access">scrollHeight</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">containerEl</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> <span class="token string">'0px'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Có 2 điểm cần lưu ý</p>
<ol>
<li>Chúng ta thay đổi <em>height</em>, là chúng ta trigger chuyện sắp xếp lại Layout. Nếu chúng ta thay đổi <code class="language-text">transform</code>, chúng ta chỉ sẽ trigger <strong>Composite</strong> và nhìn nó sẽ smooth hơn.</li>
<li>Dòng <code class="language-text">this.containerEl.style.height = ${this.contentEl.scrollHeight}px;</code> là một ví dụ điển hình của <strong>Layout Thrashing</strong>, chúng ta đọc giá trị độ cao hiện tại, rồi lấy giá trị đó update cho một đối tượng DOM, nhân số lần này lên với số lượng component <strong>Collapse</strong> sẽ là một số lần đáng quan tâm. Sẽ tốt hơn nếu chúng ta chỉ đọc một lần rồi gán giá trị một lượt luôn.</li>
</ol>
<pre class="language-jsx"><code class="language-jsx"><span class="token function">updateHeight</span><span class="token punctuation">(</span><span class="token parameter">isOpen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastRAF</span> <span class="token operator">&amp;&amp;</span> <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastRAF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastRAF</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// đọc</span>
      <span class="token keyword">const</span> height <span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">contentEl</span><span class="token punctuation">.</span><span class="token property-access">scrollHeight</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastRAF</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastRAF</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token comment">// gán giá trị</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">containerEl</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> height<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastRAF</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">containerEl</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> <span class="token string">'0px'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Có thể sử dụng thư viện <a href="https://github.com/wilsonpage/fastdom" target="_blank" rel="nofollow noopener noreferrer">Fastdom</a> thay vì tự viết</p>
<h1 id="callback"><a href="#callback" aria-hidden="true"><span class="icon icon-link"></span></a>Callback</h1>
<p>Khi attach một function vào bất kỳ event nào trong DOM, nếu có thêm <code class="language-text">debounced</code> hoặc <code class="language-text">throttled</code> sẽ tốt hơn, giảm tải số lần gọi đến function này đến mức thấp nhất.</p>
<p>Cách viết rất thường thấy</p>
<pre class="language-js"><code class="language-js"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token method function property-access">throttle</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>Nhưng tại sao không sử dụng nó trong component callback?</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">class</span> <span class="token class-name">UnleashedOne</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChange</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onChange</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token method function property-access">onChange</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChange</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Chúng ta đang lắng nghe tất tần tật mỗi khi có thay đổi trên <code class="language-text">input</code>, như vậy thực sự có cần thiết không?</p>
<p>Để giải quyết vấn đề trên, có thể viết lại component</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">class</span> <span class="token class-name">LeashedOne</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChange</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onChange</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChangeDebounce</span> <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token method function property-access">debounce</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token method function property-access">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onChangeDebounce</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChange</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Đợi user nhập xong đi rồi xử lý sự kiện, ở đây sử dụng <code class="language-text">_.debounce</code>, <code class="language-text">_.throttle</code> từ thư viện <strong>lodash</strong>, sự khác nhau của 2 thằng này thì đọc thêm trên docs của lodash.</p>
<p>Nếu bị nghiện performance, bạn có thể chia sẻ thêm một số tip với mình.</p>
<p>Tham khảo thêm </p>
<ul>
<li><a href="/2018-09-19-huong-dan-react-profiler-dev-tool">Giới thiệu React Profiler</a></li>
</ul>
<p>Tài liệu tham khảo</p>
<ul>
<li><a href="https://medium.com/myheritage-engineering/how-to-greatly-improve-your-react-app-performance-e70f7cbbb5f6" target="_blank" rel="nofollow noopener noreferrer">https://medium.com/myheritage-engineering/how-to-greatly-improve-your-react-app-performance-e70f7cbbb5f6</a></li>
<li><a href="https://logrocket-blog.ghost.io/death-by-a-thousand-cuts-a-checklist-for-eliminating-common-react-performance-issues/" target="_blank" rel="nofollow noopener noreferrer">https://logrocket-blog.ghost.io/death-by-a-thousand-cuts-a-checklist-for-eliminating-common-react-performance-issues/</a></li>
</ul>
</div></div><div class="post__footer"><div class="post-tags"><a href="/tag/javascript/" class="post-tags__link"><span>#</span>
    javascript
  </a><a href="/tag/react/" class="post-tags__link"><span>#</span>
    react
  </a><a href="/tag/performance/" class="post-tags__link"><span>#</span>
    performance
  </a></div></div><div class="single-post__share"><a class="share-network-email" style="background-color:#333333;"><i class="mst-icon icon-mail"></i><span>Email</span></a><a class="share-network-facebook" style="background-color:#1877f2;"><i class="mst-icon icon-facebook"></i><span>Facebook</span></a><a class="share-network-linkedin" style="background-color:#007bb5;"><i class="mst-icon icon-linkedin"></i><span>LinkedIn</span></a><a class="share-network-pocket" style="background-color:#ef4056;"><i class="mst-icon icon-get-pocket"></i><span>Pocket</span></a><a class="share-network-skype" style="background-color:#00aff0;"><i class="mst-icon icon-skype"></i><span>Skype</span></a><a class="share-network-twitter" style="background-color:#1da1f2;"><i class="mst-icon icon-twitter"></i><span>Twitter</span></a></div></div></article><div class="section-below-post"><div class="post-comments"><div data-href="https://vuilaptrinh.com/2018-05-01-huong-dan-cai-thien-performance-react-app/" data-numposts="10" data-width="100%" class="fb-comments"></div><div id="disqus_thread" style="min-height:200px;"></div></div><div class="related-posts"><h4>Bài liên quan</h4><ul class="related-posts__container"><li class="related-posts__media"><div class="related-posts__index">1.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/2019-06-17-huong-dan-toi-uu-hieu-nang-react-app/">3 bước tối ưu hiệu năng React App bằng các API mới của React</a></h4><p>Bài viết hướng dẫn tối ưu hiệu năng bằng memo, useMemo, useCallback</p></div></li><li class="related-posts__media"><div class="related-posts__index">2.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/2019-12-14-thu-thuat-tang-toc-bang-json-parse/">Ứng dụng JSON.parse để cải thiện tốc độ?</a></h4><p>Thủ thuật để cải thiện tốc độ bằng JSON.parse</p></div></li><li class="related-posts__media"><div class="related-posts__index">3.</div><div class="related-posts__content"><h4 class="related-posts__title"><a href="/2019-07-13-nguyen-tac-moi-lap-trinh-vien-can-biet/">10 nguyên lý lập trình nền tảng mà lập trình viên nào cũng cần biết</a></h4><p>Nhớ thời đại học quá nên ôn lại kiến thức vở lòng mấy bạn ơi</p></div></li></ul></div><div class="author post-author"><a href="https://luubinhan.github.io/" target="_blank"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-52311ff214b737f722259e901102d6b3'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-52311ff214b737f722259e901102d6b3)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAHAAAAQUBAQEAAAAAAAAAAAAABwEDBAUGCAAC/8QAMxAAAQMCAwcBBgYDAAAAAAAAAQIDEQAEBRIhBhMxQVFhcQciIzJCgbEIFDORodEWgsH/xAAZAQEBAQEBAQAAAAAAAAAAAAAEAwUGAAH/xAAhEQABBAMAAgMBAAAAAAAAAAABAAIDEQQSISJBBRNRMf/aAAwDAQACEQMRAD8A6Pr1fOalmvLyUAk6AnxS5VROUx4oR%2bvmPXNjZYbhti48DcKUt9LRIJAHsgkaxMmO1ByzxnG8PeQ/a3d5bOIIUVJdUOHMifvWjB8c6aMP2q0CfPbC/TW119SVz9YetmOMLYRfWWH3TaSA4pKVNrWOuhgH6UYtkNrsK2stFvYU65nbjesOpyrbnhPIjuKhPhSwDZw4qw5kU5ph6r%2blpCYFNOLKflV5o1JSXMkDlS5xy1qtDo4mfrWe2/xhWEbJ3t400%2b6oZWyGpkBRiTGoSNJj/tVbEXEN/VMyAC1iPUTaS2xjG3bO3IS3ay2HNJc1lR6xPDx3oa4g0RvVlQcSfhFRLrEF3V0LpSAh10layOMzw7eKl3jqLhxsxLaRw4610MUYiAa1ZMxMosrPugpJJ0nlwiiJ%2bH69eZ28NulfuX7R0LTOhygKB8yKxWLaWoC0BJKpgfL2rdfh8sV3G1F9iBTLNnalGbkFuEADzAVVMpwOO6/xCx4izJaAuiSsT8UV8KKyBznmKih1J714OqIiCa5jVdJsqk4ggL9oRPSqDbty4/w/GnLVzKPyypBkaEif4p5N2RwA/anlPtvsrafAW0tJStChKVA8QR0p4ZqQQil1ilz5Y5nGloXKkcNev908G8iUoSCUiiHtVhFhhdou6wu2O6JyuNg/pzwUCdY5a8JrAXtwErWi3RmIEZwZE9utaccm/QEVzKVZjVrltN4JyJMqFdGemuz7OzmyFjbBGS5eQLm6PMuLAMf6iE/SgBavuMPNOON75wKC0tr4GDPtdqO%2bxm0i8ew0O3O7RfJnett6J4mCnXhH81DNDzGK/i%2b4/wBbZSb7S1xQ2IIVBHWvb2BAIioBcVxMCml3KgYFZQZadtSzAK460hCpkk%2bBTzahmmnXnRA0APmadsj0ol1uE2T6r5SEWgbO9K%2bARGs0H7stto3luczSyS3mEKUJIBI66VrvUnGWlJZwlKsuaHnjmgafCk/f9qwD6y%2b2pbjhKU%2bylWaJ8dabjxmtne0HInolrVcYThj18w5clKzl1KOZ/sVLRtJ%2bQbQ7akpum/01oEA9c3bvULB8WtGbRYuW1vvBOVtTivm48eVUt9Z3dwpKlIbaZIhJQZEdJq7fJxDxxHcdWgxnvtFbZz1ItsQCWMWyWb8hJcn3ZV3Pyz14eK2e9WpUBJoGYHhVpmCQyCtTZBMaHz1oq7DYxvmBh11IeZT7pR%2bZA5eR9vFCyoGs8owm4sz38kK//9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" data-srcset="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.95c26cbf81b488daf3af4259c9393a66.jpg" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript></a><h2 class="author__site-title">VuiLapTrinh.com</h2><p class="author__intro">Nếu đọc bài viết thấy hay, bạn xài bớt cái bọc ni lông, ra đường mua tờ vé số giúp các cô các bác là đã cảm ơn mình</p></div></div></div></div></main></div><div class="layout-blog__aside"><div class="layout-blog__aside-inner"><div class="search-wrapper"><div class="mb-2"><div class="post-tags"><a href="/tag/javascript" class="post-tags__link"><span>#</span>
    Javascript
  </a><a href="/tag/dam-dao" class="post-tags__link"><span>#</span>
    Đàm đạo chém gió chuyện nghề
  </a><a href="/tag/css" class="post-tags__link"><span>#</span>
    CSS từ căn bản tới nâng cao
  </a><a href="/tag/thu-thuat" class="post-tags__link"><span>#</span>
    Thủ thuật
  </a><a href="/tag/hoc-thuat" class="post-tags__link"><span>#</span>
    Kiến thức nền tảng
  </a><a href="/tag/react" class="post-tags__link"><span>#</span>
    React
  </a><a href="/tag/vuejs" class="post-tags__link"><span>#</span>
    Vue JS
  </a><a href="/tag/chrome" class="post-tags__link"><span>#</span>
    Chrome DevTools
  </a></div></div><div class="search__container"><input type="text" placeholder="Tìm bài viết..." value="" class="search__input"><!----></div><div class="search__list"><!----><!----></div></div><div class="layout-blog__aside-footer"></div></div></div></div> <script src="/assets/js/app.06e8aecf.js" defer></script><script src="/assets/js/page--src-templates-post-vue.614d890f.js" defer></script>
  </body>
</html>
